(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,64335,e=>{"use strict";var s=e.i(15620),t=e.i(73956),r=e.i(90477),i=e.i(12737);async function n(){let{data:e,error:s}=await (0,i.request)("/stripe/accounts",{method:"GET"});if(s)throw Error(s);return e}async function a(){let{data:e,error:s}=await (0,i.request)("/stripe/stats?force_refresh=true",{method:"GET"});if(s)throw Error(s);if(!e)throw Error("Stats not found");return e}async function l(e){let{data:s,error:t}=await (0,i.request)("/stripe/accounts",{method:"POST",data:e});if(t)throw Error(t);if(!s)throw Error("Failed to create account");return s}async function o(e,s){let{data:t,error:r}=await (0,i.request)(`/stripe/accounts/${e}`,{method:"PATCH",data:s});if(r)throw Error(r);if(!t)throw Error("Failed to update account");return t}async function c(e){let{error:s}=await (0,i.request)(`/stripe/accounts/${e}`,{method:"DELETE"});if(s)throw Error(s)}async function d(e){let s=e?`/stripe/products?accountId=${e}`:"/stripe/products",{data:t,error:r}=await (0,i.request)(s);if(r)throw Error(r);return t||[]}async function u(e){let{data:s,error:t}=await (0,i.request)("/stripe/products",{method:"POST",data:{accountId:e}});if(t)throw Error(t);if(!s)throw Error("Failed to sync products");return s}function m(){return(0,s.useQuery)({queryKey:["stripe-accounts"],queryFn:n})}function p(){return(0,s.useQuery)({queryKey:["stripe-stats"],queryFn:()=>a()})}function x(){let e=(0,r.useQueryClient)();return(0,t.useMutation)({mutationFn:e=>l(e),onSuccess:()=>{e.invalidateQueries({queryKey:["stripe-accounts"]})}})}function h(e){let s=(0,r.useQueryClient)();return(0,t.useMutation)({mutationFn:s=>o(e,s),onSuccess:()=>{s.invalidateQueries({queryKey:["stripe-accounts"]}),s.invalidateQueries({queryKey:["stripe-account",e]})}})}function f(){let e=(0,r.useQueryClient)();return(0,t.useMutation)({mutationFn:e=>c(e),onSuccess:()=>{e.invalidateQueries({queryKey:["stripe-accounts"]})}})}function j(e){return(0,s.useQuery)({queryKey:e?["products",e]:["products"],queryFn:()=>d(e)})}function v(){let e=(0,r.useQueryClient)();return(0,t.useMutation)({mutationFn:e=>u(e),onSuccess:(s,t)=>{e.invalidateQueries({queryKey:["products"]}),e.invalidateQueries({queryKey:["products",t]}),e.invalidateQueries({queryKey:["stripe-accounts"]})}})}e.s(["useCreateStripeAccount",()=>x,"useDeleteStripeAccount",()=>f,"useProducts",()=>j,"useStripeAccounts",()=>m,"useStripeStats",()=>p,"useSyncProducts",()=>v,"useUpdateStripeAccount",()=>h],64335)},24405,e=>{"use strict";var s=e.i(47132),t=e.i(74248),r=e.i(64335),i=e.i(39803),n=e.i(42460),a=e.i(6505),l=e.i(65474);let o=(0,l.default)("refresh-cw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);var c=e.i(64869);let d=(0,l.default)("package",[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]]),u=(0,l.default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]),m=(0,l.default)("clock",[["path",{d:"M12 6v6l4 2",key:"mmk7yg"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]),p=(0,l.default)("external-link",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]),x=(0,l.default)("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]),h=(0,l.default)("layers",[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]]);var f=e.i(25336),j=e.i(98863),v=e.i(95993);let y=v.z.object({name:v.z.string().min(1,"Le nom est requis"),description:v.z.string().optional().nullable(),apiKey:v.z.string().min(1,"La clé API est requise"),webhookSecret:v.z.string().optional().nullable(),isActive:v.z.boolean().default(!0).nonoptional()});v.z.object({stripeAccountId:v.z.string().min(1,"Le compte Stripe est requis"),stripeProductId:v.z.string().min(1,"L'ID produit Stripe est requis"),stripePriceId:v.z.string().optional().nullable(),name:v.z.string().min(1,"Le nom est requis"),description:v.z.string().optional().nullable(),price:v.z.string().optional().nullable(),currency:v.z.string().default("EUR"),isRecurring:v.z.boolean().default(!1),billingPeriod:v.z.string().optional().nullable(),isActive:v.z.boolean().default(!0).nonoptional()});var g=e.i(45045),b=e.i(53507),N=e.i(28717),w=e.i(24123),S=e.i(9194);function k({open:e,onOpenChange:n,initialData:a,accountId:l}){let o=(0,r.useCreateStripeAccount)(),c=(0,r.useUpdateStripeAccount)(l||""),d=(0,f.useForm)({resolver:(0,j.zodResolver)(y),defaultValues:a||{name:"",description:"",apiKey:"",webhookSecret:"",isActive:!0}});(0,t.useEffect)(()=>{a?d.reset({...a}):d.reset({name:"",description:"",apiKey:"",webhookSecret:"",isActive:!0})},[a,d]);let u=async e=>{let s=l?c:o;w.toast.promise(s.mutateAsync(e).then(()=>{n(!1),d.reset()}),{loading:l?"Mise à jour...":"Ajout...",success:l?"Compte Stripe mis à jour !":"Compte Stripe ajouté !",error:e=>"Erreur: "+e.message})},m=o.isPending||c.isPending;return(0,s.jsx)(g.Dialog,{open:e,onOpenChange:n,children:(0,s.jsxs)(g.DialogContent,{className:"max-w-2xl",children:[(0,s.jsx)(g.DialogHeader,{children:(0,s.jsx)(g.DialogTitle,{children:l?"Modifier le compte Stripe":"Ajouter un compte Stripe"})}),(0,s.jsx)(b.Form,{...d,children:(0,s.jsxs)("form",{onSubmit:d.handleSubmit(u),className:"space-y-4",children:[(0,s.jsx)(b.FormField,{control:d.control,name:"name",render:({field:e})=>(0,s.jsxs)(b.FormItem,{children:[(0,s.jsx)(b.FormLabel,{children:"Nom *"}),(0,s.jsx)(b.FormControl,{children:(0,s.jsx)(N.Input,{placeholder:"Ex: SaaS Product A",...e})}),(0,s.jsx)(b.FormDescription,{children:"Un nom pour identifier ce compte Stripe"}),(0,s.jsx)(b.FormMessage,{})]})}),(0,s.jsx)(b.FormField,{control:d.control,name:"description",render:({field:e})=>(0,s.jsxs)(b.FormItem,{children:[(0,s.jsx)(b.FormLabel,{children:"Description"}),(0,s.jsx)(b.FormControl,{children:(0,s.jsx)(N.Input,{placeholder:"Description optionnelle",...e,value:e.value||""})}),(0,s.jsx)(b.FormMessage,{})]})}),(0,s.jsx)(b.FormField,{control:d.control,name:"apiKey",render:({field:e})=>(0,s.jsxs)(b.FormItem,{children:[(0,s.jsx)(b.FormLabel,{children:"Clé API Stripe *"}),(0,s.jsx)(b.FormControl,{children:(0,s.jsx)(N.Input,{type:"password",placeholder:"sk_...",...e})}),(0,s.jsx)(b.FormDescription,{children:"Votre clé secrète Stripe (sera chiffrée)"}),(0,s.jsx)(b.FormMessage,{})]})}),(0,s.jsx)(b.FormField,{control:d.control,name:"webhookSecret",render:({field:e})=>(0,s.jsxs)(b.FormItem,{children:[(0,s.jsx)(b.FormLabel,{children:"Webhook Secret"}),(0,s.jsx)(b.FormControl,{children:(0,s.jsx)(N.Input,{type:"password",placeholder:"whsec_...",...e,value:e.value||""})}),(0,s.jsx)(b.FormDescription,{children:"Secret du webhook Stripe (optionnel)"}),(0,s.jsx)(b.FormMessage,{})]})}),(0,s.jsxs)("div",{className:"flex justify-end gap-2 pt-4",children:[(0,s.jsx)(i.Button,{type:"button",variant:"outline",onClick:()=>n(!1),children:"Annuler"}),(0,s.jsx)(i.Button,{type:"submit",disabled:m,children:m?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(S.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Enregistrement..."]}):"Enregistrer"})]})]})})]})})}var A=e.i(10882),C=e.i(53682),F=e.i(88991),q=e.i(94928),z=e.i(88886),D=e.i(10784);let M=(0,z.cva)("inline-flex items-center justify-center rounded-full border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function P({className:e,variant:t,asChild:r=!1,...i}){let n=(0,D.cn)(M({variant:t}),e);return r?(0,s.jsx)(q.Slot,{"data-slot":"badge",className:n,...i}):(0,s.jsx)("span",{"data-slot":"badge",className:n,...i})}var E=e.i(23147),I=e.i(2114);let K=({products:e})=>{let t=e?.slice(0,3)||[],r=(e?.length||0)-t.length;return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center text-xs font-medium text-muted-foreground",children:[(0,s.jsx)(h,{className:"mr-1.5 h-3.5 w-3.5"})," Produits (",e?.length||0,")"]}),(0,s.jsx)("div",{className:"space-y-1.5",children:t.map(e=>(0,s.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,s.jsx)("span",{className:"truncate max-w-[65%] font-medium",children:e.name}),(0,s.jsx)("span",{className:"font-medium text-foreground",children:e.price?new Intl.NumberFormat("fr-FR",{style:"currency",currency:e.currency}).format(Number(e.price)):"—"})]},e.id))}),r>0&&(0,s.jsxs)("p",{className:"text-xs text-muted-foreground italic",children:["+",r," autre",r>1?"s":""]})]})};function L(){let{data:e,isLoading:l}=(0,r.useStripeAccounts)(),{data:h}=(0,r.useProducts)(),f=(0,r.useSyncProducts)(),j=(0,r.useDeleteStripeAccount)(),[v,y]=(0,t.useState)(!1),[g,b]=(0,t.useState)(null),[N,S]=(0,t.useState)(!1),[q,z]=(0,t.useState)(null),D=h?.reduce((e,s)=>(e[s.stripeAccountId]||(e[s.stripeAccountId]=[]),e[s.stripeAccountId].push(s),e),{});return l?(0,s.jsxs)("div",{className:"space-y-8 p-4 md:p-6 lg:p-8 max-w-7xl mx-auto",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(E.Skeleton,{className:"h-8 w-64"}),(0,s.jsx)(E.Skeleton,{className:"h-4 w-96"})]}),(0,s.jsx)("div",{className:"grid gap-12 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:[void 0,void 0,void 0].map((e,t)=>(0,s.jsxs)(n.Card,{className:"w-[280px] min-h-[380px] flex flex-col transition-all hover:shadow-md",children:[(0,s.jsxs)(n.CardHeader,{className:"space-y-2 pb-4",children:[(0,s.jsx)(E.Skeleton,{className:"h-5 w-3/4"}),(0,s.jsx)(E.Skeleton,{className:"h-3 w-1/2"})]}),(0,s.jsxs)(n.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)(E.Skeleton,{className:"h-3 w-12"}),(0,s.jsx)(E.Skeleton,{className:"h-3 w-16"})]}),(0,s.jsx)(E.Skeleton,{className:"h-6 w-full"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(E.Skeleton,{className:"h-3 w-full"}),(0,s.jsx)(E.Skeleton,{className:"h-3 w-5/6"})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)(E.Skeleton,{className:"h-9 w-full"}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(E.Skeleton,{className:"h-9 w-full"}),(0,s.jsx)(E.Skeleton,{className:"h-9 w-full"})]}),(0,s.jsx)(E.Skeleton,{className:"h-9 w-full"})]})]})]},t))})]}):(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center pb-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl md:text-3xl font-bold",children:"Gestion des Comptes Stripe"}),(0,s.jsx)("p",{className:"text-muted-foreground mt-1 max-w-2xl",children:"Connectez vos comptes Stripe pour centraliser vos produits, revenus et statistiques."})]}),(0,s.jsxs)(i.Button,{onClick:()=>{y(!0),b(null)},size:"sm",className:"h-9 px-4 md:px-5",children:[(0,s.jsx)(a.Plus,{className:"mr-2 h-4 w-4"}),"Nouveau compte"]})]}),e?.length===0&&(0,s.jsxs)(n.Card,{className:"py-12 text-center",children:[(0,s.jsx)("div",{className:"mx-auto mb-4 h-14 w-14 flex items-center justify-center rounded-full bg-primary/10",children:(0,s.jsx)(d,{className:"h-7 w-7 text-primary"})}),(0,s.jsx)(n.CardTitle,{className:"text-xl mb-2",children:"Aucun compte Stripe connecté"}),(0,s.jsx)(n.CardDescription,{className:"max-w-md mx-auto mb-6",children:"Commencez par connecter votre premier compte pour synchroniser vos produits et suivre vos ventes."}),(0,s.jsxs)(i.Button,{onClick:()=>{y(!0),b(null)},size:"sm",className:"h-9 px-5",children:[(0,s.jsx)(a.Plus,{className:"mr-2 h-4 w-4"}),"Connecter un compte"]})]}),(0,s.jsx)("div",{className:"grid gap-12 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4",children:e?.map(e=>{let t=D?.[e.id]||[],r=t.length,a=f.isPending&&f.variables===e.id,l=e.lastSyncAt?(0,A.format)(new Date(e.lastSyncAt),"dd MMM yyyy, HH:mm",{locale:C.fr}):"Jamais";return(0,s.jsxs)(n.Card,{className:"w-[280px] min-h-[380px] flex flex-col transition-all hover:shadow-md",children:[(0,s.jsx)(n.CardHeader,{className:"pb-3",children:(0,s.jsxs)("div",{className:"flex justify-between items-start gap-2",children:[(0,s.jsxs)("div",{className:"min-w-0",children:[(0,s.jsx)(n.CardTitle,{className:"text-base font-semibold truncate",children:e.name}),e.description&&(0,s.jsx)(n.CardDescription,{className:"text-xs line-clamp-2 mt-1",children:e.description})]}),(0,s.jsxs)(P,{variant:"outline",className:`px-2 py-0.5 text-xs font-medium ${e.isActive?"border-emerald-500 text-emerald-700 dark:text-emerald-400 dark:border-emerald-500":"border-muted-foreground/50 text-muted-foreground"}`,children:[e.isActive?(0,s.jsx)(u,{className:"mr-1 h-3 w-3 text-emerald-600"}):(0,s.jsx)(m,{className:"mr-1 h-3 w-3"}),e.isActive?"Actif":"Inactif"]})]})}),(0,s.jsxs)(n.CardContent,{className:"flex flex-col flex-1 gap-4 pb-5",children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3 text-xs",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"Produits"}),(0,s.jsx)("p",{className:"font-semibold",children:r})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsx)("p",{className:"text-muted-foreground",children:"Dernière synchro"}),(0,s.jsx)("p",{className:"font-semibold",children:l})]})]}),(0,s.jsx)(I.Separator,{}),(0,s.jsx)("div",{className:"flex-1 min-h-[80px]",children:(0,s.jsx)(K,{products:t})}),(0,s.jsxs)("div",{className:"space-y-2.5 mt-auto",children:[(0,s.jsxs)(i.Button,{onClick:()=>{var s,t;return s=e.id,t=e.name,void w.toast.promise(f.mutateAsync(s),{loading:`Synchronisation des produits pour ${t}…`,success:e=>`${e.count} produit${1!==e.count?"s":""} synchronis\xe9${1!==e.count?"s":""} !`,error:e=>"Erreur de synchronisation : "+e.message})},disabled:f.isPending,variant:"outline",size:"sm",className:"w-full h-10 font-medium",children:[(0,s.jsx)(o,{className:`mr-2 h-4 w-4 ${a?"animate-spin":""}`}),a?"Synchronisation…":"Synchroniser"]}),(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsxs)(i.Button,{variant:"outline",size:"sm",className:"flex-1 h-10 font-medium",onClick:()=>{b(e),y(!0)},children:[(0,s.jsx)(x,{className:"mr-2 h-4 w-4"}),"Modifier"]}),(0,s.jsx)(i.Button,{variant:"outline",size:"sm",className:"flex-1 h-10 font-medium",asChild:!0,children:(0,s.jsxs)("a",{href:`https://dashboard.stripe.com/connect/accounts/${e.id}`,target:"_blank",rel:"noopener noreferrer",children:[(0,s.jsx)(p,{className:"mr-2 h-4 w-4"}),"Stripe"]})})]}),(0,s.jsxs)(i.Button,{variant:"ghost",size:"sm",className:"w-full h-10 text-destructive hover:text-destructive font-medium",onClick:()=>{z({id:e.id,name:e.name}),S(!0)},children:[(0,s.jsx)(c.Trash2,{className:"mr-2 h-4 w-4"}),"Déconnecter le compte"]})]})]})]},e.id)})}),(0,s.jsx)(k,{open:v,onOpenChange:y,initialData:g||void 0,accountId:g?.id}),(0,s.jsx)(F.AlertDialog,{open:N,onOpenChange:S,children:(0,s.jsxs)(F.AlertDialogContent,{children:[(0,s.jsxs)(F.AlertDialogHeader,{children:[(0,s.jsx)(F.AlertDialogTitle,{children:"Confirmer la suppression"}),(0,s.jsxs)(F.AlertDialogDescription,{children:["Vous êtes sur le point de supprimer le compte ",(0,s.jsx)("span",{className:"font-semibold",children:q?.name}),". Cette action est ",(0,s.jsx)("span",{className:"font-semibold",children:"irréversible"})," et supprimera toutes les données liées."]})]}),(0,s.jsxs)(F.AlertDialogFooter,{children:[(0,s.jsx)(F.AlertDialogCancel,{children:"Annuler"}),(0,s.jsx)(F.AlertDialogAction,{className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",onClick:()=>{q&&(w.toast.promise(j.mutateAsync(q.id).then(()=>z(null)),{loading:"Deconnexion en cours…",success:" Compte Stripe deconnecté !",error:e=>" Erreur : "+e.message}),S(!1))},disabled:j.isPending,children:j.isPending?"Déconnexion en cours…":"Déconnecter le compte"})]})]})})]})}e.s(["default",()=>L],24405)}]);