(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,91650,e=>{"use strict";let t=(0,e.i(65474).default)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]);e.s(["Users",()=>t],91650)},76943,e=>{"use strict";var t=e.i(15620),r=e.i(12737);async function a(){let e=await (0,r.request)("/recettes");if(e.error)throw Error(e.error);return e.data}function s(){return(0,t.useQuery)({queryKey:["recettes"],queryFn:a})}e.s(["useRecettesList",()=>s],76943)},20366,e=>{"use strict";let t=(0,e.i(65474).default)("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);e.s(["FileText",()=>t],20366)},69742,e=>{"use strict";var t=e.i(15620),r=e.i(73956),a=e.i(90477),s=e.i(12737);async function n(){let e=await (0,s.request)("/devis");if(e.error)throw Error(e.error);if(!e.data)throw Error("Devis not found");return e.data}async function i(e){let t=await (0,s.request)("/devis",{method:"POST",data:e});if(t.error)throw Error(t.error);if(!t.data)throw Error("Failed to create devis");return t.data}async function u(e,t){let r=await (0,s.request)(`/devis/${e}`,{method:"PATCH",data:t});if(r.error)throw Error(r.error);if(!r.data)throw Error("Failed to update devis");return r.data}async function c(e){let t=await (0,s.request)(`/devis/${e}`,{method:"DELETE"});if(t.error)throw Error(t.error)}function o(){return(0,t.useQuery)({queryKey:["devis"],queryFn:n})}function l(){let e=(0,a.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>i(e),onSuccess:()=>{e.invalidateQueries({queryKey:["devis"]})}})}function d(e){let t=(0,a.useQueryClient)();return(0,r.useMutation)({mutationFn:t=>u(e,t),onSuccess:()=>{t.invalidateQueries({queryKey:["devis"]}),t.invalidateQueries({queryKey:["devis",e]})}})}function h(){let e=(0,a.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>c(e),onSuccess:()=>{e.invalidateQueries({queryKey:["devis"]})}})}e.s(["useCreateDevis",()=>l,"useDeleteDevis",()=>h,"useDevisList",()=>o,"useUpdateDevis",()=>d],69742)},54671,(e,t,r)=>{t.exports=e.r(10320)},85893,e=>{"use strict";var t=e.i(15620),r=e.i(73956),a=e.i(90477),s=e.i(12737);async function n(){let e=await (0,s.request)("/factures");if(e.error)throw Error(e.error);return e.data||[]}async function i(e){let t=await (0,s.request)("/factures",{method:"POST",data:e});if(t.error)throw Error(t.error);if(!t.data)throw Error("Failed to create facture");return t.data}async function u(e,t){let r=await (0,s.request)(`/factures/${e}`,{method:"PATCH",data:t});if(r.error)throw Error(r.error);if(!r.data)throw Error("Failed to update facture");return r.data}async function c(e){let t=await (0,s.request)(`/factures/${e}`,{method:"DELETE"});if(t.error)throw Error(t.error)}var o=e.i(54671);function l(){return(0,t.useQuery)({queryKey:["factures"],queryFn:n})}function d(){let e=(0,a.useQueryClient)(),t=(0,o.useRouter)();return(0,r.useMutation)({mutationFn:e=>i(e),onSuccess:()=>{e.invalidateQueries({queryKey:["factures"]}),t.push("/factures"),t.refresh()}})}function h(e){let t=(0,a.useQueryClient)(),s=(0,o.useRouter)();return(0,r.useMutation)({mutationFn:t=>u(e,t),onSuccess:()=>{t.invalidateQueries({queryKey:["factures"]}),t.invalidateQueries({queryKey:["facture",e]}),s.push("/factures"),s.refresh()}})}function m(){let e=(0,a.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>c(e),onSuccess:()=>{e.invalidateQueries({queryKey:["factures"]})}})}e.s(["useCreateFacture",()=>d,"useDeleteFacture",()=>m,"useFacturesList",()=>l,"useUpdateFacture",()=>h],85893)},64335,e=>{"use strict";var t=e.i(15620),r=e.i(73956),a=e.i(90477),s=e.i(12737);async function n(){let{data:e,error:t}=await (0,s.request)("/stripe/accounts",{method:"GET"});if(t)throw Error(t);return e}async function i(){let{data:e,error:t}=await (0,s.request)("/stripe/stats?force_refresh=true",{method:"GET"});if(t)throw Error(t);if(!e)throw Error("Stats not found");return e}async function u(e){let{data:t,error:r}=await (0,s.request)("/stripe/accounts",{method:"POST",data:e});if(r)throw Error(r);if(!t)throw Error("Failed to create account");return t}async function c(e,t){let{data:r,error:a}=await (0,s.request)(`/stripe/accounts/${e}`,{method:"PATCH",data:t});if(a)throw Error(a);if(!r)throw Error("Failed to update account");return r}async function o(e){let{error:t}=await (0,s.request)(`/stripe/accounts/${e}`,{method:"DELETE"});if(t)throw Error(t)}async function l(e){let t=e?`/stripe/products?accountId=${e}`:"/stripe/products",{data:r,error:a}=await (0,s.request)(t);if(a)throw Error(a);return r||[]}async function d(e){let{data:t,error:r}=await (0,s.request)("/stripe/products",{method:"POST",data:{accountId:e}});if(r)throw Error(r);if(!t)throw Error("Failed to sync products");return t}function h(){return(0,t.useQuery)({queryKey:["stripe-accounts"],queryFn:n})}function m(){return(0,t.useQuery)({queryKey:["stripe-stats"],queryFn:()=>i()})}function y(){let e=(0,a.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>u(e),onSuccess:()=>{e.invalidateQueries({queryKey:["stripe-accounts"]})}})}function f(e){let t=(0,a.useQueryClient)();return(0,r.useMutation)({mutationFn:t=>c(e,t),onSuccess:()=>{t.invalidateQueries({queryKey:["stripe-accounts"]}),t.invalidateQueries({queryKey:["stripe-account",e]})}})}function x(){let e=(0,a.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>o(e),onSuccess:()=>{e.invalidateQueries({queryKey:["stripe-accounts"]})}})}function p(e){return(0,t.useQuery)({queryKey:e?["products",e]:["products"],queryFn:()=>l(e)})}function v(){let e=(0,a.useQueryClient)();return(0,r.useMutation)({mutationFn:e=>d(e),onSuccess:(t,r)=>{e.invalidateQueries({queryKey:["products"]}),e.invalidateQueries({queryKey:["products",r]}),e.invalidateQueries({queryKey:["stripe-accounts"]})}})}e.s(["useCreateStripeAccount",()=>y,"useDeleteStripeAccount",()=>x,"useProducts",()=>p,"useStripeAccounts",()=>h,"useStripeStats",()=>m,"useSyncProducts",()=>v,"useUpdateStripeAccount",()=>f],64335)},432,e=>{"use strict";var t=e.i(47132),r=e.i(74248),a=e.i(64405),s=e.i(69742),n=e.i(85893),i=e.i(76943),u=e.i(42460);function c({title:e,value:r,description:a,icon:s,trend:n}){return(0,t.jsxs)(u.Card,{children:[(0,t.jsxs)(u.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,t.jsx)(u.CardTitle,{className:"text-sm font-medium",children:e}),(0,t.jsx)(s,{className:"h-4 w-4 text-muted-foreground"})]}),(0,t.jsxs)(u.CardContent,{children:[(0,t.jsx)("div",{className:"text-2xl font-bold",children:r}),a&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:a}),n&&(0,t.jsxs)("p",{className:`text-xs mt-1 ${n.isPositive?"text-green-600":"text-red-600"}`,children:[n.isPositive?"+":"",n.value,"% par rapport au mois dernier"]})]})]})}function o({recettes:e,stripeStats:a}){let s=(0,r.useMemo)(()=>{let t=new Date,r=new Map(Array.from({length:12},(e,r)=>{let a=new Date(t);return a.setMonth(t.getMonth()-(11-r)),{key:a.getFullYear()+"-"+String(a.getMonth()+1).padStart(2,"0"),monthLabel:a.toLocaleDateString("fr-FR",{month:"short"}),revenue:0,mrr:0,total:0}}).map(e=>[e.key,e]));return e.forEach(e=>{let t=new Date(e.date),a=t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0");if(r.has(a)){let t=r.get(a);t.revenue+=Number(e.amount),t.total+=Number(e.amount)}}),a?.forEach(e=>{e.monthlyAnalytics.forEach(e=>{let t=e.monthKey;if(r.has(t)){let a=r.get(t);a.mrr+=e.endingMRR,a.total+=e.endingMRR}})}),Array.from(r.values())},[e,a]),n=Math.max(...s.map(e=>e.total),1e3);return(0,t.jsxs)(u.Card,{className:"col-span-4 md:col-span-7",children:[" ",(0,t.jsx)(u.CardHeader,{children:(0,t.jsx)(u.CardTitle,{children:"Évolution du Chiffre d'Affaires Total (CA + MRR)"})}),(0,t.jsx)(u.CardContent,{children:(0,t.jsx)("div",{className:"h-[300px] flex items-end justify-between gap-4",children:s.map((e,r)=>(0,t.jsxs)("div",{className:"flex-1 flex flex-col items-center gap-2",children:[(0,t.jsx)("div",{className:"w-full bg-primary rounded-t relative transition-all duration-300",style:{height:`${e.total/n*100}%`,minHeight:e.total>0?"4px":"0px"},children:(0,t.jsx)("div",{className:"absolute -top-6 left-0 right-0 text-center text-xs font-medium",children:e.total>0?`${(e.total/1e3).toFixed(1)}k`:""})}),(0,t.jsx)("span",{className:"text-xs text-muted-foreground capitalize",children:e.monthLabel})]},e.key))})})]})}var l=e.i(10882),d=e.i(53682);function h({factures:e}){let r=e.slice(0,5);return(0,t.jsxs)(u.Card,{className:"col-span-3",children:[(0,t.jsx)(u.CardHeader,{children:(0,t.jsx)(u.CardTitle,{children:"Factures Récentes"})}),(0,t.jsx)(u.CardContent,{children:(0,t.jsxs)("div",{className:"space-y-4",children:[r.map((e,r)=>(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:e.number}),(0,t.jsx)("p",{className:"text-xs text-muted-foreground",children:(0,l.format)(new Date(e.date),"dd MMMM yyyy",{locale:d.fr})})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:"text-sm font-medium",children:Number(e.total).toLocaleString("fr-FR",{style:"currency",currency:"EUR"})}),(0,t.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${(e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"paid":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(e.status)}`,children:(e=>{switch(e){case"pending":return"En attente";case"paid":return"Payée";case"cancelled":return"Annulée";default:return e}})(e.status)})]})]},r)),0===r.length&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Aucune facture récente"})]})})]})}var m=e.i(91650),y=e.i(20366),f=e.i(65474);let x=(0,f.default)("euro",[["path",{d:"M4 10h12",key:"1y6xl8"}],["path",{d:"M4 14h9",key:"1loblj"}],["path",{d:"M19 6a7.7 7.7 0 0 0-5.2-2A7.9 7.9 0 0 0 6 12c0 4.4 3.5 8 7.8 8 2 0 3.8-.8 5.2-2",key:"1j6lzo"}]]),p=(0,f.default)("trending-up",[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]]);var v=e.i(90870),v=v;let g=(0,f.default)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]),j=(0,f.default)("user-x",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]),C=(0,f.default)("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);var w=e.i(64335),M=e.i(94250);let b=(0,f.default)("trending-down",[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]]),R=(0,f.default)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);function S({stripeStats:e}){if(!e||0===e.length)return null;let r=e=>e.toLocaleString("fr-FR",{style:"currency",currency:"EUR",maximumFractionDigits:0});return(0,t.jsxs)(u.Card,{className:"col-span-4",children:[(0,t.jsx)(u.CardHeader,{children:(0,t.jsx)(u.CardTitle,{children:"Performance par Compte Stripe"})}),(0,t.jsx)(u.CardContent,{children:(0,t.jsxs)(M.Table,{children:[(0,t.jsx)(M.TableHeader,{children:(0,t.jsxs)(M.TableRow,{children:[(0,t.jsx)(M.TableHead,{children:"Compte"}),(0,t.jsx)(M.TableHead,{children:"MRR"}),(0,t.jsx)(M.TableHead,{children:"ARR"}),(0,t.jsx)(M.TableHead,{children:"Clients Actifs"}),(0,t.jsx)(M.TableHead,{children:"Tendance (Mois)"})]})}),(0,t.jsx)(M.TableBody,{children:e.map(e=>{let a=e.monthlyAnalytics[e.monthlyAnalytics.length-1],s=e.monthlyAnalytics[e.monthlyAnalytics.length-2],n=0;return a&&s&&s.endingMRR>0&&(n=(a.endingMRR-s.endingMRR)/s.endingMRR*100),(0,t.jsxs)(M.TableRow,{children:[(0,t.jsx)(M.TableCell,{className:"font-medium",children:e.accountName}),(0,t.jsx)(M.TableCell,{children:r(e.currentSnapshot.mrr)}),(0,t.jsx)(M.TableCell,{children:r(e.currentSnapshot.arr)}),(0,t.jsx)(M.TableCell,{children:e.currentSnapshot.activeCustomers}),(0,t.jsx)(M.TableCell,{children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[n>0?(0,t.jsx)(p,{className:"h-4 w-4 text-green-500"}):n<0?(0,t.jsx)(b,{className:"h-4 w-4 text-red-500"}):(0,t.jsx)(R,{className:"h-4 w-4 text-muted-foreground"}),(0,t.jsxs)("span",{className:`text-sm ${n>0?"text-green-600":n<0?"text-red-600":"text-muted-foreground"}`,children:[Math.abs(n).toFixed(1),"%"]})]})})]},e.accountId)})})]})})]})}function F(){let{data:e}=(0,a.useClients)(),{data:u}=(0,s.useDevisList)(),{data:l}=(0,n.useFacturesList)(),{data:d}=(0,i.useRecettesList)(),{data:f,isLoading:M}=(0,w.useStripeStats)(),b=e=>e.toLocaleString("fr-FR",{style:"currency",currency:"EUR",maximumFractionDigits:0}),R=(0,r.useMemo)(()=>{let t=new Date().getFullYear(),r=new Date().getMonth(),a=0===r?11:r-1,s=0===r?t-1:t,n=0,i=0,c=0,o=0;d?.forEach(e=>{let u=new Date(e.date),l=Number(e.amount);n+=l,u.getFullYear()===t&&(i+=l),u.getFullYear()===t&&u.getMonth()===r&&(c+=l),u.getFullYear()===s&&u.getMonth()===a&&(o+=l)});let h=l?.filter(e=>"pending"===e.status).reduce((e,t)=>e+Number(t.total),0)||0,m=.22*i,y=o>0?(c-o)/o*100:0,x=f?.reduce((e,t)=>{let r=t.currentSnapshot;e.mrr+=r.mrr,e.arr+=r.arr,e.activeCustomers+=r.activeCustomers;let a=t.monthlyAnalytics.slice(-1)[0];return a&&(e.latestCustomerChurnRate=(e.latestCustomerChurnRate*e.accountCount+a.customerChurnRate)/(e.accountCount+1)),e.accountCount++,e},{mrr:0,arr:0,activeCustomers:0,latestCustomerChurnRate:0,accountCount:0});return{totalRevenue:n,yearRevenue:i,monthRevenue:c,pendingAmount:h,taxDue:m,growthTrend:y,clientCount:e?.length||0,devisCount:u?.length||0,facturesCount:l?.length||0,combinedStripeData:x}},[e,u,l,d,f]),F=R.combinedStripeData?.mrr||0,q=R.combinedStripeData?.arr||0,E=R.combinedStripeData?.latestCustomerChurnRate||0;return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"flex items-center justify-between",children:(0,t.jsx)("h1",{className:"text-lg font-semibold md:text-2xl",children:"Tableau de Bord"})}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,t.jsx)(c,{title:"MRR Total",value:b(F),description:"Revenu mensuel récurrent (Stripe)",icon:p}),(0,t.jsx)(c,{title:"ARR Total",value:b(q),description:"Revenu annuel récurrent (Stripe)",icon:v.default}),(0,t.jsx)(c,{title:"CA du Mois (Non-Récur.)",value:b(R.monthRevenue),description:"Hors abonnements",icon:x,trend:{value:Math.round(R.growthTrend),isPositive:R.growthTrend>=0}}),(0,t.jsx)(c,{title:"Factures en Attente",value:b(R.pendingAmount),description:"Montant à encaisser",icon:y.FileText})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-7",children:[(0,t.jsx)(o,{recettes:d?.map(e=>({...e,amount:Number(e.amount)}))||[],stripeStats:f}),(0,t.jsx)(h,{factures:l||[]})]}),(0,t.jsx)(S,{stripeStats:f}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,t.jsx)(c,{title:"Clients Actifs (Stripe)",value:R.combinedStripeData?.activeCustomers||0,description:"Abonnements en cours",icon:m.Users}),(0,t.jsx)(c,{title:"Taux de Churn",value:`${E.toFixed(2)}%`,description:"Moyenne sur tous les comptes",icon:j,trend:{value:E,isPositive:E<=0}}),(0,t.jsx)(c,{title:"CA Annuel (Non-Récur.)",value:b(R.yearRevenue),description:`Ann\xe9e 2025`,icon:C}),(0,t.jsx)(c,{title:"Charges Estimées",value:b(R.taxDue),description:"URSSAF (22% estimé)",icon:g})]})]})}e.s(["default",()=>F],432)}]);