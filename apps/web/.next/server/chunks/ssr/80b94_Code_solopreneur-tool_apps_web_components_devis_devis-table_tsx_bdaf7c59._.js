module.exports=[58448,a=>{"use strict";var b=a.i(91346),c=a.i(30271),d=a.i(68802),e=a.i(21717),f=a.i(72561),g=a.i(82519);let h=(0,a.i(57409).default)("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);var i=a.i(61751),j=a.i(5705),k=a.i(19354),l=a.i(70308),m=a.i(74871),n=a.i(56225);let o=n.z.object({id:n.z.string().optional(),description:n.z.string().min(1,"La description est requise"),quantity:n.z.number().min(.01,"La quantité doit être positive"),price:n.z.number().min(0,"Le prix doit être positif")}),p=n.z.object({clientId:n.z.string().min(1,"Le client est requis"),date:n.z.string().refine(a=>!isNaN(Date.parse(a)),"Date invalide"),validUntil:n.z.string().optional().nullable(),status:n.z.enum(["draft","sent","accepted","rejected"]).default("draft").nonoptional(),items:n.z.array(o).min(1,"Au moins un article est requis")});var q=a.i(85058),r=a.i(71195),s=a.i(92988),t=a.i(49886),u=a.i(98626),v=a.i(4733),w=a.i(77486),x=a.i(93190),y=a.i(59362);function z({open:a,onOpenChange:d,devisId:f,initialData:h}){let n=(0,j.useCreateDevis)(),o=(0,j.useUpdateDevis)(f||""),{data:z}=(0,t.useClients)(),A=h?{clientId:h.clientId??z?.[0].id,date:h.date??"",validUntil:h.validUntil??"",status:h.status,items:(Array.isArray(h.items)?h.items:[h.items]).map(a=>({...a,quantity:Number(a.quantity),price:Number(a.price)}))}:void 0,B=(0,l.useForm)({resolver:(0,m.zodResolver)(p),defaultValues:A||{clientId:z?.[0].id,date:new Date().toISOString().split("T")[0],validUntil:"",status:"draft",items:[{description:"",quantity:1,price:1}]}}),{fields:C,append:D,remove:E}=(0,l.useFieldArray)({control:B.control,name:"items"});(0,c.useEffect)(()=>{B.reset(A||{clientId:z?.[0].id,date:new Date().toISOString().split("T")[0],validUntil:"",status:"draft",items:[{description:"",quantity:1,price:1}]})},[h,B]);let F=async a=>{let b=f?o:n;w.toast.promise(b.mutateAsync(a).then(()=>{d(!1),B.reset()}),{loading:f?"Mise à jour...":"Création...",success:f?"Devis mis à jour !":"Devis créé !",error:a=>"Erreur: "+a.message})},G=n.isPending||o.isPending,H=(B.watch("items")||[{description:"",quantity:1,price:1}]).reduce((a,b)=>a+(Number(b.quantity)||0)*(Number(b.price)||0),0);return(0,b.jsxs)(k.DialogContent,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsx)(k.DialogHeader,{children:(0,b.jsx)(k.DialogTitle,{children:f?"Modifier le devis":"Nouveau devis"})}),(0,b.jsx)(q.Form,{...B,children:(0,b.jsxs)("form",{onSubmit:B.handleSubmit(F),children:[(0,b.jsxs)(i.CardContent,{className:"p-0",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsx)(q.FormField,{control:B.control,name:"clientId",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"Client *"}),(0,b.jsx)(q.FormControl,{children:(0,b.jsxs)(x.Select,{onValueChange:b=>a.onChange(b),value:a.value,children:[(0,b.jsx)(x.SelectTrigger,{className:"w-full",children:(0,b.jsx)(x.SelectValue,{placeholder:z?.length===1?z?.[0].name:z?.find(b=>b.id.toString()===a.value)?.name||"Select a client"})}),(0,b.jsx)(x.SelectContent,{children:z?.map(a=>(0,b.jsx)(x.SelectItem,{value:a.id,children:a.name},a.id))})]})}),(0,b.jsx)(q.FormMessage,{})]})}),(0,b.jsx)(q.FormField,{control:B.control,name:"date",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"Date *"}),(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(y.DatePicker,{value:a.value??"",onChange:b=>a.onChange(b||""),placeholder:a.value??""})}),(0,b.jsx)(q.FormMessage,{})]})}),(0,b.jsx)(q.FormField,{control:B.control,name:"validUntil",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"Validité (optionnel)"}),(0,b.jsx)(q.FormControl,{children:(0,b.jsx)(y.DatePicker,{value:a.value??"",onChange:b=>a.onChange(b||""),placeholder:"Sélectionner la date d'échéance"})}),(0,b.jsx)(q.FormMessage,{})]})}),(0,b.jsx)(q.FormField,{control:B.control,name:"status",render:({field:a})=>(0,b.jsxs)(q.FormItem,{children:[(0,b.jsx)(q.FormLabel,{children:"Statut"}),(0,b.jsx)(q.FormControl,{children:(0,b.jsxs)(x.Select,{onValueChange:b=>a.onChange(b),value:a.value,children:[(0,b.jsx)(x.SelectTrigger,{className:"w-full",children:(0,b.jsx)(x.SelectValue,{placeholder:"Select a status"})}),(0,b.jsxs)(x.SelectContent,{children:[(0,b.jsx)(x.SelectItem,{value:"draft",children:"Brouillon"}),(0,b.jsx)(x.SelectItem,{value:"sent",children:"Envoyé"}),(0,b.jsx)(x.SelectItem,{value:"accepted",children:"Accepté"}),(0,b.jsx)(x.SelectItem,{value:"rejected",children:"Refusé"})]})]})}),(0,b.jsx)(q.FormMessage,{})]})})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between border-b pb-2",children:[(0,b.jsx)("h3",{className:"text-lg font-medium",children:"Articles"}),(0,b.jsxs)(e.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>D({description:"",quantity:1,price:0}),children:[(0,b.jsx)(g.Plus,{className:"mr-2 h-4 w-4"})," Ajouter un article"]})]}),C.map((a,c)=>(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-end",children:[(0,b.jsxs)("div",{className:"col-span-6 space-y-1",children:[(0,b.jsx)(s.Label,{className:"text-xs",children:"Description"}),(0,b.jsx)(r.Input,{...B.register(`items.${c}.description`),placeholder:"Description de l'article"}),B.formState.errors.items?.[c]?.description&&(0,b.jsx)("p",{className:"text-xs text-destructive",children:B.formState.errors.items[c]?.description?.message})]}),(0,b.jsxs)("div",{className:"col-span-2 space-y-1",children:[(0,b.jsx)(s.Label,{className:"text-xs",children:"Qté"}),(0,b.jsx)(r.Input,{type:"number",step:"0.1",...B.register(`items.${c}.quantity`)})]}),(0,b.jsxs)("div",{className:"col-span-3 space-y-1",children:[(0,b.jsx)(s.Label,{className:"text-xs",children:"Prix Unit."}),(0,b.jsx)(r.Input,{type:"number",step:"0.01",...B.register(`items.${c}.price`)})]}),(0,b.jsx)("div",{className:"col-span-1",children:(0,b.jsx)(e.Button,{type:"button",variant:"ghost",size:"icon",className:"text-destructive",onClick:()=>E(c),children:(0,b.jsx)(u.Trash2,{className:"h-4 w-4"})})})]},a.id)),B.formState.errors.items&&(0,b.jsx)("p",{className:"text-sm text-destructive",children:B.formState.errors.items.message})]}),(0,b.jsx)("div",{className:"flex justify-end pt-4 ",children:(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("span",{className:"text-muted-foreground mr-4",children:"Total:"}),(0,b.jsx)("span",{className:"text-2xl font-bold",children:H.toLocaleString("fr-FR",{style:"currency",currency:"EUR"})})]})})]}),(0,b.jsx)(i.CardFooter,{className:"flex justify-end gap-2",children:(0,b.jsx)(e.Button,{type:"submit",disabled:G,children:G?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(v.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Enregistrement..."]}):"Enregistrer"})})]})})]})}function A({open:a,onOpenChange:c,devisId:d,initialData:e}){return(0,b.jsx)(k.Dialog,{open:a,onOpenChange:c,children:(0,b.jsx)(z,{open:a,onOpenChange:c,devisId:d,initialData:e})})}var B=a.i(27473),C=a.i(21139);function D(){let{data:a,isLoading:k,error:l}=(0,j.useDevisList)(),m=(0,j.useDeleteDevis)(),[n,o]=(0,c.useState)(!1),[p,q]=(0,c.useState)(null),r=a||[];if(k)return(0,b.jsx)("div",{children:"Chargement..."});if(l)return(0,b.jsx)("div",{children:"Erreur lors du chargement des devis"});let s=async a=>{w.toast.promise(m.mutateAsync(a),{loading:"Suppression du devis...",success:"Devis supprimé",error:a=>"Erreur de suppression du devis : "+a.message})};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(i.Card,{children:[(0,b.jsxs)(i.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsx)(i.CardTitle,{className:"px-4",children:(0,b.jsx)(h,{})}),(0,b.jsxs)(e.Button,{onClick:()=>{q(null),o(!0)},children:[(0,b.jsx)(g.Plus,{className:"mr-2 h-4 w-4"})," Nouveau Devis"]})]}),(0,b.jsx)(i.CardContent,{children:(0,b.jsxs)(d.Table,{children:[(0,b.jsx)(d.TableHeader,{children:(0,b.jsxs)(d.TableRow,{children:[(0,b.jsx)(d.TableHead,{children:"Numéro"}),(0,b.jsx)(d.TableHead,{children:"Client"}),(0,b.jsx)(d.TableHead,{children:"Date"}),(0,b.jsx)(d.TableHead,{children:"Total"}),(0,b.jsx)(d.TableHead,{children:"Statut"}),(0,b.jsx)(d.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsxs)(d.TableBody,{children:[r.map((a,c)=>(0,b.jsxs)(d.TableRow,{children:[(0,b.jsx)(d.TableCell,{className:"font-medium",children:a.number}),(0,b.jsx)(d.TableCell,{children:a.clientName}),(0,b.jsx)(d.TableCell,{children:(0,B.format)(new Date(a.date),"dd/MM/yyyy")}),(0,b.jsx)(d.TableCell,{children:Number(a.total).toLocaleString("fr-FR",{style:"currency",currency:"EUR"})}),(0,b.jsx)(d.TableCell,{children:(0,b.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${(a=>{switch(a){case"draft":default:return"bg-gray-100 text-gray-800";case"sent":return"bg-blue-100 text-blue-800";case"accepted":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800"}})(a.status)}`,children:(a=>{switch(a){case"draft":return"Brouillon";case"sent":return"Envoyé";case"accepted":return"Accepté";case"rejected":return"Refusé";default:return a}})(a.status)})}),(0,b.jsx)(d.TableCell,{className:"text-right",children:(0,b.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,b.jsx)(e.Button,{variant:"ghost",size:"icon",onClick:()=>{q(a),o(!0)},children:(0,b.jsx)(f.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(C.DeleteDialiog,{handleDelete:s,id:a.id,ressource:"devis"})]})})]},c)),0===r.length&&(0,b.jsx)(d.TableRow,{children:(0,b.jsx)(d.TableCell,{colSpan:6,className:"text-center text-muted-foreground",children:"Aucun devis trouvé."})})]})]})})]}),(0,b.jsx)(A,{open:n,onOpenChange:o,devisId:p?.id,initialData:p||void 0})]})}a.s(["DevisTable",()=>D],58448)}];

//# sourceMappingURL=80b94_Code_solopreneur-tool_apps_web_components_devis_devis-table_tsx_bdaf7c59._.js.map