module.exports=[64112,a=>{"use strict";var b=a.i(91346),c=a.i(68802),d=a.i(21717),e=a.i(72561),f=a.i(82519);let g=(0,a.i(57409).default)("receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);var h=a.i(61751),i=a.i(58392),j=a.i(27473),k=a.i(77486),l=a.i(30271),m=a.i(21139),n=a.i(19354),o=a.i(70308),p=a.i(74871),q=a.i(56225);let r=q.z.object({id:q.z.string().optional(),description:q.z.string().min(1,"La description est requise"),quantity:q.z.number().min(.01,"La quantité doit être positive"),price:q.z.number().min(0,"Le prix doit être positif")}),s=q.z.object({clientId:q.z.string().min(1,"Le client est requis"),devisId:q.z.string().optional().nullable(),date:q.z.string().refine(a=>!isNaN(Date.parse(a)),"Date invalide"),dueDate:q.z.string().optional().nullable(),status:q.z.enum(["pending","paid","cancelled"]).default("pending").nonoptional(),items:q.z.array(r).min(1,"Au moins un article est requis")});var t=a.i(85058),u=a.i(71195),v=a.i(92988),w=a.i(49886),x=a.i(98626),y=a.i(4733),z=a.i(93190),A=a.i(59362);function B({onOpenChange:a,initialData:c,factureId:e}){let g=(0,i.useCreateFacture)(),j=(0,i.useUpdateFacture)(e||""),{data:m}=(0,w.useClients)(),q=c?{clientId:c.clientId??m?.[0].id,devisId:c.devisId??"",date:c.date??"",dueDate:c.dueDate??"",status:c.status,items:(Array.isArray(c.items)?c.items:[c.items]).map(a=>({...a,quantity:Number(a.quantity),price:Number(a.price)}))}:void 0,r=(0,o.useForm)({resolver:(0,p.zodResolver)(s),defaultValues:q||{clientId:m?.[0].id,devisId:"",date:new Date().toISOString().split("T")[0],dueDate:"",status:"pending",items:[{description:"",quantity:1,price:1}]}}),{fields:B,append:C,remove:D}=(0,o.useFieldArray)({control:r.control,name:"items"});(0,l.useEffect)(()=>{r.reset(q||{clientId:m?.[0].id,devisId:"",date:new Date().toISOString().split("T")[0],dueDate:"",status:"pending",items:[{description:"",quantity:1,price:1}]})},[c,r]);let E=async b=>{let c=e?j:g;k.toast.promise(c.mutateAsync(b).then(()=>{a(!1),r.reset()}),{loading:e?"Mise à jour...":"Création...",success:e?"Facture mise à jour avec succès !":"Facture créée avec succès !",error:a=>"Erreur: "+a.message})},F=g.isPending||j.isPending,G=(r.watch("items")||[{description:"",quantity:1,price:1}]).reduce((a,b)=>a+(Number(b.quantity)||0)*(Number(b.price)||0),0);return(0,b.jsxs)(n.DialogContent,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsx)(n.DialogHeader,{children:(0,b.jsx)(n.DialogTitle,{children:e?"Modifier la facture":"Nouvelle facture"})}),(0,b.jsx)(t.Form,{...r,children:(0,b.jsxs)("form",{onSubmit:r.handleSubmit(E),children:[(0,b.jsxs)(h.CardContent,{className:"p-0",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,b.jsx)(t.FormField,{control:r.control,name:"clientId",render:({field:a})=>(0,b.jsxs)(t.FormItem,{children:[(0,b.jsx)(t.FormLabel,{children:"Client *"}),(0,b.jsx)(t.FormControl,{children:(0,b.jsxs)(z.Select,{onValueChange:b=>a.onChange(b),value:a.value,children:[(0,b.jsx)(z.SelectTrigger,{className:"w-full",children:(0,b.jsx)(z.SelectValue,{placeholder:m?.length===1?m?.[0].name:m?.find(b=>b.id.toString()===a.value)?.name||"Select a client"})}),(0,b.jsx)(z.SelectContent,{children:m?.map(a=>(0,b.jsx)(z.SelectItem,{value:a.id,children:a.name},a.id))})]})}),(0,b.jsx)(t.FormMessage,{})]})}),(0,b.jsx)(t.FormField,{control:r.control,name:"date",render:({field:a})=>(0,b.jsxs)(t.FormItem,{children:[(0,b.jsx)(t.FormLabel,{children:"Date *"}),(0,b.jsx)(t.FormControl,{children:(0,b.jsx)(A.DatePicker,{value:a.value??"",onChange:b=>a.onChange(b||""),placeholder:a.value??""})}),(0,b.jsx)(t.FormMessage,{})]})}),(0,b.jsx)(t.FormField,{control:r.control,name:"dueDate",render:({field:a})=>(0,b.jsxs)(t.FormItem,{children:[(0,b.jsx)(t.FormLabel,{children:"Date d'échéance (optionnel)"}),(0,b.jsx)(t.FormControl,{children:(0,b.jsx)(A.DatePicker,{value:a.value??"",onChange:b=>a.onChange(b||""),placeholder:"Sélectionner la date d'échéance"})}),(0,b.jsx)(t.FormMessage,{})]})}),(0,b.jsx)(t.FormField,{control:r.control,name:"status",render:({field:a})=>(0,b.jsxs)(t.FormItem,{children:[(0,b.jsx)(t.FormLabel,{children:"Statut"}),(0,b.jsx)(t.FormControl,{children:(0,b.jsxs)(z.Select,{onValueChange:b=>a.onChange(b),value:a.value,children:[(0,b.jsx)(z.SelectTrigger,{className:"w-full",children:(0,b.jsx)(z.SelectValue,{placeholder:a.value||"Select a status"})}),(0,b.jsxs)(z.SelectContent,{children:[(0,b.jsx)(z.SelectItem,{value:"pending",children:"En attente"}),(0,b.jsx)(z.SelectItem,{value:"paid",children:"Payée"}),(0,b.jsx)(z.SelectItem,{value:"cancelled",children:"Annulée"})]})]})}),(0,b.jsx)(t.FormMessage,{})]})})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between border-b pb-2",children:[(0,b.jsx)("h3",{className:"text-lg font-medium",children:"Articles"}),(0,b.jsxs)(d.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>C({description:"",quantity:1,price:0}),children:[(0,b.jsx)(f.Plus,{className:"mr-2 h-4 w-4"})," Ajouter un article"]})]}),B.map((a,c)=>(0,b.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-end",children:[(0,b.jsxs)("div",{className:"col-span-6 space-y-1",children:[(0,b.jsx)(v.Label,{className:"text-xs",children:"Description"}),(0,b.jsx)(u.Input,{...r.register(`items.${c}.description`),placeholder:"Description de l'article"}),r.formState.errors.items?.[c]?.description&&(0,b.jsx)("p",{className:"text-xs text-destructive",children:r.formState.errors.items[c]?.description?.message})]}),(0,b.jsxs)("div",{className:"col-span-2 space-y-1",children:[(0,b.jsx)(v.Label,{className:"text-xs",children:"Qté"}),(0,b.jsx)(u.Input,{type:"number",step:"0.01",...r.register(`items.${c}.quantity`)})]}),(0,b.jsxs)("div",{className:"col-span-3 space-y-1",children:[(0,b.jsx)(v.Label,{className:"text-xs",children:"Prix Unit."}),(0,b.jsx)(u.Input,{type:"number",step:"0.01",...r.register(`items.${c}.price`)})]}),(0,b.jsx)("div",{className:"col-span-1",children:(0,b.jsx)(d.Button,{type:"button",variant:"ghost",size:"icon",className:"text-destructive",onClick:()=>D(c),children:(0,b.jsx)(x.Trash2,{className:"h-4 w-4"})})})]},a.id)),r.formState.errors.items&&(0,b.jsx)("p",{className:"text-sm text-destructive",children:r.formState.errors.items.message})]}),(0,b.jsx)("div",{className:"flex justify-end pt-4 ",children:(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("span",{className:"text-muted-foreground mr-4",children:"Total:"}),(0,b.jsx)("span",{className:"text-2xl font-bold",children:G.toLocaleString("fr-FR",{style:"currency",currency:"EUR"})})]})}),(0,b.jsx)("div",{className:"bg-muted p-3 rounded-md",children:(0,b.jsx)(t.FormDescription,{className:"font-medium",children:"* TVA non applicable – art. 293 B du CGI"})})]}),(0,b.jsx)(h.CardFooter,{className:"flex justify-end gap-2",children:(0,b.jsx)(d.Button,{type:"submit",disabled:F,children:F?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(y.Loader2,{className:"mr-2 h-4 w-4 animate-spin"}),"Enregistrement..."]}):"Enregistrer"})})]})})]})}function C({open:a,onOpenChange:c,initialData:d,factureId:e}){return(0,b.jsx)(n.Dialog,{open:a,onOpenChange:c,children:(0,b.jsx)(B,{open:a,onOpenChange:c,initialData:d,factureId:e})})}function D(){let{data:a,isLoading:n,error:o}=(0,i.useFacturesList)(),[p,q]=(0,l.useState)(!1),[r,s]=(0,l.useState)(null),t=(0,i.useDeleteFacture)();if(n)return(0,b.jsx)("div",{children:"Chargement..."});if(o)return(0,b.jsx)("div",{children:"Erreur lors du chargement des factures"});let u=async a=>{k.toast.promise(t.mutateAsync(a),{loading:"Suppression de la facture...",success:"Facture supprimée",error:a=>"Erreur de suppression de la facture : "+a.message})};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(h.Card,{children:[(0,b.jsxs)(h.CardHeader,{className:"flex flex-row items-center justify-between",children:[(0,b.jsx)(h.CardTitle,{className:"px-4",children:(0,b.jsx)(g,{})}),(0,b.jsxs)(d.Button,{onClick:()=>{s(null),q(!0)},children:[(0,b.jsx)(f.Plus,{className:"mr-2 h-4 w-4"})," Nouvelle Facture"]})]}),(0,b.jsxs)(h.CardContent,{children:[(0,b.jsxs)(c.Table,{children:[(0,b.jsx)(c.TableHeader,{children:(0,b.jsxs)(c.TableRow,{children:[(0,b.jsx)(c.TableHead,{children:"Numéro"}),(0,b.jsx)(c.TableHead,{children:"Client"}),(0,b.jsx)(c.TableHead,{children:"Date"}),(0,b.jsx)(c.TableHead,{children:"Échéance"}),(0,b.jsx)(c.TableHead,{children:"Total"}),(0,b.jsx)(c.TableHead,{children:"Statut"}),(0,b.jsx)(c.TableHead,{className:"text-right",children:"Actions"})]})}),(0,b.jsxs)(c.TableBody,{children:[a?.map((a,f)=>(0,b.jsxs)(c.TableRow,{children:[(0,b.jsx)(c.TableCell,{className:"font-medium",children:a.number}),(0,b.jsx)(c.TableCell,{children:a.clientName||"Client inconnu"}),(0,b.jsx)(c.TableCell,{children:(0,j.format)(new Date(a.date),"dd/MM/yyyy")}),(0,b.jsx)(c.TableCell,{children:a.dueDate?(0,j.format)(new Date(a.dueDate),"dd/MM/yyyy"):"-"}),(0,b.jsx)(c.TableCell,{children:Number(a.total).toLocaleString("fr-FR",{style:"currency",currency:"EUR"})}),(0,b.jsx)(c.TableCell,{children:(0,b.jsx)("span",{className:`px-2 py-1 rounded-full text-xs font-semibold ${(a=>{switch(a){case"pending":return"bg-yellow-100 text-yellow-800";case"paid":return"bg-green-100 text-green-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(a.status)}`,children:(a=>{switch(a){case"pending":return"En attente";case"paid":return"Payée";case"cancelled":return"Annulée";default:return a}})(a.status)})}),(0,b.jsxs)(c.TableCell,{className:"text-right",children:[(0,b.jsx)(d.Button,{variant:"ghost",size:"icon",onClick:()=>{s(a),q(!0)},children:(0,b.jsx)(e.Edit,{className:"h-4 w-4"})}),(0,b.jsx)(m.DeleteDialiog,{handleDelete:u,id:a.id,ressource:"facture"})]})]},f)),a?.length===0&&(0,b.jsx)(c.TableRow,{children:(0,b.jsx)(c.TableCell,{colSpan:7,className:"text-center text-muted-foreground",children:"Aucune facture trouvée."})})]})]}),(0,b.jsx)("div",{className:"mt-4 text-sm text-muted-foreground",children:(0,b.jsx)("p",{children:"* TVA non applicable – art. 293 B du CGI"})})]})]}),(0,b.jsx)(C,{open:p,onOpenChange:()=>{q(!1),s(null)},initialData:r||void 0,factureId:r?.id})]})}a.s(["FactureTable",()=>D],64112)}];

//# sourceMappingURL=80b94_Code_solopreneur-tool_apps_web_components_factures_facture-table_tsx_fa7c7f0d._.js.map