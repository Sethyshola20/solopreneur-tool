module.exports=[16016,a=>{"use strict";var b=a.i(19900);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call Sidebar() from the server but Sidebar is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","Sidebar"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarContent() from the server but SidebarContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarContent"),e=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarFooter() from the server but SidebarFooter is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarFooter"),f=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarGroup() from the server but SidebarGroup is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarGroup"),g=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarGroupAction() from the server but SidebarGroupAction is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarGroupAction"),h=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarGroupContent() from the server but SidebarGroupContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarGroupContent"),i=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarGroupLabel() from the server but SidebarGroupLabel is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarGroupLabel"),j=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarHeader() from the server but SidebarHeader is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarHeader"),k=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarInput() from the server but SidebarInput is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarInput"),l=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarInset() from the server but SidebarInset is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarInset"),m=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarMenu() from the server but SidebarMenu is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarMenu"),n=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarMenuAction() from the server but SidebarMenuAction is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarMenuAction"),o=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarMenuBadge() from the server but SidebarMenuBadge is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarMenuBadge"),p=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarMenuButton() from the server but SidebarMenuButton is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarMenuButton"),q=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarMenuItem() from the server but SidebarMenuItem is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarMenuItem"),r=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarMenuSkeleton() from the server but SidebarMenuSkeleton is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarMenuSkeleton"),s=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarMenuSub() from the server but SidebarMenuSub is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarMenuSub"),t=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarMenuSubButton() from the server but SidebarMenuSubButton is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarMenuSubButton"),u=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarMenuSubItem() from the server but SidebarMenuSubItem is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarMenuSubItem"),v=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarProvider() from the server but SidebarProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarProvider"),w=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarRail() from the server but SidebarRail is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarRail"),x=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarSeparator() from the server but SidebarSeparator is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarSeparator"),y=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarTrigger() from the server but SidebarTrigger is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","SidebarTrigger"),z=(0,b.registerClientReference)(function(){throw Error("Attempted to call useSidebar() from the server but useSidebar is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx <module evaluation>","useSidebar");a.s(["Sidebar",0,c,"SidebarContent",0,d,"SidebarFooter",0,e,"SidebarGroup",0,f,"SidebarGroupAction",0,g,"SidebarGroupContent",0,h,"SidebarGroupLabel",0,i,"SidebarHeader",0,j,"SidebarInput",0,k,"SidebarInset",0,l,"SidebarMenu",0,m,"SidebarMenuAction",0,n,"SidebarMenuBadge",0,o,"SidebarMenuButton",0,p,"SidebarMenuItem",0,q,"SidebarMenuSkeleton",0,r,"SidebarMenuSub",0,s,"SidebarMenuSubButton",0,t,"SidebarMenuSubItem",0,u,"SidebarProvider",0,v,"SidebarRail",0,w,"SidebarSeparator",0,x,"SidebarTrigger",0,y,"useSidebar",0,z])},37770,a=>{"use strict";var b=a.i(19900);let c=(0,b.registerClientReference)(function(){throw Error("Attempted to call Sidebar() from the server but Sidebar is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","Sidebar"),d=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarContent() from the server but SidebarContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarContent"),e=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarFooter() from the server but SidebarFooter is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarFooter"),f=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarGroup() from the server but SidebarGroup is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarGroup"),g=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarGroupAction() from the server but SidebarGroupAction is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarGroupAction"),h=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarGroupContent() from the server but SidebarGroupContent is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarGroupContent"),i=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarGroupLabel() from the server but SidebarGroupLabel is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarGroupLabel"),j=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarHeader() from the server but SidebarHeader is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarHeader"),k=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarInput() from the server but SidebarInput is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarInput"),l=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarInset() from the server but SidebarInset is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarInset"),m=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarMenu() from the server but SidebarMenu is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarMenu"),n=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarMenuAction() from the server but SidebarMenuAction is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarMenuAction"),o=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarMenuBadge() from the server but SidebarMenuBadge is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarMenuBadge"),p=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarMenuButton() from the server but SidebarMenuButton is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarMenuButton"),q=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarMenuItem() from the server but SidebarMenuItem is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarMenuItem"),r=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarMenuSkeleton() from the server but SidebarMenuSkeleton is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarMenuSkeleton"),s=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarMenuSub() from the server but SidebarMenuSub is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarMenuSub"),t=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarMenuSubButton() from the server but SidebarMenuSubButton is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarMenuSubButton"),u=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarMenuSubItem() from the server but SidebarMenuSubItem is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarMenuSubItem"),v=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarProvider() from the server but SidebarProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarProvider"),w=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarRail() from the server but SidebarRail is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarRail"),x=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarSeparator() from the server but SidebarSeparator is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarSeparator"),y=(0,b.registerClientReference)(function(){throw Error("Attempted to call SidebarTrigger() from the server but SidebarTrigger is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","SidebarTrigger"),z=(0,b.registerClientReference)(function(){throw Error("Attempted to call useSidebar() from the server but useSidebar is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/ui/sidebar.tsx","useSidebar");a.s(["Sidebar",0,c,"SidebarContent",0,d,"SidebarFooter",0,e,"SidebarGroup",0,f,"SidebarGroupAction",0,g,"SidebarGroupContent",0,h,"SidebarGroupLabel",0,i,"SidebarHeader",0,j,"SidebarInput",0,k,"SidebarInset",0,l,"SidebarMenu",0,m,"SidebarMenuAction",0,n,"SidebarMenuBadge",0,o,"SidebarMenuButton",0,p,"SidebarMenuItem",0,q,"SidebarMenuSkeleton",0,r,"SidebarMenuSub",0,s,"SidebarMenuSubButton",0,t,"SidebarMenuSubItem",0,u,"SidebarProvider",0,v,"SidebarRail",0,w,"SidebarSeparator",0,x,"SidebarTrigger",0,y,"useSidebar",0,z])},4810,a=>{"use strict";a.i(16016);var b=a.i(37770);a.n(b)},16682,(a,b,c)=>{let{createClientModuleProxy:d}=a.r(19900);a.n(d("[project]/Documents/Code/solopreneur-tool/node_modules/next/dist/client/app-dir/link.js <module evaluation>"))},36938,(a,b,c)=>{let{createClientModuleProxy:d}=a.r(19900);a.n(d("[project]/Documents/Code/solopreneur-tool/node_modules/next/dist/client/app-dir/link.js"))},16047,a=>{"use strict";a.i(16682);var b=a.i(36938);a.n(b)},35153,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={default:function(){return i},useLinkStatus:function(){return h.useLinkStatus}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(70075),g=a.r(30918),h=f._(a.r(16047));function i(a){let b=a.legacyBehavior,c="string"==typeof a.children||"number"==typeof a.children||"string"==typeof a.children?.type,d=a.children?.type?.$$typeof===Symbol.for("react.client.reference");return!b||c||d||(a.children?.type?.$$typeof===Symbol.for("react.lazy")?console.error("Using a Lazy Component as a direct child of `<Link legacyBehavior>` from a Server Component is not supported. If you need legacyBehavior, wrap your Lazy Component in a Client Component that renders the Link's `<a>` tag."):console.error("Using a Server Component as a direct child of `<Link legacyBehavior>` is not supported. If you need legacyBehavior, wrap your Server Component in a Client Component that renders the Link's `<a>` tag.")),(0,g.jsx)(h.default,{...a})}("function"==typeof c.default||"object"==typeof c.default&&null!==c.default)&&void 0===c.default.__esModule&&(Object.defineProperty(c.default,"__esModule",{value:!0}),Object.assign(c.default,c),b.exports=c.default)},80630,a=>{"use strict";let b=(0,a.i(19900).registerClientReference)(function(){throw Error("Attempted to call SidebarUserNav() from the server but SidebarUserNav is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/sidebar-user-nav.tsx <module evaluation>","SidebarUserNav");a.s(["SidebarUserNav",0,b])},12822,a=>{"use strict";let b=(0,a.i(19900).registerClientReference)(function(){throw Error("Attempted to call SidebarUserNav() from the server but SidebarUserNav is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/Documents/Code/solopreneur-tool/apps/web/components/sidebar-user-nav.tsx","SidebarUserNav");a.s(["SidebarUserNav",0,b])},6205,a=>{"use strict";a.i(80630);var b=a.i(12822);a.n(b)},20050,a=>{"use strict";let b,c,d,e,f,g,h,i,j,k;var l,m,n,o,p=a.i(30918),q=a.i(91111);let r=a=>{let b=a.replace(/^([A-Z])|[\s-_]+(\w)/g,(a,b,c)=>c?c.toUpperCase():b.toLowerCase());return b.charAt(0).toUpperCase()+b.slice(1)},s=(...a)=>a.filter((a,b,c)=>!!a&&""!==a.trim()&&c.indexOf(a)===b).join(" ").trim();var t={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let u=(0,q.forwardRef)(({color:a="currentColor",size:b=24,strokeWidth:c=2,absoluteStrokeWidth:d,className:e="",children:f,iconNode:g,...h},i)=>(0,q.createElement)("svg",{ref:i,...t,width:b,height:b,stroke:a,strokeWidth:d?24*Number(c)/Number(b):c,className:s("lucide",e),...!f&&!(a=>{for(let b in a)if(b.startsWith("aria-")||"role"===b||"title"===b)return!0})(h)&&{"aria-hidden":"true"},...h},[...g.map(([a,b])=>(0,q.createElement)(a,b)),...Array.isArray(f)?f:[f]])),v=(a,b)=>{let c=(0,q.forwardRef)(({className:c,...d},e)=>(0,q.createElement)(u,{ref:e,iconNode:b,className:s(`lucide-${r(a).replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase()}`,`lucide-${a}`,c),...d}));return c.displayName=r(a),c},w=v("layout-dashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),x=v("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),y=v("settings",[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]),z=v("file-text",[["path",{d:"M6 22a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h8a2.4 2.4 0 0 1 1.704.706l3.588 3.588A2.4 2.4 0 0 1 20 8v12a2 2 0 0 1-2 2z",key:"1oefj6"}],["path",{d:"M14 2v5a1 1 0 0 0 1 1h5",key:"wfsgrz"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]),A=v("chart-column",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]),B=v("receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]),C=v("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);var D=a.i(4810),E=a.i(35153),F=a.i(42490),G=a.i(13964),H=a.i(19541),I=a.i(73287);let J=(a,b="ms")=>new Date(Date.now()+("sec"===b?1e3*a:a)),K=new WeakMap;function L(a,b){let c=b.fields,d={};for(let b in a){let e=c[b];if(!e){d[b]=a[b];continue}!1!==e.returned&&(d[b]=a[b])}return d}function M(a,b){K.has(a)||K.set(a,new Map);let c=K.get(a);if(c.has(b))return c.get(b);let d={..."user"===b?a.user?.additionalFields:{},..."session"===b?a.session?.additionalFields:{}};for(let c of a.plugins||[])c.schema&&c.schema[b]&&(d={...d,...c.schema[b].fields});return K.get(a).set(b,d),d}function N(a,b){return{...L(b,{fields:M(a,"user")}),id:b.id}}function O(a,b){return L(b,{fields:M(a,"session")})}function P(a,b){let c=b.action||"create",d=b.fields,e=Object.assign(Object.create(null),null);for(let b in d){if(b in a){if(!1===d[b].input){if(void 0!==d[b].defaultValue&&"update"!==c){e[b]=d[b].defaultValue;continue}if(a[b])throw new I.APIError("BAD_REQUEST",{message:`${b} is not allowed to be set`});continue}if(d[b].validator?.input&&void 0!==a[b]){e[b]=d[b].validator.input["~standard"].validate(a[b]);continue}if(d[b].transform?.input&&void 0!==a[b]){e[b]=d[b].transform?.input(a[b]);continue}e[b]=a[b];continue}if(void 0!==d[b].defaultValue&&"create"===c){if("function"==typeof d[b].defaultValue){e[b]=d[b].defaultValue();continue}e[b]=d[b].defaultValue;continue}if(d[b].required&&"create"===c)throw new I.APIError("BAD_REQUEST",{message:`${b} is required`})}return e}function Q(a,b={},c){return P(b,{fields:M(a,"user"),action:c})}a.i(54977);var R=a.i(14872),R=R,S=R,T=a.i(44282);function U(a,b){if(b.advanced?.ipAddress?.disableIpTracking)return null;if((0,S.p)()||(0,R.d)())return"127.0.0.1";let c="headers"in a?a.headers:a;for(let a of b.advanced?.ipAddress?.ipAddressHeaders||["x-forwarded-for"]){let b="get"in c?c.get(a):c[a];if("string"==typeof b){var d;let a=b.split(",")[0].trim();if(d=a,T.ipv4().safeParse(d).success||T.ipv6().safeParse(d).success)return a}}return null}var V=a.i(88445);a.i(67243);var W=a.i(38067),W=W,X=W,Y=W,Z=R,$=a.i(29470);a.i(77786);var _=a.i(48280),aa=a.i(23388);a.i(96234);var ab=a.i(64551);async function ac(b,c){let d;if(b.database)d="function"==typeof b.database?b.database(b):await c(b);else{let c=Object.keys((0,G.a)(b)).reduce((a,b)=>(a[b]=[],a),{}),{memoryAdapter:e}=await a.A(90644);d=e(c)(b)}return d.transaction||($.logger.warn("Adapter does not correctly implement transaction function, patching it automatically. Please update your adapter implementation."),d.transaction=async a=>a(d)),d}async function ad(b){return ac(b,async b=>{let{createKyselyAdapter:c}=await a.A(46791),{kysely:d,databaseType:e,transaction:f}=await c(b);if(!d)throw new _.BetterAuthError("Failed to initialize database adapter");let{kyselyAdapter:g}=await a.A(46791);return g(d,{type:e||"sqlite",debugLogs:!!b.database&&"debugLogs"in b.database&&b.database.debugLogs,transaction:f})(b)})}a.s(["default",0,ab],42056),a.i(42056),a.s(["$brand",()=>ab.$brand,"$input",()=>ab.$input,"$output",()=>ab.$output,"NEVER",()=>ab.NEVER,"TimePrecision",()=>ab.TimePrecision,"ZodAny",()=>ab.ZodAny,"ZodArray",()=>ab.ZodArray,"ZodBase64",()=>ab.ZodBase64,"ZodBase64URL",()=>ab.ZodBase64URL,"ZodBigInt",()=>ab.ZodBigInt,"ZodBigIntFormat",()=>ab.ZodBigIntFormat,"ZodBoolean",()=>ab.ZodBoolean,"ZodCIDRv4",()=>ab.ZodCIDRv4,"ZodCIDRv6",()=>ab.ZodCIDRv6,"ZodCUID",()=>ab.ZodCUID,"ZodCUID2",()=>ab.ZodCUID2,"ZodCatch",()=>ab.ZodCatch,"ZodCodec",()=>ab.ZodCodec,"ZodCustom",()=>ab.ZodCustom,"ZodCustomStringFormat",()=>ab.ZodCustomStringFormat,"ZodDate",()=>ab.ZodDate,"ZodDefault",()=>ab.ZodDefault,"ZodDiscriminatedUnion",()=>ab.ZodDiscriminatedUnion,"ZodE164",()=>ab.ZodE164,"ZodEmail",()=>ab.ZodEmail,"ZodEmoji",()=>ab.ZodEmoji,"ZodEnum",()=>ab.ZodEnum,"ZodError",()=>ab.ZodError,"ZodFile",()=>ab.ZodFile,"ZodFirstPartyTypeKind",()=>ab.ZodFirstPartyTypeKind,"ZodFunction",()=>ab.ZodFunction,"ZodGUID",()=>ab.ZodGUID,"ZodIPv4",()=>ab.ZodIPv4,"ZodIPv6",()=>ab.ZodIPv6,"ZodISODate",()=>ab.ZodISODate,"ZodISODateTime",()=>ab.ZodISODateTime,"ZodISODuration",()=>ab.ZodISODuration,"ZodISOTime",()=>ab.ZodISOTime,"ZodIntersection",()=>ab.ZodIntersection,"ZodIssueCode",()=>ab.ZodIssueCode,"ZodJWT",()=>ab.ZodJWT,"ZodKSUID",()=>ab.ZodKSUID,"ZodLazy",()=>ab.ZodLazy,"ZodLiteral",()=>ab.ZodLiteral,"ZodMAC",()=>ab.ZodMAC,"ZodMap",()=>ab.ZodMap,"ZodNaN",()=>ab.ZodNaN,"ZodNanoID",()=>ab.ZodNanoID,"ZodNever",()=>ab.ZodNever,"ZodNonOptional",()=>ab.ZodNonOptional,"ZodNull",()=>ab.ZodNull,"ZodNullable",()=>ab.ZodNullable,"ZodNumber",()=>ab.ZodNumber,"ZodNumberFormat",()=>ab.ZodNumberFormat,"ZodObject",()=>ab.ZodObject,"ZodOptional",()=>ab.ZodOptional,"ZodPipe",()=>ab.ZodPipe,"ZodPrefault",()=>ab.ZodPrefault,"ZodPromise",()=>ab.ZodPromise,"ZodReadonly",()=>ab.ZodReadonly,"ZodRealError",()=>ab.ZodRealError,"ZodRecord",()=>ab.ZodRecord,"ZodSet",()=>ab.ZodSet,"ZodString",()=>ab.ZodString,"ZodStringFormat",()=>ab.ZodStringFormat,"ZodSuccess",()=>ab.ZodSuccess,"ZodSymbol",()=>ab.ZodSymbol,"ZodTemplateLiteral",()=>ab.ZodTemplateLiteral,"ZodTransform",()=>ab.ZodTransform,"ZodTuple",()=>ab.ZodTuple,"ZodType",()=>ab.ZodType,"ZodULID",()=>ab.ZodULID,"ZodURL",()=>ab.ZodURL,"ZodUUID",()=>ab.ZodUUID,"ZodUndefined",()=>ab.ZodUndefined,"ZodUnion",()=>ab.ZodUnion,"ZodUnknown",()=>ab.ZodUnknown,"ZodVoid",()=>ab.ZodVoid,"ZodXID",()=>ab.ZodXID,"_ZodString",()=>ab._ZodString,"_default",()=>ab._default,"_function",()=>ab._function,"any",()=>ab.any,"array",()=>ab.array,"base64",()=>ab.base64,"base64url",()=>ab.base64url,"bigint",()=>ab.bigint,"boolean",()=>ab.boolean,"catch",()=>ab.catch,"check",()=>ab.check,"cidrv4",()=>ab.cidrv4,"cidrv6",()=>ab.cidrv6,"clone",()=>ab.clone,"codec",()=>ab.codec,"coerce",()=>ab.coerce,"config",()=>ab.config,"core",()=>ab.core,"cuid",()=>ab.cuid,"cuid2",()=>ab.cuid2,"custom",()=>ab.custom,"date",()=>ab.date,"decode",()=>ab.decode,"decodeAsync",()=>ab.decodeAsync,"default",0,ab,"describe",()=>ab.describe,"discriminatedUnion",()=>ab.discriminatedUnion,"e164",()=>ab.e164,"email",()=>ab.email,"emoji",()=>ab.emoji,"encode",()=>ab.encode,"encodeAsync",()=>ab.encodeAsync,"endsWith",()=>ab.endsWith,"enum",()=>ab.enum,"file",()=>ab.file,"flattenError",()=>ab.flattenError,"float32",()=>ab.float32,"float64",()=>ab.float64,"formatError",()=>ab.formatError,"function",()=>ab.function,"getErrorMap",()=>ab.getErrorMap,"globalRegistry",()=>ab.globalRegistry,"gt",()=>ab.gt,"gte",()=>ab.gte,"guid",()=>ab.guid,"hash",()=>ab.hash,"hex",()=>ab.hex,"hostname",()=>ab.hostname,"httpUrl",()=>ab.httpUrl,"includes",()=>ab.includes,"instanceof",()=>ab.instanceof,"int",()=>ab.int,"int32",()=>ab.int32,"int64",()=>ab.int64,"intersection",()=>ab.intersection,"ipv4",()=>ab.ipv4,"ipv6",()=>ab.ipv6,"iso",()=>ab.iso,"json",()=>ab.json,"jwt",()=>ab.jwt,"keyof",()=>ab.keyof,"ksuid",()=>ab.ksuid,"lazy",()=>ab.lazy,"length",()=>ab.length,"literal",()=>ab.literal,"locales",()=>ab.locales,"looseObject",()=>ab.looseObject,"lowercase",()=>ab.lowercase,"lt",()=>ab.lt,"lte",()=>ab.lte,"mac",()=>ab.mac,"map",()=>ab.map,"maxLength",()=>ab.maxLength,"maxSize",()=>ab.maxSize,"meta",()=>ab.meta,"mime",()=>ab.mime,"minLength",()=>ab.minLength,"minSize",()=>ab.minSize,"multipleOf",()=>ab.multipleOf,"nan",()=>ab.nan,"nanoid",()=>ab.nanoid,"nativeEnum",()=>ab.nativeEnum,"negative",()=>ab.negative,"never",()=>ab.never,"nonnegative",()=>ab.nonnegative,"nonoptional",()=>ab.nonoptional,"nonpositive",()=>ab.nonpositive,"normalize",()=>ab.normalize,"null",()=>ab.null,"nullable",()=>ab.nullable,"nullish",()=>ab.nullish,"number",()=>ab.number,"object",()=>ab.object,"optional",()=>ab.optional,"overwrite",()=>ab.overwrite,"parse",()=>ab.parse,"parseAsync",()=>ab.parseAsync,"partialRecord",()=>ab.partialRecord,"pipe",()=>ab.pipe,"positive",()=>ab.positive,"prefault",()=>ab.prefault,"preprocess",()=>ab.preprocess,"prettifyError",()=>ab.prettifyError,"promise",()=>ab.promise,"property",()=>ab.property,"readonly",()=>ab.readonly,"record",()=>ab.record,"refine",()=>ab.refine,"regex",()=>ab.regex,"regexes",()=>ab.regexes,"registry",()=>ab.registry,"safeDecode",()=>ab.safeDecode,"safeDecodeAsync",()=>ab.safeDecodeAsync,"safeEncode",()=>ab.safeEncode,"safeEncodeAsync",()=>ab.safeEncodeAsync,"safeParse",()=>ab.safeParse,"safeParseAsync",()=>ab.safeParseAsync,"set",()=>ab.set,"setErrorMap",()=>ab.setErrorMap,"size",()=>ab.size,"slugify",()=>ab.slugify,"startsWith",()=>ab.startsWith,"strictObject",()=>ab.strictObject,"string",()=>ab.string,"stringFormat",()=>ab.stringFormat,"stringbool",()=>ab.stringbool,"success",()=>ab.success,"superRefine",()=>ab.superRefine,"symbol",()=>ab.symbol,"templateLiteral",()=>ab.templateLiteral,"toJSONSchema",()=>ab.toJSONSchema,"toLowerCase",()=>ab.toLowerCase,"toUpperCase",()=>ab.toUpperCase,"transform",()=>ab.transform,"treeifyError",()=>ab.treeifyError,"trim",()=>ab.trim,"tuple",()=>ab.tuple,"uint32",()=>ab.uint32,"uint64",()=>ab.uint64,"ulid",()=>ab.ulid,"undefined",()=>ab.undefined,"union",()=>ab.union,"unknown",()=>ab.unknown,"uppercase",()=>ab.uppercase,"url",()=>ab.url,"util",()=>ab.util,"uuid",()=>ab.uuid,"uuidv4",()=>ab.uuidv4,"uuidv6",()=>ab.uuidv6,"uuidv7",()=>ab.uuidv7,"void",()=>ab.void,"xid",()=>ab.xid,"z",0,ab],79728),a.i(79728);let ae=(a,b)=>{let c,d=b.logger,e=b.options,f=e.secondaryStorage,g=e.session?.expiresIn||604800,{createWithHooks:h,updateWithHooks:i,updateManyWithHooks:j,deleteWithHooks:k,deleteManyWithHooks:l}=(c=b.hooks,{createWithHooks:async function(b,d,e){let f=await (0,X.u)(),g=b;for(let a of c||[]){let b=a[d]?.create?.before;if(b){let a=await b(g,f);if(!1===a)return null;"object"==typeof a&&"data"in a&&(g={...g,...a.data})}}let h=e?await e.fn(g):null,i=!e||e.executeMainFn?await (await (0,W.t)(a)).create({model:d,data:g,forceAllowId:!0}):h;for(let a of c||[]){let b=a[d]?.create?.after;b&&await b(i,f)}return i},updateWithHooks:async function(b,d,e,f){let g=await (0,X.u)(),h=b;for(let a of c||[]){let c=a[e]?.update?.before;if(c){let a=await c(b,g);if(!1===a)return null;"object"==typeof a&&"data"in a&&(h={...h,...a.data})}}let i=f?await f.fn(h):null,j=!f||f.executeMainFn?await (await (0,W.t)(a)).update({model:e,update:h,where:d}):i;for(let a of c||[]){let b=a[e]?.update?.after;b&&await b(j,g)}return j},updateManyWithHooks:async function(b,d,e,f){let g=await (0,X.u)(),h=b;for(let a of c||[]){let c=a[e]?.update?.before;if(c){let a=await c(b,g);if(!1===a)return null;"object"==typeof a&&"data"in a&&(h={...h,...a.data})}}let i=f?await f.fn(h):null,j=!f||f.executeMainFn?await (await (0,W.t)(a)).updateMany({model:e,update:h,where:d}):i;for(let a of c||[]){let b=a[e]?.update?.after;b&&await b(j,g)}return j},deleteWithHooks:async function(b,d,e){let f=await (0,X.u)(),g=null;try{g=(await (await (0,W.t)(a)).findMany({model:d,where:b,limit:1}))[0]||null}catch(a){}if(g)for(let a of c||[]){let b=a[d]?.delete?.before;if(b&&await b(g,f)===!1)return null}let h=e?await e.fn(b):null,i=!e||e.executeMainFn?await (await (0,W.t)(a)).delete({model:d,where:b}):h;if(g)for(let a of c||[]){let b=a[d]?.delete?.after;b&&await b(g,f)}return i},deleteManyWithHooks:async function(b,d,e){let f=await (0,X.u)(),g=[];try{g=await (await (0,W.t)(a)).findMany({model:d,where:b})}catch(a){}for(let a of g)for(let b of c||[]){let c=b[d]?.delete?.before;if(c&&await c(a,f)===!1)return null}let h=e?await e.fn(b):null,i=!e||e.executeMainFn?await (await (0,W.t)(a)).deleteMany({model:d,where:b}):h;for(let a of g)for(let b of c||[]){let c=b[d]?.delete?.after;c&&await c(a,f)}return i}});async function m(a){if(!f)return;let b=await f.get(`active-sessions-${a.id}`);if(!b)return;let c=Date.now(),d=((0,V.t)(b)||[]).filter(a=>a.expiresAt>c);await Promise.all(d.map(async({token:b})=>{let d=await f.get(b);if(!d)return;let e=(0,V.t)(d);if(!e)return;let g=Math.max(Math.floor(new Date(e.session.expiresAt).getTime()-c)/1e3,0);await f.set(b,JSON.stringify({session:e.session,user:a}),Math.floor(g))}))}return{createOAuthUser:async(b,c)=>(0,Y.i)(a,async()=>{let a=await h({createdAt:new Date,updatedAt:new Date,...b},"user",void 0);return{user:a,account:await h({...c,userId:a.id,createdAt:new Date,updatedAt:new Date},"account",void 0)}}),createUser:async a=>await h({createdAt:new Date,updatedAt:new Date,...a,email:a.email?.toLowerCase()},"user",void 0),createAccount:async a=>await h({createdAt:new Date,updatedAt:new Date,...a},"account",void 0),listSessions:async c=>{if(f){let a=await f.get(`active-sessions-${c}`);if(!a)return[];let d=(0,V.t)(a)||[],e=Date.now(),g=d.filter(a=>a.expiresAt>e),h=[];for(let a of g){let c=await f.get(a.token);if(c){let a=(0,V.t)(c);if(!a)return[];let d=O(b.options,{...a.session,expiresAt:new Date(a.session.expiresAt)});h.push(d)}}return h}return await (await (0,W.t)(a)).findMany({model:"session",where:[{field:"userId",value:c}]})},listUsers:async(b,c,d,e)=>await (await (0,W.t)(a)).findMany({model:"user",limit:b,offset:c,sortBy:d,where:e}),countTotalUsers:async b=>{let c=await (await (0,W.t)(a)).count({model:"user",where:b});return"string"==typeof c?parseInt(c):c},deleteUser:async a=>{f&&await f.delete(`active-sessions-${a}`),(!f||e.session?.storeSessionInDatabase)&&await l([{field:"userId",value:a}],"session",void 0),await l([{field:"userId",value:a}],"account",void 0),await k([{field:"id",value:a}],"user",void 0)},createSession:async(b,c,d,i)=>{let j=await (0,X.u)().catch(()=>null),k=j?.headers||j?.request?.headers,{id:l,...m}=d||{},n=P({},{fields:M(j?.context.options??e,"session")}),o={ipAddress:(j?.request||j?.headers)&&U(j?.request||j?.headers,j?.context.options)||"",userAgent:k?.get("user-agent")||"",...m,expiresAt:c?J(86400,"sec"):J(g,"sec"),userId:b,token:(0,H.t)(32),createdAt:new Date,updatedAt:new Date,...n,...i?m:{}};return await h(o,"session",f?{fn:async c=>{let d=await f.get(`active-sessions-${b}`),e=[],g=Date.now();d&&(e=(e=(0,V.t)(d)||[]).filter(a=>a.expiresAt>g));let h=e.sort((a,b)=>a.expiresAt-b.expiresAt),i=h.at(-1)?.expiresAt;h.push({token:o.token,expiresAt:o.expiresAt.getTime()}),(!i||i<o.expiresAt.getTime())&&(i=o.expiresAt.getTime());let j=Math.max(Math.floor((i-g)/1e3),0);j>0&&await f.set(`active-sessions-${b}`,JSON.stringify(h),j);let k=await a.findOne({model:"user",where:[{field:"id",value:b}]}),l=Math.max(Math.floor((o.expiresAt.getTime()-g)/1e3),0);return l>0&&await f.set(o.token,JSON.stringify({session:c,user:k}),l),c},executeMainFn:e.session?.storeSessionInDatabase}:void 0)},findSession:async c=>{if(f){let a=await f.get(c);if(!a&&!e.session?.storeSessionInDatabase)return null;if(a){let c=(0,V.t)(a);return c?{session:O(b.options,{...c.session,expiresAt:new Date(c.session.expiresAt),createdAt:new Date(c.session.createdAt),updatedAt:new Date(c.session.updatedAt)}),user:N(b.options,{...c.user,createdAt:new Date(c.user.createdAt),updatedAt:new Date(c.user.updatedAt)})}:null}}let d=await (await (0,W.t)(a)).findOne({model:"session",where:[{value:c,field:"token"}],join:{user:!0}});if(!d)return null;let{user:g,...h}=d;return g?{session:O(b.options,h),user:N(b.options,g)}:null},findSessions:async b=>{if(f){let a=[];for(let c of b){let b=await f.get(c);if(b){let c=(0,V.t)(b);if(!c)return[];let d={session:{...c.session,expiresAt:new Date(c.session.expiresAt)},user:{...c.user,createdAt:new Date(c.user.createdAt),updatedAt:new Date(c.user.updatedAt)}};a.push(d)}}return a}let c=await (await (0,W.t)(a)).findMany({model:"session",where:[{field:"token",value:b,operator:"in"}],join:{user:!0}});return!c.length||c.some(a=>!a.user)?[]:c.map(a=>{let{user:b,...c}=a;return{session:c,user:b}})},updateSession:async(a,b)=>await i(b,[{field:"token",value:a}],"session",f?{async fn(b){let c=await f.get(a);if(!c)return null;{let a=(0,V.t)(c);return a?{...a.session,...b}:null}},executeMainFn:e.session?.storeSessionInDatabase}:void 0),deleteSession:async c=>{if(f){let a=await f.get(c);if(a){let{session:b}=(0,V.t)(a)??{};if(!b)return void d.error("Session not found in secondary storage");let e=b.userId,g=await f.get(`active-sessions-${e}`);if(g){let a=(0,V.t)(g)||[],b=Date.now(),d=a.filter(a=>a.expiresAt>b&&a.token!==c),h=d.sort((a,b)=>a.expiresAt-b.expiresAt).at(-1)?.expiresAt;d.length>0&&h&&h>Date.now()?await f.set(`active-sessions-${e}`,JSON.stringify(d),Math.floor((h-b)/1e3)):await f.delete(`active-sessions-${e}`)}else d.error("Active sessions list not found in secondary storage")}if(await f.delete(c),!e.session?.storeSessionInDatabase||b.options.session?.preserveSessionInDatabase)return}await (await (0,W.t)(a)).delete({model:"session",where:[{field:"token",value:c}]})},deleteAccounts:async a=>{await l([{field:"userId",value:a}],"account",void 0)},deleteAccount:async a=>{await k([{field:"id",value:a}],"account",void 0)},deleteSessions:async a=>{if(f){if("string"==typeof a){let b=await f.get(`active-sessions-${a}`),c=b?(0,V.t)(b):[];if(!c)return;for(let a of c)await f.delete(a.token)}else for(let b of a)await f.get(b)&&await f.delete(b);if(!e.session?.storeSessionInDatabase||b.options.session?.preserveSessionInDatabase)return}await l([{field:Array.isArray(a)?"token":"userId",value:a,operator:Array.isArray(a)?"in":void 0}],"session",void 0)},findOAuthUser:async(b,c,d)=>{let e=await (await (0,W.t)(a)).findMany({model:"account",where:[{value:c,field:"accountId"}],join:{user:!0}}).then(a=>a.find(a=>a.providerId===d));if(e)if(e.user)return{user:e.user,accounts:[e]};else{let c=await (await (0,W.t)(a)).findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}]});return c?{user:c,accounts:[e]}:null}{let c=await (await (0,W.t)(a)).findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}]});return c?{user:c,accounts:await (await (0,W.t)(a)).findMany({model:"account",where:[{value:c.id,field:"userId"}]})||[]}:null}},findUserByEmail:async(b,c)=>{let d=await (await (0,W.t)(a)).findOne({model:"user",where:[{value:b.toLowerCase(),field:"email"}],join:{...c?.includeAccounts?{account:!0}:{}}});if(!d)return null;let{account:e,...f}=d;return{user:f,accounts:e??[]}},findUserById:async b=>b?await (await (0,W.t)(a)).findOne({model:"user",where:[{field:"id",value:b}]}):null,linkAccount:async a=>await h({createdAt:new Date,updatedAt:new Date,...a},"account",void 0),updateUser:async(a,b)=>{let c=await i(b,[{field:"id",value:a}],"user",void 0);return await m(c),await m(c),c},updateUserByEmail:async(a,b)=>{let c=await i(b,[{field:"email",value:a.toLowerCase()}],"user",void 0);return await m(c),await m(c),c},updatePassword:async(a,b)=>{await j({password:b},[{field:"userId",value:a},{field:"providerId",value:"credential"}],"account",void 0)},findAccounts:async b=>await (await (0,W.t)(a)).findMany({model:"account",where:[{field:"userId",value:b}]}),findAccount:async b=>await (await (0,W.t)(a)).findOne({model:"account",where:[{field:"accountId",value:b}]}),findAccountByProviderId:async(b,c)=>await (await (0,W.t)(a)).findOne({model:"account",where:[{field:"accountId",value:b},{field:"providerId",value:c}]}),findAccountByUserId:async b=>await (await (0,W.t)(a)).findMany({model:"account",where:[{field:"userId",value:b}]}),updateAccount:async(a,b)=>await i(b,[{field:"id",value:a}],"account",void 0),createVerificationValue:async a=>await h({createdAt:new Date,updatedAt:new Date,...a},"verification",void 0),findVerificationValue:async b=>{let c=await (await (0,W.t)(a)).findMany({model:"verification",where:[{field:"identifier",value:b}],sortBy:{field:"createdAt",direction:"desc"},limit:1});return e.verification?.disableCleanup||await (await (0,W.t)(a)).deleteMany({model:"verification",where:[{field:"expiresAt",value:new Date,operator:"lt"}]}),c[0]},deleteVerificationValue:async b=>{await (await (0,W.t)(a)).delete({model:"verification",where:[{field:"id",value:b}]})},deleteVerificationByIdentifier:async b=>{await (await (0,W.t)(a)).delete({model:"verification",where:[{field:"identifier",value:b}]})},updateVerificationValue:async(a,b)=>await i(b,[{field:"id",value:a}],"verification",void 0)}},af={postgres:{string:["character varying","varchar","text","uuid"],number:["int4","integer","bigint","smallint","numeric","real","double precision"],boolean:["bool","boolean"],date:["timestamptz","timestamp","date"],json:["json","jsonb"]},mysql:{string:["varchar","text","uuid"],number:["integer","int","bigint","smallint","decimal","float","double"],boolean:["boolean","tinyint"],date:["timestamp","datetime","date"],json:["json"]},sqlite:{string:["TEXT"],number:["INTEGER","REAL"],boolean:["INTEGER","BOOLEAN"],date:["DATE","INTEGER"],json:["TEXT"]},mssql:{string:["varchar","nvarchar","uniqueidentifier"],number:["int","bigint","smallint","decimal","float","double"],boolean:["bit","smallint"],date:["datetime2","date","datetime"],json:["varchar","nvarchar"]}};async function ag(a){try{let b=await aa.sql`SHOW search_path`.execute(a);if(b.rows[0]?.search_path)return b.rows[0].search_path.split(",").map(a=>a.trim()).map(a=>a.replace(/^["']|["']$/g,"")).filter(a=>!a.startsWith("$"))[0]||"public"}catch(a){}return"public"}async function ah(a){let b=function(a){let b=(0,G.a)(a),c={};for(let a in b){let d=b[a],e=d.fields,f={};if(Object.entries(e).forEach(([a,c])=>{if(f[c.fieldName||a]=c,c.references){let d=b[c.references.model];d&&(f[c.fieldName||a].references={...c.references,model:d.modelName,field:c.references.field})}}),c[d.modelName]){c[d.modelName].fields={...c[d.modelName].fields,...f};continue}c[d.modelName]={fields:f,order:d.order||1/0}}return c}(a),c=(0,Z.n)(a.logger),{kysely:d,databaseType:e}=await (0,F.t)(a);e||(c.warn("Could not determine database type, defaulting to sqlite. Please provide a type in the database options to avoid this."),e="sqlite"),d||(c.error("Only kysely adapter is supported for migrations. You can use `generate` command to generate the schema, if you're using a different adapter."),process.exit(1));let f="public";if("postgres"===e){f=await ag(d),c.debug(`PostgreSQL migration: Using schema '${f}' (from search_path)`);try{(await aa.sql`
				SELECT schema_name 
				FROM information_schema.schemata 
				WHERE schema_name = ${f}
			`.execute(d)).rows[0]||c.warn(`Schema '${f}' does not exist. Tables will be inspected from available schemas. Consider creating the schema first or checking your database configuration.`)}catch(a){c.debug(`Could not verify schema existence: ${a instanceof Error?a.message:String(a)}`)}}let g=await d.introspection.getTables(),h=g;if("postgres"===e)try{let a=await aa.sql`
				SELECT table_name 
				FROM information_schema.tables 
				WHERE table_schema = ${f}
				AND table_type = 'BASE TABLE'
			`.execute(d),b=new Set(a.rows.map(a=>a.table_name));h=g.filter(a=>a.schema===f&&b.has(a.name)),c.debug(`Found ${h.length} table(s) in schema '${f}': ${h.map(a=>a.name).join(", ")||"(none)"}`)}catch(a){c.warn(`Could not filter tables by schema. Using all discovered tables. Error: ${a instanceof Error?a.message:String(a)}`)}let i=[],j=[];for(let[a,d]of Object.entries(b)){let b=h.find(b=>b.name===a);if(!b){let b=i.findIndex(b=>b.table===a),c={table:a,fields:d.fields,order:d.order||1/0},e=i.findIndex(a=>(a.order||1/0)>c.order);-1===e?-1===b?i.push(c):i[b].fields={...i[b].fields,...d.fields}:i.splice(e,0,c);continue}let f={};for(let[g,h]of Object.entries(d.fields)){let d=b.columns.find(a=>a.name===g);if(!d){f[g]=h;continue}!function(a,b,c){if("string[]"===b||"number[]"===b)return a.toLowerCase().includes("json");let d=af[c];return(Array.isArray(b)?d.string.map(a=>a.toLowerCase()):d[b].map(a=>a.toLowerCase())).includes(a.toLowerCase().split("(")[0].trim())}(d.dataType,h.type,e)&&c.warn(`Field ${g} in table ${a} has a different type in the database. Expected ${h.type} but got ${d.dataType}.`)}Object.keys(f).length>0&&j.push({table:a,fields:f,order:d.order||1/0})}let k=[],l=a.advanced?.database?.generateId==="uuid",m=a.advanced?.database?.useNumberId||a.advanced?.database?.generateId==="serial";function n(a,b){let c=a.type,d={string:{sqlite:"text",postgres:"text",mysql:a.unique?"varchar(255)":a.references?"varchar(36)":a.sortable||a.index?"varchar(255)":"text",mssql:a.unique||a.sortable?"varchar(255)":a.references?"varchar(36)":"varchar(8000)"},boolean:{sqlite:"integer",postgres:"boolean",mysql:"boolean",mssql:"smallint"},number:{sqlite:a.bigint?"bigint":"integer",postgres:a.bigint?"bigint":"integer",mysql:a.bigint?"bigint":"integer",mssql:a.bigint?"bigint":"integer"},date:{sqlite:"date",postgres:"timestamptz",mysql:"timestamp(3)",mssql:aa.sql`datetime2(3)`},json:{sqlite:"text",postgres:"jsonb",mysql:"json",mssql:"varchar(8000)"},id:{postgres:m?aa.sql`integer GENERATED BY DEFAULT AS IDENTITY`:l?"uuid":"text",mysql:m?"integer":"varchar(36)",mssql:m?"integer":"varchar(36)",sqlite:m?"integer":"text"},foreignKeyId:{postgres:m?"integer":l?"uuid":"text",mysql:m?"integer":"varchar(36)",mssql:m?"integer":"varchar(36)",sqlite:m?"integer":"text"}};if("id"===b||a.references?.field==="id")return"id"===b?d.id[e]:d.foreignKeyId[e];if("sqlite"===e&&("string[]"===c||"number[]"===c))return"text";if("string[]"===c||"number[]"===c)return"jsonb";if(Array.isArray(c))return"text";if(!(c in d))throw Error(`Unsupported field type '${String(c)}' for field '${b}'. Allowed types are: string, number, boolean, date, string[], number[]. If you need to store structured data, store it as a JSON string (type: "string") or split it into primitive fields. See https://better-auth.com/docs/advanced/schema#additional-fields`);return d[c][e||"sqlite"]}let o=(0,G.t)({schema:(0,G.a)(a),usePlural:!1}),p=(0,G.n)({schema:(0,G.a)(a),usePlural:!1});function q(a,b){try{return`${o(a)}.${p({model:a,field:b})}`}catch{return`${a}.${b}`}}if(j.length)for(let a of j)for(let[b,c]of Object.entries(a.fields)){let f=n(c,b),g=d.schema.alterTable(a.table);if(c.index){let c=d.schema.alterTable(a.table).addIndex(`${a.table}_${b}_idx`);k.push(c)}let h=g.addColumn(b,f,a=>(a=!1!==c.required?a.notNull():a,c.references&&(a=a.references(q(c.references.model,c.references.field)).onDelete(c.references.onDelete||"cascade")),c.unique&&(a=a.unique()),"date"===c.type&&"function"==typeof c.defaultValue&&("postgres"===e||"mysql"===e||"mssql"===e)&&(a="mysql"===e?a.defaultTo(aa.sql`CURRENT_TIMESTAMP(3)`):a.defaultTo(aa.sql`CURRENT_TIMESTAMP`)),a));k.push(h)}let r=[];if(a.advanced?.database?.useNumberId&&c.warn("`useNumberId` is deprecated. Please use `generateId` with `serial` instead."),i.length)for(let a of i){let b=n({type:m?"number":"string"},"id"),c=d.schema.createTable(a.table).addColumn("id",b,a=>{if(m)return"postgres"===e?a.primaryKey().notNull():"sqlite"===e?a.primaryKey().notNull():"mssql"===e?a.identity().primaryKey().notNull():a.autoIncrement().primaryKey().notNull();return l&&"postgres"===e?a.primaryKey().defaultTo(aa.sql`pg_catalog.gen_random_uuid()`).notNull():a.primaryKey().notNull()});for(let[b,f]of Object.entries(a.fields)){let g=n(f,b);if(c=c.addColumn(b,g,a=>(a=!1!==f.required?a.notNull():a,f.references&&(a=a.references(q(f.references.model,f.references.field)).onDelete(f.references.onDelete||"cascade")),f.unique&&(a=a.unique()),"date"===f.type&&"function"==typeof f.defaultValue&&("postgres"===e||"mysql"===e||"mssql"===e)&&(a="mysql"===e?a.defaultTo(aa.sql`CURRENT_TIMESTAMP(3)`):a.defaultTo(aa.sql`CURRENT_TIMESTAMP`)),a)),f.index){let c=d.schema.createIndex(`${a.table}_${b}_${f.unique?"uidx":"idx"}`).on(a.table).columns([b]);r.push(f.unique?c.unique():c)}}k.push(c)}if(r.length)for(let a of r)k.push(a);return{toBeCreated:i,toBeAdded:j,runMigrations:async function(){for(let a of k)await a.execute()},compileMigrations:async function(){return k.map(a=>a.compile().sql).join(";\n\n")+";"}}}var ai=a.i(42465);function aj(a,b="/api/auth"){try{let b=new URL(a);if("http:"!==b.protocol&&"https:"!==b.protocol)throw new _.BetterAuthError(`Invalid base URL: ${a}. URL must include 'http://' or 'https://'`)}catch(b){if(b instanceof _.BetterAuthError)throw b;throw new _.BetterAuthError(`Invalid base URL: ${a}. Please provide a valid base URL.`,String(b))}if(function(a){try{return"/"!==(new URL(a).pathname.replace(/\/+$/,"")||"/")}catch(b){throw new _.BetterAuthError(`Invalid base URL: ${a}. Please provide a valid base URL.`)}}(a))return a;let c=a.replace(/\/+$/,"");return b&&"/"!==b?(b=b.startsWith("/")?b:`/${b}`,`${c}${b}`):c}function ak(a,b,c,d,e){if(a)return aj(a,b);if(!1!==d){let a=ao.c.BETTER_AUTH_URL||ao.c.NEXT_PUBLIC_BETTER_AUTH_URL||ao.c.PUBLIC_BETTER_AUTH_URL||ao.c.NUXT_PUBLIC_BETTER_AUTH_URL||ao.c.NUXT_PUBLIC_AUTH_URL||("/"!==ao.c.BASE_URL?ao.c.BASE_URL:void 0);if(a)return aj(a,b)}let f=c?.headers.get("x-forwarded-host"),g=c?.headers.get("x-forwarded-proto");if(f&&g&&e)return aj(`${g}://${f}`,b);if(c){let a=al(c.url);if(!a)throw new _.BetterAuthError("Could not get origin from request. Please provide a valid base URL.");return aj(a,b)}}function al(a){try{let b=new URL(a);return"null"===b.origin?null:b.origin}catch(a){return null}}function am(a){try{return new URL(a).protocol}catch(a){return null}}function an(a){try{return new URL(a).host}catch(a){return null}}a.i(82080);var ao=R,ap=R,aq=a.i(55397);let ar=new Map,as={decode:(a,b="utf-8")=>(ar.has(b)||ar.set(b,new TextDecoder(b)),ar.get(b).decode(a)),encode:new TextEncoder().encode};var at=a.i(18595),au=a.i(9848);let av=(a="SHA-256",b="none")=>{let c={importKey:async(b,c)=>(0,au.getWebcryptoSubtle)().importKey("raw","string"==typeof b?new TextEncoder().encode(b):b,{name:"HMAC",hash:{name:a}},!1,[c]),sign:async(a,d)=>{"string"==typeof a&&(a=await c.importKey(a,"sign"));let e=await (0,au.getWebcryptoSubtle)().sign("HMAC",a,"string"==typeof d?new TextEncoder().encode(d):d);return"hex"===b?at.hex.encode(e):"base64"===b||"base64url"===b||"base64urlnopad"===b?aq.base64Url.encode(e,{padding:"base64urlnopad"!==b}):e},verify:async(a,d,e)=>("string"==typeof a&&(a=await c.importKey(a,"verify")),"hex"===b&&(e=at.hex.decode(e)),("base64"===b||"base64url"===b||"base64urlnopad"===b)&&(e=await aq.base64.decode(e)),(0,au.getWebcryptoSubtle)().verify("HMAC",a,"string"==typeof e?new TextEncoder().encode(e):e,"string"==typeof d?new TextEncoder().encode(d):d))};return c};function aw(a){let b=a.split("."),c=parseInt(b[b.length-1]||"0",10);return isNaN(c)?0:c}function ax(a,b){let c={};for(let d in a)c[d]={name:d,value:"",options:{...b,maxAge:0}};return c}let ay=a=>(b,c,d)=>{let e=function(a,b){let c={};for(let[d,e]of Object.entries(function(a){let b=a.headers?.get("cookie");if(!b)return{};let c={};for(let a of b.split("; ")){let[b,...d]=a.split("=");b&&d.length>0&&(c[b]=d.join("="))}return c}(b)))d.startsWith(a)&&(c[d]=e);return c}(b,d),f=d.context.logger;return{getValue:()=>Object.keys(e).sort((a,b)=>aw(a)-aw(b)).map(a=>e[a]).join(""),hasChunks:()=>Object.keys(e).length>0,chunk(d,g){let h=ax(e,c);for(let a in e)delete e[a];for(let i of function(a,b,c,d){let e=Math.ceil(b.value.length/3896);if(1===e)return c[b.name]=b.value,[b];let f=[];for(let a=0;a<e;a++){let d=`${b.name}.${a}`,e=3896*a,g=b.value.substring(e,e+3896);f.push({...b,name:d,value:g}),c[d]=g}return d.debug(`CHUNKING_${a.toUpperCase()}_COOKIE`,{message:`${a} cookie exceeds allowed 4096 bytes.`,emptyCookieSize:200,valueSize:b.value.length,chunkCount:e,chunks:f.map(a=>a.value.length+200)}),f}(a,{name:b,value:d,options:{...c,...g}},e,f))h[i.name]=i;return Object.values(h)},clean(){let a=ax(e,c);for(let a in e)delete e[a];return Object.values(a)},setCookies(a){for(let b of a)d.setCookie(b.name,b.value,b.options)}}},az=ay("Session"),aA=ay("Account");function aB(a,b){let c=a.getCookie(b);if(c)return c;let d=[],e=a.headers?.get("cookie");if(!e)return null;let f={};for(let a of e.split("; ")){let[b,...c]=a.split("=");b&&c.length>0&&(f[b]=c.join("="))}for(let[a,c]of Object.entries(f))if(a.startsWith(b+".")){let b=parseInt(a.split(".").at(-1)||"0",10);isNaN(b)||d.push({index:b,value:c})}return d.length>0?(d.sort((a,b)=>a.index-b.index),d.map(a=>a.value).join("")):null}async function aC(a,b){let c=a.context.authCookies.accountData,d={maxAge:300,...c.options},e=await (0,ai.c)(b,a.context.secret,"better-auth-account",d.maxAge);if(e.length>4096){let b=aA(c.name,d,a),f=b.chunk(e,d);b.setCookies(f)}else{let b=aA(c.name,d,a);if(b.hasChunks()){let a=b.clean();b.setCookies(a)}a.setCookie(c.name,e,d)}}async function aD(a){let b=aB(a,a.context.authCookies.accountData.name);if(b){let c=(0,V.t)(await (0,ai.s)(b,a.context.secret,"better-auth-account"));if(c)return c}return null}let aE=T.optional(T.object({disableCookieCache:ab.coerce.boolean().meta({description:"Disable cookie cache and fetch session from database"}).optional(),disableRefresh:ab.coerce.boolean().meta({description:"Disable session refresh. Useful for checking session status, without updating the session"}).optional()}));function aF(a){let b=(a.advanced?.useSecureCookies!==void 0?a.advanced?.useSecureCookies:void 0!==a.baseURL?!!a.baseURL.startsWith("https://"):ap.f)?"__Secure-":"",c=!!a.advanced?.crossSubDomainCookies?.enabled,d=c?a.advanced?.crossSubDomainCookies?.domain||(a.baseURL?new URL(a.baseURL).hostname:void 0):void 0;if(c&&!d)throw new _.BetterAuthError("baseURL is required when crossSubdomainCookies are enabled");return function(e,f={}){let g=a.advanced?.cookiePrefix||"better-auth",h=a.advanced?.cookies?.[e]?.name||`${g}.${e}`,i=a.advanced?.cookies?.[e]?.attributes;return{name:`${b}${h}`,attributes:{secure:!!b,sameSite:"lax",path:"/",httpOnly:!0,...c?{domain:d}:{},...a.advanced?.defaultCookieAttributes,...f,...i}}}}async function aG(a,b,c){if(a.context.options.session?.cookieCache?.enabled){let d,e=Object.entries(b.session).reduce((b,[c,d])=>{let e=a.context.options.session?.additionalFields?.[c];return e&&!1===e.returned||(b[c]=d),b},{}),f=N(a.context.options,b.user),g=a.context.options.session?.cookieCache?.version,h="1";if(g){if("string"==typeof g)h=g;else if("function"==typeof g){let a=g(b.session,b.user);h=a instanceof Promise?await a:a}}let i={session:e,user:f,updatedAt:Date.now(),version:h},j={...a.context.authCookies.sessionData.options,maxAge:c?void 0:a.context.authCookies.sessionData.options.maxAge},k=J(j.maxAge||60,"sec").getTime(),l=a.context.options.session?.cookieCache?.strategy||"compact";if((d="jwe"===l?await (0,ai.c)(i,a.context.secret,"better-auth-session",j.maxAge||300):"jwt"===l?await (0,ai.o)(i,a.context.secret,j.maxAge||300):aq.base64Url.encode(JSON.stringify({session:i,expiresAt:k,signature:await av("SHA-256","base64urlnopad").sign(a.context.secret,JSON.stringify({...i,expiresAt:k}))}),{padding:!1})).length>4093){let b=az(a.context.authCookies.sessionData.name,j,a),c=b.chunk(d,j);b.setCookies(c)}else{let b=az(a.context.authCookies.sessionData.name,j,a);if(b.hasChunks()){let a=b.clean();b.setCookies(a)}a.setCookie(a.context.authCookies.sessionData.name,d,j)}}}async function aH(a,b,c,d){let e=await a.getSignedCookie(a.context.authCookies.dontRememberToken.name,a.context.secret);c=void 0!==c?c:!!e;let f=a.context.authCookies.sessionToken.options,g=c?void 0:a.context.sessionConfig.expiresIn;await a.setSignedCookie(a.context.authCookies.sessionToken.name,b.session.token,a.context.secret,{...f,maxAge:g,...d}),c&&await a.setSignedCookie(a.context.authCookies.dontRememberToken.name,"true",a.context.secret,a.context.authCookies.dontRememberToken.options),await aG(a,b,c),a.context.setNewSession(b),a.context.options.secondaryStorage&&await a.context.secondaryStorage?.set(b.session.token,JSON.stringify({user:b.user,session:b.session}),Math.floor((new Date(b.session.expiresAt).getTime()-Date.now())/1e3))}function aI(a,b){a.setCookie(a.context.authCookies.sessionToken.name,"",{...a.context.authCookies.sessionToken.options,maxAge:0});let c=az(a.context.authCookies.sessionData.name,a.context.authCookies.sessionData.options,a),d=c.clean();c.setCookies(d),b||a.setCookie(a.context.authCookies.dontRememberToken.name,"",{...a.context.authCookies.dontRememberToken.options,maxAge:0})}var aJ=a.i(71679),aJ=aJ;a.i(71353);var aK=W;let aL=(0,I.createMiddleware)(async()=>({})),aM=I.createMiddleware.create({use:[aL,(0,I.createMiddleware)(async()=>({}))]}),aN=[aL],aO=(a,b,c)=>(0,I.createEndpoint)(a,{...b,use:[...b?.use||[],...aN]},async a=>(0,aK.f)(a,()=>c(a))),aP=()=>aO("/get-session",{method:"GET",operationId:"getSession",query:aE,requireHeaders:!0,metadata:{openapi:{operationId:"getSession",description:"Get the current session",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{session:{$ref:"#/components/schemas/Session"},user:{$ref:"#/components/schemas/User"}},required:["session","user"]}}}}}}}},async a=>{try{let b=await a.getSignedCookie(a.context.authCookies.sessionToken.name,a.context.secret);if(!b)return null;let c=aB(a,a.context.authCookies.sessionData.name),d=null;if(c){let b=a.context.options.session?.cookieCache?.strategy||"compact";if("jwe"===b){let b=await (0,ai.s)(c,a.context.secret,"better-auth-session");if(b&&b.session&&b.user)d={session:{session:b.session,user:b.user,updatedAt:b.updatedAt,version:b.version},expiresAt:b.exp?1e3*b.exp:Date.now()};else{let b=a.context.authCookies.sessionData.name;return a.setCookie(b,"",{maxAge:0}),a.json(null)}}else if("jwt"===b){let b=await (0,ai.l)(c,a.context.secret);if(b&&b.session&&b.user)d={session:{session:b.session,user:b.user,updatedAt:b.updatedAt,version:b.version},expiresAt:b.exp?1e3*b.exp:Date.now()};else{let b=a.context.authCookies.sessionData.name;return a.setCookie(b,"",{maxAge:0}),a.json(null)}}else{let b=(0,V.t)(as.decode(aq.base64Url.decode(c)));if(b)if(await av("SHA-256","base64urlnopad").verify(a.context.secret,JSON.stringify({...b.session,expiresAt:b.expiresAt}),b.signature))d=b;else{let b=a.context.authCookies.sessionData.name;return a.setCookie(b,"",{maxAge:0}),a.json(null)}}}let e=await a.getSignedCookie(a.context.authCookies.dontRememberToken.name,a.context.secret);if(d?.session&&a.context.options.session?.cookieCache?.enabled&&!a.query?.disableCookieCache){let b=d.session,c=a.context.options.session?.cookieCache?.version,e="1";if(c){if("string"==typeof c)e=c;else if("function"==typeof c){let a=c(b.session,b.user);e=a instanceof Promise?await a:a}}if((b.version||"1")!==e){let b=a.context.authCookies.sessionData.name;a.setCookie(b,"",{maxAge:0})}else if(d.expiresAt<Date.now()||b.session.expiresAt<new Date){let b=a.context.authCookies.sessionData.name;a.setCookie(b,"",{maxAge:0})}else{let c=a.context.sessionConfig.cookieRefreshCache;if(!1===c)return a.context.session=b,a.json({session:b.session,user:b.user});if(d.expiresAt-Date.now()<1e3*c.updateAge){let c=J(a.context.options.session?.cookieCache?.maxAge||300,"sec"),d={session:{...b.session,expiresAt:c},user:b.user,updatedAt:Date.now()};await aG(a,d,!1);let e=O(a.context.options,{...d.session,expiresAt:new Date(d.session.expiresAt),createdAt:new Date(d.session.createdAt),updatedAt:new Date(d.session.updatedAt)}),f=N(a.context.options,{...d.user,createdAt:new Date(d.user.createdAt),updatedAt:new Date(d.user.updatedAt)});return a.context.session={session:e,user:f},a.json({session:e,user:f})}let e=O(a.context.options,{...b.session,expiresAt:new Date(b.session.expiresAt),createdAt:new Date(b.session.createdAt),updatedAt:new Date(b.session.updatedAt)}),f=N(a.context.options,{...b.user,createdAt:new Date(b.user.createdAt),updatedAt:new Date(b.user.updatedAt)});return a.context.session={session:e,user:f},a.json({session:e,user:f})}}let f=await a.context.internalAdapter.findSession(b);if(a.context.session=f,!f||f.session.expiresAt<new Date)return aI(a),f&&await a.context.internalAdapter.deleteSession(f.session.token),a.json(null);if(e||a.query?.disableRefresh){let b=O(a.context.options,f.session),c=N(a.context.options,f.user);return a.json({session:b,user:c})}let g=a.context.sessionConfig.expiresIn,h=a.context.sessionConfig.updateAge;if(f.session.expiresAt.valueOf()-1e3*g+1e3*h<=Date.now()&&(!a.query?.disableRefresh||!a.context.options.session?.disableSessionRefresh)){let b=await a.context.internalAdapter.updateSession(f.session.token,{expiresAt:J(a.context.sessionConfig.expiresIn,"sec"),updatedAt:new Date});if(!b)return aI(a),a.json(null,{status:401});let c=(b.expiresAt.valueOf()-Date.now())/1e3;await aH(a,{session:b,user:f.user},!1,{maxAge:c});let d=O(a.context.options,b),e=N(a.context.options,f.user);return a.json({session:d,user:e})}return await aG(a,f,!!e),a.json(f)}catch(b){throw a.context.logger.error("INTERNAL_SERVER_ERROR",b),new I.APIError("INTERNAL_SERVER_ERROR",{message:aJ.n.FAILED_TO_GET_SESSION})}}),aQ=async(a,b)=>{if(a.context.session)return a.context.session;let c=await aP()({...a,asResponse:!1,headers:a.headers,returnHeaders:!1,returnStatus:!1,query:{...b,...a.query}}).catch(a=>null);return a.context.session=c,c},aR=aM(async a=>{let b=await aQ(a);if(!b?.session)throw new I.APIError("UNAUTHORIZED");return{session:b}}),aS=aM(async a=>{let b=await aQ(a,{disableCookieCache:!0});if(!b?.session)throw new I.APIError("UNAUTHORIZED");return{session:b}});aM(async a=>{let b=await aQ(a);if(!b?.session&&(a.request||a.headers))throw new I.APIError("UNAUTHORIZED");return{session:b}});let aT=aM(async a=>{let b=await aQ(a);if(!b?.session)throw new I.APIError("UNAUTHORIZED");if(0===a.context.sessionConfig.freshAge)return{session:b};let c=a.context.sessionConfig.freshAge,d=new Date(b.session.updatedAt||b.session.createdAt).getTime();if(!(Date.now()-d<1e3*c))throw new I.APIError("FORBIDDEN",{message:"Session is not fresh"});return{session:b}}),aU=aO("/revoke-session",{method:"POST",body:T.object({token:T.string().meta({description:"The token to revoke"})}),use:[aS],requireHeaders:!0,metadata:{openapi:{description:"Revoke a single session",requestBody:{content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",description:"The token to revoke"}},required:["token"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the session was revoked successfully"}},required:["status"]}}}}}}}},async a=>{let b=a.body.token;if((await a.context.internalAdapter.findSession(b))?.session.userId===a.context.session.user.id)try{await a.context.internalAdapter.deleteSession(b)}catch(b){throw a.context.logger.error(b&&"object"==typeof b&&"name"in b?b.name:"",b),new I.APIError("INTERNAL_SERVER_ERROR")}return a.json({status:!0})}),aV=aO("/revoke-sessions",{method:"POST",use:[aS],requireHeaders:!0,metadata:{openapi:{description:"Revoke all sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all sessions were revoked successfully"}},required:["status"]}}}}}}}},async a=>{try{await a.context.internalAdapter.deleteSessions(a.context.session.user.id)}catch(b){throw a.context.logger.error(b&&"object"==typeof b&&"name"in b?b.name:"",b),new I.APIError("INTERNAL_SERVER_ERROR")}return a.json({status:!0})}),aW=aO("/revoke-other-sessions",{method:"POST",requireHeaders:!0,use:[aS],metadata:{openapi:{description:"Revoke all other sessions for the user except the current one",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if all other sessions were revoked successfully"}},required:["status"]}}}}}}}},async a=>{let b=a.context.session;if(!b.user)throw new I.APIError("UNAUTHORIZED");let c=(await a.context.internalAdapter.listSessions(b.user.id)).filter(a=>a.expiresAt>new Date).filter(b=>b.token!==a.context.session.session.token);return await Promise.all(c.map(b=>a.context.internalAdapter.deleteSession(b.token))),a.json({status:!0})});var aX=W,aY=W,aZ=W,Y=W,R=R,ap=R,a$=R,aJ=aJ,a_=a.i(5550),a0=R,a1=Object.defineProperty,a2=Object.defineProperties,a3=Object.getOwnPropertyDescriptors,a4=Object.getOwnPropertySymbols,a5=Object.prototype.hasOwnProperty,a6=Object.prototype.propertyIsEnumerable,a7=(a,b,c)=>b in a?a1(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,a8=(a,b)=>{for(var c in b||(b={}))a5.call(b,c)&&a7(a,c,b[c]);if(a4)for(var c of a4(b))a6.call(b,c)&&a7(a,c,b[c]);return a},a9=(a,b)=>a2(a,a3(b)),ba=class extends Error{constructor(a,b,c){super(b||a.toString(),{cause:c}),this.status=a,this.statusText=b,this.error=c}},bb=async(a,b)=>{var c,d,e,f,g,h;let i=b||{},j={onRequest:[null==b?void 0:b.onRequest],onResponse:[null==b?void 0:b.onResponse],onSuccess:[null==b?void 0:b.onSuccess],onError:[null==b?void 0:b.onError],onRetry:[null==b?void 0:b.onRetry]};if(!b||!(null==b?void 0:b.plugins))return{url:a,options:i,hooks:j};for(let k of(null==b?void 0:b.plugins)||[]){if(k.init){let d=await (null==(c=k.init)?void 0:c.call(k,a.toString(),b));i=d.options||i,a=d.url}j.onRequest.push(null==(d=k.hooks)?void 0:d.onRequest),j.onResponse.push(null==(e=k.hooks)?void 0:e.onResponse),j.onSuccess.push(null==(f=k.hooks)?void 0:f.onSuccess),j.onError.push(null==(g=k.hooks)?void 0:g.onError),j.onRetry.push(null==(h=k.hooks)?void 0:h.onRetry)}return{url:a,options:i,hooks:j}},bc=class{constructor(a){this.options=a}shouldAttemptRetry(a,b){return this.options.shouldRetry?Promise.resolve(a<this.options.attempts&&this.options.shouldRetry(b)):Promise.resolve(a<this.options.attempts)}getDelay(){return this.options.delay}},bd=class{constructor(a){this.options=a}shouldAttemptRetry(a,b){return this.options.shouldRetry?Promise.resolve(a<this.options.attempts&&this.options.shouldRetry(b)):Promise.resolve(a<this.options.attempts)}getDelay(a){return Math.min(this.options.maxDelay,this.options.baseDelay*2**a)}},be=async a=>{let b={},c=async a=>"function"==typeof a?await a():a;if(null==a?void 0:a.auth){if("Bearer"===a.auth.type){let d=await c(a.auth.token);if(!d)return b;b.authorization=`Bearer ${d}`}else if("Basic"===a.auth.type){let d=c(a.auth.username),e=c(a.auth.password);if(!d||!e)return b;b.authorization=`Basic ${btoa(`${d}:${e}`)}`}else if("Custom"===a.auth.type){let d=c(a.auth.value);if(!d)return b;b.authorization=`${c(a.auth.prefix)} ${d}`}}return b},bf=/^application\/(?:[\w!#$%&*.^`~-]*\+)?json(;.+)?$/i;function bg(a){if(void 0===a)return!1;let b=typeof a;return"string"===b||"number"===b||"boolean"===b||null===b||"object"===b&&(!!Array.isArray(a)||!a.buffer&&(a.constructor&&"Object"===a.constructor.name||"function"==typeof a.toJSON))}function bh(a){try{return JSON.parse(a)}catch(b){return a}}async function bi(a){let b=new Headers(null==a?void 0:a.headers);for(let[c,d]of Object.entries(await be(a)||{}))b.set(c,d);if(!b.has("content-type")){let c=bg(null==a?void 0:a.body)?"application/json":null;c&&b.set("content-type",c)}return b}var bj=class a extends Error{constructor(b,c){super(c||JSON.stringify(b,null,2)),this.issues=b,Object.setPrototypeOf(this,a.prototype)}};async function bk(a,b){let c=await a["~standard"].validate(b);if(c.issues)throw new bj(c.issues);return c.value}var bl=["get","post","put","patch","delete"],bm=async(a,b)=>{var c,d,e,f,g,h,i,j;let k,{hooks:l,url:m,options:n}=await bb(a,b),o=function(a){if(null==a?void 0:a.customFetchImpl)return a.customFetchImpl;if("undefined"!=typeof globalThis&&"function"==typeof globalThis.fetch)return globalThis.fetch;throw Error("No fetch implementation found")}(n),p=new AbortController,q=null!=(c=n.signal)?c:p.signal,r=function(a,b){let{baseURL:c,params:d,query:e}=b||{query:{},params:{},baseURL:""},f=a.startsWith("http")?a.split("/").slice(0,3).join("/"):c||"";if(a.startsWith("@")){let b=a.toString().split("@")[1].split("/")[0];bl.includes(b)&&(a=a.replace(`@${b}/`,"/"))}f.endsWith("/")||(f+="/");let[g,h]=a.replace(f,"").split("?"),i=new URLSearchParams(h);for(let[a,b]of Object.entries(e||{}))null!=b&&i.set(a,String(b));if(d)if(Array.isArray(d))for(let[a,b]of g.split("/").filter(a=>a.startsWith(":")).entries()){let c=d[a];g=g.replace(b,c)}else for(let[a,b]of Object.entries(d))g=g.replace(`:${a}`,String(b));(g=g.split("/").map(encodeURIComponent).join("/")).startsWith("/")&&(g=g.slice(1));let j=i.toString();return(j=j.length>0?`?${j}`.replace(/\+/g,"%20"):"",f.startsWith("http"))?new URL(`${g}${j}`,f):`${f}${g}${j}`}(m,n),s=function(a){if(!(null==a?void 0:a.body))return null;let b=new Headers(null==a?void 0:a.headers);if(bg(a.body)&&!b.has("content-type")){for(let[b,c]of Object.entries(null==a?void 0:a.body))c instanceof Date&&(a.body[b]=c.toISOString());return JSON.stringify(a.body)}return a.body}(n),t=await bi(n),u=function(a,b){var c;if(null==b?void 0:b.method)return b.method.toUpperCase();if(a.startsWith("@")){let d=null==(c=a.split("@")[1])?void 0:c.split("/")[0];return bl.includes(d)?d.toUpperCase():(null==b?void 0:b.body)?"POST":"GET"}return(null==b?void 0:b.body)?"POST":"GET"}(m,n),v=a9(a8({},n),{url:r,headers:t,body:s,method:u,signal:q});for(let a of l.onRequest)if(a){let b=await a(v);b instanceof Object&&(v=b)}("pipeTo"in v&&"function"==typeof v.pipeTo||"function"==typeof(null==(d=null==b?void 0:b.body)?void 0:d.pipe))&&!("duplex"in v)&&(v.duplex="half");let{clearTimeout:w}=(!(null==n?void 0:n.signal)&&(null==n?void 0:n.timeout)&&(k=setTimeout(()=>null==p?void 0:p.abort(),null==n?void 0:n.timeout)),{abortTimeout:k,clearTimeout:()=>{k&&clearTimeout(k)}}),x=await o(v.url,v);w();let y={response:x,request:v};for(let a of l.onResponse)if(a){let c=await a(a9(a8({},y),{response:(null==(e=null==b?void 0:b.hookOptions)?void 0:e.cloneResponse)?x.clone():x}));c instanceof Response?x=c:c instanceof Object&&(x=c.response)}if(x.ok){if("HEAD"===v.method)return{data:"",error:null};let a=function(a){let b=a.headers.get("content-type"),c=new Set(["image/svg","application/xml","application/xhtml","application/html"]);if(!b)return"json";let d=b.split(";").shift()||"";return bf.test(d)?"json":c.has(d)||d.startsWith("text/")?"text":"blob"}(x),c={data:"",response:x,request:v};if("json"===a||"text"===a){let a=await x.text(),b=null!=(f=v.jsonParser)?f:bh;c.data=await b(a)}else c.data=await x[a]();for(let a of((null==v?void 0:v.output)&&v.output&&!v.disableValidation&&(c.data=await bk(v.output,c.data)),l.onSuccess))a&&await a(a9(a8({},c),{response:(null==(g=null==b?void 0:b.hookOptions)?void 0:g.cloneResponse)?x.clone():x}));return(null==b?void 0:b.throw)?c.data:{data:c.data,error:null}}let z=null!=(h=null==b?void 0:b.jsonParser)?h:bh,A=await x.text(),B=function(a){try{return JSON.parse(a),!0}catch(a){return!1}}(A),C=B?await z(A):null,D={response:x,responseText:A,request:v,error:a9(a8({},C),{status:x.status,statusText:x.statusText})};for(let a of l.onError)a&&await a(a9(a8({},D),{response:(null==(i=null==b?void 0:b.hookOptions)?void 0:i.cloneResponse)?x.clone():x}));if(null==b?void 0:b.retry){let c=function(a){if("number"==typeof a)return new bc({type:"linear",attempts:a,delay:1e3});switch(a.type){case"linear":return new bc(a);case"exponential":return new bd(a);default:throw Error("Invalid retry strategy")}}(b.retry),d=null!=(j=b.retryAttempt)?j:0;if(await c.shouldAttemptRetry(d,x)){for(let a of l.onRetry)a&&await a(y);let e=c.getDelay(d);return await new Promise(a=>setTimeout(a,e)),await bm(a,a9(a8({},b),{retryAttempt:d+1}))}}if(null==b?void 0:b.throw)throw new ba(x.status,x.statusText,B?C:A);return{data:null,error:a9(a8({},C),{status:x.status,statusText:x.statusText})}};function bn(a){let b=a=>new Date(new Date().getTime()+1e3*a);return{tokenType:a.token_type,accessToken:a.access_token,refreshToken:a.refresh_token,accessTokenExpiresAt:a.expires_in?b(a.expires_in):void 0,refreshTokenExpiresAt:a.refresh_token_expires_in?b(a.refresh_token_expires_in):void 0,scopes:a?.scope?"string"==typeof a.scope?a.scope.split(" "):a.scope:[],idToken:a.id_token,raw:a}}async function bo(a){let b=new TextEncoder().encode(a),c=await crypto.subtle.digest("SHA-256",b);return aq.base64Url.encode(new Uint8Array(c),{padding:!1})}async function bp({id:a,options:b,authorizationEndpoint:c,state:d,codeVerifier:e,scopes:f,claims:g,redirectURI:h,duration:i,prompt:j,accessType:k,responseType:l,display:m,loginHint:n,hd:o,responseMode:p,additionalParams:q,scopeJoiner:r}){let s=new URL(c);s.searchParams.set("response_type",l||"code");let t=Array.isArray(b.clientId)?b.clientId[0]:b.clientId;if(s.searchParams.set("client_id",t),s.searchParams.set("state",d),f&&s.searchParams.set("scope",f.join(r||" ")),s.searchParams.set("redirect_uri",b.redirectURI||h),i&&s.searchParams.set("duration",i),m&&s.searchParams.set("display",m),n&&s.searchParams.set("login_hint",n),j&&s.searchParams.set("prompt",j),o&&s.searchParams.set("hd",o),k&&s.searchParams.set("access_type",k),p&&s.searchParams.set("response_mode",p),e){let a=await bo(e);s.searchParams.set("code_challenge_method","S256"),s.searchParams.set("code_challenge",a)}if(g){let a=g.reduce((a,b)=>(a[b]=null,a),{});s.searchParams.set("claims",JSON.stringify({id_token:{email:null,email_verified:null,...a}}))}return q&&Object.entries(q).forEach(([a,b])=>{s.searchParams.set(a,b)}),s}async function bq({refreshToken:a,options:b,tokenEndpoint:c,authentication:d,extraParams:e}){let{body:f,headers:g}=function({refreshToken:a,options:b,authentication:c,extraParams:d,resource:e}){let f=new URLSearchParams,g={"content-type":"application/x-www-form-urlencoded",accept:"application/json"};if(f.set("grant_type","refresh_token"),f.set("refresh_token",a),"basic"===c){let a=Array.isArray(b.clientId)?b.clientId[0]:b.clientId;a?g.authorization="Basic "+aq.base64.encode(`${a}:${b.clientSecret??""}`):g.authorization="Basic "+aq.base64.encode(`:${b.clientSecret??""}`)}else{let a=Array.isArray(b.clientId)?b.clientId[0]:b.clientId;f.set("client_id",a),b.clientSecret&&f.set("client_secret",b.clientSecret)}if(e)if("string"==typeof e)f.append("resource",e);else for(let a of e)f.append("resource",a);if(d)for(let[a,b]of Object.entries(d))f.set(a,b);return{body:f,headers:g}}({refreshToken:a,options:b,authentication:d,extraParams:e}),{data:h,error:i}=await bm(c,{method:"POST",body:f,headers:g});if(i)throw i;let j={accessToken:h.access_token,refreshToken:h.refresh_token,tokenType:h.token_type,scopes:h.scope?.split(" "),idToken:h.id_token};return h.expires_in&&(j.accessTokenExpiresAt=new Date(new Date().getTime()+1e3*h.expires_in)),j}async function br({code:a,codeVerifier:b,redirectURI:c,options:d,tokenEndpoint:e,authentication:f,deviceId:g,headers:h,additionalParams:i={},resource:j}){let{body:k,headers:l}=function({code:a,codeVerifier:b,redirectURI:c,options:d,authentication:e,deviceId:f,headers:g,additionalParams:h={},resource:i}){let j=new URLSearchParams,k={"content-type":"application/x-www-form-urlencoded",accept:"application/json",...g};if(j.set("grant_type","authorization_code"),j.set("code",a),b&&j.set("code_verifier",b),d.clientKey&&j.set("client_key",d.clientKey),f&&j.set("device_id",f),j.set("redirect_uri",d.redirectURI||c),i)if("string"==typeof i)j.append("resource",i);else for(let a of i)j.append("resource",a);if("basic"===e){let a=Array.isArray(d.clientId)?d.clientId[0]:d.clientId;k.authorization=`Basic ${aq.base64.encode(`${a}:${d.clientSecret??""}`)}`}else{let a=Array.isArray(d.clientId)?d.clientId[0]:d.clientId;j.set("client_id",a),d.clientSecret&&j.set("client_secret",d.clientSecret)}for(let[a,b]of Object.entries(h))j.has(a)||j.append(a,b);return{body:j,headers:k}}({code:a,codeVerifier:b,redirectURI:c,options:d,authentication:f,deviceId:g,headers:h,additionalParams:i,resource:j}),{data:m,error:n}=await bm(e,{method:"POST",body:k,headers:l});if(n)throw n;return bn(m)}a.i(88081);var bs=aJ,bt=a.i(15123),bu=a.i(91239),bv=a.i(32542);function bw(a){return(0,bv.isObject)(a)}class bx{#a;#b=new WeakMap;constructor(a){if(!function(a){return a&&"object"==typeof a&&Array.isArray(a.keys)&&a.keys.every(bw)}(a))throw new bt.JWKSInvalid("JSON Web Key Set malformed");this.#a=structuredClone(a)}jwks(){return this.#a}async getKey(a,b){let{alg:c,kid:d}={...a,...b?.header},e=function(a){switch("string"==typeof a&&a.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";case"ML":return"AKP";default:throw new bt.JOSENotSupported('Unsupported "alg" value for a JSON Web Key Set')}}(c),f=this.#a.keys.filter(a=>{let b=e===a.kty;if(b&&"string"==typeof d&&(b=d===a.kid),b&&("string"==typeof a.alg||"AKP"===e)&&(b=c===a.alg),b&&"string"==typeof a.use&&(b="sig"===a.use),b&&Array.isArray(a.key_ops)&&(b=a.key_ops.includes("verify")),b)switch(c){case"ES256":b="P-256"===a.crv;break;case"ES384":b="P-384"===a.crv;break;case"ES512":b="P-521"===a.crv;break;case"Ed25519":case"EdDSA":b="Ed25519"===a.crv}return b}),{0:g,length:h}=f;if(0===h)throw new bt.JWKSNoMatchingKey;if(1!==h){let a=new bt.JWKSMultipleMatchingKeys,b=this.#b;throw a[Symbol.asyncIterator]=async function*(){for(let a of f)try{yield await by(b,a,c)}catch{}},a}return by(this.#b,g,c)}}async function by(a,b,c){let d=a.get(b)||a.set(b,{}).get(b);if(void 0===d[c]){let a=await (0,bu.importJWK)({...b,ext:!0},c);if(a instanceof Uint8Array||"public"!==a.type)throw new bt.JWKSInvalid("JSON Web Key Set members must be public keys");d[c]=a}return d[c]}function bz(a){let b=new bx(a),c=async(a,c)=>b.getKey(a,c);return Object.defineProperties(c,{jwks:{value:()=>structuredClone(b.jwks()),enumerable:!1,configurable:!1,writable:!1}}),c}"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(b="jose/v6.1.3");let bA=Symbol();async function bB(a,b,c,d=fetch){let e=await d(a,{method:"GET",signal:c,redirect:"manual",headers:b}).catch(a=>{if("TimeoutError"===a.name)throw new bt.JWKSTimeout;throw a});if(200!==e.status)throw new bt.JOSEError("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await e.json()}catch{throw new bt.JOSEError("Failed to parse the JSON Web Key Set HTTP response as JSON")}}let bC=Symbol();class bD{#c;#d;#e;#f;#g;#h;#i;#j;#k;#l;constructor(a,c){if(!(a instanceof URL))throw TypeError("url must be an instance of URL");this.#c=new URL(a.href),this.#d="number"==typeof c?.timeoutDuration?c?.timeoutDuration:5e3,this.#e="number"==typeof c?.cooldownDuration?c?.cooldownDuration:3e4,this.#f="number"==typeof c?.cacheMaxAge?c?.cacheMaxAge:6e5,this.#i=new Headers(c?.headers),b&&!this.#i.has("User-Agent")&&this.#i.set("User-Agent",b),this.#i.has("accept")||(this.#i.set("accept","application/json"),this.#i.append("accept","application/jwk-set+json")),this.#j=c?.[bA],c?.[bC]!==void 0&&(this.#l=c?.[bC],function(a,b){return!("object"!=typeof a||null===a||!("uat"in a)||"number"!=typeof a.uat||Date.now()-a.uat>=b)&&"jwks"in a&&!!(0,bv.isObject)(a.jwks)&&!!Array.isArray(a.jwks.keys)&&!!Array.prototype.every.call(a.jwks.keys,bv.isObject)}(c?.[bC],this.#f)&&(this.#g=this.#l.uat,this.#k=bz(this.#l.jwks)))}pendingFetch(){return!!this.#h}coolingDown(){return"number"==typeof this.#g&&Date.now()<this.#g+this.#e}fresh(){return"number"==typeof this.#g&&Date.now()<this.#g+this.#f}jwks(){return this.#k?.jwks()}async getKey(a,b){this.#k&&this.fresh()||await this.reload();try{return await this.#k(a,b)}catch(c){if(c instanceof bt.JWKSNoMatchingKey&&!1===this.coolingDown())return await this.reload(),this.#k(a,b);throw c}}async reload(){this.#h&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this.#h=void 0),this.#h||=bB(this.#c.href,this.#i,AbortSignal.timeout(this.#d),this.#j).then(a=>{this.#k=bz(a),this.#l&&(this.#l.uat=Date.now(),this.#l.jwks=a),this.#g=Date.now(),this.#h=void 0}).catch(a=>{throw this.#h=void 0,a}),await this.#h}}var bE=a.i(47824),bF=a.i(2274);function bG(a){let b,c;if("string"!=typeof a)throw new bt.JWTInvalid("JWTs must use Compact JWS serialization, JWT must be a string");let{1:d,length:e}=a.split(".");if(5===e)throw new bt.JWTInvalid("Only JWTs using Compact JWS serialization can be decoded");if(3!==e)throw new bt.JWTInvalid("Invalid JWT");if(!d)throw new bt.JWTInvalid("JWTs must contain a payload");try{b=(0,bE.decode)(d)}catch{throw new bt.JWTInvalid("Failed to base64url decode the payload")}try{c=JSON.parse(bF.decoder.decode(b))}catch{throw new bt.JWTInvalid("Failed to parse the decoded payload as JSON")}if(!(0,bv.isObject)(c))throw new bt.JWTInvalid("Invalid JWT Claims Set");return c}function bH(a){let b;if("string"==typeof a){let c=a.split(".");(3===c.length||5===c.length)&&([b]=c)}else if("object"==typeof a&&a)if("protected"in a)b=a.protected;else throw TypeError("Token does not contain a Protected Header");try{if("string"!=typeof b||!b)throw Error();let a=JSON.parse(bF.decoder.decode((0,bE.decode)(b)));if(!(0,bv.isObject)(a))throw Error();return a}catch{throw TypeError("Invalid Token or Protected Header formatting")}}let bI=async a=>{let{data:b}=await bm("https://appleid.apple.com/auth/keys");if(!b?.keys)throw new I.APIError("BAD_REQUEST",{message:"Keys not found"});let c=b.keys.find(b=>b.kid===a);if(!c)throw Error(`JWK with kid ${a} not found`);return await (0,bu.importJWK)(c,c.alg)},bJ=async(a,b,c)=>{let d=`https://cognito-idp.${b}.amazonaws.com/${c}/.well-known/jwks.json`;try{let{data:b}=await bm(d);if(!b?.keys)throw new I.APIError("BAD_REQUEST",{message:"Keys not found"});let c=b.keys.find(b=>b.kid===a);if(!c)throw Error(`JWK with kid ${a} not found`);return await (0,bu.importJWK)(c,c.alg)}catch(a){throw a0.i.error("Failed to fetch Cognito public key:",a),a}},bK=(a="")=>a.split("://").map(a=>a.replace(/\/{2,}/g,"/")).join("://"),bL={apple:a=>({id:"apple",name:"Apple",async createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["email","name"];return a.scope&&e.push(...a.scope),c&&e.push(...c),await bp({id:"apple",options:a,authorizationEndpoint:"https://appleid.apple.com/auth/authorize",scopes:e,state:b,redirectURI:d,responseMode:"form_post",responseType:"code id_token"})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>br({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://appleid.apple.com/auth/token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);let{kid:d,alg:e}=bH(b);if(!d||!e)return!1;let{payload:f}=await (0,a_.jwtVerify)(b,await bI(d),{algorithms:[e],issuer:"https://appleid.apple.com",audience:a.audience&&a.audience.length?a.audience:a.appBundleIdentifier?a.appBundleIdentifier:a.clientId,maxTokenAge:"1h"});return["email_verified","is_private_email"].forEach(a=>{void 0!==f[a]&&(f[a]=!!f[a])}),(!c||f.nonce===c)&&!!f},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://appleid.apple.com/auth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=bG(b.idToken);if(!c)return null;let d=b.user?`${b.user.name?.firstName} ${b.user.name?.lastName}`:c.name||c.email,e="boolean"==typeof c.email_verified?c.email_verified:"true"===c.email_verified,f={...c,name:d},g=await a.mapProfileToUser?.(f);return{user:{id:c.sub,name:f.name,emailVerified:e,email:c.email,...g},data:f}},options:a}),atlassian:a=>({id:"atlassian",name:"Atlassian",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){if(!a.clientId||!a.clientSecret)throw a0.i.error("Client Id and Secret are required for Atlassian"),new bs.t("CLIENT_ID_AND_SECRET_REQUIRED");if(!d)throw new bs.t("codeVerifier is required for Atlassian");let f=a.disableDefaultScope?[]:["read:jira-user","offline_access"];return a.scope&&f.push(...a.scope),c&&f.push(...c),bp({id:"atlassian",options:a,authorizationEndpoint:"https://auth.atlassian.com/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e,additionalParams:{audience:"api.atlassian.com"},prompt:a.prompt})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>br({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://auth.atlassian.com/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},tokenEndpoint:"https://auth.atlassian.com/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.accessToken)return null;try{let{data:c}=await bm("https://api.atlassian.com/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(!c)return null;let d=await a.mapProfileToUser?.(c);return{user:{id:c.account_id,name:c.name,email:c.email,image:c.picture,emailVerified:!1,...d},data:c}}catch(a){return a0.i.error("Failed to fetch user info from Figma:",a),null}},options:a}),cognito:a=>{if(!a.domain||!a.region||!a.userPoolId)throw a0.i.error("Domain, region and userPoolId are required for Amazon Cognito. Make sure to provide them in the options."),new bs.t("DOMAIN_AND_REGION_REQUIRED");let b=a.domain.replace(/^https?:\/\//,""),c=`https://${b}/oauth2/authorize`,d=`https://${b}/oauth2/token`,e=`https://${b}/oauth2/userinfo`;return{id:"cognito",name:"Cognito",async createAuthorizationURL({state:b,scopes:d,codeVerifier:e,redirectURI:f}){if(!a.clientId)throw a0.i.error("ClientId is required for Amazon Cognito. Make sure to provide them in the options."),new bs.t("CLIENT_ID_AND_SECRET_REQUIRED");if(a.requireClientSecret&&!a.clientSecret)throw a0.i.error("Client Secret is required when requireClientSecret is true. Make sure to provide it in the options."),new bs.t("CLIENT_SECRET_REQUIRED");let g=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&g.push(...a.scope),d&&g.push(...d),await bp({id:"cognito",options:{...a},authorizationEndpoint:c,scopes:g,state:b,codeVerifier:e,redirectURI:f,prompt:a.prompt})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:e})=>br({code:b,codeVerifier:c,redirectURI:e,options:a,tokenEndpoint:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:d}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);try{let{kid:d,alg:e}=bH(b);if(!d||!e)return!1;let f=await bJ(d,a.region,a.userPoolId),g=`https://cognito-idp.${a.region}.amazonaws.com/${a.userPoolId}`,{payload:h}=await (0,a_.jwtVerify)(b,f,{algorithms:[e],issuer:g,audience:a.clientId,maxTokenAge:"1h"});if(c&&h.nonce!==c)return!1;return!0}catch(a){return a0.i.error("Failed to verify ID token:",a),!1}},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(b.idToken)try{let c=bG(b.idToken);if(!c)return null;let d=c.name||c.given_name||c.username||c.email,e={...c,name:d},f=await a.mapProfileToUser?.(e);return{user:{id:c.sub,name:e.name,email:c.email,image:c.picture,emailVerified:c.email_verified,...f},data:e}}catch(a){a0.i.error("Failed to decode ID token:",a)}if(b.accessToken)try{let{data:c}=await bm(e,{headers:{Authorization:`Bearer ${b.accessToken}`}});if(c){let b=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name||c.given_name||c.username,email:c.email,image:c.picture,emailVerified:c.email_verified,...b},data:c}}}catch(a){a0.i.error("Failed to fetch user info from Cognito:",a)}return null},options:a}},discord:a=>({id:"discord",name:"Discord",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["identify","email"];c&&e.push(...c),a.scope&&e.push(...a.scope);let f=e.includes("bot")&&void 0!==a.permissions?`&permissions=${a.permissions}`:"";return new URL(`https://discord.com/api/oauth2/authorize?scope=${e.join("+")}&response_type=code&client_id=${a.clientId}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}&prompt=${a.prompt||"none"}${f}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>br({code:b,redirectURI:c,options:a,tokenEndpoint:"https://discord.com/api/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://discord.com/api/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bm("https://discord.com/api/users/@me",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;if(null===c.avatar)c.image_url=`https://cdn.discordapp.com/embed/avatars/${"0"===c.discriminator?Number(BigInt(c.id)>>BigInt(22))%6:parseInt(c.discriminator)%5}.png`;else{let a=c.avatar.startsWith("a_")?"gif":"png";c.image_url=`https://cdn.discordapp.com/avatars/${c.id}/${c.avatar}.${a}`}let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.global_name||c.username||"",email:c.email,emailVerified:c.verified,image:c.image_url,...e},data:c}},options:a}),facebook:a=>({id:"facebook",name:"Facebook",async createAuthorizationURL({state:b,scopes:c,redirectURI:d,loginHint:e}){let f=a.disableDefaultScope?[]:["email","public_profile"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await bp({id:"facebook",options:a,authorizationEndpoint:"https://www.facebook.com/v21.0/dialog/oauth",scopes:f,state:b,redirectURI:d,loginHint:e,additionalParams:a.configId?{config_id:a.configId}:{}})},validateAuthorizationCode:async({code:b,redirectURI:c})=>br({code:b,redirectURI:c,options:a,tokenEndpoint:"https://graph.facebook.com/oauth/access_token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);if(3===b.split(".").length)try{var d;let e,f,{payload:g}=await (0,a_.jwtVerify)(b,(d=new URL("https://limited.facebook.com/.well-known/oauth/openid/jwks/"),e=new bD(d,void 0),f=async(a,b)=>e.getKey(a,b),Object.defineProperties(f,{coolingDown:{get:()=>e.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>e.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>e.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>e.pendingFetch(),enumerable:!0,configurable:!1},jwks:{value:()=>e.jwks(),enumerable:!0,configurable:!1,writable:!1}}),f),{algorithms:["RS256"],audience:a.clientId,issuer:"https://www.facebook.com"});if(c&&g.nonce!==c)return!1;return!!g}catch(a){return!1}return!0},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://graph.facebook.com/v18.0/oauth/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(b.idToken&&3===b.idToken.split(".").length){let c=bG(b.idToken),d={id:c.sub,name:c.name,email:c.email,picture:{data:{url:c.picture,height:100,width:100,is_silhouette:!1}}},e=await a.mapProfileToUser?.({...d,email_verified:!1});return{user:{...d,emailVerified:!1,...e},data:c}}let{data:c,error:d}=await bm("https://graph.facebook.com/me?fields="+["id","name","email","picture",...a?.fields||[]].join(","),{auth:{type:"Bearer",token:b.accessToken}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name,email:c.email,image:c.picture.data.url,emailVerified:c.email_verified,...e},data:c}},options:a}),figma:a=>({id:"figma",name:"Figma",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){if(!a.clientId||!a.clientSecret)throw a0.i.error("Client Id and Client Secret are required for Figma. Make sure to provide them in the options."),new bs.t("CLIENT_ID_AND_SECRET_REQUIRED");if(!d)throw new bs.t("codeVerifier is required for Figma");let f=a.disableDefaultScope?[]:["file_read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await bp({id:"figma",options:a,authorizationEndpoint:"https://www.figma.com/oauth",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>br({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://www.figma.com/api/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://www.figma.com/api/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);try{let{data:c}=await bm("https://api.figma.com/v1/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(!c)return a0.i.error("Failed to fetch user from Figma"),null;let d=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.handle,email:c.email,image:c.img_url,emailVerified:!!c.email,...d},data:c}}catch(a){return a0.i.error("Failed to fetch user info from Figma:",a),null}},options:a}),github:a=>({id:"github",name:"GitHub",createAuthorizationURL({state:b,scopes:c,loginHint:d,codeVerifier:e,redirectURI:f}){let g=a.disableDefaultScope?[]:["read:user","user:email"];return a.scope&&g.push(...a.scope),c&&g.push(...c),bp({id:"github",options:a,authorizationEndpoint:"https://github.com/login/oauth/authorize",scopes:g,state:b,codeVerifier:e,redirectURI:f,loginHint:d,prompt:a.prompt})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>br({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://github.com/login/oauth/access_token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://github.com/login/oauth/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bm("https://api.github.com/user",{headers:{"User-Agent":"better-auth",authorization:`Bearer ${b.accessToken}`}});if(d)return null;let{data:e}=await bm("https://api.github.com/user/emails",{headers:{Authorization:`Bearer ${b.accessToken}`,"User-Agent":"better-auth"}});!c.email&&e&&(c.email=(e.find(a=>a.primary)??e[0])?.email);let f=e?.find(a=>a.email===c.email)?.verified??!1,g=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name||c.login,email:c.email,image:c.avatar_url,emailVerified:f,...g},data:c}},options:a}),microsoft:a=>{let b=a.tenantId||"common",c=a.authority||"https://login.microsoftonline.com",d=`${c}/${b}/oauth2/v2.0/authorize`,e=`${c}/${b}/oauth2/v2.0/token`;return{id:"microsoft",name:"Microsoft EntraID",createAuthorizationURL(b){let c=a.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return a.scope&&c.push(...a.scope),b.scopes&&c.push(...b.scopes),bp({id:"microsoft",options:a,authorizationEndpoint:d,state:b.state,codeVerifier:b.codeVerifier,scopes:c,redirectURI:b.redirectURI,prompt:a.prompt,loginHint:b.loginHint})},validateAuthorizationCode:({code:b,codeVerifier:c,redirectURI:d})=>br({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:e}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=bG(b.idToken),d=a.profilePhotoSize||48;await bm(`https://graph.microsoft.com/v1.0/me/photos/${d}x${d}/$value`,{headers:{Authorization:`Bearer ${b.accessToken}`},async onResponse(b){if(!a.disableProfilePhoto&&b.response.ok)try{let a=await b.response.clone().arrayBuffer();c.picture=`data:image/jpeg;base64, ${aq.base64.encode(a)}`}catch(a){a0.i.error(a&&"object"==typeof a&&"name"in a?a.name:"",a)}}});let e=await a.mapProfileToUser?.(c),f=void 0!==c.email_verified?c.email_verified:!!(c.email&&(c.verified_primary_email?.includes(c.email)||c.verified_secondary_email?.includes(c.email)));return{user:{id:c.sub,name:c.name,email:c.email,image:c.picture,emailVerified:f,...e},data:c}},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>{let c=a.disableDefaultScope?[]:["openid","profile","email","User.Read","offline_access"];return a.scope&&c.push(...a.scope),bq({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},extraParams:{scope:c.join(" ")},tokenEndpoint:e})},options:a}},google:a=>({id:"google",name:"Google",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e,loginHint:f,display:g}){if(!a.clientId||!a.clientSecret)throw a0.i.error("Client Id and Client Secret is required for Google. Make sure to provide them in the options."),new bs.t("CLIENT_ID_AND_SECRET_REQUIRED");if(!d)throw new bs.t("codeVerifier is required for Google");let h=a.disableDefaultScope?[]:["email","profile","openid"];return a.scope&&h.push(...a.scope),c&&h.push(...c),await bp({id:"google",options:a,authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",scopes:h,state:b,codeVerifier:d,redirectURI:e,prompt:a.prompt,accessType:a.accessType,display:g||a.display,loginHint:f,hd:a.hd,additionalParams:{include_granted_scopes:"true"}})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>br({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://oauth2.googleapis.com/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://www.googleapis.com/oauth2/v4/token"}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);let{data:d}=await bm(`https://www.googleapis.com/oauth2/v3/tokeninfo?id_token=${b}`);return!!d&&d.aud===a.clientId&&("https://accounts.google.com"===d.iss||"accounts.google.com"===d.iss)},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=bG(b.idToken),d=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name,email:c.email,image:c.picture,emailVerified:c.email_verified,...d},data:c}},options:a}),huggingface:a=>({id:"huggingface",name:"Hugging Face",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),bp({id:"huggingface",options:a,authorizationEndpoint:"https://huggingface.co/oauth/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>br({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://huggingface.co/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://huggingface.co/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bm("https://huggingface.co/oauth/userinfo",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name||c.preferred_username,email:c.email,image:c.picture,emailVerified:c.email_verified??!1,...e},data:c}},options:a}),slack:a=>({id:"slack",name:"Slack",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["openid","profile","email"];c&&e.push(...c),a.scope&&e.push(...a.scope);let f=new URL("https://slack.com/openid/connect/authorize");return f.searchParams.set("scope",e.join(" ")),f.searchParams.set("response_type","code"),f.searchParams.set("client_id",a.clientId),f.searchParams.set("redirect_uri",a.redirectURI||d),f.searchParams.set("state",b),f},validateAuthorizationCode:async({code:b,redirectURI:c})=>br({code:b,redirectURI:c,options:a,tokenEndpoint:"https://slack.com/api/openid.connect.token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://slack.com/api/openid.connect.token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bm("https://slack.com/api/openid.connect.userInfo",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c["https://slack.com/user_id"],name:c.name||"",email:c.email,emailVerified:c.email_verified,image:c.picture||c["https://slack.com/user_image_512"],...e},data:c}},options:a}),spotify:a=>({id:"spotify",name:"Spotify",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["user-read-email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),bp({id:"spotify",options:a,authorizationEndpoint:"https://accounts.spotify.com/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>br({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://accounts.spotify.com/api/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://accounts.spotify.com/api/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bm("https://api.spotify.com/v1/me",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.display_name,email:c.email,image:c.images[0]?.url,emailVerified:!1,...e},data:c}},options:a}),twitch:a=>({id:"twitch",name:"Twitch",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["user:read:email","openid"];return a.scope&&e.push(...a.scope),c&&e.push(...c),bp({id:"twitch",redirectURI:d,options:a,authorizationEndpoint:"https://id.twitch.tv/oauth2/authorize",scopes:e,state:b,claims:a.claims||["email","email_verified","preferred_username","picture"]})},validateAuthorizationCode:async({code:b,redirectURI:c})=>br({code:b,redirectURI:c,options:a,tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://id.twitch.tv/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let c=b.idToken;if(!c)return a0.i.error("No idToken found in token"),null;let d=bG(c),e=await a.mapProfileToUser?.(d);return{user:{id:d.sub,name:d.preferred_username,email:d.email,image:d.picture,emailVerified:d.email_verified,...e},data:d}},options:a}),twitter:a=>({id:"twitter",name:"Twitter",createAuthorizationURL(b){let c=a.disableDefaultScope?[]:["users.read","tweet.read","offline.access","users.email"];return a.scope&&c.push(...a.scope),b.scopes&&c.push(...b.scopes),bp({id:"twitter",options:a,authorizationEndpoint:"https://x.com/i/oauth2/authorize",scopes:c,state:b.state,codeVerifier:b.codeVerifier,redirectURI:b.redirectURI})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>br({code:b,codeVerifier:c,authentication:"basic",redirectURI:d,options:a,tokenEndpoint:"https://api.x.com/2/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},authentication:"basic",tokenEndpoint:"https://api.x.com/2/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bm("https://api.x.com/2/users/me?user.fields=profile_image_url",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let{data:e,error:f}=await bm("https://api.x.com/2/users/me?user.fields=confirmed_email",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}}),g=!1;!f&&e?.data?.confirmed_email&&(c.data.email=e.data.confirmed_email,g=!0);let h=await a.mapProfileToUser?.(c);return{user:{id:c.data.id,name:c.data.name,email:c.data.email||c.data.username||null,image:c.data.profile_image_url,emailVerified:g,...h},data:c}},options:a}),dropbox:a=>({id:"dropbox",name:"Dropbox",createAuthorizationURL:async({state:b,scopes:c,codeVerifier:d,redirectURI:e})=>{let f=a.disableDefaultScope?[]:["account_info.read"];a.scope&&f.push(...a.scope),c&&f.push(...c);let g={};return a.accessType&&(g.token_access_type=a.accessType),await bp({id:"dropbox",options:a,authorizationEndpoint:"https://www.dropbox.com/oauth2/authorize",scopes:f,state:b,redirectURI:e,codeVerifier:d,additionalParams:g})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>await br({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://api.dropboxapi.com/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://api.dropbox.com/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bm("https://api.dropboxapi.com/2/users/get_current_account",{method:"POST",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.account_id,name:c.name?.display_name,email:c.email,emailVerified:c.email_verified||!1,image:c.profile_photo_url,...e},data:c}},options:a}),kick:a=>({id:"kick",name:"Kick",createAuthorizationURL({state:b,scopes:c,redirectURI:d,codeVerifier:e}){let f=a.disableDefaultScope?[]:["user:read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),bp({id:"kick",redirectURI:d,options:a,authorizationEndpoint:"https://id.kick.com/oauth/authorize",scopes:f,codeVerifier:e,state:b})},validateAuthorizationCode:async({code:b,redirectURI:c,codeVerifier:d})=>br({code:b,redirectURI:c,options:a,tokenEndpoint:"https://id.kick.com/oauth/token",codeVerifier:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bm("https://api.kick.com/public/v1/users",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=c.data[0],f=await a.mapProfileToUser?.(e);return{user:{id:e.user_id,name:e.name,email:e.email,image:e.profile_picture,emailVerified:!1,...f},data:e}},options:a}),linear:a=>{let b="https://api.linear.app/oauth/token";return{id:"linear",name:"Linear",createAuthorizationURL({state:b,scopes:c,loginHint:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["read"];return a.scope&&f.push(...a.scope),c&&f.push(...c),bp({id:"linear",options:a,authorizationEndpoint:"https://linear.app/oauth/authorize",scopes:f,state:b,redirectURI:e,loginHint:d})},validateAuthorizationCode:async({code:c,redirectURI:d})=>br({code:c,redirectURI:d,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>bq({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bm("https://api.linear.app/graphql",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${b.accessToken}`},body:JSON.stringify({query:`
							query {
								viewer {
									id
									name
									email
									avatarUrl
									active
									createdAt
									updatedAt
								}
							}
						`})});if(d||!c?.data?.viewer)return null;let e=c.data.viewer,f=await a.mapProfileToUser?.(e);return{user:{id:c.data.viewer.id,name:c.data.viewer.name,email:c.data.viewer.email,image:c.data.viewer.avatarUrl,emailVerified:!1,...f},data:e}},options:a}},linkedin:a=>{let b="https://www.linkedin.com/oauth/v2/accessToken";return{id:"linkedin",name:"Linkedin",createAuthorizationURL:async({state:b,scopes:c,redirectURI:d,loginHint:e})=>{let f=a.disableDefaultScope?[]:["profile","email","openid"];return a.scope&&f.push(...a.scope),c&&f.push(...c),await bp({id:"linkedin",options:a,authorizationEndpoint:"https://www.linkedin.com/oauth/v2/authorization",scopes:f,state:b,loginHint:e,redirectURI:d})},validateAuthorizationCode:async({code:c,redirectURI:d})=>await br({code:c,redirectURI:d,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>bq({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bm("https://api.linkedin.com/v2/userinfo",{method:"GET",headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name,email:c.email,emailVerified:c.email_verified||!1,image:c.picture,...e},data:c}},options:a}},gitlab:a=>{let b,{authorizationEndpoint:c,tokenEndpoint:d,userinfoEndpoint:e}=(b=a.issuer||"https://gitlab.com",{authorizationEndpoint:bK(`${b}/oauth/authorize`),tokenEndpoint:bK(`${b}/oauth/token`),userinfoEndpoint:bK(`${b}/api/v4/user`)}),f="gitlab";return{id:f,name:"Gitlab",createAuthorizationURL:async({state:b,scopes:d,codeVerifier:e,loginHint:g,redirectURI:h})=>{let i=a.disableDefaultScope?[]:["read_user"];return a.scope&&i.push(...a.scope),d&&i.push(...d),await bp({id:f,options:a,authorizationEndpoint:c,scopes:i,state:b,redirectURI:h,codeVerifier:e,loginHint:g})},validateAuthorizationCode:async({code:b,redirectURI:c,codeVerifier:e})=>br({code:b,redirectURI:c,options:a,codeVerifier:e,tokenEndpoint:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bm(e,{headers:{authorization:`Bearer ${b.accessToken}`}});if(d||"active"!==c.state||c.locked)return null;let f=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name??c.username,email:c.email,image:c.avatar_url,emailVerified:c.email_verified??!1,...f},data:c}},options:a}},tiktok:a=>({id:"tiktok",name:"TikTok",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["user.info.profile"];return a.scope&&e.push(...a.scope),c&&e.push(...c),new URL(`https://www.tiktok.com/v2/auth/authorize?scope=${e.join(",")}&response_type=code&client_key=${a.clientKey}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>br({code:b,redirectURI:a.redirectURI||c,options:{clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientSecret:a.clientSecret},tokenEndpoint:"https://open.tiktokapis.com/v2/oauth/token/",authentication:"post",extraParams:{client_key:a.clientKey}}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bm("https://open.tiktokapis.com/v2/user/info/?fields=open_id,avatar_large_url,display_name,username",{headers:{authorization:`Bearer ${b.accessToken}`}});return d?null:{user:{email:c.data.user.email||c.data.user.username,id:c.data.user.open_id,name:c.data.user.display_name||c.data.user.username,image:c.data.user.avatar_large_url,emailVerified:!!c.data.user.email},data:c}},options:a}),reddit:a=>({id:"reddit",name:"Reddit",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["identity"];return a.scope&&e.push(...a.scope),c&&e.push(...c),bp({id:"reddit",options:a,authorizationEndpoint:"https://www.reddit.com/api/v1/authorize",scopes:e,state:b,redirectURI:d,duration:a.duration})},validateAuthorizationCode:async({code:b,redirectURI:c})=>{let d=new URLSearchParams({grant_type:"authorization_code",code:b,redirect_uri:a.redirectURI||c}),{data:e,error:f}=await bm("https://www.reddit.com/api/v1/access_token",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded",accept:"text/plain","user-agent":"better-auth",Authorization:`Basic ${aq.base64.encode(`${a.clientId}:${a.clientSecret}`)}`},body:d.toString()});if(f)throw f;return bn(e)},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},authentication:"basic",tokenEndpoint:"https://www.reddit.com/api/v1/access_token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bm("https://oauth.reddit.com/api/v1/me",{headers:{Authorization:`Bearer ${b.accessToken}`,"User-Agent":"better-auth"}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.name,email:c.oauth_client_id,emailVerified:c.has_verified_email,image:c.icon_img?.split("?")[0],...e},data:c}},options:a}),roblox:a=>({id:"roblox",name:"Roblox",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["openid","profile"];return a.scope&&e.push(...a.scope),c&&e.push(...c),new URL(`https://apis.roblox.com/oauth/v1/authorize?scope=${e.join("+")}&response_type=code&client_id=${a.clientId}&redirect_uri=${encodeURIComponent(a.redirectURI||d)}&state=${b}&prompt=${a.prompt||"select_account consent"}`)},validateAuthorizationCode:async({code:b,redirectURI:c})=>br({code:b,redirectURI:a.redirectURI||c,options:a,tokenEndpoint:"https://apis.roblox.com/oauth/v1/token",authentication:"post"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://apis.roblox.com/oauth/v1/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bm("https://apis.roblox.com/oauth/v1/userinfo",{headers:{authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.nickname||c.preferred_username||"",image:c.picture,email:c.preferred_username||null,emailVerified:!1,...e},data:{...c}}},options:a}),salesforce:a=>{let b=(a.environment??"production")==="sandbox",c=a.loginUrl?`https://${a.loginUrl}/services/oauth2/authorize`:b?"https://test.salesforce.com/services/oauth2/authorize":"https://login.salesforce.com/services/oauth2/authorize",d=a.loginUrl?`https://${a.loginUrl}/services/oauth2/token`:b?"https://test.salesforce.com/services/oauth2/token":"https://login.salesforce.com/services/oauth2/token",e=a.loginUrl?`https://${a.loginUrl}/services/oauth2/userinfo`:b?"https://test.salesforce.com/services/oauth2/userinfo":"https://login.salesforce.com/services/oauth2/userinfo";return{id:"salesforce",name:"Salesforce",async createAuthorizationURL({state:b,scopes:d,codeVerifier:e,redirectURI:f}){if(!a.clientId||!a.clientSecret)throw a0.i.error("Client Id and Client Secret are required for Salesforce. Make sure to provide them in the options."),new bs.t("CLIENT_ID_AND_SECRET_REQUIRED");if(!e)throw new bs.t("codeVerifier is required for Salesforce");let g=a.disableDefaultScope?[]:["openid","email","profile"];return a.scope&&g.push(...a.scope),d&&g.push(...d),bp({id:"salesforce",options:a,authorizationEndpoint:c,scopes:g,state:b,codeVerifier:e,redirectURI:a.redirectURI||f})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:e})=>br({code:b,codeVerifier:c,redirectURI:a.redirectURI||e,options:a,tokenEndpoint:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientSecret:a.clientSecret},tokenEndpoint:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);try{let{data:c}=await bm(e,{headers:{Authorization:`Bearer ${b.accessToken}`}});if(!c)return a0.i.error("Failed to fetch user info from Salesforce"),null;let d=await a.mapProfileToUser?.(c);return{user:{id:c.user_id,name:c.name,email:c.email,image:c.photos?.picture||c.photos?.thumbnail,emailVerified:c.email_verified??!1,...d},data:c}}catch(a){return a0.i.error("Failed to fetch user info from Salesforce:",a),null}},options:a}},vk:a=>({id:"vk",name:"VK",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["email","phone"];return a.scope&&f.push(...a.scope),c&&f.push(...c),bp({id:"vk",options:a,authorizationEndpoint:"https://id.vk.com/authorize",scopes:f,state:b,redirectURI:e,codeVerifier:d})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d,deviceId:e})=>br({code:b,codeVerifier:c,redirectURI:a.redirectURI||d,options:a,deviceId:e,tokenEndpoint:"https://id.vk.com/oauth2/auth"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://id.vk.com/oauth2/auth"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.accessToken)return null;let c=new URLSearchParams({access_token:b.accessToken,client_id:a.clientId}).toString(),{data:d,error:e}=await bm("https://id.vk.com/oauth2/user_info",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:c});if(e)return null;let f=await a.mapProfileToUser?.(d);return d.user.email||f?.email?{user:{id:d.user.user_id,first_name:d.user.first_name,last_name:d.user.last_name,email:d.user.email,image:d.user.avatar,emailVerified:!!d.user.email,birthday:d.user.birthday,sex:d.user.sex,name:`${d.user.first_name} ${d.user.last_name}`,...f},data:d}:null},options:a}),zoom:a=>{let b={pkce:!0,...a};return{id:"zoom",name:"Zoom",createAuthorizationURL:async({state:a,redirectURI:c,codeVerifier:d})=>{let e=new URLSearchParams({response_type:"code",redirect_uri:b.redirectURI?b.redirectURI:c,client_id:b.clientId,state:a});if(b.pkce){let a=await bo(d);e.set("code_challenge_method","S256"),e.set("code_challenge",a)}let f=new URL("https://zoom.us/oauth/authorize");return f.search=e.toString(),f},validateAuthorizationCode:async({code:a,redirectURI:c,codeVerifier:d})=>br({code:a,redirectURI:b.redirectURI||c,codeVerifier:d,options:b,tokenEndpoint:"https://zoom.us/oauth/token",authentication:"post"}),refreshAccessToken:b.refreshAccessToken?b.refreshAccessToken:async a=>bq({refreshToken:a,options:{clientId:b.clientId,clientKey:b.clientKey,clientSecret:b.clientSecret},tokenEndpoint:"https://zoom.us/oauth/token"}),async getUserInfo(a){if(b.getUserInfo)return b.getUserInfo(a);let{data:c,error:d}=await bm("https://api.zoom.us/v2/users/me",{headers:{authorization:`Bearer ${a.accessToken}`}});if(d)return null;let e=await b.mapProfileToUser?.(c);return{user:{id:c.id,name:c.display_name,image:c.pic_url,email:c.email,emailVerified:!!c.verified,...e},data:{...c}}}}},notion:a=>{let b="https://api.notion.com/v1/oauth/token";return{id:"notion",name:"Notion",createAuthorizationURL({state:b,scopes:c,loginHint:d,redirectURI:e}){let f=(a.disableDefaultScope,[]);return a.scope&&f.push(...a.scope),c&&f.push(...c),bp({id:"notion",options:a,authorizationEndpoint:"https://api.notion.com/v1/oauth/authorize",scopes:f,state:b,redirectURI:e,loginHint:d,additionalParams:{owner:"user"}})},validateAuthorizationCode:async({code:c,redirectURI:d})=>br({code:c,redirectURI:d,options:a,tokenEndpoint:b,authentication:"basic"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>bq({refreshToken:c,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:b}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bm("https://api.notion.com/v1/users/me",{headers:{Authorization:`Bearer ${b.accessToken}`,"Notion-Version":"2022-06-28"}});if(d||!c)return null;let e=c.bot?.owner?.user;if(!e)return null;let f=await a.mapProfileToUser?.(e);return{user:{id:e.id,name:e.name||"Notion User",email:e.person?.email||null,image:e.avatar_url,emailVerified:!!e.person?.email,...f},data:e}},options:a}},kakao:a=>({id:"kakao",name:"Kakao",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["account_email","profile_image","profile_nickname"];return a.scope&&e.push(...a.scope),c&&e.push(...c),bp({id:"kakao",options:a,authorizationEndpoint:"https://kauth.kakao.com/oauth/authorize",scopes:e,state:b,redirectURI:d})},validateAuthorizationCode:async({code:b,redirectURI:c})=>br({code:b,redirectURI:c,options:a,tokenEndpoint:"https://kauth.kakao.com/oauth/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://kauth.kakao.com/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bm("https://kapi.kakao.com/v2/user/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(d||!c)return null;let e=await a.mapProfileToUser?.(c),f=c.kakao_account||{},g=f.profile||{};return{user:{id:String(c.id),name:g.nickname||f.name||void 0,email:f.email,image:g.profile_image_url||g.thumbnail_image_url,emailVerified:!!f.is_email_valid&&!!f.is_email_verified,...e},data:c}},options:a}),naver:a=>({id:"naver",name:"Naver",createAuthorizationURL({state:b,scopes:c,redirectURI:d}){let e=a.disableDefaultScope?[]:["profile","email"];return a.scope&&e.push(...a.scope),c&&e.push(...c),bp({id:"naver",options:a,authorizationEndpoint:"https://nid.naver.com/oauth2.0/authorize",scopes:e,state:b,redirectURI:d})},validateAuthorizationCode:async({code:b,redirectURI:c})=>br({code:b,redirectURI:c,options:a,tokenEndpoint:"https://nid.naver.com/oauth2.0/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://nid.naver.com/oauth2.0/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bm("https://openapi.naver.com/v1/nid/me",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(d||!c||"00"!==c.resultcode)return null;let e=await a.mapProfileToUser?.(c),f=c.response||{};return{user:{id:f.id,name:f.name||f.nickname,email:f.email,image:f.profile_image,emailVerified:!1,...e},data:c}},options:a}),line:a=>{let b="https://api.line.me/oauth2/v2.1/token";return{id:"line",name:"LINE",async createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e,loginHint:f}){let g=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&g.push(...a.scope),c&&g.push(...c),await bp({id:"line",options:a,authorizationEndpoint:"https://access.line.me/oauth2/v2.1/authorize",scopes:g,state:b,codeVerifier:d,redirectURI:e,loginHint:f})},validateAuthorizationCode:async({code:c,codeVerifier:d,redirectURI:e})=>br({code:c,codeVerifier:d,redirectURI:e,options:a,tokenEndpoint:b}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async c=>bq({refreshToken:c,options:{clientId:a.clientId,clientSecret:a.clientSecret},tokenEndpoint:b}),async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);let d=new URLSearchParams;d.set("id_token",b),d.set("client_id",a.clientId),c&&d.set("nonce",c);let{data:e,error:f}=await bm("https://api.line.me/oauth2/v2.1/verify",{method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:d});return!f&&!!e&&e.aud===a.clientId&&(!c||!e.nonce||e.nonce===c)},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let c=null;if(b.idToken)try{c=bG(b.idToken)}catch{}if(!c){let{data:a}=await bm("https://api.line.me/oauth2/v2.1/userinfo",{headers:{authorization:`Bearer ${b.accessToken}`}});c=a||null}if(!c)return null;let d=await a.mapProfileToUser?.(c),e=c.sub||c.userId,f=c.name||c.displayName,g=c.picture||c.pictureUrl||void 0;return{user:{id:e,name:f,email:c.email,image:g,emailVerified:!1,...d},data:c}},options:a}},paybin:a=>{let b=a.issuer||"https://idp.paybin.io",c=`${b}/oauth2/authorize`,d=`${b}/oauth2/token`;return{id:"paybin",name:"Paybin",async createAuthorizationURL({state:b,scopes:d,codeVerifier:e,redirectURI:f,loginHint:g}){if(!a.clientId||!a.clientSecret)throw a0.i.error("Client Id and Client Secret is required for Paybin. Make sure to provide them in the options."),new bs.t("CLIENT_ID_AND_SECRET_REQUIRED");if(!e)throw new bs.t("codeVerifier is required for Paybin");let h=a.disableDefaultScope?[]:["openid","email","profile"];return a.scope&&h.push(...a.scope),d&&h.push(...d),await bp({id:"paybin",options:a,authorizationEndpoint:c,scopes:h,state:b,codeVerifier:e,redirectURI:f,prompt:a.prompt,loginHint:g})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:e})=>br({code:b,codeVerifier:c,redirectURI:e,options:a,tokenEndpoint:d}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:d}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.idToken)return null;let c=bG(b.idToken),d=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name||c.preferred_username||(c.email?c.email.split("@")[0]:"User")||"User",email:c.email,image:c.picture,emailVerified:c.email_verified||!1,...d},data:c}},options:a}},paypal:a=>{let b="sandbox"===(a.environment||"sandbox"),c=b?"https://www.sandbox.paypal.com/signin/authorize":"https://www.paypal.com/signin/authorize",d=b?"https://api-m.sandbox.paypal.com/v1/oauth2/token":"https://api-m.paypal.com/v1/oauth2/token",e=b?"https://api-m.sandbox.paypal.com/v1/identity/oauth2/userinfo":"https://api-m.paypal.com/v1/identity/oauth2/userinfo";return{id:"paypal",name:"PayPal",async createAuthorizationURL({state:b,codeVerifier:d,redirectURI:e}){if(!a.clientId||!a.clientSecret)throw a0.i.error("Client Id and Client Secret is required for PayPal. Make sure to provide them in the options."),new bs.t("CLIENT_ID_AND_SECRET_REQUIRED");return await bp({id:"paypal",options:a,authorizationEndpoint:c,scopes:[],state:b,codeVerifier:d,redirectURI:e,prompt:a.prompt})},validateAuthorizationCode:async({code:b,redirectURI:c})=>{let e=aq.base64.encode(`${a.clientId}:${a.clientSecret}`);try{let a=await bm(d,{method:"POST",headers:{Authorization:`Basic ${e}`,Accept:"application/json","Accept-Language":"en_US","Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"authorization_code",code:b,redirect_uri:c}).toString()});if(!a.data)throw new bs.t("FAILED_TO_GET_ACCESS_TOKEN");let f=a.data;return{accessToken:f.access_token,refreshToken:f.refresh_token,accessTokenExpiresAt:f.expires_in?new Date(Date.now()+1e3*f.expires_in):void 0,idToken:f.id_token}}catch(a){throw a0.i.error("PayPal token exchange failed:",a),new bs.t("FAILED_TO_GET_ACCESS_TOKEN")}},refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>{let c=aq.base64.encode(`${a.clientId}:${a.clientSecret}`);try{let a=await bm(d,{method:"POST",headers:{Authorization:`Basic ${c}`,Accept:"application/json","Accept-Language":"en_US","Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:b}).toString()});if(!a.data)throw new bs.t("FAILED_TO_REFRESH_ACCESS_TOKEN");let e=a.data;return{accessToken:e.access_token,refreshToken:e.refresh_token,accessTokenExpiresAt:e.expires_in?new Date(Date.now()+1e3*e.expires_in):void 0}}catch(a){throw a0.i.error("PayPal token refresh failed:",a),new bs.t("FAILED_TO_REFRESH_ACCESS_TOKEN")}},async verifyIdToken(b,c){if(a.disableIdTokenSignIn)return!1;if(a.verifyIdToken)return a.verifyIdToken(b,c);try{return!!bG(b).sub}catch(a){return a0.i.error("Failed to verify PayPal ID token:",a),!1}},async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);if(!b.accessToken)return a0.i.error("Access token is required to fetch PayPal user info"),null;try{let c=await bm(`${e}?schema=paypalv1.1`,{headers:{Authorization:`Bearer ${b.accessToken}`,Accept:"application/json"}});if(!c.data)return a0.i.error("Failed to fetch user info from PayPal"),null;let d=c.data,f=await a.mapProfileToUser?.(d);return{user:{id:d.user_id,name:d.name,email:d.email,image:d.picture,emailVerified:d.email_verified,...f},data:d}}catch(a){return a0.i.error("Failed to fetch user info from PayPal:",a),null}},options:a}},polar:a=>({id:"polar",name:"Polar",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f=a.disableDefaultScope?[]:["openid","profile","email"];return a.scope&&f.push(...a.scope),c&&f.push(...c),bp({id:"polar",options:a,authorizationEndpoint:"https://polar.sh/oauth2/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e,prompt:a.prompt})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>br({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://api.polar.sh/v1/oauth2/token"}),refreshAccessToken:a.refreshAccessToken?a.refreshAccessToken:async b=>bq({refreshToken:b,options:{clientId:a.clientId,clientKey:a.clientKey,clientSecret:a.clientSecret},tokenEndpoint:"https://api.polar.sh/v1/oauth2/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bm("https://api.polar.sh/v1/oauth2/userinfo",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(d)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.id,name:c.public_name||c.username,email:c.email,image:c.avatar_url,emailVerified:c.email_verified??!1,...e},data:c}},options:a}),vercel:a=>({id:"vercel",name:"Vercel",createAuthorizationURL({state:b,scopes:c,codeVerifier:d,redirectURI:e}){let f;if(!d)throw new bs.t("codeVerifier is required for Vercel");return(void 0!==a.scope||void 0!==c)&&(f=[],a.scope&&f.push(...a.scope),c&&f.push(...c)),bp({id:"vercel",options:a,authorizationEndpoint:"https://vercel.com/oauth/authorize",scopes:f,state:b,codeVerifier:d,redirectURI:e})},validateAuthorizationCode:async({code:b,codeVerifier:c,redirectURI:d})=>br({code:b,codeVerifier:c,redirectURI:d,options:a,tokenEndpoint:"https://api.vercel.com/login/oauth/token"}),async getUserInfo(b){if(a.getUserInfo)return a.getUserInfo(b);let{data:c,error:d}=await bm("https://api.vercel.com/login/oauth/userinfo",{headers:{Authorization:`Bearer ${b.accessToken}`}});if(d||!c)return null;let e=await a.mapProfileToUser?.(c);return{user:{id:c.sub,name:c.name??c.preferred_username,email:c.email,image:c.picture,emailVerified:c.email_verified??!1,...e},data:c}},options:a})},bM=Object.keys(bL),bN=T.enum(bM).or(T.string());function bO(a){if(null===a||"object"!=typeof a)return!1;let b=Object.getPrototypeOf(a);return(null===b||b===Object.prototype||null===Object.getPrototypeOf(b))&&!(Symbol.iterator in a)&&(!(Symbol.toStringTag in a)||"[object Module]"===Object.prototype.toString.call(a))}function bP(a){return(...b)=>b.reduce((b,c)=>(function a(b,c,d=".",e){if(!bO(c))return a(b,{},d,e);let f=Object.assign({},c);for(let c in b){if("__proto__"===c||"constructor"===c)continue;let g=b[c];null!=g&&(e&&e(f,c,g,d)||(Array.isArray(g)&&Array.isArray(f[c])?f[c]=[...g,...f[c]]:bO(g)&&bO(f[c])?f[c]=a(g,f[c],(d?`${d}.`:"")+c.toString(),e):f[c]=g))}return f})(b,c,"",a),{})}let bQ=bP();function bR(a){return"-"===a||"^"===a||"$"===a||"+"===a||"."===a||"("===a||")"===a||"|"===a||"["===a||"]"===a||"{"===a||"}"===a||"*"===a||"?"===a||"\\"===a?`\\${a}`:a}function bS(a,b){if("string"!=typeof b)throw TypeError(`Sample must be a string, but ${typeof b} given`);return a.test(b)}function bT(a,b){if("string"!=typeof a&&!Array.isArray(a))throw TypeError(`The first argument must be a single pattern string or an array of patterns, but ${typeof a} given`);if(("string"==typeof b||"boolean"==typeof b)&&(b={separator:b}),2==arguments.length&&!(void 0===b||"object"==typeof b&&null!==b&&!Array.isArray(b)))throw TypeError(`The second argument must be an options object or a string/boolean separator, but ${typeof b} given`);if("\\"===(b=b||{}).separator)throw Error("\\ is not a valid separator because it is used for escaping. Try setting the separator to `true` instead");let c=function a(b,c=!0){if(Array.isArray(b))return`(?:${b.map(b=>`^${a(b,c)}$`).join("|")})`;let d="",e="",f=".";!0===c?(d="/",e="[/\\\\]",f="[^/\\\\]"):c&&((e=function(a){let b="";for(let c=0;c<a.length;c++)b+=bR(a[c]);return b}(d=c)).length>1?(e=`(?:${e})`,f=`((?!${e}).)`):f=`[^${e}]`);let g=c?`${e}+?`:"",h=c?`${e}*?`:"",i=c?b.split(d):[b],j="";for(let a=0;a<i.length;a++){let b=i[a],d=i[a+1],e="";if(b||!(a>0)){if(c&&(e=a===i.length-1?h:"**"!==d?g:""),c&&"**"===b){e&&(j+=0===a?"":e,j+=`(?:${f}*?${e})*?`);continue}for(let a=0;a<b.length;a++){let c=b[a];"\\"===c?a<b.length-1&&(j+=bR(b[a+1]),a++):"?"===c?j+=f:"*"===c?j+=`${f}*?`:j+=bR(c)}j+=e}}return j}(a,b.separator),d=RegExp(`^${c}$`,b.flags),e=bS.bind(null,d);return e.options=b,e.pattern=a,e.regexp=d,e}bP((a,b,c)=>{if(void 0!==a[b]&&"function"==typeof c)return a[b]=c(a[b]),!0}),bP((a,b,c)=>{if(Array.isArray(a[b])&&"function"==typeof c)return a[b]=c(a[b]),!0});let bU=aM(async a=>{if(a.request?.method==="GET"||a.request?.method==="OPTIONS"||a.request?.method==="HEAD"||!a.request)return;let b=a.request?.headers,c=a.request,{body:d,query:e,context:f}=a,g=b?.get("origin")||b?.get("referer")||"",h=d?.callbackURL||e?.callbackURL,i=d?.redirectTo,j=d?.errorCallbackURL,k=d?.newUserCallbackURL,l=Array.isArray(f.options.trustedOrigins)?f.trustedOrigins:[...f.trustedOrigins,...await f.options.trustedOrigins?.(c)||[]],m=b?.has("cookie"),n=(b,c)=>{if(b&&!l.some(a=>((a,b)=>{if(a.startsWith("/"))return!1;if(b.includes("*")){if(b.includes("://"))return bT(b)(al(a)||a);let c=an(a);return!!c&&bT(b)(c)}let c=am(a);return"http:"!==c&&"https:"!==c&&c?a.startsWith(b):b===al(a)})(b,a)||b?.startsWith("/")&&"origin"!==c&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(b)))throw a.context.logger.error(`Invalid ${c}: ${b}`),a.context.logger.info(`If it's a valid URL, please add ${b} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${l}`),new I.APIError("FORBIDDEN",{message:`Invalid ${c}`})};if(m&&!a.context.skipCSRFCheck&&!a.context.skipOriginCheck){if(!g||"null"===g)throw new I.APIError("FORBIDDEN",{message:"Missing or null Origin"});n(g,"origin")}h&&n(h,"callbackURL"),i&&n(i,"redirectURL"),j&&n(j,"errorCallbackURL"),k&&n(k,"newUserCallbackURL")}),bV=a=>aM(async b=>{if(!b.request)return;let{context:c}=b,d=a(b),e=Array.isArray(c.options.trustedOrigins)?c.trustedOrigins:[...c.trustedOrigins,...await c.options.trustedOrigins?.(b.request)||[]],f=(a,c)=>{if(a&&!e.some(b=>((a,b)=>{if(a.startsWith("/"))return!1;if(b.includes("*")){if(b.includes("://"))return bT(b)(al(a)||a);let c=an(a);return!!c&&bT(b)(c)}let c=am(a);return"http:"!==c&&"https:"!==c&&c?a.startsWith(b):b===al(a)})(a,b)||a?.startsWith("/")&&"origin"!==c&&/^\/(?!\/|\\|%2f|%5c)[\w\-.\+/@]*(?:\?[\w\-.\+/=&%@]*)?$/.test(a)))throw b.context.logger.error(`Invalid ${c}: ${a}`),b.context.logger.info(`If it's a valid URL, please add ${a} to trustedOrigins in your auth config
`,`Current list of trustedOrigins: ${e}`),new I.APIError("FORBIDDEN",{message:`Invalid ${c}`})};for(let a of Array.isArray(d)?d:[d])f(a,"callbackURL")}),bW=new Map;async function bX(a,b){if(!b.rateLimit.enabled)return;let c=new URL(a.url).pathname.replace(b.options.basePath||"/api/auth",""),d=b.rateLimit.window,e=b.rateLimit.max,f=U(a,b.options);if(!f)return;let g=f+c,h=[{pathMatcher:a=>a.startsWith("/sign-in")||a.startsWith("/sign-up")||a.startsWith("/change-password")||a.startsWith("/change-email"),window:10,max:3}].find(a=>a.pathMatcher(c));for(let a of(h&&(d=h.window,e=h.max),b.options.plugins||[]))if(a.rateLimit){let b=a.rateLimit.find(a=>a.pathMatcher(c));if(b){d=b.window,e=b.max;break}}if(b.rateLimit.customRules){let f=Object.keys(b.rateLimit.customRules).find(a=>a.includes("*")?bT(a)(c):a===c);if(f){let c=b.rateLimit.customRules[f],g="function"==typeof c?await c(a):c;if(g&&(d=g.window,e=g.max),!1===g)return}}let i=function(a,b){let c,d;if(a.options.rateLimit?.customStorage)return a.options.rateLimit.customStorage;let e=a.rateLimit.storage;return"secondary-storage"===e?{get:async b=>{let c=await a.options.secondaryStorage?.get(b);return c?(0,V.t)(c):void 0},set:async(c,d,e)=>{let f=b?.window??a.options.rateLimit?.window??10;await a.options.secondaryStorage?.set?.(c,JSON.stringify(d),f)}}:"memory"===e?{get:async a=>bW.get(a),async set(a,b,c){bW.set(a,b)}}:(c="rateLimit",d=a.adapter,{get:async a=>{let b=(await d.findMany({model:c,where:[{field:"key",value:a}]}))[0];return"bigint"==typeof b?.lastRequest&&(b.lastRequest=Number(b.lastRequest)),b},set:async(b,e,f)=>{try{f?await d.updateMany({model:c,where:[{field:"key",value:b}],update:{count:e.count,lastRequest:e.lastRequest}}):await d.create({model:c,data:{key:b,count:e.count,lastRequest:e.lastRequest}})}catch(b){a.logger.error("Error setting rate limit",b)}}})}(b,{window:d}),j=await i.get(g),k=Date.now();if(j){var l,m,n;let a=k-j.lastRequest;if(l=e,m=d,Date.now()-j.lastRequest<1e3*m&&j.count>=l)return n=Math.ceil((j.lastRequest+1e3*d-Date.now())/1e3),new Response(JSON.stringify({message:"Too many requests. Please try again later."}),{status:429,statusText:"Too Many Requests",headers:{"X-Retry-After":n.toString()}});a>1e3*d?await i.set(g,{...j,count:1,lastRequest:k},!0):await i.set(g,{...j,count:j.count+1,lastRequest:k},!0)}else await i.set(g,{key:g,count:1,lastRequest:k})}function bY(a,b){return a&&b.options.account?.encryptOAuthTokens?(0,ai.t)({key:b.secret,data:a}):a}function bZ(a,b){return b.options.account?.encryptOAuthTokens&&a?(0,ai.n)({key:b.secret,data:a}):a}let b$=aO("/list-accounts",{method:"GET",use:[aR],metadata:{openapi:{operationId:"listUserAccounts",description:"List all accounts linked to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{type:"object",properties:{id:{type:"string"},providerId:{type:"string"},createdAt:{type:"string",format:"date-time"},updatedAt:{type:"string",format:"date-time"},accountId:{type:"string"},userId:{type:"string"},scopes:{type:"array",items:{type:"string"}}},required:["id","providerId","createdAt","updatedAt","accountId","userId","scopes"]}}}}}}}}},async a=>{let b=a.context.session,c=await a.context.internalAdapter.findAccounts(b.user.id);return a.json(c.map(a=>({id:a.id,providerId:a.providerId,createdAt:a.createdAt,updatedAt:a.updatedAt,accountId:a.accountId,userId:a.userId,scopes:a.scope?.split(",")||[]})))}),b_=aO("/link-social",{method:"POST",requireHeaders:!0,body:T.object({callbackURL:T.string().meta({description:"The URL to redirect to after the user has signed in"}).optional(),provider:bN,idToken:T.object({token:T.string(),nonce:T.string().optional(),accessToken:T.string().optional(),refreshToken:T.string().optional(),scopes:T.array(T.string()).optional()}).optional(),requestSignUp:T.boolean().optional(),scopes:T.array(T.string()).meta({description:"Additional scopes to request from the provider"}).optional(),errorCallbackURL:T.string().meta({description:"The URL to redirect to if there is an error during the link process"}).optional(),disableRedirect:T.boolean().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),additionalData:T.record(T.string(),T.any()).optional()}),use:[aR],metadata:{openapi:{description:"Link a social account to the user",operationId:"linkSocialAccount",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{url:{type:"string",description:"The authorization URL to redirect the user to"},redirect:{type:"boolean",description:"Indicates if the user should be redirected to the authorization URL"},status:{type:"boolean"}},required:["redirect"]}}}}}}}},async a=>{let b=a.context.session,c=a.context.socialProviders.find(b=>b.id===a.body.provider);if(!c)throw a.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:a.body.provider}),new I.APIError("NOT_FOUND",{message:aJ.n.PROVIDER_NOT_FOUND});if(a.body.idToken){if(!c.verifyIdToken)throw a.context.logger.error("Provider does not support id token verification",{provider:a.body.provider}),new I.APIError("NOT_FOUND",{message:aJ.n.ID_TOKEN_NOT_SUPPORTED});let{token:d,nonce:e}=a.body.idToken;if(!await c.verifyIdToken(d,e))throw a.context.logger.error("Invalid id token",{provider:a.body.provider}),new I.APIError("UNAUTHORIZED",{message:aJ.n.INVALID_TOKEN});let f=await c.getUserInfo({idToken:d,accessToken:a.body.idToken.accessToken,refreshToken:a.body.idToken.refreshToken});if(!f||!f?.user)throw a.context.logger.error("Failed to get user info",{provider:a.body.provider}),new I.APIError("UNAUTHORIZED",{message:aJ.n.FAILED_TO_GET_USER_INFO});let g=String(f.user.id);if(!f.user.email)throw a.context.logger.error("User email not found",{provider:a.body.provider}),new I.APIError("UNAUTHORIZED",{message:aJ.n.USER_EMAIL_NOT_FOUND});if((await a.context.internalAdapter.findAccounts(b.user.id)).find(a=>a.providerId===c.id&&a.accountId===g))return a.json({url:"",status:!0,redirect:!1});if(!a.context.options.account?.accountLinking?.trustedProviders?.includes(c.id)&&!f.user.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)throw new I.APIError("UNAUTHORIZED",{message:"Account not linked - linking not allowed"});if(f.user.email!==b.user.email&&a.context.options.account?.accountLinking?.allowDifferentEmails!==!0)throw new I.APIError("UNAUTHORIZED",{message:"Account not linked - different emails not allowed"});try{await a.context.internalAdapter.createAccount({userId:b.user.id,providerId:c.id,accountId:g,accessToken:a.body.idToken.accessToken,idToken:d,refreshToken:a.body.idToken.refreshToken,scope:a.body.idToken.scopes?.join(",")})}catch(a){throw new I.APIError("EXPECTATION_FAILED",{message:"Account not linked - unable to create account"})}if(a.context.options.account?.accountLinking?.updateUserInfoOnLink===!0)try{await a.context.internalAdapter.updateUser(b.user.id,{name:f.user?.name,image:f.user?.image})}catch(a){console.warn("Could not update user - "+a.toString())}return a.json({url:"",status:!0,redirect:!1})}let d=await (0,H.r)(a,{userId:b.user.id,email:b.user.email},a.body.additionalData),e=await c.createAuthorizationURL({state:d.state,codeVerifier:d.codeVerifier,redirectURI:`${a.context.baseURL}/callback/${c.id}`,scopes:a.body.scopes});return a.json({url:e.toString(),redirect:!a.body.disableRedirect})}),b0=aO("/unlink-account",{method:"POST",body:T.object({providerId:T.string(),accountId:T.string().optional()}),use:[aT],metadata:{openapi:{description:"Unlink an account",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async a=>{let{providerId:b,accountId:c}=a.body,d=await a.context.internalAdapter.findAccounts(a.context.session.user.id);if(1===d.length&&!a.context.options.account?.accountLinking?.allowUnlinkingAll)throw new I.APIError("BAD_REQUEST",{message:aJ.n.FAILED_TO_UNLINK_LAST_ACCOUNT});let e=d.find(a=>c?a.accountId===c&&a.providerId===b:a.providerId===b);if(!e)throw new I.APIError("BAD_REQUEST",{message:aJ.n.ACCOUNT_NOT_FOUND});return await a.context.internalAdapter.deleteAccount(e.id),a.json({status:!0})}),b1=aO("/get-access-token",{method:"POST",body:T.object({providerId:T.string().meta({description:"The provider ID for the OAuth provider"}),accountId:T.string().meta({description:"The account ID associated with the refresh token"}).optional(),userId:T.string().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Get a valid access token, doing a refresh if needed",responses:{200:{description:"A Valid access token",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async a=>{let b,{providerId:c,accountId:d,userId:e}=a.body||{},f=a.request,g=await aQ(a);if(f&&!g)throw a.error("UNAUTHORIZED");let h=g?.user?.id||e;if(!h)throw a.error("UNAUTHORIZED");if(!a.context.socialProviders.find(a=>a.id===c))throw new I.APIError("BAD_REQUEST",{message:`Provider ${c} is not supported.`});let i=await aD(a);if(!(b=i&&c===i.providerId&&(!d||i.id===d)?i:(await a.context.internalAdapter.findAccounts(h)).find(a=>d?a.id===d&&a.providerId===c:a.providerId===c)))throw new I.APIError("BAD_REQUEST",{message:"Account not found"});let j=a.context.socialProviders.find(a=>a.id===c);if(!j)throw new I.APIError("BAD_REQUEST",{message:`Provider ${c} not found.`});try{let c=null,d=b.accessTokenExpiresAt&&new Date(b.accessTokenExpiresAt).getTime()-Date.now()<5e3;if(b.refreshToken&&d&&j.refreshAccessToken){let d=await bY(b.refreshToken,a.context);c=await j.refreshAccessToken(d);let e=await a.context.internalAdapter.updateAccount(b.id,{accessToken:await bZ(c.accessToken,a.context),accessTokenExpiresAt:c.accessTokenExpiresAt,refreshToken:await bZ(c.refreshToken,a.context),refreshTokenExpiresAt:c.refreshTokenExpiresAt});a.context.options.account?.storeAccountCookie&&e&&await aC(a,e)}let e={accessToken:c?.accessToken??await bY(b.accessToken??"",a.context),accessTokenExpiresAt:c?.accessTokenExpiresAt??b.accessTokenExpiresAt??void 0,scopes:b.scope?.split(",")??[],idToken:c?.idToken??b.idToken??void 0};return a.json(e)}catch(a){throw new I.APIError("BAD_REQUEST",{message:"Failed to get a valid access token",cause:a})}}),b2=aO("/refresh-token",{method:"POST",body:T.object({providerId:T.string().meta({description:"The provider ID for the OAuth provider"}),accountId:T.string().meta({description:"The account ID associated with the refresh token"}).optional(),userId:T.string().meta({description:"The user ID associated with the account"}).optional()}),metadata:{openapi:{description:"Refresh the access token using a refresh token",responses:{200:{description:"Access token refreshed successfully",content:{"application/json":{schema:{type:"object",properties:{tokenType:{type:"string"},idToken:{type:"string"},accessToken:{type:"string"},refreshToken:{type:"string"},accessTokenExpiresAt:{type:"string",format:"date-time"},refreshTokenExpiresAt:{type:"string",format:"date-time"}}}}}},400:{description:"Invalid refresh token or provider configuration"}}}}},async a=>{let b,c,{providerId:d,accountId:e,userId:f}=a.body,g=a.request,h=await aQ(a);if(g&&!h)throw a.error("UNAUTHORIZED");let i=h?.user?.id||f;if(!i)throw new I.APIError("BAD_REQUEST",{message:"Either userId or session is required"});let j=a.context.socialProviders.find(a=>a.id===d);if(!j)throw new I.APIError("BAD_REQUEST",{message:`Provider ${d} not found.`});if(!j.refreshAccessToken)throw new I.APIError("BAD_REQUEST",{message:`Provider ${d} does not support token refreshing.`});let k=await aD(a);if(!(b=k&&(!d||d===k?.providerId)?k:(await a.context.internalAdapter.findAccounts(i)).find(a=>e?a.id===e&&a.providerId===d:a.providerId===d)))throw new I.APIError("BAD_REQUEST",{message:"Account not found"});if(!(c=k&&d===k.providerId?k.refreshToken??void 0:b.refreshToken??void 0))throw new I.APIError("BAD_REQUEST",{message:"Refresh token not found"});try{let e=await bY(c,a.context),f=await j.refreshAccessToken(e);if(b.id){let c={...b||{},accessToken:await bZ(f.accessToken,a.context),refreshToken:await bZ(f.refreshToken,a.context),accessTokenExpiresAt:f.accessTokenExpiresAt,refreshTokenExpiresAt:f.refreshTokenExpiresAt,scope:f.scopes?.join(",")||b.scope,idToken:f.idToken||b.idToken};await a.context.internalAdapter.updateAccount(b.id,c)}return k&&d===k.providerId&&a.context.options.account?.storeAccountCookie&&await aC(a,{...k,accessToken:await bZ(f.accessToken,a.context),refreshToken:await bZ(f.refreshToken,a.context),accessTokenExpiresAt:f.accessTokenExpiresAt,refreshTokenExpiresAt:f.refreshTokenExpiresAt,scope:f.scopes?.join(",")||k.scope,idToken:f.idToken||k.idToken}),a.json({accessToken:f.accessToken,refreshToken:f.refreshToken,accessTokenExpiresAt:f.accessTokenExpiresAt,refreshTokenExpiresAt:f.refreshTokenExpiresAt,scope:f.scopes?.join(",")||b.scope,idToken:f.idToken||b.idToken,providerId:b.providerId,accountId:b.accountId})}catch(a){throw new I.APIError("BAD_REQUEST",{message:"Failed to refresh access token",cause:a})}}),b3=aO("/account-info",{method:"GET",use:[aR],metadata:{openapi:{description:"Get the account info provided by the provider",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",properties:{id:{type:"string"},name:{type:"string"},email:{type:"string"},image:{type:"string"},emailVerified:{type:"boolean"}},required:["id","emailVerified"]},data:{type:"object",properties:{},additionalProperties:!0}},required:["user","data"],additionalProperties:!1}}}}}}},query:T.optional(T.object({accountId:T.string().meta({description:"The provider given account id for which to get the account info"}).optional()}))},async a=>{let b,c=a.query?.accountId;if(c){let d=await a.context.internalAdapter.findAccount(c);d&&(b=d)}else if(a.context.options.account?.storeAccountCookie){let c=await aD(a);c&&(b=c)}if(!b||b.userId!==a.context.session.user.id)throw new I.APIError("BAD_REQUEST",{message:"Account not found"});let d=a.context.socialProviders.find(a=>a.id===b.providerId);if(!d)throw new I.APIError("INTERNAL_SERVER_ERROR",{message:`Provider account provider is ${b.providerId} but it is not configured`});let e=await b1({...a,method:"POST",body:{accountId:b.id,providerId:b.providerId},returnHeaders:!1,returnStatus:!1});if(!e.accessToken)throw new I.APIError("BAD_REQUEST",{message:"Access token not found"});let f=await d.getUserInfo({...e,accessToken:e.accessToken});return a.json(f)});async function b4(a,{userInfo:b,account:c,callbackURL:d,disableSignUp:e,overrideUserInfo:f}){let g=await a.context.internalAdapter.findOAuthUser(b.email.toLowerCase(),c.accountId,c.providerId).catch(b=>{$.logger.error("Better auth was unable to query your database.\nError: ",b);let c=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;throw a.redirect(`${c}?error=internal_server_error`)}),h=g?.user,i=!h;if(g){let d=g.accounts.find(a=>a.providerId===c.providerId&&a.accountId===c.accountId);if(d){if(a.context.options.account?.updateAccountOnSignIn!==!1){let b=Object.fromEntries(Object.entries({idToken:c.idToken,accessToken:await bZ(c.accessToken,a.context),refreshToken:await bZ(c.refreshToken,a.context),accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scope}).filter(([a,b])=>void 0!==b));a.context.options.account?.storeAccountCookie&&await aC(a,b),Object.keys(b).length>0&&await a.context.internalAdapter.updateAccount(d.id,b)}b.emailVerified&&!g.user.emailVerified&&b.email.toLowerCase()===g.user.email&&await a.context.internalAdapter.updateUser(g.user.id,{emailVerified:!0})}else{if(!a.context.options.account?.accountLinking?.trustedProviders?.includes(c.providerId)&&!b.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)return(0,R.d)()&&$.logger.warn(`User already exist but account isn't linked to ${c.providerId}. To read more about how account linking works in Better Auth see https://www.better-auth.com/docs/concepts/users-accounts#account-linking.`),{error:"account not linked",data:null};try{await a.context.internalAdapter.linkAccount({providerId:c.providerId,accountId:b.id.toString(),userId:g.user.id,accessToken:await bZ(c.accessToken,a.context),refreshToken:await bZ(c.refreshToken,a.context),idToken:c.idToken,accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scope})}catch(a){return $.logger.error("Unable to link account",a),{error:"unable to link account",data:null}}b.emailVerified&&!g.user.emailVerified&&b.email.toLowerCase()===g.user.email&&await a.context.internalAdapter.updateUser(g.user.id,{emailVerified:!0})}if(f){let{id:c,...d}=b;h=await a.context.internalAdapter.updateUser(g.user.id,{...d,email:b.email.toLowerCase(),emailVerified:b.email.toLowerCase()===g.user.email&&g.user.emailVerified||b.emailVerified})}}else{if(e)return{error:"signup disabled",data:null,isRegister:!1};try{let{id:e,...f}=b,g={accessToken:await bZ(c.accessToken,a.context),refreshToken:await bZ(c.refreshToken,a.context),idToken:c.idToken,accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scope,providerId:c.providerId,accountId:b.id.toString()},{user:i,account:j}=await a.context.internalAdapter.createOAuthUser({...f,email:b.email.toLowerCase()},g);if(h=i,a.context.options.account?.storeAccountCookie&&await aC(a,j),!b.emailVerified&&h&&a.context.options.emailVerification?.sendOnSignUp){let b=await b7(a.context.secret,h.email,void 0,a.context.options.emailVerification?.expiresIn),c=`${a.context.baseURL}/verify-email?token=${b}&callbackURL=${d}`;await a.context.options.emailVerification?.sendVerificationEmail?.({user:h,url:c,token:b},a.request)}}catch(a){if($.logger.error(a),a instanceof I.APIError)return{error:a.message,data:null,isRegister:!1};return{error:"unable to create user",data:null,isRegister:!1}}}if(!h)return{error:"unable to create user",data:null,isRegister:!1};let j=await a.context.internalAdapter.createSession(h.id);return j?{data:{session:j,user:h},error:null,isRegister:i}:{error:"unable to create session",data:null,isRegister:!1}}let b5=T.object({code:T.string().optional(),error:T.string().optional(),device_id:T.string().optional(),error_description:T.string().optional(),state:T.string().optional(),user:T.string().optional()}),b6=aO("/callback/:id",{method:["GET","POST"],operationId:"handleOAuthCallback",body:b5.optional(),query:b5.optional(),metadata:{...H.n,allowedMediaTypes:["application/x-www-form-urlencoded","application/json"]}},async a=>{let b,c,d,e=a.context.options.onAPIError?.errorURL||`${a.context.baseURL}/error`;if("POST"===a.method){let b=a.body?b5.parse(a.body):{},c=a.query?b5.parse(a.query):{},d=b5.parse({...b,...c}),e=new URLSearchParams;for(let[a,b]of Object.entries(d))null!=b&&e.set(a,String(b));let f=`${a.context.baseURL}/callback/${a.params.id}?${e.toString()}`;throw a.redirect(f)}try{if("GET"===a.method)b=b5.parse(a.query);else if("POST"===a.method)b=b5.parse(a.body);else throw Error("Unsupported method")}catch(b){throw a.context.logger.error("INVALID_CALLBACK_REQUEST",b),a.redirect(`${e}?error=invalid_callback_request`)}let{code:f,error:g,state:h,error_description:i,device_id:j}=b;if(!h){a.context.logger.error("State not found",g);let b=`${e}${e.includes("?")?"&":"?"}state=state_not_found`;throw a.redirect(b)}let{codeVerifier:k,callbackURL:l,link:m,errorURL:n,newUserURL:o,requestSignUp:p}=await (0,H.i)(a);function q(b,c){let d=n??e,f=new URLSearchParams({error:b});c&&f.set("error_description",c);let g=`${d}${d.includes("?")?"&":"?"}${f.toString()}`;throw a.redirect(g)}if(g&&q(g,i),!f)throw a.context.logger.error("Code not found"),q("no_code");let r=a.context.socialProviders.find(b=>b.id===a.params.id);if(!r)throw a.context.logger.error("Oauth provider with id",a.params.id,"not found"),q("oauth_provider_not_found");try{c=await r.validateAuthorizationCode({code:f,codeVerifier:k,deviceId:j,redirectURI:`${a.context.baseURL}/callback/${r.id}`})}catch(b){throw a.context.logger.error("",b),q("invalid_code")}let s=await r.getUserInfo({...c,user:a.body?.user?(0,V.t)(a.body.user):void 0}).then(a=>a?.user);if(!s)return a.context.logger.error("Unable to get user info"),q("unable_to_get_user_info");if(!l)throw a.context.logger.error("No callback URL found"),q("no_callback_url");if(m){let b;if(!a.context.options.account?.accountLinking?.trustedProviders?.includes(r.id)&&!s.emailVerified||a.context.options.account?.accountLinking?.enabled===!1)return a.context.logger.error("Unable to link account - untrusted provider"),q("unable_to_link_account");if(s.email!==m.email&&a.context.options.account?.accountLinking?.allowDifferentEmails!==!0)return q("email_doesn't_match");let d=await a.context.internalAdapter.findAccount(String(s.id));if(d){if(d.userId.toString()!==m.userId.toString())return q("account_already_linked_to_different_user");let b=Object.fromEntries(Object.entries({accessToken:await bZ(c.accessToken,a.context),refreshToken:await bZ(c.refreshToken,a.context),idToken:c.idToken,accessTokenExpiresAt:c.accessTokenExpiresAt,refreshTokenExpiresAt:c.refreshTokenExpiresAt,scope:c.scopes?.join(",")}).filter(([a,b])=>void 0!==b));await a.context.internalAdapter.updateAccount(d.id,b)}else if(!await a.context.internalAdapter.createAccount({userId:m.userId,providerId:r.id,accountId:String(s.id),...c,accessToken:await bZ(c.accessToken,a.context),refreshToken:await bZ(c.refreshToken,a.context),scope:c.scopes?.join(",")}))return q("unable_to_link_account");try{b=l.toString()}catch{b=l}throw a.redirect(b)}if(!s.email)return a.context.logger.error("Provider did not return email. This could be due to misconfiguration in the provider settings."),q("email_not_found");let t={providerId:r.id,accountId:String(s.id),...c,scope:c.scopes?.join(",")},u=await b4(a,{userInfo:{...s,id:String(s.id),email:s.email,name:s.name||s.email},account:t,callbackURL:l,disableSignUp:r.disableImplicitSignUp&&!p||r.options?.disableSignUp,overrideUserInfo:r.options?.overrideUserInfoOnSignIn});if(u.error)return a.context.logger.error(u.error.split(" ").join("_")),q(u.error.split(" ").join("_"));let{session:v,user:w}=u.data;await aH(a,{session:v,user:w});try{d=(u.isRegister&&o||l).toString()}catch{d=u.isRegister&&o||l}throw a.redirect(d)});async function b7(a,b,c,d=3600,e){return await (0,ai.o)({email:b.toLowerCase(),updateTo:c,...e},a,d)}async function b8(a,b){if(!a.context.options.emailVerification?.sendVerificationEmail)throw a.context.logger.error("Verification email isn't enabled."),new I.APIError("BAD_REQUEST",{message:"Verification email isn't enabled"});let c=await b7(a.context.secret,b.email,void 0,a.context.options.emailVerification?.expiresIn),d=a.body.callbackURL?encodeURIComponent(a.body.callbackURL):encodeURIComponent("/"),e=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${d}`;await a.context.options.emailVerification.sendVerificationEmail({user:b,url:e,token:c},a.request)}let b9=aO("/send-verification-email",{method:"POST",operationId:"sendVerificationEmail",body:T.object({email:T.email().meta({description:"The email to send the verification email to"}),callbackURL:T.string().meta({description:"The URL to use for email verification callback"}).optional()}),metadata:{openapi:{operationId:"sendVerificationEmail",description:"Send a verification email to the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{email:{type:"string",description:"The email to send the verification email to",example:"user@example.com"},callbackURL:{type:"string",description:"The URL to use for email verification callback",example:"https://example.com/callback",nullable:!0}},required:["email"]}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean",description:"Indicates if the email was sent successfully",example:!0}}}}}},400:{description:"Bad Request",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string",description:"Error message",example:"Verification email isn't enabled"}}}}}}}}}},async a=>{if(!a.context.options.emailVerification?.sendVerificationEmail)throw a.context.logger.error("Verification email isn't enabled."),new I.APIError("BAD_REQUEST",{message:"Verification email isn't enabled"});let{email:b}=a.body,c=await aQ(a);if(!c){let c=await a.context.internalAdapter.findUserByEmail(b);return c?await b8(a,c.user):await b7(a.context.secret,b,void 0,a.context.options.emailVerification?.expiresIn),a.json({status:!0})}if(c?.user.emailVerified)throw new I.APIError("BAD_REQUEST",{message:"You can only send a verification email to an unverified email"});if(c?.user.email!==b)throw new I.APIError("BAD_REQUEST",{message:"You can only send a verification email to your own email"});return await b8(a,c.user),a.json({status:!0})}),ca=aO("/verify-email",{method:"GET",operationId:"verifyEmail",query:T.object({token:T.string().meta({description:"The token to verify the email"}),callbackURL:T.string().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[bV(a=>a.query.callbackURL)],metadata:{openapi:{description:"Verify the email of the user",parameters:[{name:"token",in:"query",description:"The token to verify the email",required:!0,schema:{type:"string"}},{name:"callbackURL",in:"query",description:"The URL to redirect to after email verification",required:!1,schema:{type:"string"}}],responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",$ref:"#/components/schemas/User"},status:{type:"boolean",description:"Indicates if the email was verified successfully"}},required:["user","status"]}}}}}}}},async a=>{let b;function c(b){if(a.query.callbackURL){if(a.query.callbackURL.includes("?"))throw a.redirect(`${a.query.callbackURL}&error=${b}`);throw a.redirect(`${a.query.callbackURL}?error=${b}`)}throw new I.APIError("UNAUTHORIZED",{message:b})}let{token:d}=a.query;try{b=await (0,a_.jwtVerify)(d,new TextEncoder().encode(a.context.secret),{algorithms:["HS256"]})}catch(a){if(a instanceof bt.JWTExpired)return c("token_expired");return c("invalid_token")}let e=T.object({email:T.email(),updateTo:T.string().optional(),requestType:T.string().optional()}).parse(b.payload),f=await a.context.internalAdapter.findUserByEmail(e.email);if(!f)return c("user_not_found");if(e.updateTo){let b=await aQ(a);if(b&&b.user.email!==e.email)return c("unauthorized");if("change-email-confirmation"===e.requestType){let b=await b7(a.context.secret,e.email,e.updateTo,a.context.options.emailVerification?.expiresIn,{requestType:"change-email-verification"}),c=a.query.callbackURL?encodeURIComponent(a.query.callbackURL):encodeURIComponent("/"),d=`${a.context.baseURL}/verify-email?token=${b}&callbackURL=${c}`;if(await a.context.options.emailVerification?.sendVerificationEmail?.({user:{...f.user,email:e.updateTo},url:d,token:b},a.request),a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0})}if(!b){let c=await a.context.internalAdapter.createSession(f.user.id);if(!c)throw new I.APIError("INTERNAL_SERVER_ERROR",{message:"Failed to create session"});b={session:c,user:f.user}}if("change-email-verification"===e.requestType){let c=await a.context.internalAdapter.updateUserByEmail(e.email,{email:e.updateTo,emailVerified:!0});if(await aH(a,{session:b.session,user:{...b.user,email:e.updateTo,emailVerified:!0}}),a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:c})}let d=await a.context.internalAdapter.updateUserByEmail(e.email,{email:e.updateTo,emailVerified:!1}),g=await b7(a.context.secret,e.updateTo),h=a.query.callbackURL?encodeURIComponent(a.query.callbackURL):encodeURIComponent("/");if(await a.context.options.emailVerification?.sendVerificationEmail?.({user:d,url:`${a.context.baseURL}/verify-email?token=${g}&callbackURL=${h}`,token:g},a.request),await aH(a,{session:b.session,user:{...b.user,email:e.updateTo,emailVerified:!1}}),a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:{id:d.id,email:d.email,name:d.name,image:d.image,emailVerified:d.emailVerified,createdAt:d.createdAt,updatedAt:d.updatedAt}})}if(f.user.emailVerified){if(a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:null})}a.context.options.emailVerification?.onEmailVerification&&await a.context.options.emailVerification.onEmailVerification(f.user,a.request);let g=await a.context.internalAdapter.updateUserByEmail(e.email,{emailVerified:!0});if(a.context.options.emailVerification?.afterEmailVerification&&await a.context.options.emailVerification.afterEmailVerification(g,a.request),a.context.options.emailVerification?.autoSignInAfterVerification){let b=await aQ(a);if(b&&b.user.email===e.email)await aH(a,{session:b.session,user:{...b.user,emailVerified:!0}});else{let b=await a.context.internalAdapter.createSession(f.user.id);if(!b)throw new I.APIError("INTERNAL_SERVER_ERROR",{message:"Failed to create session"});await aH(a,{session:b,user:{...f.user,emailVerified:!0}})}}if(a.query.callbackURL)throw a.redirect(a.query.callbackURL);return a.json({status:!0,user:null})});function cb(a){return a.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/&(?!amp;|lt;|gt;|quot;|#39;|#x[0-9a-fA-F]+;|#[0-9]+;)/g,"&amp;")}let cc=aO("/error",{method:"GET",metadata:{...H.n,openapi:{description:"Displays an error page",responses:{200:{description:"Success",content:{"text/html":{schema:{type:"string",description:"The HTML content of the error page"}}}}}}}},async a=>{let b=new URL(a.request?.url||""),c=b.searchParams.get("error")||"UNKNOWN",d=b.searchParams.get("error_description")||null,e=/^[\'A-Za-z0-9_-]+$/.test(c||"")?c:"UNKNOWN",f=d?cb(d):null,g=new URLSearchParams;g.set("error",e),d&&g.set("error_description",d);let h=a.context.options,i=h.onAPIError?.errorURL;return i?new Response(null,{status:302,headers:{Location:`${i}${i.includes("?")?"&":"?"}${g.toString()}`}}):ap.f&&!h.onAPIError?.customizeDefaultErrorPage?new Response(null,{status:302,headers:{Location:`/?${g.toString()}`}}):new Response(((a,b="Unknown",c=null)=>{let d=a.onAPIError?.customizeDefaultErrorPage;return`<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Error</title>
    <style>
      * {
        box-sizing: border-box;
      }
      body {
        font-family: ${d?.font?.defaultFamily||"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif"};
        background: ${d?.colors?.background||"var(--background)"};
        color: var(--foreground);
        margin: 0;
      }
      :root,
      :host {
        --spacing: 0.25rem;
        --container-md: 28rem;
        --text-sm: ${d?.size?.textSm||"0.875rem"};
        --text-sm--line-height: calc(1.25 / 0.875);
        --text-2xl: ${d?.size?.text2xl||"1.5rem"};
        --text-2xl--line-height: calc(2 / 1.5);
        --text-4xl: ${d?.size?.text4xl||"2.25rem"};
        --text-4xl--line-height: calc(2.5 / 2.25);
        --text-6xl: ${d?.size?.text6xl||"3rem"};
        --text-6xl--line-height: 1;
        --font-weight-medium: 500;
        --font-weight-semibold: 600;
        --font-weight-bold: 700;
        --default-transition-duration: 150ms;
        --default-transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
        --radius: ${d?.size?.radiusSm||"0.625rem"};
        --default-mono-font-family: ${d?.font?.monoFamily||"var(--font-geist-mono)"};
        --primary: ${d?.colors?.primary||"black"};
        --primary-foreground: ${d?.colors?.primaryForeground||"white"};
        --background: ${d?.colors?.background||"white"};
        --foreground: ${d?.colors?.foreground||"oklch(0.271 0 0)"};
        --border: ${d?.colors?.border||"oklch(0.89 0 0)"};
        --destructive: ${d?.colors?.destructive||"oklch(0.55 0.15 25.723)"};
        --muted-foreground: ${d?.colors?.mutedForeground||"oklch(0.545 0 0)"};
        --corner-border: ${d?.colors?.cornerBorder||"#404040"};
      }

      button, .btn {
        cursor: pointer;
        background: none;
        border: none;
        color: inherit;
        font: inherit;
        transition: all var(--default-transition-duration)
          var(--default-transition-timing-function);
      }
      button:hover, .btn:hover {
        opacity: 0.8;
      }

      @media (prefers-color-scheme: dark) {
        :root,
        :host {
          --primary: ${d?.colors?.primary||"white"};
          --primary-foreground: ${d?.colors?.primaryForeground||"black"};
          --background: ${d?.colors?.background||"oklch(0.15 0 0)"};
          --foreground: ${d?.colors?.foreground||"oklch(0.98 0 0)"};
          --border: ${d?.colors?.border||"oklch(0.27 0 0)"};
          --destructive: ${d?.colors?.destructive||"oklch(0.65 0.15 25.723)"};
          --muted-foreground: ${d?.colors?.mutedForeground||"oklch(0.65 0 0)"};
          --corner-border: ${d?.colors?.cornerBorder||"#a0a0a0"};
        }
      }
      @media (max-width: 640px) {
        :root, :host {
          --text-6xl: 2.5rem;
          --text-2xl: 1.25rem;
          --text-sm: 0.8125rem;
        }
      }
      @media (max-width: 480px) {
        :root, :host {
          --text-6xl: 2rem;
          --text-2xl: 1.125rem;
        }
      }
    </style>
  </head>
  <body style="width: 100vw; min-height: 100vh; overflow-x: hidden; overflow-y: auto;">
    <div
        style="
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            position: relative;
            width: 100%;
            min-height: 100vh;
            padding: 1rem;
        "
        >
${d?.disableBackgroundGrid?"":`
      <div
        style="
          position: absolute;
          inset: 0;
          background-image: linear-gradient(to right, ${d?.colors?.gridColor||"var(--border)"} 1px, transparent 1px),
            linear-gradient(to bottom, ${d?.colors?.gridColor||"var(--border)"} 1px, transparent 1px);
          background-size: 40px 40px;
          opacity: 0.6;
          pointer-events: none;
          width: 100vw;
          height: 100vh;
        "
      ></div>
      <div
        style="
          position: absolute;
          inset: 0;
          display: flex;
          align-items: center;
          justify-content: center;
          background: ${d?.colors?.background||"var(--background)"};
          mask-image: radial-gradient(ellipse at center, transparent 20%, black);
          -webkit-mask-image: radial-gradient(ellipse at center, transparent 20%, black);
          pointer-events: none;
        "
      ></div>
`}

<div
  style="
    position: relative;
    z-index: 10;
    border: 2px solid var(--border);
    background: ${d?.colors?.cardBackground||"var(--background)"};
    padding: 1.5rem;
    max-width: 42rem;
    width: 100%;
  "
>
    ${d?.disableCornerDecorations?"":`
        <!-- Corner decorations -->
        <div
          style="
            position: absolute;
            top: -2px;
            left: -2px;
            width: 2rem;
            height: 2rem;
            border-top: 4px solid var(--corner-border);
            border-left: 4px solid var(--corner-border);
          "
        ></div>
        <div
          style="
            position: absolute;
            top: -2px;
            right: -2px;
            width: 2rem;
            height: 2rem;
            border-top: 4px solid var(--corner-border);
            border-right: 4px solid var(--corner-border);
          "
        ></div>
  
        <div
          style="
            position: absolute;
            bottom: -2px;
            left: -2px;
            width: 2rem;
            height: 2rem;
            border-bottom: 4px solid var(--corner-border);
            border-left: 4px solid var(--corner-border);
          "
        ></div>
        <div
          style="
            position: absolute;
            bottom: -2px;
            right: -2px;
            width: 2rem;
            height: 2rem;
            border-bottom: 4px solid var(--corner-border);
            border-right: 4px solid var(--corner-border);
          "
        ></div>`}

        <div style="text-align: center; margin-bottom: 1.5rem;">
          <div style="margin-bottom: 1.5rem;">
            <div
              style="
                display: inline-block;
                border: 2px solid ${d?.disableTitleBorder?"transparent":d?.colors?.titleBorder||"var(--destructive)"};
                padding: 0.375rem 1rem;
              "
            >
              <h1
                style="
                  font-size: var(--text-6xl);
                  font-weight: var(--font-weight-semibold);
                  color: ${d?.colors?.titleColor||"var(--foreground)"};
                  letter-spacing: -0.02em;
                  margin: 0;
                "
              >
                ERROR
              </h1>
            </div>
            <div
              style="
                height: 2px;
                background-color: var(--border);
                width: calc(100% + 3rem);
                margin-left: -1.5rem;
                margin-top: 1.5rem;
              "
            ></div>
          </div>

          <h2
            style="
              font-size: var(--text-2xl);
              font-weight: var(--font-weight-semibold);
              color: var(--foreground);
              margin: 0 0 1rem;
            "
          >
            Something went wrong
          </h2>

          <div
            style="
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                border: 2px solid var(--border);
                background-color: var(--muted);
                padding: 0.375rem 0.75rem;
                margin: 0 0 1rem;
                flex-wrap: wrap;
                justify-content: center;
            "
            >
            <span
                style="
                font-size: 0.75rem;
                color: var(--muted-foreground);
                font-weight: var(--font-weight-semibold);
                "
            >
                CODE:
            </span>
            <span
                style="
                font-size: var(--text-sm);
                font-family: var(--default-mono-font-family, monospace);
                color: var(--foreground);
                word-break: break-all;
                "
            >
                ${cb(b)}
            </span>
            </div>

          <p
            style="
              color: var(--muted-foreground);
              max-width: 28rem;
              margin: 0 auto;
              font-size: var(--text-sm);
              line-height: 1.5;
              text-wrap: pretty;
            "
          >
            ${!c?`We encountered an unexpected error. Please try again or return to the home page. If you're a developer, you can find more information about the error <a href='https://better-auth.com/docs/errors/${encodeURIComponent(b)}' target='_blank' rel="noopener noreferrer" style='color: var(--foreground); text-decoration: underline;'>here</a>.`:c}
          </p>
        </div>

        <div
          style="
            display: flex;
            gap: 0.75rem;
            margin-top: 1.5rem;
            justify-content: center;
            flex-wrap: wrap;
          "
        >
          <a
            href="/"
            style="
              text-decoration: none;
            "
          >
            <div
              style="
                border: 2px solid var(--border);
                background: var(--primary);
                color: var(--primary-foreground);
                padding: 0.5rem 1rem;
                border-radius: 0;
                white-space: nowrap;
              "
              class="btn"
            >
              Go Home
            </div>
          </a>
          <a
            href="https://better-auth.com/docs/errors/${encodeURIComponent(b)}?askai=${encodeURIComponent(`What does the error code ${b} mean?`)}"
            target="_blank"
            rel="noopener noreferrer"
            style="
              text-decoration: none;
            "
          >
            <div
              style="
                border: 2px solid var(--border);
                background: transparent;
                color: var(--foreground);
                padding: 0.5rem 1rem;
                border-radius: 0;
                white-space: nowrap;
              "
              class="btn"
            >
              Ask AI
            </div>
          </a>
        </div>
      </div>
    </div>
  </body>
</html>`})(a.context.options,e,f),{headers:{"Content-Type":"text/html"}})}),cd=aO("/ok",{method:"GET",metadata:{...H.n,openapi:{description:"Check if the API is working",responses:{200:{description:"API is working",content:{"application/json":{schema:{type:"object",properties:{ok:{type:"boolean",description:"Indicates if the API is working"}},required:["ok"]}}}}}}}},async a=>a.json({ok:!0}));function ce(a,b,c){let d=b?new URL(b,a.baseURL):new URL(`${a.baseURL}/error`);return c&&Object.entries(c).forEach(([a,b])=>d.searchParams.set(a,b)),d.href}let cf=aO("/request-password-reset",{method:"POST",body:T.object({email:T.email().meta({description:"The email address of the user to send a password reset email to"}),redirectTo:T.string().meta({description:"The URL to redirect the user to reset their password. If the token isn't valid or expired, it'll be redirected with a query parameter `?error=INVALID_TOKEN`. If the token is valid, it'll be redirected with a query parameter `?token=VALID_TOKEN"}).optional()}),metadata:{openapi:{operationId:"requestPasswordReset",description:"Send a password reset email to the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"},message:{type:"string"}}}}}}}}}},async a=>{if(!a.context.options.emailAndPassword?.sendResetPassword)throw a.context.logger.error("Reset password isn't enabled.Please pass an emailAndPassword.sendResetPassword function in your auth config!"),new I.APIError("BAD_REQUEST",{message:"Reset password isn't enabled"});let{email:b,redirectTo:c}=a.body,d=await a.context.internalAdapter.findUserByEmail(b,{includeAccounts:!0});if(!d)return(0,H.t)(24),await a.context.internalAdapter.findVerificationValue("dummy-verification-token"),a.context.logger.error("Reset Password: User not found",{email:b}),a.json({status:!0,message:"If this email exists in our system, check your email for the reset link"});let e=J(a.context.options.emailAndPassword.resetPasswordTokenExpiresIn||3600,"sec"),f=(0,H.t)(24);await a.context.internalAdapter.createVerificationValue({value:d.user.id,identifier:`reset-password:${f}`,expiresAt:e});let g=c?encodeURIComponent(c):"",h=`${a.context.baseURL}/reset-password/${f}?callbackURL=${g}`;return await a.context.options.emailAndPassword.sendResetPassword({user:d.user,url:h,token:f},a.request).catch(b=>{a.context.logger.error("Failed to send reset password email",b)}),a.json({status:!0,message:"If this email exists in our system, check your email for the reset link"})}),cg=aO("/reset-password/:token",{method:"GET",operationId:"forgetPasswordCallback",query:T.object({callbackURL:T.string().meta({description:"The URL to redirect the user to reset their password"})}),use:[bV(a=>a.query.callbackURL)],metadata:{openapi:{operationId:"resetPasswordCallback",description:"Redirects the user to the callback URL with the token",parameters:[{name:"token",in:"path",required:!0,description:"The token to reset the password",schema:{type:"string"}},{name:"callbackURL",in:"query",required:!0,description:"The URL to redirect the user to reset their password",schema:{type:"string"}}],responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string"}}}}}}}}}},async a=>{var b,c;let d,{token:e}=a.params,{callbackURL:f}=a.query;if(!e||!f)throw a.redirect(ce(a.context,f,{error:"INVALID_TOKEN"}));let g=await a.context.internalAdapter.findVerificationValue(`reset-password:${e}`);if(!g||g.expiresAt<new Date)throw a.redirect(ce(a.context,f,{error:"INVALID_TOKEN"}));throw a.redirect((b=a.context,c={token:e},d=new URL(f,b.baseURL),c&&Object.entries(c).forEach(([a,b])=>d.searchParams.set(a,b)),d.href))}),ch=aO("/reset-password",{method:"POST",operationId:"resetPassword",query:T.object({token:T.string().optional()}).optional(),body:T.object({newPassword:T.string().meta({description:"The new password to set"}),token:T.string().meta({description:"The token to reset the password"}).optional()}),metadata:{openapi:{operationId:"resetPassword",description:"Reset the password for a user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{status:{type:"boolean"}}}}}}}}}},async a=>{let b=a.body.token||a.query?.token;if(!b)throw new I.APIError("BAD_REQUEST",{message:aJ.n.INVALID_TOKEN});let{newPassword:c}=a.body,d=a.context.password?.config.minPasswordLength,e=a.context.password?.config.maxPasswordLength;if(c.length<d)throw new I.APIError("BAD_REQUEST",{message:aJ.n.PASSWORD_TOO_SHORT});if(c.length>e)throw new I.APIError("BAD_REQUEST",{message:aJ.n.PASSWORD_TOO_LONG});let f=`reset-password:${b}`,g=await a.context.internalAdapter.findVerificationValue(f);if(!g||g.expiresAt<new Date)throw new I.APIError("BAD_REQUEST",{message:aJ.n.INVALID_TOKEN});let h=g.value,i=await a.context.password.hash(c);if((await a.context.internalAdapter.findAccounts(h)).find(a=>"credential"===a.providerId)?await a.context.internalAdapter.updatePassword(h,i):await a.context.internalAdapter.createAccount({userId:h,providerId:"credential",password:i,accountId:h}),await a.context.internalAdapter.deleteVerificationValue(g.id),a.context.options.emailAndPassword?.onPasswordReset){let b=await a.context.internalAdapter.findUserById(h);b&&await a.context.options.emailAndPassword.onPasswordReset({user:b},a.request)}return a.context.options.emailAndPassword?.revokeSessionsOnPasswordReset&&await a.context.internalAdapter.deleteSessions(h),a.json({status:!0})}),ci=T.object({callbackURL:T.string().meta({description:"Callback URL to redirect to after the user has signed in"}).optional(),newUserCallbackURL:T.string().optional(),errorCallbackURL:T.string().meta({description:"Callback URL to redirect to if an error happens"}).optional(),provider:bN,disableRedirect:T.boolean().meta({description:"Disable automatic redirection to the provider. Useful for handling the redirection yourself"}).optional(),idToken:T.optional(T.object({token:T.string().meta({description:"ID token from the provider"}),nonce:T.string().meta({description:"Nonce used to generate the token"}).optional(),accessToken:T.string().meta({description:"Access token from the provider"}).optional(),refreshToken:T.string().meta({description:"Refresh token from the provider"}).optional(),expiresAt:T.number().meta({description:"Expiry date of the token"}).optional()})),scopes:T.array(T.string()).meta({description:"Array of scopes to request from the provider. This will override the default scopes passed."}).optional(),requestSignUp:T.boolean().meta({description:"Explicitly request sign-up. Useful when disableImplicitSignUp is true for this provider"}).optional(),loginHint:T.string().meta({description:"The login hint to use for the authorization code request"}).optional(),additionalData:T.record(T.string(),T.any()).optional().meta({description:"Additional data to be passed through the OAuth flow"})}),cj=aO("/sign-out",{method:"POST",operationId:"signOut",requireHeaders:!0,metadata:{openapi:{operationId:"signOut",description:"Sign out the current user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean"}}}}}}}}}},async a=>{let b=await a.getSignedCookie(a.context.authCookies.sessionToken.name,a.context.secret);if(b)try{await a.context.internalAdapter.deleteSession(b)}catch(b){a.context.logger.error("Failed to delete session from database",b)}return aI(a),a.json({success:!0})}),ck=aO("/change-password",{method:"POST",operationId:"changePassword",body:T.object({newPassword:T.string().meta({description:"The new password to set"}),currentPassword:T.string().meta({description:"The current password is required"}),revokeOtherSessions:T.boolean().meta({description:"Must be a boolean value"}).optional()}),use:[aS],metadata:{openapi:{operationId:"changePassword",description:"Change the password of the user",responses:{200:{description:"Password successfully changed",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"New session token if other sessions were revoked"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}}}}}},async a=>{let{newPassword:b,currentPassword:c,revokeOtherSessions:d}=a.body,e=a.context.session,f=a.context.password.config.minPasswordLength;if(b.length<f)throw a.context.logger.error("Password is too short"),new I.APIError("BAD_REQUEST",{message:aJ.n.PASSWORD_TOO_SHORT});let g=a.context.password.config.maxPasswordLength;if(b.length>g)throw a.context.logger.error("Password is too long"),new I.APIError("BAD_REQUEST",{message:aJ.n.PASSWORD_TOO_LONG});let h=(await a.context.internalAdapter.findAccounts(e.user.id)).find(a=>"credential"===a.providerId&&a.password);if(!h||!h.password)throw new I.APIError("BAD_REQUEST",{message:aJ.n.CREDENTIAL_ACCOUNT_NOT_FOUND});let i=await a.context.password.hash(b);if(!await a.context.password.verify({hash:h.password,password:c}))throw new I.APIError("BAD_REQUEST",{message:aJ.n.INVALID_PASSWORD});await a.context.internalAdapter.updateAccount(h.id,{password:i});let j=null;if(d){await a.context.internalAdapter.deleteSessions(e.user.id);let b=await a.context.internalAdapter.createSession(e.user.id);if(!b)throw new I.APIError("INTERNAL_SERVER_ERROR",{message:aJ.n.FAILED_TO_GET_SESSION});await aH(a,{session:b,user:e.user}),j=b.token}return a.json({token:j,user:{id:e.user.id,email:e.user.email,name:e.user.name,image:e.user.image,emailVerified:e.user.emailVerified,createdAt:e.user.createdAt,updatedAt:e.user.updatedAt}})}),cl=aO("/set-password",{method:"POST",body:T.object({newPassword:T.string().meta({description:"The new password to set is required"})}),metadata:{SERVER_ONLY:!0},use:[aS]},async a=>{let{newPassword:b}=a.body,c=a.context.session,d=a.context.password.config.minPasswordLength;if(b.length<d)throw a.context.logger.error("Password is too short"),new I.APIError("BAD_REQUEST",{message:aJ.n.PASSWORD_TOO_SHORT});let e=a.context.password.config.maxPasswordLength;if(b.length>e)throw a.context.logger.error("Password is too long"),new I.APIError("BAD_REQUEST",{message:aJ.n.PASSWORD_TOO_LONG});let f=(await a.context.internalAdapter.findAccounts(c.user.id)).find(a=>"credential"===a.providerId&&a.password),g=await a.context.password.hash(b);if(!f)return await a.context.internalAdapter.linkAccount({userId:c.user.id,providerId:"credential",accountId:c.user.id,password:g}),a.json({status:!0});throw new I.APIError("BAD_REQUEST",{message:"user already has a password"})}),cm=aO("/delete-user",{method:"POST",use:[aS],body:T.object({callbackURL:T.string().meta({description:"The callback URL to redirect to after the user is deleted"}).optional(),password:T.string().meta({description:"The password of the user is required to delete the user"}).optional(),token:T.string().meta({description:"The token to delete the user is required"}).optional()}),metadata:{openapi:{operationId:"deleteUser",description:"Delete the user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{callbackURL:{type:"string",description:"The callback URL to redirect to after the user is deleted"},password:{type:"string",description:"The user's password. Required if session is not fresh"},token:{type:"string",description:"The deletion verification token"}}}}}},responses:{200:{description:"User deletion processed successfully",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the operation was successful"},message:{type:"string",enum:["User deleted","Verification email sent"],description:"Status message of the deletion process"}},required:["success","message"]}}}}}}}},async a=>{if(!a.context.options.user?.deleteUser?.enabled)throw a.context.logger.error("Delete user is disabled. Enable it in the options"),new I.APIError("NOT_FOUND");let b=a.context.session;if(a.body.password){let c=(await a.context.internalAdapter.findAccounts(b.user.id)).find(a=>"credential"===a.providerId&&a.password);if(!c||!c.password)throw new I.APIError("BAD_REQUEST",{message:aJ.n.CREDENTIAL_ACCOUNT_NOT_FOUND});if(!await a.context.password.verify({hash:c.password,password:a.body.password}))throw new I.APIError("BAD_REQUEST",{message:aJ.n.INVALID_PASSWORD})}if(a.body.token)return await cn({...a,query:{token:a.body.token}}),a.json({success:!0,message:"User deleted"});if(a.context.options.user.deleteUser?.sendDeleteAccountVerification){let c=(0,ai.r)(32,"0-9","a-z");await a.context.internalAdapter.createVerificationValue({value:b.user.id,identifier:`delete-account-${c}`,expiresAt:new Date(Date.now()+1e3*(a.context.options.user.deleteUser?.deleteTokenExpiresIn||86400))});let d=`${a.context.baseURL}/delete-user/callback?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;return await a.context.options.user.deleteUser.sendDeleteAccountVerification({user:b.user,url:d,token:c},a.request),a.json({success:!0,message:"Verification email sent"})}if(!a.body.password&&0!==a.context.sessionConfig.freshAge){let c=new Date(b.session.createdAt).getTime(),d=1e3*a.context.sessionConfig.freshAge;if(Date.now()-c>1e3*d)throw new I.APIError("BAD_REQUEST",{message:aJ.n.SESSION_EXPIRED})}let c=a.context.options.user.deleteUser?.beforeDelete;c&&await c(b.user,a.request),await a.context.internalAdapter.deleteUser(b.user.id),await a.context.internalAdapter.deleteSessions(b.user.id),aI(a);let d=a.context.options.user.deleteUser?.afterDelete;return d&&await d(b.user,a.request),a.json({success:!0,message:"User deleted"})}),cn=aO("/delete-user/callback",{method:"GET",query:T.object({token:T.string().meta({description:"The token to verify the deletion request"}),callbackURL:T.string().meta({description:"The URL to redirect to after deletion"}).optional()}),use:[bV(a=>a.query.callbackURL)],metadata:{openapi:{description:"Callback to complete user deletion with verification token",responses:{200:{description:"User successfully deleted",content:{"application/json":{schema:{type:"object",properties:{success:{type:"boolean",description:"Indicates if the deletion was successful"},message:{type:"string",enum:["User deleted"],description:"Confirmation message"}},required:["success","message"]}}}}}}}},async a=>{if(!a.context.options.user?.deleteUser?.enabled)throw a.context.logger.error("Delete user is disabled. Enable it in the options"),new I.APIError("NOT_FOUND");let b=await aQ(a);if(!b)throw new I.APIError("NOT_FOUND",{message:aJ.n.FAILED_TO_GET_USER_INFO});let c=await a.context.internalAdapter.findVerificationValue(`delete-account-${a.query.token}`);if(!c||c.expiresAt<new Date||c.value!==b.user.id)throw new I.APIError("NOT_FOUND",{message:aJ.n.INVALID_TOKEN});let d=a.context.options.user.deleteUser?.beforeDelete;d&&await d(b.user,a.request),await a.context.internalAdapter.deleteUser(b.user.id),await a.context.internalAdapter.deleteSessions(b.user.id),await a.context.internalAdapter.deleteAccounts(b.user.id),await a.context.internalAdapter.deleteVerificationValue(c.id),aI(a);let e=a.context.options.user.deleteUser?.afterDelete;if(e&&await e(b.user,a.request),a.query.callbackURL)throw a.redirect(a.query.callbackURL||"/");return a.json({success:!0,message:"User deleted"})}),co=aO("/change-email",{method:"POST",body:T.object({newEmail:T.email().meta({description:"The new email address to set must be a valid email address"}),callbackURL:T.string().meta({description:"The URL to redirect to after email verification"}).optional()}),use:[aS],metadata:{openapi:{operationId:"changeEmail",responses:{200:{description:"Email change request processed successfully",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",$ref:"#/components/schemas/User"},status:{type:"boolean",description:"Indicates if the request was successful"},message:{type:"string",enum:["Email updated","Verification email sent"],description:"Status message of the email change process",nullable:!0}},required:["status"]}}}},422:{description:"Unprocessable Entity. Email already exists",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}}}}}},async a=>{if(!a.context.options.user?.changeEmail?.enabled)throw a.context.logger.error("Change email is disabled."),new I.APIError("BAD_REQUEST",{message:"Change email is disabled"});let b=a.body.newEmail.toLowerCase();if(b===a.context.session.user.email)throw a.context.logger.error("Email is the same"),new I.APIError("BAD_REQUEST",{message:"Email is the same"});if(await a.context.internalAdapter.findUserByEmail(b))throw a.context.logger.error("Email already exists"),new I.APIError("UNPROCESSABLE_ENTITY",{message:aJ.n.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL});if(!0!==a.context.session.user.emailVerified&&a.context.options.user.changeEmail.updateEmailWithoutVerification){if(await a.context.internalAdapter.updateUserByEmail(a.context.session.user.email,{email:b}),await aH(a,{session:a.context.session.session,user:{...a.context.session.user,email:b}}),a.context.options.emailVerification?.sendVerificationEmail){let c=await b7(a.context.secret,b,void 0,a.context.options.emailVerification?.expiresIn),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;await a.context.options.emailVerification.sendVerificationEmail({user:{...a.context.session.user,email:b},url:d,token:c},a.request)}return a.json({status:!0})}if(a.context.session.user.emailVerified&&(a.context.options.user.changeEmail.sendChangeEmailConfirmation||a.context.options.user.changeEmail.sendChangeEmailVerification)){let c=await b7(a.context.secret,a.context.session.user.email,b,a.context.options.emailVerification?.expiresIn,{requestType:"change-email-confirmation"}),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`,e=a.context.options.user.changeEmail.sendChangeEmailConfirmation||a.context.options.user.changeEmail.sendChangeEmailVerification;return e&&await e({user:a.context.session.user,newEmail:b,url:d,token:c},a.request),a.json({status:!0})}if(!a.context.options.emailVerification?.sendVerificationEmail)throw a.context.logger.error("Verification email isn't enabled."),new I.APIError("BAD_REQUEST",{message:"Verification email isn't enabled"});let c=await b7(a.context.secret,a.context.session.user.email,b,a.context.options.emailVerification?.expiresIn,{requestType:"change-email-verification"}),d=`${a.context.baseURL}/verify-email?token=${c}&callbackURL=${a.body.callbackURL||"/"}`;return await a.context.options.emailVerification.sendVerificationEmail({user:{...a.context.session.user,email:b},url:d,token:c},a.request),a.json({status:!0})}),cp=bP((a,b,c)=>{if(Array.isArray(a[b])&&Array.isArray(c))return a[b]=c,!0});async function cq(a,b){let c={};for(let d of b)if(d.matcher(a)){let b=await d.handler({...a,returnHeaders:!1}).catch(b=>{throw b instanceof I.APIError&&(0,a$.a)(a.context.logger.level,"debug")&&(b.stack=b.errorStack),b});if(b&&"object"==typeof b){if("context"in b&&"object"==typeof b.context){let{headers:a,...d}=b.context;a instanceof Headers&&(c.headers?a.forEach((a,b)=>{c.headers?.set(b,a)}):c.headers=a),c=cp(d,c);continue}return b}}return{context:c}}async function cr(a,b){for(let c of b)if(c.matcher(a)){let b=await c.handler(a).catch(b=>{if(b instanceof I.APIError)return(0,a$.a)(a.context.logger.level,"debug")&&(b.stack=b.errorStack),{response:b,headers:b.headers?new Headers(b.headers):null};throw b});b.headers&&b.headers.forEach((b,c)=>{a.context.responseHeaders?"set-cookie"===c.toLowerCase()?a.context.responseHeaders.append(c,b):a.context.responseHeaders.set(c,b):a.context.responseHeaders=new Headers({[c]:b})}),b.response&&(a.context.returned=b.response)}return{response:a.context.returned,headers:a.context.responseHeaders}}function cs(a,b){let c=b.plugins?.reduce((a,b)=>({...a,...b.endpoints}),{})??{},d=b.plugins?.map(b=>b.middlewares?.map(b=>{let c=async c=>{let d=await a;return b.middleware({...c,context:{...d,...c.context}})};return c.options=b.middleware.options,{path:b.path,middleware:c}})).filter(a=>void 0!==a).flat()||[];return{api:function(a,b){let c={};for(let[d,e]of Object.entries(a))c[d]=async a=>{let c=async()=>{let c=await b,d={...a,context:{...c,returned:void 0,responseHeaders:void 0,session:null},path:e.path,headers:a?.headers?new Headers(a?.headers):void 0};return(0,aY.f)(d,async()=>{let{beforeHooks:b,afterHooks:f}=function(a){let b=a.options.plugins||[],c=[],d=[];a.options.hooks?.before&&c.push({matcher:()=>!0,handler:a.options.hooks.before}),a.options.hooks?.after&&d.push({matcher:()=>!0,handler:a.options.hooks.after});let e=b.map(a=>{if(a.hooks?.before)return a.hooks.before}).filter(a=>void 0!==a).flat(),f=b.map(a=>{if(a.hooks?.after)return a.hooks.after}).filter(a=>void 0!==a).flat();return e.length&&c.push(...e),f.length&&d.push(...f),{beforeHooks:c,afterHooks:d}}(c),g=await cq(d,b);if("context"in g&&g.context&&"object"==typeof g.context){let{headers:a,...b}=g.context;a&&a.forEach((a,b)=>{d.headers.set(b,a)}),d=cp(b,d)}else if(g)return a?.asResponse?(0,I.toResponse)(g,{headers:a?.headers}):a?.returnHeaders?{headers:a?.headers,response:g}:g;d.asResponse=!1,d.returnHeaders=!0,d.returnStatus=!0;let h=await (0,aY.f)(d,()=>e(d)).catch(a=>{if(a instanceof I.APIError)return{response:a,status:a.statusCode,headers:a.headers?new Headers(a.headers):null};throw a});if(h&&h instanceof Response)return h;d.context.returned=h.response,d.context.responseHeaders=h.headers;let i=await cr(d,f);if(i.response&&(h.response=i.response),h.response instanceof I.APIError&&(0,a$.a)(c.logger.level,"debug")&&(h.response.stack=h.response.errorStack),h.response instanceof I.APIError&&!a?.asResponse)throw h.response;return a?.asResponse?(0,I.toResponse)(h.response,{headers:h.headers,status:h.status}):a?.returnHeaders?a?.returnStatus?{headers:h.headers,response:h.response,status:h.status}:{headers:h.headers,response:h.response}:a?.returnStatus?{response:h.response,status:h.status}:h.response})};return await (0,aX.c)()?c():(0,aZ.l)(new WeakMap,c)},c[d].path=e.path,c[d].options=e.options;return c}({signInSocial:aO("/sign-in/social",{method:"POST",operationId:"socialSignIn",body:ci,metadata:{$Infer:{body:{},returned:{}},openapi:{description:"Sign in with a social provider",operationId:"socialSignIn",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{token:{type:"string"},user:{type:"object",$ref:"#/components/schemas/User"},url:{type:"string"},redirect:{type:"boolean",enum:[!1]}},required:["redirect","token","user"]}}}}}}}},async a=>{let b=a.context.socialProviders.find(b=>b.id===a.body.provider);if(!b)throw a.context.logger.error("Provider not found. Make sure to add the provider in your auth config",{provider:a.body.provider}),new I.APIError("NOT_FOUND",{message:aJ.n.PROVIDER_NOT_FOUND});if(a.body.idToken){if(!b.verifyIdToken)throw a.context.logger.error("Provider does not support id token verification",{provider:a.body.provider}),new I.APIError("NOT_FOUND",{message:aJ.n.ID_TOKEN_NOT_SUPPORTED});let{token:c,nonce:d}=a.body.idToken;if(!await b.verifyIdToken(c,d))throw a.context.logger.error("Invalid id token",{provider:a.body.provider}),new I.APIError("UNAUTHORIZED",{message:aJ.n.INVALID_TOKEN});let e=await b.getUserInfo({idToken:c,accessToken:a.body.idToken.accessToken,refreshToken:a.body.idToken.refreshToken});if(!e||!e?.user)throw a.context.logger.error("Failed to get user info",{provider:a.body.provider}),new I.APIError("UNAUTHORIZED",{message:aJ.n.FAILED_TO_GET_USER_INFO});if(!e.user.email)throw a.context.logger.error("User email not found",{provider:a.body.provider}),new I.APIError("UNAUTHORIZED",{message:aJ.n.USER_EMAIL_NOT_FOUND});let f=await b4(a,{userInfo:{...e.user,email:e.user.email,id:String(e.user.id),name:e.user.name||"",image:e.user.image,emailVerified:e.user.emailVerified||!1},account:{providerId:b.id,accountId:String(e.user.id),accessToken:a.body.idToken.accessToken},callbackURL:a.body.callbackURL,disableSignUp:b.disableImplicitSignUp&&!a.body.requestSignUp||b.disableSignUp});if(f.error)throw new I.APIError("UNAUTHORIZED",{message:f.error});return await aH(a,f.data),a.json({redirect:!1,token:f.data.session.token,url:void 0,user:N(a.context.options,f.data.user)})}let{codeVerifier:c,state:d}=await (0,H.r)(a,void 0,a.body.additionalData),e=await b.createAuthorizationURL({state:d,codeVerifier:c,redirectURI:`${a.context.baseURL}/callback/${b.id}`,scopes:a.body.scopes,loginHint:a.body.loginHint});return a.json({url:e.toString(),redirect:!a.body.disableRedirect})}),callbackOAuth:b6,getSession:aP(),signOut:cj,signUpEmail:aO("/sign-up/email",{method:"POST",operationId:"signUpWithEmailAndPassword",body:T.record(T.string(),T.any()),metadata:{$Infer:{body:{},returned:{}},openapi:{operationId:"signUpWithEmailAndPassword",description:"Sign up a user using email and password",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},email:{type:"string",description:"The email of the user"},password:{type:"string",description:"The password of the user"},image:{type:"string",description:"The profile image URL of the user"},callbackURL:{type:"string",description:"The URL to use for email verification callback"},rememberMe:{type:"boolean",description:"If this is false, the session will not be remembered. Default is `true`."}},required:["name","email","password"]}}}},responses:{200:{description:"Successfully created user",content:{"application/json":{schema:{type:"object",properties:{token:{type:"string",nullable:!0,description:"Authentication token for the session"},user:{type:"object",properties:{id:{type:"string",description:"The unique identifier of the user"},email:{type:"string",format:"email",description:"The email address of the user"},name:{type:"string",description:"The name of the user"},image:{type:"string",format:"uri",nullable:!0,description:"The profile image URL of the user"},emailVerified:{type:"boolean",description:"Whether the email has been verified"},createdAt:{type:"string",format:"date-time",description:"When the user was created"},updatedAt:{type:"string",format:"date-time",description:"When the user was last updated"}},required:["id","email","name","emailVerified","createdAt","updatedAt"]}},required:["user"]}}}},422:{description:"Unprocessable Entity. User already exists or failed to create user.",content:{"application/json":{schema:{type:"object",properties:{message:{type:"string"}}}}}}}}}},async a=>(0,Y.i)(a.context.adapter,async()=>{let b;if(!a.context.options.emailAndPassword?.enabled||a.context.options.emailAndPassword?.disableSignUp)throw new I.APIError("BAD_REQUEST",{message:"Email and password sign up is not enabled"});let c=a.body,{name:d,email:e,password:f,image:g,callbackURL:h,rememberMe:i,...j}=c;if(!T.email().safeParse(e).success)throw new I.APIError("BAD_REQUEST",{message:aJ.n.INVALID_EMAIL});let k=a.context.password.config.minPasswordLength;if(f.length<k)throw a.context.logger.error("Password is too short"),new I.APIError("BAD_REQUEST",{message:aJ.n.PASSWORD_TOO_SHORT});let l=a.context.password.config.maxPasswordLength;if(f.length>l)throw a.context.logger.error("Password is too long"),new I.APIError("BAD_REQUEST",{message:aJ.n.PASSWORD_TOO_LONG});if((await a.context.internalAdapter.findUserByEmail(e))?.user)throw a.context.logger.info(`Sign-up attempt for existing email: ${e}`),new I.APIError("UNPROCESSABLE_ENTITY",{message:aJ.n.USER_ALREADY_EXISTS_USE_ANOTHER_EMAIL});let m=await a.context.password.hash(f);try{let c=Q(a.context.options,j,"create");if(!(b=await a.context.internalAdapter.createUser({email:e.toLowerCase(),name:d,image:g,...c,emailVerified:!1})))throw new I.APIError("BAD_REQUEST",{message:aJ.n.FAILED_TO_CREATE_USER})}catch(b){if((0,R.d)()&&a.context.logger.error("Failed to create user",b),b instanceof I.APIError)throw b;throw a.context.logger?.error("Failed to create user",b),new I.APIError("UNPROCESSABLE_ENTITY",{message:aJ.n.FAILED_TO_CREATE_USER,details:b})}if(!b)throw new I.APIError("UNPROCESSABLE_ENTITY",{message:aJ.n.FAILED_TO_CREATE_USER});if(await a.context.internalAdapter.linkAccount({userId:b.id,providerId:"credential",accountId:b.id,password:m}),a.context.options.emailVerification?.sendOnSignUp||a.context.options.emailAndPassword.requireEmailVerification){let d=await b7(a.context.secret,b.email,void 0,a.context.options.emailVerification?.expiresIn),e=c.callbackURL?encodeURIComponent(c.callbackURL):encodeURIComponent("/"),f=`${a.context.baseURL}/verify-email?token=${d}&callbackURL=${e}`,g=a.request?[{user:b,url:f,token:d},a.request]:[{user:b,url:f,token:d}];await a.context.options.emailVerification?.sendVerificationEmail?.(...g)}if(!1===a.context.options.emailAndPassword.autoSignIn||a.context.options.emailAndPassword.requireEmailVerification)return a.json({token:null,user:N(a.context.options,b)});let n=await a.context.internalAdapter.createSession(b.id,!1===i);if(!n)throw new I.APIError("BAD_REQUEST",{message:aJ.n.FAILED_TO_CREATE_SESSION});return await aH(a,{session:n,user:b},!1===i),a.json({token:n.token,user:N(a.context.options,b)})})),signInEmail:aO("/sign-in/email",{method:"POST",operationId:"signInEmail",body:T.object({email:T.string().meta({description:"Email of the user"}),password:T.string().meta({description:"Password of the user"}),callbackURL:T.string().meta({description:"Callback URL to use as a redirect for email verification"}).optional(),rememberMe:T.boolean().meta({description:"If this is false, the session will not be remembered. Default is `true`."}).default(!0).optional()}),metadata:{$Infer:{body:{},returned:{}},openapi:{operationId:"signInEmail",description:"Sign in with email and password",responses:{200:{description:"Success - Returns either session details or redirect URL",content:{"application/json":{schema:{type:"object",description:"Session response when idToken is provided",properties:{redirect:{type:"boolean",enum:[!1]},token:{type:"string",description:"Session token"},url:{type:"string",nullable:!0},user:{type:"object",$ref:"#/components/schemas/User"}},required:["redirect","token","user"]}}}}}}}},async a=>{if(!a.context.options?.emailAndPassword?.enabled)throw a.context.logger.error("Email and password is not enabled. Make sure to enable it in the options on you `auth.ts` file. Check `https://better-auth.com/docs/authentication/email-password` for more!"),new I.APIError("BAD_REQUEST",{message:"Email and password is not enabled"});let{email:b,password:c}=a.body;if(!T.email().safeParse(b).success)throw new I.APIError("BAD_REQUEST",{message:aJ.n.INVALID_EMAIL});let d=await a.context.internalAdapter.findUserByEmail(b,{includeAccounts:!0});if(!d)throw await a.context.password.hash(c),a.context.logger.error("User not found",{email:b}),new I.APIError("UNAUTHORIZED",{message:aJ.n.INVALID_EMAIL_OR_PASSWORD});let e=d.accounts.find(a=>"credential"===a.providerId);if(!e)throw await a.context.password.hash(c),a.context.logger.error("Credential account not found",{email:b}),new I.APIError("UNAUTHORIZED",{message:aJ.n.INVALID_EMAIL_OR_PASSWORD});let f=e?.password;if(!f)throw await a.context.password.hash(c),a.context.logger.error("Password not found",{email:b}),new I.APIError("UNAUTHORIZED",{message:aJ.n.INVALID_EMAIL_OR_PASSWORD});if(!await a.context.password.verify({hash:f,password:c}))throw a.context.logger.error("Invalid password"),new I.APIError("UNAUTHORIZED",{message:aJ.n.INVALID_EMAIL_OR_PASSWORD});if(a.context.options?.emailAndPassword?.requireEmailVerification&&!d.user.emailVerified){if(!a.context.options?.emailVerification?.sendVerificationEmail)throw new I.APIError("FORBIDDEN",{message:aJ.n.EMAIL_NOT_VERIFIED});if(a.context.options?.emailVerification?.sendOnSignIn){let b=await b7(a.context.secret,d.user.email,void 0,a.context.options.emailVerification?.expiresIn),c=a.body.callbackURL?encodeURIComponent(a.body.callbackURL):encodeURIComponent("/"),e=`${a.context.baseURL}/verify-email?token=${b}&callbackURL=${c}`;await a.context.options.emailVerification.sendVerificationEmail({user:d.user,url:e,token:b},a.request)}throw new I.APIError("FORBIDDEN",{message:aJ.n.EMAIL_NOT_VERIFIED})}let g=await a.context.internalAdapter.createSession(d.user.id,!1===a.body.rememberMe);if(!g)throw a.context.logger.error("Failed to create session"),new I.APIError("UNAUTHORIZED",{message:aJ.n.FAILED_TO_CREATE_SESSION});return await aH(a,{session:g,user:d.user},!1===a.body.rememberMe),a.json({redirect:!!a.body.callbackURL,token:g.token,url:a.body.callbackURL,user:N(a.context.options,d.user)})}),resetPassword:ch,verifyEmail:ca,sendVerificationEmail:b9,changeEmail:co,changePassword:ck,setPassword:cl,updateUser:aO("/update-user",{method:"POST",operationId:"updateUser",body:T.record(T.string().meta({description:"Field name must be a string"}),T.any()),use:[aR],metadata:{$Infer:{body:{}},openapi:{operationId:"updateUser",description:"Update the current user",requestBody:{content:{"application/json":{schema:{type:"object",properties:{name:{type:"string",description:"The name of the user"},image:{type:"string",description:"The image of the user",nullable:!0}}}}}},responses:{200:{description:"Success",content:{"application/json":{schema:{type:"object",properties:{user:{type:"object",$ref:"#/components/schemas/User"}}}}}}}}}},async a=>{let b=a.body;if(b.email)throw new I.APIError("BAD_REQUEST",{message:aJ.n.EMAIL_CAN_NOT_BE_UPDATED});let{name:c,image:d,...e}=b,f=a.context.session,g=Q(a.context.options,e,"update");if(void 0===d&&void 0===c&&0===Object.keys(g).length)throw new I.APIError("BAD_REQUEST",{message:"No fields to update"});let h=await a.context.internalAdapter.updateUser(f.user.id,{name:c,image:d,...g});return await aH(a,{session:f.session,user:h}),a.json({status:!0})}),deleteUser:cm,requestPasswordReset:cf,requestPasswordResetCallback:cg,listSessions:aO("/list-sessions",{method:"GET",operationId:"listUserSessions",use:[aR],requireHeaders:!0,metadata:{openapi:{operationId:"listUserSessions",description:"List all active sessions for the user",responses:{200:{description:"Success",content:{"application/json":{schema:{type:"array",items:{$ref:"#/components/schemas/Session"}}}}}}}}},async a=>{try{let b=(await a.context.internalAdapter.listSessions(a.context.session.user.id)).filter(a=>a.expiresAt>new Date);return a.json(b)}catch(b){throw a.context.logger.error(b),a.error("INTERNAL_SERVER_ERROR")}}),revokeSession:aU,revokeSessions:aV,revokeOtherSessions:aW,linkSocialAccount:b_,listUserAccounts:b$,deleteUserCallback:cn,unlinkAccount:b0,refreshToken:b2,getAccessToken:b1,accountInfo:b3,...c,ok:cd,error:cc},a),middlewares:d}}async function ct(a,b){let c=(await b.context.internalAdapter.findAccounts(a))?.find(a=>"credential"===a.providerId),d=c?.password;if(!c||!d||!b.body.password)throw new I.APIError("BAD_REQUEST",{message:"No password credential found"});if(!await b.context.password.verify({hash:d,password:b.body.password}))throw new I.APIError("BAD_REQUEST",{message:"Invalid password"});return!0}var cu=W,Z=R,ao=R,ap=R,S=R,aJ=aJ,cv=R,ao=R,cw=R,cx=R,S=R,cy=a.i(71633),cz=a.i(12719);async function cA(){if(c)return c;try{let a="undefined"!=typeof process&&"function"==typeof process.cwd?process.cwd():"";if(!a)return;let[{default:b},{default:d}]=await Promise.all([Function("mm","return import(mm)")("fs/promises"),Function("mm","return import(mm)")("path")]),e=await b.readFile(d.join(a,"package.json"),"utf-8");return c=JSON.parse(e)}catch{}}async function cB(a){if(c)return c.dependencies?.[a]||c.devDependencies?.[a]||c.peerDependencies?.[a];try{let b="undefined"!=typeof process&&"function"==typeof process.cwd?process.cwd():"";if(!b)throw Error("no-cwd");let[{default:c},{default:d}]=await Promise.all([Function("mm","return import(mm)")("fs/promises"),Function("mm","return import(mm)")("path")]),e=d.join(b,"node_modules",a,"package.json"),f=await c.readFile(e,"utf-8");return JSON.parse(f).version||await cC(a)||void 0}catch{}return await cC(a)}async function cC(a){let b=await cA();if(b)return({...b.dependencies,...b.devDependencies,...b.peerDependencies})[a]}async function cD(){return(await cA())?.name}let cE={pg:"postgresql",mysql:"mysql",mariadb:"mariadb",sqlite3:"sqlite","better-sqlite3":"sqlite","@prisma/client":"prisma",mongoose:"mongodb",mongodb:"mongodb","drizzle-orm":"drizzle"};async function cF(){for(let[a,b]of Object.entries(cE)){let c=await cB(a);if(c)return{name:b,version:c}}}let cG={next:"next",nuxt:"nuxt","@remix-run/server-runtime":"remix",astro:"astro","@sveltejs/kit":"sveltekit","solid-start":"solid-start","tanstack-start":"tanstack-start",hono:"hono",express:"express",elysia:"elysia",expo:"expo"};async function cH(){for(let[a,b]of Object.entries(cG)){let c=await cB(a);if(c)return{name:b,version:c}}}function cI(){let a=(...a)=>a.some(a=>!!ao.c[a]);return a("CF_PAGES","CF_PAGES_URL","CF_ACCOUNT_ID")||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent?"cloudflare":a("VERCEL","VERCEL_URL","VERCEL_ENV")?"vercel":a("NETLIFY","NETLIFY_URL")?"netlify":a("RENDER","RENDER_URL","RENDER_INTERNAL_HOSTNAME","RENDER_SERVICE_ID")?"render":a("AWS_LAMBDA_FUNCTION_NAME","AWS_EXECUTION_ENV","LAMBDA_TASK_ROOT")?"aws":a("GOOGLE_CLOUD_FUNCTION_NAME","GOOGLE_CLOUD_PROJECT","GCP_PROJECT","K_SERVICE")?"gcp":a("AZURE_FUNCTION_NAME","FUNCTIONS_WORKER_RUNTIME","WEBSITE_INSTANCE_ID","WEBSITE_SITE_NAME")?"azure":a("DENO_DEPLOYMENT_ID","DENO_REGION")?"deno-deploy":a("FLY_APP_NAME","FLY_REGION","FLY_ALLOC_ID")?"fly-io":a("RAILWAY_STATIC_URL","RAILWAY_ENVIRONMENT_NAME")?"railway":a("DYNO","HEROKU_APP_NAME")?"heroku":a("DO_DEPLOYMENT_ID","DO_APP_NAME","DIGITALOCEAN")?"digitalocean":a("KOYEB","KOYEB_DEPLOYMENT_ID","KOYEB_APP_NAME")?"koyeb":null}async function cJ(){try{if("cloudflare"===cI())return"cloudflare";let a=await Function("mm","return import(mm)")("os"),b=a.cpus();return{deploymentVendor:cI(),systemPlatform:a.platform(),systemRelease:a.release(),systemArchitecture:a.arch(),cpuCount:b.length,cpuModel:b.length?b[0].model:null,cpuSpeed:b.length?b[0].speed:null,memory:a.totalmem(),isWSL:await cN(),isDocker:await cM(),isTTY:"undefined"!=typeof process&&process.stdout?process.stdout.isTTY:null}}catch(a){return{systemPlatform:null,systemRelease:null,systemArchitecture:null,cpuCount:null,cpuModel:null,cpuSpeed:null,memory:null,isWSL:null,isDocker:null,isTTY:null}}}async function cK(){if("cloudflare"===cI())return!1;try{return(await Function("mm","return import(mm)")("fs")).statSync("/.dockerenv"),!0}catch{return!1}}async function cL(){if("cloudflare"===cI())return!1;try{return(await Function("mm","return import(mm)")("fs")).readFileSync("/proc/self/cgroup","utf8").includes("docker")}catch{return!1}}async function cM(){return"cloudflare"!==cI()&&(void 0===d&&(d=await cK()||await cL()),d)}async function cN(){try{if("cloudflare"===cI()||"undefined"==typeof process||process?.platform!=="linux")return!1;let a=await Function("mm","return import(mm)")("fs");if((await Function("mm","return import(mm)")("os")).release().toLowerCase().includes("microsoft")){if(await cP())return!1;return!0}return!!a.readFileSync("/proc/version","utf8").toLowerCase().includes("microsoft")&&!await cP()}catch{return!1}}let cO=async()=>{if("cloudflare"===cI())return!1;try{return(await Function("mm","return import(mm)")("fs")).statSync("/run/.containerenv"),!0}catch{return!1}};async function cP(){return void 0===e&&(e=await cO()||await cM()),e}async function cQ(a){let b=await (0,cy.createHash)("SHA-256").digest(a);return aq.base64.encode(b)}let cR=null;async function cS(a){if(cR)return cR;let b=await cD();return b?cR=await cQ(a?a+b:b):a?cR=await cQ(a):cR=(0,cz.createRandomStringGenerator)("a-z","A-Z","0-9")(32)}async function cT(a,b){let c,d=a.telemetry?.debug||(0,cw.l)("BETTER_AUTH_TELEMETRY_DEBUG",!1),e=cv.s.BETTER_AUTH_TELEMETRY_ENDPOINT,f=async a=>{b?.customTrack?await b.customTrack(a).catch($.logger.error):d?$.logger.info("telemetry event",JSON.stringify(a,null,2)):await bm(e,{method:"POST",body:a}).catch($.logger.error)},g=async()=>{let c=a.telemetry?.enabled!==void 0&&a.telemetry.enabled;return((0,cw.l)("BETTER_AUTH_TELEMETRY",!1)||c)&&(b?.skipTestCheck||!(0,S.p)())},h=await g();h&&(c=await cS(a.baseURL),f({type:"init",payload:{config:{database:b?.database,adapter:b?.adapter,emailVerification:{sendVerificationEmail:!!a.emailVerification?.sendVerificationEmail,sendOnSignUp:!!a.emailVerification?.sendOnSignUp,sendOnSignIn:!!a.emailVerification?.sendOnSignIn,autoSignInAfterVerification:!!a.emailVerification?.autoSignInAfterVerification,expiresIn:a.emailVerification?.expiresIn,onEmailVerification:!!a.emailVerification?.onEmailVerification,afterEmailVerification:!!a.emailVerification?.afterEmailVerification},emailAndPassword:{enabled:!!a.emailAndPassword?.enabled,disableSignUp:!!a.emailAndPassword?.disableSignUp,requireEmailVerification:!!a.emailAndPassword?.requireEmailVerification,maxPasswordLength:a.emailAndPassword?.maxPasswordLength,minPasswordLength:a.emailAndPassword?.minPasswordLength,sendResetPassword:!!a.emailAndPassword?.sendResetPassword,resetPasswordTokenExpiresIn:a.emailAndPassword?.resetPasswordTokenExpiresIn,onPasswordReset:!!a.emailAndPassword?.onPasswordReset,password:{hash:!!a.emailAndPassword?.password?.hash,verify:!!a.emailAndPassword?.password?.verify},autoSignIn:!!a.emailAndPassword?.autoSignIn,revokeSessionsOnPasswordReset:!!a.emailAndPassword?.revokeSessionsOnPasswordReset},socialProviders:Object.keys(a.socialProviders||{}).map(b=>{let c=a.socialProviders?.[b];return c?{id:b,mapProfileToUser:!!c.mapProfileToUser,disableDefaultScope:!!c.disableDefaultScope,disableIdTokenSignIn:!!c.disableIdTokenSignIn,disableImplicitSignUp:c.disableImplicitSignUp,disableSignUp:c.disableSignUp,getUserInfo:!!c.getUserInfo,overrideUserInfoOnSignIn:!!c.overrideUserInfoOnSignIn,prompt:c.prompt,verifyIdToken:!!c.verifyIdToken,scope:c.scope,refreshAccessToken:!!c.refreshAccessToken}:{}}),plugins:a.plugins?.map(a=>a.id.toString()),user:{modelName:a.user?.modelName,fields:a.user?.fields,additionalFields:a.user?.additionalFields,changeEmail:{enabled:a.user?.changeEmail?.enabled,sendChangeEmailVerification:!!a.user?.changeEmail?.sendChangeEmailVerification}},verification:{modelName:a.verification?.modelName,disableCleanup:a.verification?.disableCleanup,fields:a.verification?.fields},session:{modelName:a.session?.modelName,additionalFields:a.session?.additionalFields,cookieCache:{enabled:a.session?.cookieCache?.enabled,maxAge:a.session?.cookieCache?.maxAge,strategy:a.session?.cookieCache?.strategy},disableSessionRefresh:a.session?.disableSessionRefresh,expiresIn:a.session?.expiresIn,fields:a.session?.fields,freshAge:a.session?.freshAge,preserveSessionInDatabase:a.session?.preserveSessionInDatabase,storeSessionInDatabase:a.session?.storeSessionInDatabase,updateAge:a.session?.updateAge},account:{modelName:a.account?.modelName,fields:a.account?.fields,encryptOAuthTokens:a.account?.encryptOAuthTokens,updateAccountOnSignIn:a.account?.updateAccountOnSignIn,accountLinking:{enabled:a.account?.accountLinking?.enabled,trustedProviders:a.account?.accountLinking?.trustedProviders,updateUserInfoOnLink:a.account?.accountLinking?.updateUserInfoOnLink,allowUnlinkingAll:a.account?.accountLinking?.allowUnlinkingAll}},hooks:{after:!!a.hooks?.after,before:!!a.hooks?.before},secondaryStorage:!!a.secondaryStorage,advanced:{cookiePrefix:!!a.advanced?.cookiePrefix,cookies:!!a.advanced?.cookies,crossSubDomainCookies:{domain:!!a.advanced?.crossSubDomainCookies?.domain,enabled:a.advanced?.crossSubDomainCookies?.enabled,additionalCookies:a.advanced?.crossSubDomainCookies?.additionalCookies},database:{useNumberId:!!a.advanced?.database?.useNumberId||a.advanced?.database?.generateId==="serial",generateId:a.advanced?.database?.generateId,defaultFindManyLimit:a.advanced?.database?.defaultFindManyLimit},useSecureCookies:a.advanced?.useSecureCookies,ipAddress:{disableIpTracking:a.advanced?.ipAddress?.disableIpTracking,ipAddressHeaders:a.advanced?.ipAddress?.ipAddressHeaders},disableCSRFCheck:a.advanced?.disableCSRFCheck,cookieAttributes:{expires:a.advanced?.defaultCookieAttributes?.expires,secure:a.advanced?.defaultCookieAttributes?.secure,sameSite:a.advanced?.defaultCookieAttributes?.sameSite,domain:!!a.advanced?.defaultCookieAttributes?.domain,path:a.advanced?.defaultCookieAttributes?.path,httpOnly:a.advanced?.defaultCookieAttributes?.httpOnly}},trustedOrigins:a.trustedOrigins?.length,rateLimit:{storage:a.rateLimit?.storage,modelName:a.rateLimit?.modelName,window:a.rateLimit?.window,customStorage:!!a.rateLimit?.customStorage,enabled:a.rateLimit?.enabled,max:a.rateLimit?.max},onAPIError:{errorURL:a.onAPIError?.errorURL,onError:!!a.onAPIError?.onError,throw:a.onAPIError?.throw},logger:{disabled:a.logger?.disabled,level:a.logger?.level,log:!!a.logger?.log},databaseHooks:{user:{create:{after:!!a.databaseHooks?.user?.create?.after,before:!!a.databaseHooks?.user?.create?.before},update:{after:!!a.databaseHooks?.user?.update?.after,before:!!a.databaseHooks?.user?.update?.before}},session:{create:{after:!!a.databaseHooks?.session?.create?.after,before:!!a.databaseHooks?.session?.create?.before},update:{after:!!a.databaseHooks?.session?.update?.after,before:!!a.databaseHooks?.session?.update?.before}},account:{create:{after:!!a.databaseHooks?.account?.create?.after,before:!!a.databaseHooks?.account?.create?.before},update:{after:!!a.databaseHooks?.account?.update?.after,before:!!a.databaseHooks?.account?.update?.before}},verification:{create:{after:!!a.databaseHooks?.verification?.create?.after,before:!!a.databaseHooks?.verification?.create?.before},update:{after:!!a.databaseHooks?.verification?.update?.after,before:!!a.databaseHooks?.verification?.update?.before}}}},runtime:"undefined"!=typeof Deno?{name:"deno",version:Deno?.version?.deno??null}:"undefined"!=typeof Bun?{name:"bun",version:Bun?.version??null}:"undefined"!=typeof process&&process?.versions?.node?{name:"node",version:process.versions.node??null}:{name:"edge",version:null},database:await cF(),framework:await cH(),environment:"production"===(0,cx.u)("NODE_ENV")?"production":"false"!==ao.c.CI&&("BUILD_ID"in ao.c||"BUILD_NUMBER"in ao.c||"CI"in ao.c||"CI_APP_ID"in ao.c||"CI_BUILD_ID"in ao.c||"CI_BUILD_NUMBER"in ao.c||"CI_NAME"in ao.c||"CONTINUOUS_INTEGRATION"in ao.c||"RUN_ID"in ao.c)?"ci":(0,S.p)()?"test":"development",systemInfo:await cJ(),packageManager:function(){let a=ao.c.npm_config_user_agent;if(!a)return;let b=a.split(" ")[0],c=b.lastIndexOf("/"),d=b.substring(0,c);return{name:"npminstall"===d?"cnpm":d,version:b.substring(c+1)}}()},anonymousId:c}));return{publish:async b=>{h&&(c||(c=await cS(a.baseURL)),await f({type:b.type,payload:b.payload,anonymousId:c}))}}}let cU="better-auth-secret-12345678901234567890";function cV(a){return!!a&&("object"==typeof a||"function"==typeof a)&&"function"==typeof a.then}async function cW(a){let b=a.options,c=b.plugins||[],d=a,e=[];for(let a of c)if(a.init){let c,f=a.init(d);if("object"==typeof(c=cV(f)?await f:f)){if(c.options){let{databaseHooks:a,...d}=c.options;a&&e.push(a),b=bQ(b,d)}c.context&&(d={...d,...c.context})}}return e.push(b.databaseHooks),d.internalAdapter=ae(d.adapter,{options:b,logger:d.logger,hooks:e.filter(a=>void 0!==a),generateId:d.generateId}),d.options=b,{context:d}}async function cX(a,b,c){var d,e;let f,g,h,i,j,k,l,m;b.database||(b=bQ(b,{session:{cookieCache:{enabled:!0,strategy:"jwe",refreshCache:!0}},account:{storeStateStrategy:"cookie",storeAccountCookie:!0}}));let n=b.plugins||[],o=(d=b,d.advanced?.crossSubDomainCookies?.enabled,[]),p=(0,Z.n)(b.logger),q=ak(b.baseURL,b.basePath),r=b.secret||ao.c.BETTER_AUTH_SECRET||ao.c.AUTH_SECRET||cU,s=r===cU;if(!(0,S.p)()){let a;if(s&&ap.f)throw new _.BetterAuthError("You are using the default secret. Please set `BETTER_AUTH_SECRET` in your environment variables or pass `secret` in your auth config.");if(!r)throw new _.BetterAuthError("BETTER_AUTH_SECRET is missing. Set it in your environment or pass `secret` to betterAuth({ secret }).");if(r.length<32)throw new _.BetterAuthError("Invalid BETTER_AUTH_SECRET: must be at least 32 characters long for adequate security. Generate one with `npx @better-auth/cli secret` or `openssl rand -base64 32`.");120>(0===(a=new Set(r).size)?0:Math.log2(Math.pow(a,r.length)))&&p.warn("[better-auth] Warning: your BETTER_AUTH_SECRET appears low-entropy. Use a randomly generated secret for production.")}!function(a,b){let c=new Map;a.plugins?.forEach(a=>{if(a.endpoints){for(let[b,d]of Object.entries(a.endpoints))if(d&&"path"in d){let e=d.path,f=[];d.options&&"method"in d.options&&(Array.isArray(d.options.method)?f=d.options.method:"string"==typeof d.options.method&&(f=[d.options.method])),0===f.length&&(f=["*"]),c.has(e)||c.set(e,[]),c.get(e).push({pluginId:a.id,endpointKey:b,methods:f})}}});let d=[];for(let[a,b]of c.entries())if(b.length>1){let c=new Map,e=!1;for(let a of b)for(let d of a.methods)c.has(d)||c.set(d,[]),c.get(d).push(a.pluginId),c.get(d).length>1&&(e=!0),"*"===d&&b.length>1?e=!0:"*"!==d&&c.has("*")&&(e=!0);if(e){let e=[...new Set(b.map(a=>a.pluginId))],f=[];for(let[a,d]of c.entries())(d.length>1||"*"===a&&b.length>1||"*"!==a&&c.has("*"))&&f.push(a);d.push({path:a,plugins:e,conflictingMethods:f})}}if(d.length>0){let a=d.map(a=>`  - "${a.path}" [${a.conflictingMethods.join(", ")}] used by plugins: ${a.plugins.join(", ")}`).join("\n");b.error(`Endpoint path conflicts detected! Multiple plugins are trying to use the same endpoint paths with conflicting HTTP methods:
${a}

To resolve this, you can:
	1. Use only one of the conflicting plugins
	2. Configure the plugins to use different paths (if supported)
	3. Ensure plugins use different HTTP methods for the same path
`)}}(b={...b,secret:r,baseURL:q?new URL(q).origin:"",basePath:b.basePath||"/api/auth",plugins:n.concat(o)},p);let t=(h=(g=aF(e=b))("session_token",{maxAge:e.session?.expiresIn||function(a){!1;let b=/^(?<value>-?\d*\.?\d+) *(?<unit>milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|months?|mo|years?|yrs?|y)?$/i.exec("7d");if(!b?.groups)return NaN;let{value:c,unit:d="ms"}=b.groups,e=parseFloat(c),f=d.toLowerCase();switch(f){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*e;case"months":case"month":case"mo":return 26298e5*e;case"weeks":case"week":case"w":return 6048e5*e;case"days":case"day":case"d":return 864e5*e;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*e;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*e;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e;default:throw Error(`Unknown unit "${f}" provided to ms.parse(). value=${JSON.stringify("7d")}`)}}("7d")/1e3}),i=g("session_data",{maxAge:e.session?.cookieCache?.maxAge||300}),j=g("account_data",{maxAge:e.session?.cookieCache?.maxAge||300}),k=g("dont_remember"),{sessionToken:{name:h.name,options:h.attributes},sessionData:{name:i.name,options:i.attributes},dontRememberToken:{name:k.name,options:k.attributes},accountData:{name:j.name,options:j.attributes}}),u=(0,G.a)(b),v=Object.entries(b.socialProviders||{}).map(([a,b])=>{if(null==b||!1===b.enabled)return null;b.clientId||p.warn(`Social provider ${a} is missing clientId or clientSecret`);let c=bL[a](b);return c.disableImplicitSignUp=b.disableImplicitSignUp,c}).filter(a=>null!==a),w=({model:a,size:c})=>"function"==typeof b.advanced?.generateId?b.advanced.generateId({model:a,size:c}):"function"==typeof b?.advanced?.database?.generateId?b.advanced.database.generateId({model:a,size:c}):(0,H.t)(c),{publish:x}=await cT(b,{adapter:a.id,database:"function"==typeof b.database?"adapter":c(b.database)}),y=cW({appName:b.appName||"Better Auth",socialProviders:v,options:b,oauthConfig:{storeStateStrategy:b.account?.storeStateStrategy||"database",skipStateCookieCheck:!!b.account?.skipStateCookieCheck},tables:u,trustedOrigins:function(a){let b=ak(a.baseURL,a.basePath);if(!b)return[];let c=[new URL(b).origin];a.trustedOrigins&&Array.isArray(a.trustedOrigins)&&c.push(...a.trustedOrigins);let d=ao.c.BETTER_AUTH_TRUSTED_ORIGINS;if(d&&c.push(...d.split(",")),c.filter(a=>!a).length)throw new _.BetterAuthError("A provided trusted origin is invalid, make sure your trusted origins list is properly defined.");return c}(b),baseURL:q||"",sessionConfig:{updateAge:b.session?.updateAge!==void 0?b.session.updateAge:86400,expiresIn:b.session?.expiresIn||604800,freshAge:b.session?.freshAge===void 0?86400:b.session.freshAge,cookieRefreshCache:(l=b.session?.cookieCache?.refreshCache,m=b.session?.cookieCache?.maxAge||300,!1!==l&&void 0!==l&&(!0===l?{enabled:!0,updateAge:Math.floor(.2*m)}:{enabled:!0,updateAge:void 0!==l.updateAge?l.updateAge:Math.floor(.2*m)}))},secret:r,rateLimit:{...b.rateLimit,enabled:b.rateLimit?.enabled??ap.f,window:b.rateLimit?.window||10,max:b.rateLimit?.max||100,storage:b.rateLimit?.storage||(b.secondaryStorage?"secondary-storage":"memory")},authCookies:t,logger:p,generateId:w,session:null,secondaryStorage:b.secondaryStorage,password:{hash:b.emailAndPassword?.password?.hash||ai.i,verify:b.emailAndPassword?.password?.verify||ai.a,config:{minPasswordLength:b.emailAndPassword?.minPasswordLength||8,maxPasswordLength:b.emailAndPassword?.maxPasswordLength||128},checkPassword:ct},setNewSession(a){this.newSession=a},newSession:null,adapter:a,internalAdapter:ae(a,{options:b,logger:p,hooks:b.databaseHooks?[b.databaseHooks]:[],generateId:w}),createAuthCookie:aF(b),async runMigrations(){throw new _.BetterAuthError("runMigrations will be set by the specific init implementation")},publishTelemetry:x,skipCSRFCheck:!!b.advanced?.disableCSRFCheck,skipOriginCheck:b.advanced?.disableOriginCheck!==void 0?b.advanced.disableOriginCheck:!!(0,S.p)()});return cV(y)?{context:f}=await y:{context:f}=y,f}let cY=async a=>{let b=await ad(a),c=await cX(b,a,a=>(0,F.n)(a)||"unknown");return c.runMigrations=async function(){if(!a.database||"updateMany"in a.database)throw new _.BetterAuthError("Database is not provided or it's an adapter. Migrations are only supported with a database instance.");let{runMigrations:b}=await ah(a);await b()},c};var W=W;let cZ=T.object({id:T.string(),createdAt:T.date().default(()=>new Date),updatedAt:T.date().default(()=>new Date)});cZ.extend({providerId:T.string(),accountId:T.string(),userId:ab.coerce.string(),accessToken:T.string().nullish(),refreshToken:T.string().nullish(),idToken:T.string().nullish(),accessTokenExpiresAt:T.date().nullish(),refreshTokenExpiresAt:T.date().nullish(),scope:T.string().nullish(),password:T.string().nullish()}),T.object({key:T.string(),count:T.number(),lastRequest:T.number()}),cZ.extend({userId:ab.coerce.string(),expiresAt:T.date(),token:T.string(),ipAddress:T.string().nullish(),userAgent:T.string().nullish()}),cZ.extend({email:T.string().transform(a=>a.toLowerCase()),emailVerified:T.boolean().default(!1),name:T.string(),image:T.string().nullish()}),cZ.extend({value:T.string(),expiresAt:T.date(),identifier:T.string()});var c$=a.i(25536);let c_=Symbol.for("drizzle:entityKind");function c0(a,b){if(!a||"object"!=typeof a)return!1;if(a instanceof b)return!0;if(!Object.prototype.hasOwnProperty.call(b,c_))throw Error(`Class "${b.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let c=Object.getPrototypeOf(a).constructor;if(c)for(;c;){if(c_ in c&&c[c_]===b[c_])return!0;c=Object.getPrototypeOf(c)}return!1}Symbol.for("drizzle:hasOwnEntityKind");class c1{constructor(a,b){this.table=a,this.config=b,this.name=b.name,this.keyAsName=b.keyAsName,this.notNull=b.notNull,this.default=b.default,this.defaultFn=b.defaultFn,this.onUpdateFn=b.onUpdateFn,this.hasDefault=b.hasDefault,this.primary=b.primaryKey,this.isUnique=b.isUnique,this.uniqueName=b.uniqueName,this.uniqueType=b.uniqueType,this.dataType=b.dataType,this.columnType=b.columnType,this.generated=b.generated,this.generatedIdentity=b.generatedIdentity}static [c_]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(a){return a}mapToDriverValue(a){return a}shouldDisableInsert(){return void 0!==this.config.generated&&"byDefault"!==this.config.generated.type}}let c2=Symbol.for("drizzle:Name"),c3=Symbol.for("drizzle:Schema"),c4=Symbol.for("drizzle:Columns"),c5=Symbol.for("drizzle:ExtraConfigColumns"),c6=Symbol.for("drizzle:OriginalName"),c7=Symbol.for("drizzle:BaseName"),c8=Symbol.for("drizzle:IsAlias"),c9=Symbol.for("drizzle:ExtraConfigBuilder"),da=Symbol.for("drizzle:IsDrizzleTable");class db{static [c_]="Table";static Symbol={Name:c2,Schema:c3,OriginalName:c6,Columns:c4,ExtraConfigColumns:c5,BaseName:c7,IsAlias:c8,ExtraConfigBuilder:c9};[c2];[c6];[c3];[c4];[c5];[c7];[c8]=!1;[da]=!0;[c9]=void 0;constructor(a,b,c){this[c2]=this[c6]=a,this[c3]=b,this[c7]=c}}function dc(a){return`${a[c3]??"public"}.${a[c2]}`}class dd{static [c_]="ColumnBuilder";config;constructor(a,b,c){this.config={name:a,keyAsName:""===a,notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType:b,columnType:c,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(a){return this.config.default=a,this.config.hasDefault=!0,this}$defaultFn(a){return this.config.defaultFn=a,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(a){return this.config.onUpdateFn=a,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(a){""===this.config.name&&(this.config.name=a)}}class de{static [c_]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(a,b){this.reference=()=>{let{name:b,columns:c,foreignColumns:d}=a();return{name:b,columns:c,foreignTable:d[0].table,foreignColumns:d}},b&&(this._onUpdate=b.onUpdate,this._onDelete=b.onDelete)}onUpdate(a){return this._onUpdate=void 0===a?"no action":a,this}onDelete(a){return this._onDelete=void 0===a?"no action":a,this}build(a){return new df(a,this)}}class df{constructor(a,b){this.table=a,this.reference=b.reference,this.onUpdate=b._onUpdate,this.onDelete=b._onDelete}static [c_]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name:a,columns:b,foreignColumns:c}=this.reference(),d=b.map(a=>a.name),e=c.map(a=>a.name),f=[this.table[c2],...d,c[0].table[c2],...e];return a??`${f.join("_")}_fk`}}function dg(a,...b){return a(...b)}function dh(a,b){return`${a[c2]}_${b.join("_")}_unique`}class di{constructor(a,b){this.name=b,this.columns=a}static [c_]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(a){return new dk(a,this.columns,this.nullsNotDistinctConfig,this.name)}}class dj{static [c_]="PgUniqueOnConstraintBuilder";name;constructor(a){this.name=a}on(...a){return new di(a,this.name)}}class dk{constructor(a,b,c,d){this.table=a,this.columns=b,this.name=d??dh(this.table,this.columns.map(a=>a.name)),this.nullsNotDistinct=c}static [c_]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}}function dl(a,b,c){for(let d=b;d<a.length;d++){let e=a[d];if("\\"===e){d++;continue}if('"'===e)return[a.slice(b,d).replace(/\\/g,""),d+1];if(!c&&(","===e||"}"===e))return[a.slice(b,d).replace(/\\/g,""),d]}return[a.slice(b).replace(/\\/g,""),a.length]}class dm extends dd{foreignKeyConfigs=[];static [c_]="PgColumnBuilder";array(a){return new dr(this.config.name,this,a)}references(a,b={}){return this.foreignKeyConfigs.push({ref:a,actions:b}),this}unique(a,b){return this.config.isUnique=!0,this.config.uniqueName=a,this.config.uniqueType=b?.nulls,this}generatedAlwaysAs(a){return this.config.generated={as:a,type:"always",mode:"stored"},this}buildForeignKeys(a,b){return this.foreignKeyConfigs.map(({ref:c,actions:d})=>dg((c,d)=>{let e=new de(()=>({columns:[a],foreignColumns:[c()]}));return d.onUpdate&&e.onUpdate(d.onUpdate),d.onDelete&&e.onDelete(d.onDelete),e.build(b)},c,d))}buildExtraConfigColumn(a){return new dp(a,this.config)}}class dn extends c1{constructor(a,b){b.uniqueName||(b.uniqueName=dh(a,[b.name])),super(a,b),this.table=a}static [c_]="PgColumn"}class dp extends dn{static [c_]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(a){return this.indexConfig.opClass=a,this}}class dq{static [c_]="IndexedColumn";constructor(a,b,c,d){this.name=a,this.keyAsName=b,this.type=c,this.indexConfig=d}name;keyAsName;type;indexConfig}class dr extends dm{static [c_]="PgArrayBuilder";constructor(a,b,c){super(a,"array","PgArray"),this.config.baseBuilder=b,this.config.size=c}build(a){let b=this.config.baseBuilder.build(a);return new ds(a,this.config,b)}}class ds extends dn{constructor(a,b,c,d){super(a,b),this.baseColumn=c,this.range=d,this.size=b.size}size;static [c_]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${"number"==typeof this.size?this.size:""}]`}mapFromDriverValue(a){return"string"==typeof a&&(a=function(a){let[b]=function a(b,c=0){let d=[],e=c,f=!1;for(;e<b.length;){let g=b[e];if(","===g){(f||e===c)&&d.push(""),f=!0,e++;continue}if(f=!1,"\\"===g){e+=2;continue}if('"'===g){let[a,c]=dl(b,e+1,!0);d.push(a),e=c;continue}if("}"===g)return[d,e+1];if("{"===g){let[c,f]=a(b,e+1);d.push(c),e=f;continue}let[h,i]=dl(b,e,!1);d.push(h),e=i}return[d,e]}(a,1);return b}(a)),a.map(a=>this.baseColumn.mapFromDriverValue(a))}mapToDriverValue(a,b=!1){let c=a.map(a=>null===a?null:c0(this.baseColumn,ds)?this.baseColumn.mapToDriverValue(a,!0):this.baseColumn.mapToDriverValue(a));return b?c:function a(b){return`{${b.map(b=>Array.isArray(b)?a(b):"string"==typeof b?`"${b.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`:`${b}`).join(",")}}`}(c)}}class dt extends dm{static [c_]="PgEnumObjectColumnBuilder";constructor(a,b){super(a,"string","PgEnumObjectColumn"),this.config.enum=b}build(a){return new du(a,this.config)}}class du extends dn{static [c_]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(a,b){super(a,b),this.enum=b.enum}getSQLType(){return this.enum.enumName}}let dv=Symbol.for("drizzle:isPgEnum");class dw extends dm{static [c_]="PgEnumColumnBuilder";constructor(a,b){super(a,"string","PgEnumColumn"),this.config.enum=b}build(a){return new dx(a,this.config)}}class dx extends dn{static [c_]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(a,b){super(a,b),this.enum=b.enum}getSQLType(){return this.enum.enumName}}class dy{static [c_]="Subquery";constructor(a,b,c,d=!1,e=[]){this._={brand:"Subquery",sql:a,selectedFields:b,alias:c,isWith:d,usedTables:e}}}class dz extends dy{static [c_]="WithSubquery"}let dA=(a,b)=>f?(g||(g=f.trace.getTracer("drizzle-orm","0.44.7")),dg((c,d)=>d.startActiveSpan(a,a=>{try{return b(a)}catch(b){throw a.setStatus({code:c.SpanStatusCode.ERROR,message:b instanceof Error?b.message:"Unknown error"}),b}finally{a.end()}}),f,g)):b(),dB=Symbol.for("drizzle:ViewBaseConfig");class dC{static [c_]="FakePrimitiveParam"}function dD(a){return null!=a&&"function"==typeof a.getSQL}class dE{static [c_]="StringChunk";value;constructor(a){this.value=Array.isArray(a)?a:[a]}getSQL(){return new dF([this])}}class dF{constructor(a){for(const b of(this.queryChunks=a,a))if(c0(b,db)){const a=b[db.Symbol.Schema];this.usedTables.push(void 0===a?b[db.Symbol.Name]:a+"."+b[db.Symbol.Name])}}static [c_]="SQL";decoder=dH;shouldInlineParams=!1;usedTables=[];append(a){return this.queryChunks.push(...a.queryChunks),this}toQuery(a){return dA("drizzle.buildSQL",b=>{let c=this.buildQueryFromSourceParams(this.queryChunks,a);return b?.setAttributes({"drizzle.query.text":c.sql,"drizzle.query.params":JSON.stringify(c.params)}),c})}buildQueryFromSourceParams(a,b){let c=Object.assign({},b,{inlineParams:b.inlineParams||this.shouldInlineParams,paramStartIndex:b.paramStartIndex||{value:0}}),{casing:d,escapeName:e,escapeParam:f,prepareTyping:g,inlineParams:h,paramStartIndex:i}=c;var j=a.map(a=>{if(c0(a,dE))return{sql:a.value.join(""),params:[]};if(c0(a,dG))return{sql:e(a.value),params:[]};if(void 0===a)return{sql:"",params:[]};if(Array.isArray(a)){let b=[new dE("(")];for(let[c,d]of a.entries())b.push(d),c<a.length-1&&b.push(new dE(", "));return b.push(new dE(")")),this.buildQueryFromSourceParams(b,c)}if(c0(a,dF))return this.buildQueryFromSourceParams(a.queryChunks,{...c,inlineParams:h||a.shouldInlineParams});if(c0(a,db)){let b=a[db.Symbol.Schema],c=a[db.Symbol.Name];return{sql:void 0===b||a[c8]?e(c):e(b)+"."+e(c),params:[]}}if(c0(a,c1)){let c=d.getColumnCasing(a);if("indexes"===b.invokeSource)return{sql:e(c),params:[]};let f=a.table[db.Symbol.Schema];return{sql:a.table[c8]||void 0===f?e(a.table[db.Symbol.Name])+"."+e(c):e(f)+"."+e(a.table[db.Symbol.Name])+"."+e(c),params:[]}}if(c0(a,dQ)){let b=a[dB].schema,c=a[dB].name;return{sql:void 0===b||a[dB].isAlias?e(c):e(b)+"."+e(c),params:[]}}if(c0(a,dJ)){if(c0(a.value,dN))return{sql:f(i.value++,a),params:[a],typings:["none"]};let b=null===a.value?null:a.encoder.mapToDriverValue(a.value);if(c0(b,dF))return this.buildQueryFromSourceParams([b],c);if(h)return{sql:this.mapInlineParam(b,c),params:[]};let d=["none"];return g&&(d=[g(a.encoder)]),{sql:f(i.value++,b),params:[b],typings:d}}return c0(a,dN)?{sql:f(i.value++,a),params:[a],typings:["none"]}:c0(a,dF.Aliased)&&void 0!==a.fieldAlias?{sql:e(a.fieldAlias),params:[]}:c0(a,dy)?a._.isWith?{sql:e(a._.alias),params:[]}:this.buildQueryFromSourceParams([new dE("("),a._.sql,new dE(") "),new dG(a._.alias)],c):a&&"function"==typeof a&&dv in a&&!0===a[dv]?a.schema?{sql:e(a.schema)+"."+e(a.enumName),params:[]}:{sql:e(a.enumName),params:[]}:dD(a)?a.shouldOmitSQLParens?.()?this.buildQueryFromSourceParams([a.getSQL()],c):this.buildQueryFromSourceParams([new dE("("),a.getSQL(),new dE(")")],c):h?{sql:this.mapInlineParam(a,c),params:[]}:{sql:f(i.value++,a),params:[a],typings:["none"]}});let k={sql:"",params:[]};for(let a of j)k.sql+=a.sql,k.params.push(...a.params),a.typings?.length&&(k.typings||(k.typings=[]),k.typings.push(...a.typings));return k}mapInlineParam(a,{escapeString:b}){if(null===a)return"null";if("number"==typeof a||"boolean"==typeof a)return a.toString();if("string"==typeof a)return b(a);if("object"==typeof a){let c=a.toString();return"[object Object]"===c?b(JSON.stringify(a)):b(c)}throw Error("Unexpected param value: "+a)}getSQL(){return this}as(a){return void 0===a?this:new dF.Aliased(this,a)}mapWith(a){return this.decoder="function"==typeof a?{mapFromDriverValue:a}:a,this}inlineParams(){return this.shouldInlineParams=!0,this}if(a){return a?this:void 0}}class dG{constructor(a){this.value=a}static [c_]="Name";brand;getSQL(){return new dF([this])}}let dH={mapFromDriverValue:a=>a},dI={mapToDriverValue:a=>a};({...dH,...dI});class dJ{constructor(a,b=dI){this.value=a,this.encoder=b}static [c_]="Param";brand;getSQL(){return new dF([this])}}function dK(a,...b){let c=[];for(let[d,e]of((b.length>0||a.length>0&&""!==a[0])&&c.push(new dE(a[0])),b.entries()))c.push(e,new dE(a[d+1]));return new dF(c)}(ed=dK||(dK={})).empty=function(){return new dF([])},ed.fromList=function(a){return new dF(a)},ed.raw=function(a){return new dF([new dE(a)])},ed.join=function(a,b){let c=[];for(let[d,e]of a.entries())d>0&&void 0!==b&&c.push(b),c.push(e);return new dF(c)},ed.identifier=function(a){return new dG(a)},ed.placeholder=function(a){return new dN(a)},ed.param=function(a,b){return new dJ(a,b)};var dL=dF||(dF={});class dM{constructor(a,b){this.sql=a,this.fieldAlias=b}static [c_]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new dM(this.sql,this.fieldAlias)}}dL.Aliased=dM;class dN{constructor(a){this.name=a}static [c_]="Placeholder";getSQL(){return new dF([this])}}function dO(a,b){return a.map(a=>{if(c0(a,dN)){if(!(a.name in b))throw Error(`No value for placeholder "${a.name}" was provided`);return b[a.name]}if(c0(a,dJ)&&c0(a.value,dN)){if(!(a.value.name in b))throw Error(`No value for placeholder "${a.value.name}" was provided`);return a.encoder.mapToDriverValue(b[a.value.name])}return a})}let dP=Symbol.for("drizzle:IsDrizzleView");class dQ{static [c_]="View";[dB];[dP]=!0;constructor({name:a,schema:b,selectedFields:c,query:d}){this[dB]={name:a,originalName:a,schema:b,selectedFields:c,query:d,isExisting:!d,isAlias:!1}}getSQL(){return new dF([this])}}function dR(a,b){return"object"!=typeof b||null===b||!("mapToDriverValue"in b)||"function"!=typeof b.mapToDriverValue||dD(a)||c0(a,dJ)||c0(a,dN)||c0(a,c1)||c0(a,db)||c0(a,dQ)?a:new dJ(a,b)}c1.prototype.getSQL=function(){return new dF([this])},db.prototype.getSQL=function(){return new dF([this])},dy.prototype.getSQL=function(){return new dF([this])};let dS=(a,b)=>dK`${a} = ${dR(b,a)}`,dT=(a,b)=>dK`${a} <> ${dR(b,a)}`;function dU(...a){let b=a.filter(a=>void 0!==a);if(0!==b.length)return new dF(1===b.length?b:[new dE("("),dK.join(b,new dE(" and ")),new dE(")")])}function dV(...a){let b=a.filter(a=>void 0!==a);if(0!==b.length)return new dF(1===b.length?b:[new dE("("),dK.join(b,new dE(" or ")),new dE(")")])}function dW(a){return dK`not ${a}`}let dX=(a,b)=>dK`${a} > ${dR(b,a)}`,dY=(a,b)=>dK`${a} >= ${dR(b,a)}`,dZ=(a,b)=>dK`${a} < ${dR(b,a)}`,d$=(a,b)=>dK`${a} <= ${dR(b,a)}`;function d_(a,b){return Array.isArray(b)?0===b.length?dK`false`:dK`${a} in ${b.map(b=>dR(b,a))}`:dK`${a} in ${dR(b,a)}`}function d0(a,b){return Array.isArray(b)?0===b.length?dK`true`:dK`${a} not in ${b.map(b=>dR(b,a))}`:dK`${a} not in ${dR(b,a)}`}function d1(a){return dK`${a} is null`}function d2(a){return dK`${a} is not null`}function d3(a){return dK`exists ${a}`}function d4(a){return dK`not exists ${a}`}function d5(a,b,c){return dK`${a} between ${dR(b,a)} and ${dR(c,a)}`}function d6(a,b,c){return dK`${a} not between ${dR(b,a)} and ${dR(c,a)}`}function d7(a,b){return dK`${a} like ${b}`}function d8(a,b){return dK`${a} not like ${b}`}function d9(a,b){return dK`${a} ilike ${b}`}function ea(a,b){return dK`${a} not ilike ${b}`}function eb(a){return dK`${a} asc`}function ec(a){return dK`${a} desc`}var ed,ee,ef,eg,eh,ei=Object.create,ej=Object.defineProperty,ek=Object.getOwnPropertyDescriptor,el=Object.getOwnPropertyNames,em=Object.getPrototypeOf,en=Object.prototype.hasOwnProperty,eo=(a,b)=>ej(a,"name",{value:b,configurable:!0}),ep=(a,b)=>()=>(a&&(b=a(a=0)),b),eq=(a,b)=>()=>(b||a((b={exports:{}}).exports,b),b.exports),er=(a,b)=>{for(var c in b)ej(a,c,{get:b[c],enumerable:!0})},es=(a,b,c,d)=>{if(b&&"object"==typeof b||"function"==typeof b)for(let e of el(b))en.call(a,e)||e===c||ej(a,e,{get:()=>b[e],enumerable:!(d=ek(b,e))||d.enumerable});return a},et=(a,b,c)=>(c=null!=a?ei(em(a)):{},es(!b&&a&&a.__esModule?c:ej(c,"default",{value:a,enumerable:!0}),a)),eu=a=>es(ej({},"__esModule",{value:!0}),a),ev=(a,b,c)=>{let d;return(d="symbol"!=typeof b?b+"":b)in a?ej(a,d,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[d]=c},ew=eq(a=>{ez(),a.byteLength=i,a.toByteArray=k,a.fromByteArray=n;var b,c,d=[],e=[],f="u">typeof Uint8Array?Uint8Array:Array,g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(b=0,c=g.length;b<c;++b)d[b]=g[b],e[g.charCodeAt(b)]=b;function h(a){var b=a.length;if(b%4>0)throw Error("Invalid string. Length must be a multiple of 4");var c=a.indexOf("=");-1===c&&(c=b);var d=c===b?0:4-c%4;return[c,d]}function i(a){var b=h(a),c=b[0],d=b[1];return(c+d)*3/4-d}function j(a,b,c){return(b+c)*3/4-c}function k(a){var b,c,d=h(a),g=d[0],i=d[1],k=new f(j(a,g,i)),l=0,m=i>0?g-4:g;for(c=0;c<m;c+=4)b=e[a.charCodeAt(c)]<<18|e[a.charCodeAt(c+1)]<<12|e[a.charCodeAt(c+2)]<<6|e[a.charCodeAt(c+3)],k[l++]=b>>16&255,k[l++]=b>>8&255,k[l++]=255&b;return 2===i&&(b=e[a.charCodeAt(c)]<<2|e[a.charCodeAt(c+1)]>>4,k[l++]=255&b),1===i&&(b=e[a.charCodeAt(c)]<<10|e[a.charCodeAt(c+1)]<<4|e[a.charCodeAt(c+2)]>>2,k[l++]=b>>8&255,k[l++]=255&b),k}function l(a){return d[a>>18&63]+d[a>>12&63]+d[a>>6&63]+d[63&a]}function m(a,b,c){for(var d=[],e=b;e<c;e+=3)d.push(l((a[e]<<16&0xff0000)+(a[e+1]<<8&65280)+(255&a[e+2])));return d.join("")}function n(a){for(var b,c=a.length,e=c%3,f=[],g=0,h=c-e;g<h;g+=16383)f.push(m(a,g,g+16383>h?h:g+16383));return 1===e?f.push(d[(b=a[c-1])>>2]+d[b<<4&63]+"=="):2===e&&f.push(d[(b=(a[c-2]<<8)+a[c-1])>>10]+d[b>>4&63]+d[b<<2&63]+"="),f.join("")}e[45]=62,e[95]=63,eo(h,"getLens"),eo(i,"byteLength"),eo(j,"_byteLength"),eo(k,"toByteArray"),eo(l,"tripletToBase64"),eo(m,"encodeChunk"),eo(n,"fromByteArray")}),ex=eq(a=>{ez(),a.read=function(a,b,c,d,e){var f,g,h=8*e-d-1,i=(1<<h)-1,j=i>>1,k=-7,l=c?e-1:0,m=c?-1:1,n=a[b+l];for(l+=m,f=n&(1<<-k)-1,n>>=-k,k+=h;k>0;f=256*f+a[b+l],l+=m,k-=8);for(g=f&(1<<-k)-1,f>>=-k,k+=d;k>0;g=256*g+a[b+l],l+=m,k-=8);if(0===f)f=1-j;else{if(f===i)return g?NaN:1/0*(n?-1:1);g+=Math.pow(2,d),f-=j}return(n?-1:1)*g*Math.pow(2,f-d)},a.write=function(a,b,c,d,e,f){var g,h,i,j=8*f-e-1,k=(1<<j)-1,l=k>>1,m=5960464477539062e-23*(23===e),n=d?0:f-1,o=d?1:-1,p=+(b<0||0===b&&1/b<0);for(isNaN(b=Math.abs(b))||b===1/0?(h=+!!isNaN(b),g=k):(g=Math.floor(Math.log(b)/Math.LN2),b*(i=Math.pow(2,-g))<1&&(g--,i*=2),g+l>=1?b+=m/i:b+=m*Math.pow(2,1-l),b*i>=2&&(g++,i/=2),g+l>=k?(h=0,g=k):g+l>=1?(h=(b*i-1)*Math.pow(2,e),g+=l):(h=b*Math.pow(2,l-1)*Math.pow(2,e),g=0));e>=8;a[c+n]=255&h,n+=o,h/=256,e-=8);for(g=g<<e|h,j+=e;j>0;a[c+n]=255&g,n+=o,g/=256,j-=8);a[c+n-o]|=128*p}}),ey=eq(a=>{ez();var b=ew(),c=ex(),d="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function e(){try{let a=new Uint8Array(1),b={foo:eo(function(){return 42},"foo")};return Object.setPrototypeOf(b,Uint8Array.prototype),Object.setPrototypeOf(a,b),42===a.foo()}catch{return!1}}function f(a){if(a>0x7fffffff)throw RangeError('The value "'+a+'" is invalid for option "size"');let b=new Uint8Array(a);return Object.setPrototypeOf(b,g.prototype),b}function g(a,b,c){if("number"==typeof a){if("string"==typeof b)throw TypeError('The "string" argument must be of type string. Received type number');return k(a)}return h(a,b,c)}function h(a,b,c){if("string"==typeof a)return l(a,b);if(ArrayBuffer.isView(a))return n(a);if(null==a)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof a);if(ac(a,ArrayBuffer)||a&&ac(a.buffer,ArrayBuffer)||"u">typeof SharedArrayBuffer&&(ac(a,SharedArrayBuffer)||a&&ac(a.buffer,SharedArrayBuffer)))return o(a,b,c);if("number"==typeof a)throw TypeError('The "value" argument must not be of type number. Received type number');let d=a.valueOf&&a.valueOf();if(null!=d&&d!==a)return g.from(d,b,c);let e=p(a);if(e)return e;if("u">typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof a[Symbol.toPrimitive])return g.from(a[Symbol.toPrimitive]("string"),b,c);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof a)}function i(a){if("number"!=typeof a)throw TypeError('"size" argument must be of type number');if(a<0)throw RangeError('The value "'+a+'" is invalid for option "size"')}function j(a,b,c){return i(a),a<=0?f(a):void 0!==b?"string"==typeof c?f(a).fill(b,c):f(a).fill(b):f(a)}function k(a){return i(a),f(a<0?0:0|q(a))}function l(a,b){if(("string"!=typeof b||""===b)&&(b="utf8"),!g.isEncoding(b))throw TypeError("Unknown encoding: "+b);let c=0|s(a,b),d=f(c),e=d.write(a,b);return e!==c&&(d=d.slice(0,e)),d}function m(a){let b=a.length<0?0:0|q(a.length),c=f(b);for(let d=0;d<b;d+=1)c[d]=255&a[d];return c}function n(a){if(ac(a,Uint8Array)){let b=new Uint8Array(a);return o(b.buffer,b.byteOffset,b.byteLength)}return m(a)}function o(a,b,c){let d;if(b<0||a.byteLength<b)throw RangeError('"offset" is outside of buffer bounds');if(a.byteLength<b+(c||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(d=void 0===b&&void 0===c?new Uint8Array(a):void 0===c?new Uint8Array(a,b):new Uint8Array(a,b,c),g.prototype),d}function p(a){if(g.isBuffer(a)){let b=0|q(a.length),c=f(b);return 0===c.length||a.copy(c,0,0,b),c}return void 0!==a.length?"number"!=typeof a.length||ad(a.length)?f(0):m(a):"Buffer"===a.type&&Array.isArray(a.data)?m(a.data):void 0}function q(a){if(a>=0x7fffffff)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|a}function r(a){return+a!=a&&(a=0),g.alloc(+a)}function s(a,b){if(g.isBuffer(a))return a.length;if(ArrayBuffer.isView(a)||ac(a,ArrayBuffer))return a.byteLength;if("string"!=typeof a)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof a);let c=a.length,d=arguments.length>2&&!0===arguments[2];if(!d&&0===c)return 0;let e=!1;for(;;)switch(b){case"ascii":case"latin1":case"binary":return c;case"utf8":case"utf-8":return Z(a).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*c;case"hex":return c>>>1;case"base64":return aa(a).length;default:if(e)return d?-1:Z(a).length;b=(""+b).toLowerCase(),e=!0}}function t(a,b,c){let d=!1;if((void 0===b||b<0)&&(b=0),b>this.length||((void 0===c||c>this.length)&&(c=this.length),c<=0)||(c>>>=0)<=(b>>>=0))return"";for(a||(a="utf8");;)switch(a){case"hex":return H(this,b,c);case"utf8":case"utf-8":return D(this,b,c);case"ascii":return F(this,b,c);case"latin1":case"binary":return G(this,b,c);case"base64":return C(this,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return I(this,b,c);default:if(d)throw TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),d=!0}}function u(a,b,c){let d=a[b];a[b]=a[c],a[c]=d}function v(a,b,c,d,e){if(0===a.length)return -1;if("string"==typeof c?(d=c,c=0):c>0x7fffffff?c=0x7fffffff:c<-0x80000000&&(c=-0x80000000),ad(c*=1)&&(c=e?0:a.length-1),c<0&&(c=a.length+c),c>=a.length){if(e)return -1;c=a.length-1}else if(c<0)if(!e)return -1;else c=0;if("string"==typeof b&&(b=g.from(b,d)),g.isBuffer(b))return 0===b.length?-1:w(a,b,c,d,e);if("number"==typeof b)return b&=255,"function"==typeof Uint8Array.prototype.indexOf?e?Uint8Array.prototype.indexOf.call(a,b,c):Uint8Array.prototype.lastIndexOf.call(a,b,c):w(a,[b],c,d,e);throw TypeError("val must be string, number or Buffer")}function w(a,b,c,d,e){let f,g=1,h=a.length,i=b.length;if(void 0!==d&&("ucs2"===(d=String(d).toLowerCase())||"ucs-2"===d||"utf16le"===d||"utf-16le"===d)){if(a.length<2||b.length<2)return -1;g=2,h/=2,i/=2,c/=2}function j(a,b){return 1===g?a[b]:a.readUInt16BE(b*g)}if(eo(j,"read"),e){let d=-1;for(f=c;f<h;f++)if(j(a,f)===j(b,-1===d?0:f-d)){if(-1===d&&(d=f),f-d+1===i)return d*g}else -1!==d&&(f-=f-d),d=-1}else for(c+i>h&&(c=h-i),f=c;f>=0;f--){let c=!0;for(let d=0;d<i;d++)if(j(a,f+d)!==j(b,d)){c=!1;break}if(c)return f}return -1}function x(a,b,c,d){let e;c=Number(c)||0;let f=a.length-c;d?(d=Number(d))>f&&(d=f):d=f;let g=b.length;for(d>g/2&&(d=g/2),e=0;e<d;++e){let d=parseInt(b.substr(2*e,2),16);if(ad(d))break;a[c+e]=d}return e}function y(a,b,c,d){return ab(Z(b,a.length-c),a,c,d)}function z(a,b,c,d){return ab($(b),a,c,d)}function A(a,b,c,d){return ab(aa(b),a,c,d)}function B(a,b,c,d){return ab(_(b,a.length-c),a,c,d)}function C(a,c,d){return 0===c&&d===a.length?b.fromByteArray(a):b.fromByteArray(a.slice(c,d))}function D(a,b,c){c=Math.min(a.length,c);let d=[],e=b;for(;e<c;){let b=a[e],f=null,g=b>239?4:b>223?3:b>191?2:1;if(e+g<=c){let c,d,h,i;switch(g){case 1:b<128&&(f=b);break;case 2:(192&(c=a[e+1]))==128&&(i=(31&b)<<6|63&c)>127&&(f=i);break;case 3:c=a[e+1],d=a[e+2],(192&c)==128&&(192&d)==128&&(i=(15&b)<<12|(63&c)<<6|63&d)>2047&&(i<55296||i>57343)&&(f=i);break;case 4:c=a[e+1],d=a[e+2],h=a[e+3],(192&c)==128&&(192&d)==128&&(192&h)==128&&(i=(15&b)<<18|(63&c)<<12|(63&d)<<6|63&h)>65535&&i<1114112&&(f=i)}}null===f?(f=65533,g=1):f>65535&&(f-=65536,d.push(f>>>10&1023|55296),f=56320|1023&f),d.push(f),e+=g}return E(d)}function E(a){let b=a.length;if(b<=4096)return String.fromCharCode.apply(String,a);let c="",d=0;for(;d<b;)c+=String.fromCharCode.apply(String,a.slice(d,d+=4096));return c}function F(a,b,c){let d="";c=Math.min(a.length,c);for(let e=b;e<c;++e)d+=String.fromCharCode(127&a[e]);return d}function G(a,b,c){let d="";c=Math.min(a.length,c);for(let e=b;e<c;++e)d+=String.fromCharCode(a[e]);return d}function H(a,b,c){let d=a.length;(!b||b<0)&&(b=0),(!c||c<0||c>d)&&(c=d);let e="";for(let d=b;d<c;++d)e+=ae[a[d]];return e}function I(a,b,c){let d=a.slice(b,c),e="";for(let a=0;a<d.length-1;a+=2)e+=String.fromCharCode(d[a]+256*d[a+1]);return e}function J(a,b,c){if(a%1!=0||a<0)throw RangeError("offset is not uint");if(a+b>c)throw RangeError("Trying to access beyond buffer length")}function K(a,b,c,d,e,f){if(!g.isBuffer(a))throw TypeError('"buffer" argument must be a Buffer instance');if(b>e||b<f)throw RangeError('"value" argument is out of bounds');if(c+d>a.length)throw RangeError("Index out of range")}function L(a,b,c,d,e){U(b,d,e,a,c,7);let f=Number(b&BigInt(0xffffffff));a[c++]=f,f>>=8,a[c++]=f,f>>=8,a[c++]=f,f>>=8,a[c++]=f;let g=Number(b>>BigInt(32)&BigInt(0xffffffff));return a[c++]=g,g>>=8,a[c++]=g,g>>=8,a[c++]=g,g>>=8,a[c++]=g,c}function M(a,b,c,d,e){U(b,d,e,a,c,7);let f=Number(b&BigInt(0xffffffff));a[c+7]=f,f>>=8,a[c+6]=f,f>>=8,a[c+5]=f,f>>=8,a[c+4]=f;let g=Number(b>>BigInt(32)&BigInt(0xffffffff));return a[c+3]=g,g>>=8,a[c+2]=g,g>>=8,a[c+1]=g,g>>=8,a[c]=g,c+8}function N(a,b,c,d,e,f){if(c+d>a.length||c<0)throw RangeError("Index out of range")}function O(a,b,d,e,f){return b*=1,d>>>=0,f||N(a,b,d,4,34028234663852886e22,-34028234663852886e22),c.write(a,b,d,e,23,4),d+4}function P(a,b,d,e,f){return b*=1,d>>>=0,f||N(a,b,d,8,17976931348623157e292,-17976931348623157e292),c.write(a,b,d,e,52,8),d+8}a.Buffer=g,a.SlowBuffer=r,a.INSPECT_MAX_BYTES=50,a.kMaxLength=0x7fffffff,g.TYPED_ARRAY_SUPPORT=e(),!g.TYPED_ARRAY_SUPPORT&&"u">typeof console&&"function"==typeof console.error&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),eo(e,"typedArraySupport"),Object.defineProperty(g.prototype,"parent",{enumerable:!0,get:eo(function(){if(g.isBuffer(this))return this.buffer},"get")}),Object.defineProperty(g.prototype,"offset",{enumerable:!0,get:eo(function(){if(g.isBuffer(this))return this.byteOffset},"get")}),eo(f,"createBuffer"),eo(g,"Buffer"),g.poolSize=8192,eo(h,"from"),g.from=function(a,b,c){return h(a,b,c)},Object.setPrototypeOf(g.prototype,Uint8Array.prototype),Object.setPrototypeOf(g,Uint8Array),eo(i,"assertSize"),eo(j,"alloc"),g.alloc=function(a,b,c){return j(a,b,c)},eo(k,"allocUnsafe"),g.allocUnsafe=function(a){return k(a)},g.allocUnsafeSlow=function(a){return k(a)},eo(l,"fromString"),eo(m,"fromArrayLike"),eo(n,"fromArrayView"),eo(o,"fromArrayBuffer"),eo(p,"fromObject"),eo(q,"checked"),eo(r,"SlowBuffer"),g.isBuffer=eo(function(a){return null!=a&&!0===a._isBuffer&&a!==g.prototype},"isBuffer"),g.compare=eo(function(a,b){if(ac(a,Uint8Array)&&(a=g.from(a,a.offset,a.byteLength)),ac(b,Uint8Array)&&(b=g.from(b,b.offset,b.byteLength)),!g.isBuffer(a)||!g.isBuffer(b))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===b)return 0;let c=a.length,d=b.length;for(let e=0,f=Math.min(c,d);e<f;++e)if(a[e]!==b[e]){c=a[e],d=b[e];break}return c<d?-1:+(d<c)},"compare"),g.isEncoding=eo(function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},"isEncoding"),g.concat=eo(function(a,b){let c;if(!Array.isArray(a))throw TypeError('"list" argument must be an Array of Buffers');if(0===a.length)return g.alloc(0);if(void 0===b)for(b=0,c=0;c<a.length;++c)b+=a[c].length;let d=g.allocUnsafe(b),e=0;for(c=0;c<a.length;++c){let b=a[c];if(ac(b,Uint8Array))e+b.length>d.length?(g.isBuffer(b)||(b=g.from(b)),b.copy(d,e)):Uint8Array.prototype.set.call(d,b,e);else if(g.isBuffer(b))b.copy(d,e);else throw TypeError('"list" argument must be an Array of Buffers');e+=b.length}return d},"concat"),eo(s,"byteLength"),g.byteLength=s,eo(t,"slowToString"),g.prototype._isBuffer=!0,eo(u,"swap"),g.prototype.swap16=eo(function(){let a=this.length;if(a%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(let b=0;b<a;b+=2)u(this,b,b+1);return this},"swap16"),g.prototype.swap32=eo(function(){let a=this.length;if(a%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(let b=0;b<a;b+=4)u(this,b,b+3),u(this,b+1,b+2);return this},"swap32"),g.prototype.swap64=eo(function(){let a=this.length;if(a%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(let b=0;b<a;b+=8)u(this,b,b+7),u(this,b+1,b+6),u(this,b+2,b+5),u(this,b+3,b+4);return this},"swap64"),g.prototype.toString=eo(function(){let a=this.length;return 0===a?"":0==arguments.length?D(this,0,a):t.apply(this,arguments)},"toString"),g.prototype.toLocaleString=g.prototype.toString,g.prototype.equals=eo(function(a){if(!g.isBuffer(a))throw TypeError("Argument must be a Buffer");return this===a||0===g.compare(this,a)},"equals"),g.prototype.inspect=eo(function(){let b="",c=a.INSPECT_MAX_BYTES;return b=this.toString("hex",0,c).replace(/(.{2})/g,"$1 ").trim(),this.length>c&&(b+=" ... "),"<Buffer "+b+">"},"inspect"),d&&(g.prototype[d]=g.prototype.inspect),g.prototype.compare=eo(function(a,b,c,d,e){if(ac(a,Uint8Array)&&(a=g.from(a,a.offset,a.byteLength)),!g.isBuffer(a))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof a);if(void 0===b&&(b=0),void 0===c&&(c=a?a.length:0),void 0===d&&(d=0),void 0===e&&(e=this.length),b<0||c>a.length||d<0||e>this.length)throw RangeError("out of range index");if(d>=e&&b>=c)return 0;if(d>=e)return -1;if(b>=c)return 1;if(b>>>=0,c>>>=0,d>>>=0,e>>>=0,this===a)return 0;let f=e-d,h=c-b,i=Math.min(f,h),j=this.slice(d,e),k=a.slice(b,c);for(let a=0;a<i;++a)if(j[a]!==k[a]){f=j[a],h=k[a];break}return f<h?-1:+(h<f)},"compare"),eo(v,"bidirectionalIndexOf"),eo(w,"arrayIndexOf"),g.prototype.includes=eo(function(a,b,c){return -1!==this.indexOf(a,b,c)},"includes"),g.prototype.indexOf=eo(function(a,b,c){return v(this,a,b,c,!0)},"indexOf"),g.prototype.lastIndexOf=eo(function(a,b,c){return v(this,a,b,c,!1)},"lastIndexOf"),eo(x,"hexWrite"),eo(y,"utf8Write"),eo(z,"asciiWrite"),eo(A,"base64Write"),eo(B,"ucs2Write"),g.prototype.write=eo(function(a,b,c,d){if(void 0===b)d="utf8",c=this.length,b=0;else if(void 0===c&&"string"==typeof b)d=b,c=this.length,b=0;else if(isFinite(b))b>>>=0,isFinite(c)?(c>>>=0,void 0===d&&(d="utf8")):(d=c,c=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");let e=this.length-b;if((void 0===c||c>e)&&(c=e),a.length>0&&(c<0||b<0)||b>this.length)throw RangeError("Attempt to write outside buffer bounds");d||(d="utf8");let f=!1;for(;;)switch(d){case"hex":return x(this,a,b,c);case"utf8":case"utf-8":return y(this,a,b,c);case"ascii":case"latin1":case"binary":return z(this,a,b,c);case"base64":return A(this,a,b,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return B(this,a,b,c);default:if(f)throw TypeError("Unknown encoding: "+d);d=(""+d).toLowerCase(),f=!0}},"write"),g.prototype.toJSON=eo(function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},"toJSON"),eo(C,"base64Slice"),eo(D,"utf8Slice"),eo(E,"decodeCodePointsArray"),eo(F,"asciiSlice"),eo(G,"latin1Slice"),eo(H,"hexSlice"),eo(I,"utf16leSlice"),g.prototype.slice=eo(function(a,b){let c=this.length;a=~~a,b=void 0===b?c:~~b,a<0?(a+=c)<0&&(a=0):a>c&&(a=c),b<0?(b+=c)<0&&(b=0):b>c&&(b=c),b<a&&(b=a);let d=this.subarray(a,b);return Object.setPrototypeOf(d,g.prototype),d},"slice"),eo(J,"checkOffset"),g.prototype.readUintLE=g.prototype.readUIntLE=eo(function(a,b,c){a>>>=0,b>>>=0,c||J(a,b,this.length);let d=this[a],e=1,f=0;for(;++f<b&&(e*=256);)d+=this[a+f]*e;return d},"readUIntLE"),g.prototype.readUintBE=g.prototype.readUIntBE=eo(function(a,b,c){a>>>=0,b>>>=0,c||J(a,b,this.length);let d=this[a+--b],e=1;for(;b>0&&(e*=256);)d+=this[a+--b]*e;return d},"readUIntBE"),g.prototype.readUint8=g.prototype.readUInt8=eo(function(a,b){return a>>>=0,b||J(a,1,this.length),this[a]},"readUInt8"),g.prototype.readUint16LE=g.prototype.readUInt16LE=eo(function(a,b){return a>>>=0,b||J(a,2,this.length),this[a]|this[a+1]<<8},"readUInt16LE"),g.prototype.readUint16BE=g.prototype.readUInt16BE=eo(function(a,b){return a>>>=0,b||J(a,2,this.length),this[a]<<8|this[a+1]},"readUInt16BE"),g.prototype.readUint32LE=g.prototype.readUInt32LE=eo(function(a,b){return a>>>=0,b||J(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+0x1000000*this[a+3]},"readUInt32LE"),g.prototype.readUint32BE=g.prototype.readUInt32BE=eo(function(a,b){return a>>>=0,b||J(a,4,this.length),0x1000000*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])},"readUInt32BE"),g.prototype.readBigUInt64LE=af(eo(function(a){V(a>>>=0,"offset");let b=this[a],c=this[a+7];(void 0===b||void 0===c)&&W(a,this.length-8);let d=b+256*this[++a]+65536*this[++a]+0x1000000*this[++a],e=this[++a]+256*this[++a]+65536*this[++a]+0x1000000*c;return BigInt(d)+(BigInt(e)<<BigInt(32))},"readBigUInt64LE")),g.prototype.readBigUInt64BE=af(eo(function(a){V(a>>>=0,"offset");let b=this[a],c=this[a+7];(void 0===b||void 0===c)&&W(a,this.length-8);let d=0x1000000*b+65536*this[++a]+256*this[++a]+this[++a],e=0x1000000*this[++a]+65536*this[++a]+256*this[++a]+c;return(BigInt(d)<<BigInt(32))+BigInt(e)},"readBigUInt64BE")),g.prototype.readIntLE=eo(function(a,b,c){a>>>=0,b>>>=0,c||J(a,b,this.length);let d=this[a],e=1,f=0;for(;++f<b&&(e*=256);)d+=this[a+f]*e;return d>=(e*=128)&&(d-=Math.pow(2,8*b)),d},"readIntLE"),g.prototype.readIntBE=eo(function(a,b,c){a>>>=0,b>>>=0,c||J(a,b,this.length);let d=b,e=1,f=this[a+--d];for(;d>0&&(e*=256);)f+=this[a+--d]*e;return f>=(e*=128)&&(f-=Math.pow(2,8*b)),f},"readIntBE"),g.prototype.readInt8=eo(function(a,b){return a>>>=0,b||J(a,1,this.length),128&this[a]?-((255-this[a]+1)*1):this[a]},"readInt8"),g.prototype.readInt16LE=eo(function(a,b){a>>>=0,b||J(a,2,this.length);let c=this[a]|this[a+1]<<8;return 32768&c?0xffff0000|c:c},"readInt16LE"),g.prototype.readInt16BE=eo(function(a,b){a>>>=0,b||J(a,2,this.length);let c=this[a+1]|this[a]<<8;return 32768&c?0xffff0000|c:c},"readInt16BE"),g.prototype.readInt32LE=eo(function(a,b){return a>>>=0,b||J(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},"readInt32LE"),g.prototype.readInt32BE=eo(function(a,b){return a>>>=0,b||J(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},"readInt32BE"),g.prototype.readBigInt64LE=af(eo(function(a){V(a>>>=0,"offset");let b=this[a],c=this[a+7];return(void 0===b||void 0===c)&&W(a,this.length-8),(BigInt(this[a+4]+256*this[a+5]+65536*this[a+6]+(c<<24))<<BigInt(32))+BigInt(b+256*this[++a]+65536*this[++a]+0x1000000*this[++a])},"readBigInt64LE")),g.prototype.readBigInt64BE=af(eo(function(a){V(a>>>=0,"offset");let b=this[a],c=this[a+7];return(void 0===b||void 0===c)&&W(a,this.length-8),(BigInt((b<<24)+65536*this[++a]+256*this[++a]+this[++a])<<BigInt(32))+BigInt(0x1000000*this[++a]+65536*this[++a]+256*this[++a]+c)},"readBigInt64BE")),g.prototype.readFloatLE=eo(function(a,b){return a>>>=0,b||J(a,4,this.length),c.read(this,a,!0,23,4)},"readFloatLE"),g.prototype.readFloatBE=eo(function(a,b){return a>>>=0,b||J(a,4,this.length),c.read(this,a,!1,23,4)},"readFloatBE"),g.prototype.readDoubleLE=eo(function(a,b){return a>>>=0,b||J(a,8,this.length),c.read(this,a,!0,52,8)},"readDoubleLE"),g.prototype.readDoubleBE=eo(function(a,b){return a>>>=0,b||J(a,8,this.length),c.read(this,a,!1,52,8)},"readDoubleBE"),eo(K,"checkInt"),g.prototype.writeUintLE=g.prototype.writeUIntLE=eo(function(a,b,c,d){if(a*=1,b>>>=0,c>>>=0,!d){let d=Math.pow(2,8*c)-1;K(this,a,b,c,d,0)}let e=1,f=0;for(this[b]=255&a;++f<c&&(e*=256);)this[b+f]=a/e&255;return b+c},"writeUIntLE"),g.prototype.writeUintBE=g.prototype.writeUIntBE=eo(function(a,b,c,d){if(a*=1,b>>>=0,c>>>=0,!d){let d=Math.pow(2,8*c)-1;K(this,a,b,c,d,0)}let e=c-1,f=1;for(this[b+e]=255&a;--e>=0&&(f*=256);)this[b+e]=a/f&255;return b+c},"writeUIntBE"),g.prototype.writeUint8=g.prototype.writeUInt8=eo(function(a,b,c){return a*=1,b>>>=0,c||K(this,a,b,1,255,0),this[b]=255&a,b+1},"writeUInt8"),g.prototype.writeUint16LE=g.prototype.writeUInt16LE=eo(function(a,b,c){return a*=1,b>>>=0,c||K(this,a,b,2,65535,0),this[b]=255&a,this[b+1]=a>>>8,b+2},"writeUInt16LE"),g.prototype.writeUint16BE=g.prototype.writeUInt16BE=eo(function(a,b,c){return a*=1,b>>>=0,c||K(this,a,b,2,65535,0),this[b]=a>>>8,this[b+1]=255&a,b+2},"writeUInt16BE"),g.prototype.writeUint32LE=g.prototype.writeUInt32LE=eo(function(a,b,c){return a*=1,b>>>=0,c||K(this,a,b,4,0xffffffff,0),this[b+3]=a>>>24,this[b+2]=a>>>16,this[b+1]=a>>>8,this[b]=255&a,b+4},"writeUInt32LE"),g.prototype.writeUint32BE=g.prototype.writeUInt32BE=eo(function(a,b,c){return a*=1,b>>>=0,c||K(this,a,b,4,0xffffffff,0),this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a,b+4},"writeUInt32BE"),eo(L,"wrtBigUInt64LE"),eo(M,"wrtBigUInt64BE"),g.prototype.writeBigUInt64LE=af(eo(function(a,b=0){return L(this,a,b,BigInt(0),BigInt("0xffffffffffffffff"))},"writeBigUInt64LE")),g.prototype.writeBigUInt64BE=af(eo(function(a,b=0){return M(this,a,b,BigInt(0),BigInt("0xffffffffffffffff"))},"writeBigUInt64BE")),g.prototype.writeIntLE=eo(function(a,b,c,d){if(a*=1,b>>>=0,!d){let d=Math.pow(2,8*c-1);K(this,a,b,c,d-1,-d)}let e=0,f=1,g=0;for(this[b]=255&a;++e<c&&(f*=256);)a<0&&0===g&&0!==this[b+e-1]&&(g=1),this[b+e]=(a/f|0)-g&255;return b+c},"writeIntLE"),g.prototype.writeIntBE=eo(function(a,b,c,d){if(a*=1,b>>>=0,!d){let d=Math.pow(2,8*c-1);K(this,a,b,c,d-1,-d)}let e=c-1,f=1,g=0;for(this[b+e]=255&a;--e>=0&&(f*=256);)a<0&&0===g&&0!==this[b+e+1]&&(g=1),this[b+e]=(a/f|0)-g&255;return b+c},"writeIntBE"),g.prototype.writeInt8=eo(function(a,b,c){return a*=1,b>>>=0,c||K(this,a,b,1,127,-128),a<0&&(a=255+a+1),this[b]=255&a,b+1},"writeInt8"),g.prototype.writeInt16LE=eo(function(a,b,c){return a*=1,b>>>=0,c||K(this,a,b,2,32767,-32768),this[b]=255&a,this[b+1]=a>>>8,b+2},"writeInt16LE"),g.prototype.writeInt16BE=eo(function(a,b,c){return a*=1,b>>>=0,c||K(this,a,b,2,32767,-32768),this[b]=a>>>8,this[b+1]=255&a,b+2},"writeInt16BE"),g.prototype.writeInt32LE=eo(function(a,b,c){return a*=1,b>>>=0,c||K(this,a,b,4,0x7fffffff,-0x80000000),this[b]=255&a,this[b+1]=a>>>8,this[b+2]=a>>>16,this[b+3]=a>>>24,b+4},"writeInt32LE"),g.prototype.writeInt32BE=eo(function(a,b,c){return a*=1,b>>>=0,c||K(this,a,b,4,0x7fffffff,-0x80000000),a<0&&(a=0xffffffff+a+1),this[b]=a>>>24,this[b+1]=a>>>16,this[b+2]=a>>>8,this[b+3]=255&a,b+4},"writeInt32BE"),g.prototype.writeBigInt64LE=af(eo(function(a,b=0){return L(this,a,b,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))},"writeBigInt64LE")),g.prototype.writeBigInt64BE=af(eo(function(a,b=0){return M(this,a,b,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))},"writeBigInt64BE")),eo(N,"checkIEEE754"),eo(O,"writeFloat"),g.prototype.writeFloatLE=eo(function(a,b,c){return O(this,a,b,!0,c)},"writeFloatLE"),g.prototype.writeFloatBE=eo(function(a,b,c){return O(this,a,b,!1,c)},"writeFloatBE"),eo(P,"writeDouble"),g.prototype.writeDoubleLE=eo(function(a,b,c){return P(this,a,b,!0,c)},"writeDoubleLE"),g.prototype.writeDoubleBE=eo(function(a,b,c){return P(this,a,b,!1,c)},"writeDoubleBE"),g.prototype.copy=eo(function(a,b,c,d){if(!g.isBuffer(a))throw TypeError("argument should be a Buffer");if(c||(c=0),d||0===d||(d=this.length),b>=a.length&&(b=a.length),b||(b=0),d>0&&d<c&&(d=c),d===c||0===a.length||0===this.length)return 0;if(b<0)throw RangeError("targetStart out of bounds");if(c<0||c>=this.length)throw RangeError("Index out of range");if(d<0)throw RangeError("sourceEnd out of bounds");d>this.length&&(d=this.length),a.length-b<d-c&&(d=a.length-b+c);let e=d-c;return this===a&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(b,c,d):Uint8Array.prototype.set.call(a,this.subarray(c,d),b),e},"copy"),g.prototype.fill=eo(function(a,b,c,d){let e;if("string"==typeof a){if("string"==typeof b?(d=b,b=0,c=this.length):"string"==typeof c&&(d=c,c=this.length),void 0!==d&&"string"!=typeof d)throw TypeError("encoding must be a string");if("string"==typeof d&&!g.isEncoding(d))throw TypeError("Unknown encoding: "+d);if(1===a.length){let b=a.charCodeAt(0);("utf8"===d&&b<128||"latin1"===d)&&(a=b)}}else"number"==typeof a?a&=255:"boolean"==typeof a&&(a=Number(a));if(b<0||this.length<b||this.length<c)throw RangeError("Out of range index");if(c<=b)return this;if(b>>>=0,c=void 0===c?this.length:c>>>0,a||(a=0),"number"==typeof a)for(e=b;e<c;++e)this[e]=a;else{let f=g.isBuffer(a)?a:g.from(a,d),h=f.length;if(0===h)throw TypeError('The value "'+a+'" is invalid for argument "value"');for(e=0;e<c-b;++e)this[e+b]=f[e%h]}return this},"fill");var Q={};function R(a,b,c){var d;Q[a]=(eo(d=class extends c{constructor(){super(),Object.defineProperty(this,"message",{value:b.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${a}]`,this.stack,delete this.name}get code(){return a}set code(a){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:a,writable:!0})}toString(){return`${this.name} [${a}\
]: ${this.message}`}},"NodeError"),d)}function S(a){let b="",c=a.length,d=+("-"===a[0]);for(;c>=d+4;c-=3)b=`\
_${a.slice(c-3,c)}${b}`;return`${a.slice(0,c)}${b}`}function T(a,b,c){V(b,"offset"),(void 0===a[b]||void 0===a[b+c])&&W(b,a.length-(c+1))}function U(a,b,c,d,e,f){if(a>c||a<b){let d="bigint"==typeof b?"n":"",e;throw e=f>3?0===b||b===BigInt(0)?`>= 0${d} and < 2${d}\
 ** ${(f+1)*8}${d}`:`>= -(2${d} ** ${(f+1)*8-1}${d}) and < 2 ** ${(f+1)*8-1}${d}`:`>= ${b}${d} a\
nd <= ${c}${d}`,new Q.ERR_OUT_OF_RANGE("value",e,a)}T(d,e,f)}function V(a,b){if("number"!=typeof a)throw new Q.ERR_INVALID_ARG_TYPE(b,"number",a)}function W(a,b,c){throw Math.floor(a)!==a?(V(a,c),new Q.ERR_OUT_OF_RANGE(c||"offset","an integer",a)):b<0?new Q.ERR_BUFFER_OUT_OF_BOUNDS:new Q.ERR_OUT_OF_RANGE(c||"offset",`>= ${+!!c} and <= ${b}`,a)}eo(R,"E"),R("ERR_BUFFER_OUT_OF_BOUNDS",function(a){return a?`${a} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),R("ERR_INVALID_ARG_TYPE",function(a,b){return`The "${a}" argument must be of type number. Received typ\
e ${typeof b}`},TypeError),R("ERR_OUT_OF_RANGE",function(a,b,c){let d=`The value of "${a}" is out o\
f range.`,e=c;return Number.isInteger(c)&&Math.abs(c)>0x100000000?e=S(String(c)):"bigint"==typeof c&&(e=String(c),(c>BigInt(2)**BigInt(32)||c<-(BigInt(2)**BigInt(32)))&&(e=S(e)),e+="n"),d+=` It must be ${b}. Re\
ceived ${e}`},RangeError),eo(S,"addNumericalSeparator"),eo(T,"checkBounds"),eo(U,"checkIntBI"),eo(V,"validateNumber"),eo(W,"boundsError");var X=/[^+/0-9A-Za-z-_]/g;function Y(a){if((a=(a=a.split("=")[0]).trim().replace(X,"")).length<2)return"";for(;a.length%4!=0;)a+="=";return a}function Z(a,b){b=b||1/0;let c,d=a.length,e=null,f=[];for(let g=0;g<d;++g){if((c=a.charCodeAt(g))>55295&&c<57344){if(!e){if(c>56319||g+1===d){(b-=3)>-1&&f.push(239,191,189);continue}e=c;continue}if(c<56320){(b-=3)>-1&&f.push(239,191,189),e=c;continue}c=(e-55296<<10|c-56320)+65536}else e&&(b-=3)>-1&&f.push(239,191,189);if(e=null,c<128){if((b-=1)<0)break;f.push(c)}else if(c<2048){if((b-=2)<0)break;f.push(c>>6|192,63&c|128)}else if(c<65536){if((b-=3)<0)break;f.push(c>>12|224,c>>6&63|128,63&c|128)}else if(c<1114112){if((b-=4)<0)break;f.push(c>>18|240,c>>12&63|128,c>>6&63|128,63&c|128)}else throw Error("Invalid code point")}return f}function $(a){let b=[];for(let c=0;c<a.length;++c)b.push(255&a.charCodeAt(c));return b}function _(a,b){let c,d,e=[];for(let f=0;f<a.length&&!((b-=2)<0);++f)d=(c=a.charCodeAt(f))>>8,e.push(c%256),e.push(d);return e}function aa(a){return b.toByteArray(Y(a))}function ab(a,b,c,d){let e;for(e=0;e<d&&!(e+c>=b.length||e>=a.length);++e)b[e+c]=a[e];return e}function ac(a,b){return a instanceof b||null!=a&&null!=a.constructor&&null!=a.constructor.name&&a.constructor.name===b.name}function ad(a){return a!=a}eo(Y,"base64clean"),eo(Z,"utf8ToBytes"),eo($,"asciiToBytes"),eo(_,"utf16leToBytes"),eo(aa,"base64ToBytes"),eo(ab,"blitBuffer"),eo(ac,"isInstance"),eo(ad,"numberIsNaN");var ae=function(){let a="0123456789abcdef",b=Array(256);for(let c=0;c<16;++c){let d=16*c;for(let e=0;e<16;++e)b[d+e]=a[c]+a[e]}return b}();function af(a){return typeof BigInt>"u"?ag:a}function ag(){throw Error("BigInt not supported")}eo(af,"defineBigIntMethod"),eo(ag,"BufferBigIntNotDefined")}),ez=ep(()=>{ee=globalThis,ef=globalThis.setImmediate??(a=>setTimeout(a,0)),globalThis.clearImmediate??(a=>clearTimeout(a)),eg="function"==typeof globalThis.Buffer&&"function"==typeof globalThis.Buffer.allocUnsafe?globalThis.Buffer:ey().Buffer,(eh=globalThis.process??{}).env??(eh.env={});try{eh.nextTick(()=>{})}catch{let a=Promise.resolve();eh.nextTick=a.then.bind(a)}}),eA=eq((a,b)=>{ez();var c,d="object"==typeof Reflect?Reflect:null,e=d&&"function"==typeof d.apply?d.apply:eo(function(a,b,c){return Function.prototype.apply.call(a,b,c)},"ReflectApply");function f(a){console&&console.warn&&console.warn(a)}c=d&&"function"==typeof d.ownKeys?d.ownKeys:Object.getOwnPropertySymbols?eo(function(a){return Object.getOwnPropertyNames(a).concat(Object.getOwnPropertySymbols(a))},"ReflectOwnKeys"):eo(function(a){return Object.getOwnPropertyNames(a)},"ReflectOwnKeys"),eo(f,"ProcessEmitWarning");var g=Number.isNaN||eo(function(a){return a!=a},"NumberIsNaN");function h(){h.init.call(this)}eo(h,"EventEmitter"),b.exports=h,b.exports.once=t,h.EventEmitter=h,h.prototype._events=void 0,h.prototype._eventsCount=0,h.prototype._maxListeners=void 0;var i=10;function j(a){if("function"!=typeof a)throw TypeError('The "listener" argument must be of type Function. Received type '+typeof a)}function k(a){return void 0===a._maxListeners?h.defaultMaxListeners:a._maxListeners}function l(a,b,c,d){var e,g,h;if(j(c),void 0===(g=a._events)?(g=a._events=Object.create(null),a._eventsCount=0):(void 0!==g.newListener&&(a.emit("newListener",b,c.listener?c.listener:c),g=a._events),h=g[b]),void 0===h)h=g[b]=c,++a._eventsCount;else if("function"==typeof h?h=g[b]=d?[c,h]:[h,c]:d?h.unshift(c):h.push(c),(e=k(a))>0&&h.length>e&&!h.warned){h.warned=!0;var i=Error("Possible EventEmitter memory leak detected. "+h.length+" "+String(b)+" listeners added. Use emitter.setMaxListeners() to increase limit");i.name="MaxListenersExceededWarning",i.emitter=a,i.type=b,i.count=h.length,f(i)}return a}function m(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0==arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function n(a,b,c){var d={fired:!1,wrapFn:void 0,target:a,type:b,listener:c},e=m.bind(d);return e.listener=c,d.wrapFn=e,e}function o(a,b,c){var d=a._events;if(void 0===d)return[];var e=d[b];return void 0===e?[]:"function"==typeof e?c?[e.listener||e]:[e]:c?s(e):q(e,e.length)}function p(a){var b=this._events;if(void 0!==b){var c=b[a];if("function"==typeof c)return 1;if(void 0!==c)return c.length}return 0}function q(a,b){for(var c=Array(b),d=0;d<b;++d)c[d]=a[d];return c}function r(a,b){for(;b+1<a.length;b++)a[b]=a[b+1];a.pop()}function s(a){for(var b=Array(a.length),c=0;c<b.length;++c)b[c]=a[c].listener||a[c];return b}function t(a,b){return new Promise(function(c,d){function e(c){a.removeListener(b,f),d(c)}function f(){"function"==typeof a.removeListener&&a.removeListener("error",e),c([].slice.call(arguments))}eo(e,"errorListener"),eo(f,"resolver"),v(a,b,f,{once:!0}),"error"!==b&&u(a,e,{once:!0})})}function u(a,b,c){"function"==typeof a.on&&v(a,"error",b,c)}function v(a,b,c,d){if("function"==typeof a.on)d.once?a.once(b,c):a.on(b,c);else if("function"==typeof a.addEventListener)a.addEventListener(b,eo(function e(f){d.once&&a.removeEventListener(b,e),c(f)},"wrapListener"));else throw TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof a)}eo(j,"checkListener"),Object.defineProperty(h,"defaultMaxListeners",{enumerable:!0,get:eo(function(){return i},"get"),set:eo(function(a){if("number"!=typeof a||a<0||g(a))throw RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+a+".");i=a},"set")}),h.init=function(){(void 0===this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},h.prototype.setMaxListeners=eo(function(a){if("number"!=typeof a||a<0||g(a))throw RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+a+".");return this._maxListeners=a,this},"setMaxListeners"),eo(k,"_getMaxListeners"),h.prototype.getMaxListeners=eo(function(){return k(this)},"getMaxListeners"),h.prototype.emit=eo(function(a){for(var b=[],c=1;c<arguments.length;c++)b.push(arguments[c]);var d="error"===a,f=this._events;if(void 0!==f)d=d&&void 0===f.error;else if(!d)return!1;if(d){if(b.length>0&&(g=b[0]),g instanceof Error)throw g;var g,h=Error("Unhandled error."+(g?" ("+g.message+")":""));throw h.context=g,h}var i=f[a];if(void 0===i)return!1;if("function"==typeof i)e(i,this,b);else for(var j=i.length,k=q(i,j),c=0;c<j;++c)e(k[c],this,b);return!0},"emit"),eo(l,"_addListener"),h.prototype.addListener=eo(function(a,b){return l(this,a,b,!1)},"addListener"),h.prototype.on=h.prototype.addListener,h.prototype.prependListener=eo(function(a,b){return l(this,a,b,!0)},"prependListener"),eo(m,"onceWrapper"),eo(n,"_onceWrap"),h.prototype.once=eo(function(a,b){return j(b),this.on(a,n(this,a,b)),this},"once"),h.prototype.prependOnceListener=eo(function(a,b){return j(b),this.prependListener(a,n(this,a,b)),this},"prependOnceListener"),h.prototype.removeListener=eo(function(a,b){var c,d,e,f,g;if(j(b),void 0===(d=this._events)||void 0===(c=d[a]))return this;if(c===b||c.listener===b)0==--this._eventsCount?this._events=Object.create(null):(delete d[a],d.removeListener&&this.emit("removeListener",a,c.listener||b));else if("function"!=typeof c){for(e=-1,f=c.length-1;f>=0;f--)if(c[f]===b||c[f].listener===b){g=c[f].listener,e=f;break}if(e<0)return this;0===e?c.shift():r(c,e),1===c.length&&(d[a]=c[0]),void 0!==d.removeListener&&this.emit("removeListener",a,g||b)}return this},"removeListener"),h.prototype.off=h.prototype.removeListener,h.prototype.removeAllListeners=eo(function(a){var b,c,d;if(void 0===(c=this._events))return this;if(void 0===c.removeListener)return 0==arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==c[a]&&(0==--this._eventsCount?this._events=Object.create(null):delete c[a]),this;if(0==arguments.length){var e,f=Object.keys(c);for(d=0;d<f.length;++d)"removeListener"!==(e=f[d])&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(b=c[a]))this.removeListener(a,b);else if(void 0!==b)for(d=b.length-1;d>=0;d--)this.removeListener(a,b[d]);return this},"removeAllListeners"),eo(o,"_listeners"),h.prototype.listeners=eo(function(a){return o(this,a,!0)},"listeners"),h.prototype.rawListeners=eo(function(a){return o(this,a,!1)},"rawListeners"),h.listenerCount=function(a,b){return"function"==typeof a.listenerCount?a.listenerCount(b):p.call(a,b)},h.prototype.listenerCount=p,eo(p,"listenerCount"),h.prototype.eventNames=eo(function(){return this._eventsCount>0?c(this._events):[]},"eventNames"),eo(q,"arrayClone"),eo(r,"spliceOne"),eo(s,"unwrapListeners"),eo(t,"once"),eo(u,"addErrorHandlerIfEventEmitter"),eo(v,"eventTargetAgnosticAddListener")}),eB={};function eC(a){return 0}er(eB,{Socket:()=>eG,isIP:()=>eC});var eD,eE,eF,eG,eH=ep(()=>{ez(),eD=et(eA(),1),eo(eC,"isIP"),eE=/^[^.]+\./,eF=class a extends eD.EventEmitter{constructor(){super(...arguments),ev(this,"opts",{}),ev(this,"connecting",!1),ev(this,"pending",!0),ev(this,"writable",!0),ev(this,"encrypted",!1),ev(this,"authorized",!1),ev(this,"destroyed",!1),ev(this,"ws",null),ev(this,"writeBuffer"),ev(this,"tlsState",0),ev(this,"tlsRead"),ev(this,"tlsWrite")}static get poolQueryViaFetch(){return a.opts.poolQueryViaFetch??a.defaults.poolQueryViaFetch}static set poolQueryViaFetch(b){a.opts.poolQueryViaFetch=b}static get fetchEndpoint(){return a.opts.fetchEndpoint??a.defaults.fetchEndpoint}static set fetchEndpoint(b){a.opts.fetchEndpoint=b}static get fetchConnectionCache(){return!0}static set fetchConnectionCache(a){console.warn("The `fetchConnectionCache` option is deprecated (now always `true`)")}static get fetchFunction(){return a.opts.fetchFunction??a.defaults.fetchFunction}static set fetchFunction(b){a.opts.fetchFunction=b}static get webSocketConstructor(){return a.opts.webSocketConstructor??a.defaults.webSocketConstructor}static set webSocketConstructor(b){a.opts.webSocketConstructor=b}get webSocketConstructor(){return this.opts.webSocketConstructor??a.webSocketConstructor}set webSocketConstructor(a){this.opts.webSocketConstructor=a}static get wsProxy(){return a.opts.wsProxy??a.defaults.wsProxy}static set wsProxy(b){a.opts.wsProxy=b}get wsProxy(){return this.opts.wsProxy??a.wsProxy}set wsProxy(a){this.opts.wsProxy=a}static get coalesceWrites(){return a.opts.coalesceWrites??a.defaults.coalesceWrites}static set coalesceWrites(b){a.opts.coalesceWrites=b}get coalesceWrites(){return this.opts.coalesceWrites??a.coalesceWrites}set coalesceWrites(a){this.opts.coalesceWrites=a}static get useSecureWebSocket(){return a.opts.useSecureWebSocket??a.defaults.useSecureWebSocket}static set useSecureWebSocket(b){a.opts.useSecureWebSocket=b}get useSecureWebSocket(){return this.opts.useSecureWebSocket??a.useSecureWebSocket}set useSecureWebSocket(a){this.opts.useSecureWebSocket=a}static get forceDisablePgSSL(){return a.opts.forceDisablePgSSL??a.defaults.forceDisablePgSSL}static set forceDisablePgSSL(b){a.opts.forceDisablePgSSL=b}get forceDisablePgSSL(){return this.opts.forceDisablePgSSL??a.forceDisablePgSSL}set forceDisablePgSSL(a){this.opts.forceDisablePgSSL=a}static get disableSNI(){return a.opts.disableSNI??a.defaults.disableSNI}static set disableSNI(b){a.opts.disableSNI=b}get disableSNI(){return this.opts.disableSNI??a.disableSNI}set disableSNI(a){this.opts.disableSNI=a}static get disableWarningInBrowsers(){return a.opts.disableWarningInBrowsers??a.defaults.disableWarningInBrowsers}static set disableWarningInBrowsers(b){a.opts.disableWarningInBrowsers=b}get disableWarningInBrowsers(){return this.opts.disableWarningInBrowsers??a.disableWarningInBrowsers}set disableWarningInBrowsers(a){this.opts.disableWarningInBrowsers=a}static get pipelineConnect(){return a.opts.pipelineConnect??a.defaults.pipelineConnect}static set pipelineConnect(b){a.opts.pipelineConnect=b}get pipelineConnect(){return this.opts.pipelineConnect??a.pipelineConnect}set pipelineConnect(a){this.opts.pipelineConnect=a}static get subtls(){return a.opts.subtls??a.defaults.subtls}static set subtls(b){a.opts.subtls=b}get subtls(){return this.opts.subtls??a.subtls}set subtls(a){this.opts.subtls=a}static get pipelineTLS(){return a.opts.pipelineTLS??a.defaults.pipelineTLS}static set pipelineTLS(b){a.opts.pipelineTLS=b}get pipelineTLS(){return this.opts.pipelineTLS??a.pipelineTLS}set pipelineTLS(a){this.opts.pipelineTLS=a}static get rootCerts(){return a.opts.rootCerts??a.defaults.rootCerts}static set rootCerts(b){a.opts.rootCerts=b}get rootCerts(){return this.opts.rootCerts??a.rootCerts}set rootCerts(a){this.opts.rootCerts=a}wsProxyAddrForHost(a,b){let c=this.wsProxy;if(void 0===c)throw Error("No WebSocket proxy is configured. Please see https://github.com/neondatabase/serverless/blob/main/CONFIG.md#wsproxy-string--host-string-port-number--string--string");return"function"==typeof c?c(a,b):`${c}?address=${a}:${b}`}setNoDelay(){return this}setKeepAlive(){return this}ref(){return this}unref(){return this}connect(a,b,c){this.connecting=!0,c&&this.once("connect",c);let d=eo(()=>{this.connecting=!1,this.pending=!1,this.emit("connect"),this.emit("ready")},"handleWebSocketOpen"),e=eo((a,b=!1)=>{a.binaryType="arraybuffer",a.addEventListener("error",a=>{this.emit("error",a),this.emit("close")}),a.addEventListener("message",a=>{if(0===this.tlsState){let b=eg.from(a.data);this.emit("data",b)}}),a.addEventListener("close",()=>{this.emit("close")}),b?d():a.addEventListener("open",d)},"configureWebSocket"),f;try{f=this.wsProxyAddrForHost(b,"string"==typeof a?parseInt(a,10):a)}catch(a){this.emit("error",a),this.emit("close");return}try{let a=(this.useSecureWebSocket?"wss:":"ws:")+"//"+f;if(void 0!==this.webSocketConstructor)this.ws=new this.webSocketConstructor(a),e(this.ws);else try{this.ws=new WebSocket(a),e(this.ws)}catch{this.ws=new __unstable_WebSocket(a),e(this.ws)}}catch(a){fetch((this.useSecureWebSocket?"https:":"http:")+"//"+f,{headers:{Upgrade:"websocket"}}).then(b=>{if(this.ws=b.webSocket,null==this.ws)throw a;this.ws.accept(),e(this.ws,!0)}).catch(a=>{this.emit("error",Error(`All attempts to open a WebSocket to connect to the database failed. Please refer \
to https://github.com/neondatabase/serverless/blob/main/CONFIG.md#websocketconstructor-typeof-websoc\
ket--undefined. Details: ${a}`)),this.emit("close")})}}async startTls(a){if(void 0===this.subtls)throw Error("For Postgres SSL connections, you must set `neonConfig.subtls` to the subtls library. See https://github.com/neondatabase/serverless/blob/main/CONFIG.md for more information.");this.tlsState=1;let b=await this.subtls.TrustedCert.databaseFromPEM(this.rootCerts),c=new this.subtls.WebSocketReadQueue(this.ws),d=c.read.bind(c),e=this.rawWrite.bind(this),{read:f,write:g}=await this.subtls.startTls(a,b,d,e,{useSNI:!this.disableSNI,expectPreData:this.pipelineTLS?new Uint8Array([83]):void 0});this.tlsRead=f,this.tlsWrite=g,this.tlsState=2,this.encrypted=!0,this.authorized=!0,this.emit("secureConnection",this),this.tlsReadLoop()}async tlsReadLoop(){for(;;){let a=await this.tlsRead();if(void 0===a)break;{let b=eg.from(a);this.emit("data",b)}}}rawWrite(a){if(!this.coalesceWrites){this.ws&&this.ws.send(a);return}if(void 0===this.writeBuffer)this.writeBuffer=a,setTimeout(()=>{this.ws&&this.ws.send(this.writeBuffer),this.writeBuffer=void 0},0);else{let b=new Uint8Array(this.writeBuffer.length+a.length);b.set(this.writeBuffer),b.set(a,this.writeBuffer.length),this.writeBuffer=b}}write(a,b="utf8",c=a=>{}){return 0===a.length?c():("string"==typeof a&&(a=eg.from(a,b)),0===this.tlsState?(this.rawWrite(a),c()):1===this.tlsState?this.once("secureConnection",()=>{this.write(a,b,c)}):(this.tlsWrite(a),c())),!0}end(a=eg.alloc(0),b="utf8",c=()=>{}){return this.write(a,b,()=>{this.ws.close(),c()}),this}destroy(){return this.destroyed=!0,this.end()}},eo(eF,"Socket"),ev(eF,"defaults",{poolQueryViaFetch:!1,fetchEndpoint:eo((a,b,c)=>"https://"+(c?.jwtAuth?a.replace(eE,"apiauth."):a.replace(eE,"api."))+"/sql","fetchEndpoint"),fetchConnectionCache:!0,fetchFunction:void 0,webSocketConstructor:void 0,wsProxy:eo(a=>a+"/v2","wsProxy"),useSecureWebSocket:!0,forceDisablePgSSL:!0,coalesceWrites:!0,pipelineConnect:"password",subtls:void 0,rootCerts:"",pipelineTLS:!1,disableSNI:!1,disableWarningInBrowsers:!1}),ev(eF,"opts",{}),eG=eF}),eI={};function eJ(a,b=!1){let{protocol:c}=new URL(a),{username:d,password:e,host:f,hostname:g,port:h,pathname:i,search:j,searchParams:k,hash:l}=new URL("http:"+a.substring(c.length));e=decodeURIComponent(e),d=decodeURIComponent(d),i=decodeURIComponent(i);let m=d+":"+e,n=b?Object.fromEntries(k.entries()):j;return{href:a,protocol:c,auth:m,username:d,password:e,host:f,hostname:g,port:h,pathname:i,search:j,query:n,hash:l}}er(eI,{parse:()=>eJ});var eK=ep(()=>{ez(),eo(eJ,"parse")}),eL=eq(a=>{ez(),a.parse=function(a,b){return new c(a,b).parse()};var b=class a{constructor(a,b){this.source=a,this.transform=b||d,this.position=0,this.entries=[],this.recorded=[],this.dimension=0}isEof(){return this.position>=this.source.length}nextCharacter(){var a=this.source[this.position++];return"\\"===a?{value:this.source[this.position++],escaped:!0}:{value:a,escaped:!1}}record(a){this.recorded.push(a)}newEntry(a){var b;(this.recorded.length>0||a)&&("NULL"!==(b=this.recorded.join(""))||a||(b=null),null!==b&&(b=this.transform(b)),this.entries.push(b),this.recorded=[])}consumeDimensions(){if("["===this.source[0])for(;!this.isEof()&&"="!==this.nextCharacter().value;);}parse(b){var c,d,e;for(this.consumeDimensions();!this.isEof();)if("{"!==(c=this.nextCharacter()).value||e){if("}"!==c.value||e)'"'!==c.value||c.escaped?","!==c.value||e?this.record(c.value):this.newEntry():(e&&this.newEntry(!0),e=!e);else if(this.dimension--,!this.dimension&&(this.newEntry(),b))return this.entries}else this.dimension++,this.dimension>1&&(d=new a(this.source.substr(this.position-1),this.transform),this.entries.push(d.parse(!0)),this.position+=d.position-2);if(0!==this.dimension)throw Error("array dimension not balanced");return this.entries}};eo(b,"ArrayParser");var c=b;function d(a){return a}eo(d,"identity")}),eM=eq((a,b)=>{ez();var c=eL();b.exports={create:eo(function(a,b){return{parse:eo(function(){return c.parse(a,b)},"parse")}},"create")}}),eN=eq((a,b)=>{ez();var c=/(\d{1,})-(\d{2})-(\d{2}) (\d{2}):(\d{2}):(\d{2})(\.\d{1,})?.*?( BC)?$/,d=/^(\d{1,})-(\d{2})-(\d{2})( BC)?$/,e=/([Z+-])(\d{2})?:?(\d{2})?:?(\d{2})?/,f=/^-?infinity$/;function g(a){var b=d.exec(a);if(b){var c=parseInt(b[1],10);b[4]&&(c=i(c));var e=new Date(c,parseInt(b[2],10)-1,b[3]);return j(c)&&e.setFullYear(c),e}}function h(a){if(a.endsWith("+00"))return 0;var b=e.exec(a.split(" ")[1]);if(b){var c=b[1];return"Z"===c?0:(3600*parseInt(b[2],10)+60*parseInt(b[3]||0,10)+parseInt(b[4]||0,10))*("-"===c?-1:1)*1e3}}function i(a){return-(a-1)}function j(a){return a>=0&&a<100}b.exports=eo(function(a){if(f.test(a))return Number(a.replace("i","I"));var b=c.exec(a);if(!b)return g(a)||null;var d=!!b[8],e=parseInt(b[1],10);d&&(e=i(e));var k=parseInt(b[2],10)-1,l=b[3],m=parseInt(b[4],10),n=parseInt(b[5],10),o=parseInt(b[6],10),p=b[7];p=p?1e3*parseFloat(p):0;var q,r=h(a);return null!=r?(q=new Date(Date.UTC(e,k,l,m,n,o,p)),j(e)&&q.setUTCFullYear(e),0!==r&&q.setTime(q.getTime()-r)):(q=new Date(e,k,l,m,n,o,p),j(e)&&q.setFullYear(e)),q},"parseDate"),eo(g,"getDate"),eo(h,"timeZoneOffset"),eo(i,"bcYearToNegativeYear"),eo(j,"is0To99")}),eO=eq((a,b)=>{ez(),b.exports=d;var c=Object.prototype.hasOwnProperty;function d(a){for(var b=1;b<arguments.length;b++){var d=arguments[b];for(var e in d)c.call(d,e)&&(a[e]=d[e])}return a}eo(d,"extend")}),eP=eq((a,b)=>{ez();var c=eO();function d(a){if(!(this instanceof d))return new d(a);c(this,n(a))}b.exports=d,eo(d,"PostgresInterval");var e=["seconds","minutes","hours","days","months","years"];d.prototype.toPostgres=function(){var a=e.filter(this.hasOwnProperty,this);return this.milliseconds&&0>a.indexOf("seconds")&&a.push("seconds"),0===a.length?"0":a.map(function(a){var b=this[a]||0;return"seconds"===a&&this.milliseconds&&(b=(b+this.milliseconds/1e3).toFixed(6).replace(/\.?0+$/,"")),b+" "+a},this).join(" ")};var f={years:"Y",months:"M",days:"D",hours:"H",minutes:"M",seconds:"S"},g=["years","months","days"],h=["hours","minutes","seconds"];d.prototype.toISOString=d.prototype.toISO=function(){return"P"+g.map(a,this).join("")+"T"+h.map(a,this).join("");function a(a){var b=this[a]||0;return"seconds"===a&&this.milliseconds&&(b=(b+this.milliseconds/1e3).toFixed(6).replace(/0+$/,"")),b+f[a]}};var i="([+-]?\\d+)",j=new RegExp([i+"\\s+years?",i+"\\s+mons?",i+"\\s+days?","([+-])?([\\d]*):(\\d\\d):(\\d\\d)\\.?(\\d{1,6})?"].map(function(a){return"("+a+")?"}).join("\\s*")),k={years:2,months:4,days:6,hours:9,minutes:10,seconds:11,milliseconds:12},l=["hours","minutes","seconds","milliseconds"];function m(a){return parseInt(a+"000000".slice(a.length),10)/1e3}function n(a){if(!a)return{};var b=j.exec(a),c="-"===b[8];return Object.keys(k).reduce(function(a,d){var e=b[k[d]];return e&&(e="milliseconds"===d?m(e):parseInt(e,10))&&(c&&~l.indexOf(d)&&(e*=-1),a[d]=e),a},{})}eo(m,"parseMilliseconds"),eo(n,"parse")}),eQ=eq((a,b)=>{ez(),b.exports=eo(function(a){if(/^\\x/.test(a))return new eg(a.substr(2),"hex");for(var b="",c=0;c<a.length;)if("\\"!==a[c])b+=a[c],++c;else if(/[0-7]{3}/.test(a.substr(c+1,3)))b+=String.fromCharCode(parseInt(a.substr(c+1,3),8)),c+=4;else{for(var d=1;c+d<a.length&&"\\"===a[c+d];)d++;for(var e=0;e<Math.floor(d/2);++e)b+="\\";c+=2*Math.floor(d/2)}return new eg(b,"binary")},"parseBytea")}),eR=eq((a,b)=>{ez();var c=eL(),d=eM(),e=eN(),f=eP(),g=eQ();function h(a){return eo(function(b){return null===b?b:a(b)},"nullAllowed")}function i(a){return null===a?a:"TRUE"===a||"t"===a||"true"===a||"y"===a||"yes"===a||"on"===a||"1"===a}function j(a){return a?c.parse(a,i):null}function k(a){return parseInt(a,10)}function l(a){return a?c.parse(a,h(k)):null}function m(a){return a?c.parse(a,h(function(a){return u(a).trim()})):null}eo(h,"allowNull"),eo(i,"parseBool"),eo(j,"parseBoolArray"),eo(k,"parseBaseTenInt"),eo(l,"parseIntegerArray"),eo(m,"parseBigIntegerArray");var n=eo(function(a){return a?d.create(a,function(a){return null!==a&&(a=w(a)),a}).parse():null},"parsePointArray"),o=eo(function(a){return a?d.create(a,function(a){return null!==a&&(a=parseFloat(a)),a}).parse():null},"parseFloatArray"),p=eo(function(a){return a?d.create(a).parse():null},"parseStringArray"),q=eo(function(a){return a?d.create(a,function(a){return null!==a&&(a=e(a)),a}).parse():null},"parseDateArray"),r=eo(function(a){return a?d.create(a,function(a){return null!==a&&(a=f(a)),a}).parse():null},"parseIntervalArray"),s=eo(function(a){return a?c.parse(a,h(g)):null},"parseByteAArray"),t=eo(function(a){return parseInt(a,10)},"parseInteger"),u=eo(function(a){var b=String(a);return/^\d+$/.test(b)?b:a},"parseBigInteger"),v=eo(function(a){return a?c.parse(a,h(JSON.parse)):null},"parseJsonArray"),w=eo(function(a){return"("!==a[0]?null:{x:parseFloat((a=a.substring(1,a.length-1).split(","))[0]),y:parseFloat(a[1])}},"parsePoint"),x=eo(function(a){if("<"!==a[0]&&"("!==a[1])return null;for(var b="(",c="",d=!1,e=2;e<a.length-1;e++){if(d||(b+=a[e]),")"===a[e]){d=!0;continue}d&&","!==a[e]&&(c+=a[e])}var f=w(b);return f.radius=parseFloat(c),f},"parseCircle");b.exports={init:eo(function(a){a(20,u),a(21,t),a(23,t),a(26,t),a(700,parseFloat),a(701,parseFloat),a(16,i),a(1082,e),a(1114,e),a(1184,e),a(600,w),a(651,p),a(718,x),a(1e3,j),a(1001,s),a(1005,l),a(1007,l),a(1028,l),a(1016,m),a(1017,n),a(1021,o),a(1022,o),a(1231,o),a(1014,p),a(1015,p),a(1008,p),a(1009,p),a(1040,p),a(1041,p),a(1115,q),a(1182,q),a(1185,q),a(1186,f),a(1187,r),a(17,g),a(114,JSON.parse.bind(JSON)),a(3802,JSON.parse.bind(JSON)),a(199,v),a(3807,v),a(3907,p),a(2951,p),a(791,p),a(1183,p),a(1270,p)},"init")}}),eS=eq((a,b)=>{function c(a){var b=a.readInt32BE(0),c=a.readUInt32BE(4),d="";b<0&&(b=~b+(0===c),c=~c+1>>>0,d="-");var e,f,g,h,i,j,k="";if(e=b%1e6,b=b/1e6>>>0,c=(f=0x100000000*e+c)/1e6>>>0,g=""+(f-1e6*c),0===c&&0===b)return d+g+k;for(h="",i=6-g.length,j=0;j<i;j++)h+="0";if(k=h+g+k,e=b%1e6,b=b/1e6>>>0,c=(f=0x100000000*e+c)/1e6>>>0,g=""+(f-1e6*c),0===c&&0===b)return d+g+k;for(h="",i=6-g.length,j=0;j<i;j++)h+="0";if(k=h+g+k,e=b%1e6,b=b/1e6>>>0,c=(f=0x100000000*e+c)/1e6>>>0,g=""+(f-1e6*c),0===c&&0===b)return d+g+k;for(h="",i=6-g.length,j=0;j<i;j++)h+="0";return k=h+g+k,d+(g=""+(f=0x100000000*(e=b%1e6)+c)%1e6)+k}ez(),eo(c,"readInt8"),b.exports=c}),eT=eq((a,b)=>{ez();var c=eS(),d=eo(function(a,b,c,d,e){c=c||0,d=d||!1,e=e||function(a,b,c){return a*Math.pow(2,c)+b};var f=c>>3,g=eo(function(a){return d?255&~a:a},"inv"),h=255,i=8-c%8;b<i&&(h=255<<8-b&255,i=b),c&&(h>>=c%8);var j=0;c%8+b>=8&&(j=e(0,g(a[f])&h,i));for(var k=b+c>>3,l=f+1;l<k;l++)j=e(j,g(a[l]),8);var m=(b+c)%8;return m>0&&(j=e(j,g(a[k])>>8-m,m)),j},"parseBits"),e=eo(function(a,b,c){var e=Math.pow(2,c-1)-1,f=d(a,1),g=d(a,c,1);if(0===g)return 0;var h=1,i=d(a,b,c+1,!1,eo(function(a,b,c){0===a&&(a=1);for(var d=1;d<=c;d++)h/=2,(b&1<<c-d)>0&&(a+=h);return a},"parsePrecisionBits"));return g==Math.pow(2,c+1)-1?0===i?0===f?1/0:-1/0:NaN:(0===f?1:-1)*Math.pow(2,g-e)*i},"parseFloatFromBits"),f=eo(function(a){return 1==d(a,1)?-1*(d(a,15,1,!0)+1):d(a,15,1)},"parseInt16"),g=eo(function(a){return 1==d(a,1)?-1*(d(a,31,1,!0)+1):d(a,31,1)},"parseInt32"),h=eo(function(a){return e(a,23,8)},"parseFloat32"),i=eo(function(a){return e(a,52,11)},"parseFloat64"),j=eo(function(a){var b=d(a,16,32);if(49152==b)return NaN;for(var c=Math.pow(1e4,d(a,16,16)),e=0,f=d(a,16),g=0;g<f;g++)e+=d(a,16,64+16*g)*c,c/=1e4;var h=Math.pow(10,d(a,16,48));return(0===b?1:-1)*Math.round(e*h)/h},"parseNumeric"),k=eo(function(a,b){var c=d(b,1),e=d(b,63,1),f=new Date((0===c?1:-1)*e/1e3+9466848e5);return a||f.setTime(f.getTime()+6e4*f.getTimezoneOffset()),f.usec=e%1e3,f.getMicroSeconds=function(){return this.usec},f.setMicroSeconds=function(a){this.usec=a},f.getUTCMicroSeconds=function(){return this.usec},f},"parseDate"),l=eo(function(a){for(var b=d(a,32),c=(d(a,32,32),d(a,32,64)),e=96,f=[],g=0;g<b;g++)f[g]=d(a,32,e),e+=64;var h=eo(function(b){var c,f=d(a,32,e);return(e+=32,0xffffffff==f)?null:23==b||20==b?(c=d(a,8*f,e),e+=8*f,c):25==b?a.toString(this.encoding,e>>3,(e+=f<<3)>>3):void console.log("ERROR: ElementType not implemented: "+b)},"parseElement"),i=eo(function(a,b){var c,d=[];if(a.length>1){var e=a.shift();for(c=0;c<e;c++)d[c]=i(a,b);a.unshift(e)}else for(c=0;c<a[0];c++)d[c]=h(b);return d},"parse");return i(f,c)},"parseArray"),m=eo(function(a){return a.toString("utf8")},"parseText"),n=eo(function(a){return null===a?null:d(a,8)>0},"parseBool");b.exports={init:eo(function(a){a(20,c),a(21,f),a(23,g),a(26,g),a(1700,j),a(700,h),a(701,i),a(16,n),a(1114,k.bind(null,!1)),a(1184,k.bind(null,!0)),a(1e3,l),a(1007,l),a(1016,l),a(1008,l),a(1009,l),a(25,m)},"init")}}),eU=eq((a,b)=>{ez(),b.exports={BOOL:16,BYTEA:17,CHAR:18,INT8:20,INT2:21,INT4:23,REGPROC:24,TEXT:25,OID:26,TID:27,XID:28,CID:29,JSON:114,XML:142,PG_NODE_TREE:194,SMGR:210,PATH:602,POLYGON:604,CIDR:650,FLOAT4:700,FLOAT8:701,ABSTIME:702,RELTIME:703,TINTERVAL:704,CIRCLE:718,MACADDR8:774,MONEY:790,MACADDR:829,INET:869,ACLITEM:1033,BPCHAR:1042,VARCHAR:1043,DATE:1082,TIME:1083,TIMESTAMP:1114,TIMESTAMPTZ:1184,INTERVAL:1186,TIMETZ:1266,BIT:1560,VARBIT:1562,NUMERIC:1700,REFCURSOR:1790,REGPROCEDURE:2202,REGOPER:2203,REGOPERATOR:2204,REGCLASS:2205,REGTYPE:2206,UUID:2950,TXID_SNAPSHOT:2970,PG_LSN:3220,PG_NDISTINCT:3361,PG_DEPENDENCIES:3402,TSVECTOR:3614,TSQUERY:3615,GTSVECTOR:3642,REGCONFIG:3734,REGDICTIONARY:3769,JSONB:3802,REGNAMESPACE:4089,REGROLE:4096}}),eV=eq(a=>{ez();var b=eR(),c=eT(),d=eM(),e=eU();a.getTypeParser=h,a.setTypeParser=i,a.arrayParser=d,a.builtins=e;var f={text:{},binary:{}};function g(a){return String(a)}function h(a,b){return f[b=b||"text"]&&f[b][a]||g}function i(a,b,c){"function"==typeof b&&(c=b,b="text"),f[b][a]=c}eo(g,"noParse"),eo(h,"getTypeParser"),eo(i,"setTypeParser"),b.init(function(a,b){f.text[a]=b}),c.init(function(a,b){f.binary[a]=b})}),eW=eq((a,b)=>{ez();var c=eV();function d(a){this._types=a||c,this.text={},this.binary={}}eo(d,"TypeOverrides"),d.prototype.getOverrides=function(a){switch(a){case"text":return this.text;case"binary":return this.binary;default:return{}}},d.prototype.setTypeParser=function(a,b,c){"function"==typeof b&&(c=b,b="text"),this.getOverrides(b)[a]=c},d.prototype.getTypeParser=function(a,b){return b=b||"text",this.getOverrides(b)[a]||this._types.getTypeParser(a,b)},b.exports=d});function eX(a){let b=0x6a09e667,c=0xbb67ae85,d=0x3c6ef372,e=0xa54ff53a,f=0x510e527f,g=0x9b05688c,h=0x1f83d9ab,i=0x5be0cd19,j=0,k=0,l=[0x428a2f98,0x71374491,0xb5c0fbcf,0xe9b5dba5,0x3956c25b,0x59f111f1,0x923f82a4,0xab1c5ed5,0xd807aa98,0x12835b01,0x243185be,0x550c7dc3,0x72be5d74,0x80deb1fe,0x9bdc06a7,0xc19bf174,0xe49b69c1,0xefbe4786,0xfc19dc6,0x240ca1cc,0x2de92c6f,0x4a7484aa,0x5cb0a9dc,0x76f988da,0x983e5152,0xa831c66d,0xb00327c8,0xbf597fc7,0xc6e00bf3,0xd5a79147,0x6ca6351,0x14292967,0x27b70a85,0x2e1b2138,0x4d2c6dfc,0x53380d13,0x650a7354,0x766a0abb,0x81c2c92e,0x92722c85,0xa2bfe8a1,0xa81a664b,0xc24b8b70,0xc76c51a3,0xd192e819,0xd6990624,0xf40e3585,0x106aa070,0x19a4c116,0x1e376c08,0x2748774c,0x34b0bcb5,0x391c0cb3,0x4ed8aa4a,0x5b9cca4f,0x682e6ff3,0x748f82ee,0x78a5636f,0x84c87814,0x8cc70208,0x90befffa,0xa4506ceb,0xbef9a3f7,0xc67178f2],m=eo((a,b)=>a>>>b|a<<32-b,"rrot"),n=new Uint32Array(64),o=new Uint8Array(64),p=eo(()=>{for(let a=0,b=0;a<16;a++,b+=4)n[a]=o[b]<<24|o[b+1]<<16|o[b+2]<<8|o[b+3];for(let a=16;a<64;a++){let b=m(n[a-15],7)^m(n[a-15],18)^n[a-15]>>>3,c=m(n[a-2],17)^m(n[a-2],19)^n[a-2]>>>10;n[a]=n[a-16]+b+n[a-7]+c|0}let a=b,j=c,p=d,q=e,r=f,s=g,t=h,u=i;for(let b=0;b<64;b++){let c=u+(m(r,6)^m(r,11)^m(r,25))+(r&s^~r&t)+l[b]+n[b]|0,d=(m(a,2)^m(a,13)^m(a,22))+(a&j^a&p^j&p)|0;u=t,t=s,s=r,r=q+c|0,q=p,p=j,j=a,a=c+d|0}b=b+a|0,c=c+j|0,d=d+p|0,e=e+q|0,f=f+r|0,g=g+s|0,h=h+t|0,i=i+u|0,k=0},"process"),q=eo(a=>{"string"==typeof a&&(a=new TextEncoder().encode(a));for(let b=0;b<a.length;b++)o[k++]=a[b],64===k&&p();j+=a.length},"add"),r=eo(()=>{if(o[k++]=128,64==k&&p(),k+8>64){for(;k<64;)o[k++]=0;p()}for(;k<58;)o[k++]=0;let a=8*j;o[k++]=a/0x10000000000&255,o[k++]=a/0x100000000&255,o[k++]=a>>>24,o[k++]=a>>>16&255,o[k++]=a>>>8&255,o[k++]=255&a,p();let l=new Uint8Array(32);return l[0]=b>>>24,l[1]=b>>>16&255,l[2]=b>>>8&255,l[3]=255&b,l[4]=c>>>24,l[5]=c>>>16&255,l[6]=c>>>8&255,l[7]=255&c,l[8]=d>>>24,l[9]=d>>>16&255,l[10]=d>>>8&255,l[11]=255&d,l[12]=e>>>24,l[13]=e>>>16&255,l[14]=e>>>8&255,l[15]=255&e,l[16]=f>>>24,l[17]=f>>>16&255,l[18]=f>>>8&255,l[19]=255&f,l[20]=g>>>24,l[21]=g>>>16&255,l[22]=g>>>8&255,l[23]=255&g,l[24]=h>>>24,l[25]=h>>>16&255,l[26]=h>>>8&255,l[27]=255&h,l[28]=i>>>24,l[29]=i>>>16&255,l[30]=i>>>8&255,l[31]=255&i,l},"digest");return void 0===a?{add:q,digest:r}:(q(a),r())}var eY,eZ,e$=ep(()=>{ez(),eo(eX,"sha256")}),e_=ep(()=>{ez(),eo(eY=class a{constructor(){ev(this,"_dataLength",0),ev(this,"_bufferLength",0),ev(this,"_state",new Int32Array(4)),ev(this,"_buffer",new ArrayBuffer(68)),ev(this,"_buffer8"),ev(this,"_buffer32"),this._buffer8=new Uint8Array(this._buffer,0,68),this._buffer32=new Uint32Array(this._buffer,0,17),this.start()}static hashByteArray(a,b=!1){return this.onePassHasher.start().appendByteArray(a).end(b)}static hashStr(a,b=!1){return this.onePassHasher.start().appendStr(a).end(b)}static hashAsciiStr(a,b=!1){return this.onePassHasher.start().appendAsciiStr(a).end(b)}static _hex(b){let c=a.hexChars,d=a.hexOut,e,f,g,h;for(h=0;h<4;h+=1)for(f=8*h,e=b[h],g=0;g<8;g+=2)d[f+1+g]=c.charAt(15&e),e>>>=4,d[f+0+g]=c.charAt(15&e),e>>>=4;return d.join("")}static _md5cycle(a,b){let c=a[0],d=a[1],e=a[2],f=a[3];c+=(d&e|~d&f)+b[0]-0x28955b88|0,f+=((c=(c<<7|c>>>25)+d|0)&d|~c&e)+b[1]-0x173848aa|0,e+=((f=(f<<12|f>>>20)+c|0)&c|~f&d)+b[2]+0x242070db|0,d+=((e=(e<<17|e>>>15)+f|0)&f|~e&c)+b[3]-0x3e423112|0,c+=((d=(d<<22|d>>>10)+e|0)&e|~d&f)+b[4]-0xa83f051|0,f+=((c=(c<<7|c>>>25)+d|0)&d|~c&e)+b[5]+0x4787c62a|0,e+=((f=(f<<12|f>>>20)+c|0)&c|~f&d)+b[6]-0x57cfb9ed|0,d+=((e=(e<<17|e>>>15)+f|0)&f|~e&c)+b[7]-0x2b96aff|0,c+=((d=(d<<22|d>>>10)+e|0)&e|~d&f)+b[8]+0x698098d8|0,f+=((c=(c<<7|c>>>25)+d|0)&d|~c&e)+b[9]-0x74bb0851|0,e+=((f=(f<<12|f>>>20)+c|0)&c|~f&d)+b[10]-42063|0,d+=((e=(e<<17|e>>>15)+f|0)&f|~e&c)+b[11]-0x76a32842|0,c+=((d=(d<<22|d>>>10)+e|0)&e|~d&f)+b[12]+0x6b901122|0,f+=((c=(c<<7|c>>>25)+d|0)&d|~c&e)+b[13]-0x2678e6d|0,e+=((f=(f<<12|f>>>20)+c|0)&c|~f&d)+b[14]-0x5986bc72|0,d+=((e=(e<<17|e>>>15)+f|0)&f|~e&c)+b[15]+0x49b40821|0,c+=((d=(d<<22|d>>>10)+e|0)&f|e&~f)+b[1]-0x9e1da9e|0,f+=((c=(c<<5|c>>>27)+d|0)&e|d&~e)+b[6]-0x3fbf4cc0|0,e+=((f=(f<<9|f>>>23)+c|0)&d|c&~d)+b[11]+0x265e5a51|0,d+=((e=(e<<14|e>>>18)+f|0)&c|f&~c)+b[0]-0x16493856|0,c+=((d=(d<<20|d>>>12)+e|0)&f|e&~f)+b[5]-0x29d0efa3|0,f+=((c=(c<<5|c>>>27)+d|0)&e|d&~e)+b[10]+0x2441453|0,e+=((f=(f<<9|f>>>23)+c|0)&d|c&~d)+b[15]-0x275e197f|0,d+=((e=(e<<14|e>>>18)+f|0)&c|f&~c)+b[4]-0x182c0438|0,c+=((d=(d<<20|d>>>12)+e|0)&f|e&~f)+b[9]+0x21e1cde6|0,f+=((c=(c<<5|c>>>27)+d|0)&e|d&~e)+b[14]-0x3cc8f82a|0,e+=((f=(f<<9|f>>>23)+c|0)&d|c&~d)+b[3]-0xb2af279|0,d+=((e=(e<<14|e>>>18)+f|0)&c|f&~c)+b[8]+0x455a14ed|0,c+=((d=(d<<20|d>>>12)+e|0)&f|e&~f)+b[13]-0x561c16fb|0,f+=((c=(c<<5|c>>>27)+d|0)&e|d&~e)+b[2]-0x3105c08|0,e+=((f=(f<<9|f>>>23)+c|0)&d|c&~d)+b[7]+0x676f02d9|0,d+=((e=(e<<14|e>>>18)+f|0)&c|f&~c)+b[12]-0x72d5b376|0,c+=((d=(d<<20|d>>>12)+e|0)^e^f)+b[5]-378558|0,f+=((c=(c<<4|c>>>28)+d|0)^d^e)+b[8]-0x788e097f|0,e+=((f=(f<<11|f>>>21)+c|0)^c^d)+b[11]+0x6d9d6122|0,d+=((e=(e<<16|e>>>16)+f|0)^f^c)+b[14]-0x21ac7f4|0,c+=((d=(d<<23|d>>>9)+e|0)^e^f)+b[1]-0x5b4115bc|0,f+=((c=(c<<4|c>>>28)+d|0)^d^e)+b[4]+0x4bdecfa9|0,e+=((f=(f<<11|f>>>21)+c|0)^c^d)+b[7]-0x944b4a0|0,d+=((e=(e<<16|e>>>16)+f|0)^f^c)+b[10]-0x41404390|0,c+=((d=(d<<23|d>>>9)+e|0)^e^f)+b[13]+0x289b7ec6|0,f+=((c=(c<<4|c>>>28)+d|0)^d^e)+b[0]-0x155ed806|0,e+=((f=(f<<11|f>>>21)+c|0)^c^d)+b[3]-0x2b10cf7b|0,d+=((e=(e<<16|e>>>16)+f|0)^f^c)+b[6]+0x4881d05|0,c+=((d=(d<<23|d>>>9)+e|0)^e^f)+b[9]-0x262b2fc7|0,f+=((c=(c<<4|c>>>28)+d|0)^d^e)+b[12]-0x1924661b|0,e+=((f=(f<<11|f>>>21)+c|0)^c^d)+b[15]+0x1fa27cf8|0,d+=((e=(e<<16|e>>>16)+f|0)^f^c)+b[2]-0x3b53a99b|0,d=(d<<23|d>>>9)+e|0,c+=(e^(d|~f))+b[0]-0xbd6ddbc|0,c=(c<<6|c>>>26)+d|0,f+=(d^(c|~e))+b[7]+0x432aff97|0,f=(f<<10|f>>>22)+c|0,e+=(c^(f|~d))+b[14]-0x546bdc59|0,e=(e<<15|e>>>17)+f|0,d+=(f^(e|~c))+b[5]-0x36c5fc7|0,d=(d<<21|d>>>11)+e|0,c+=(e^(d|~f))+b[12]+0x655b59c3|0,c=(c<<6|c>>>26)+d|0,f+=(d^(c|~e))+b[3]-0x70f3336e|0,f=(f<<10|f>>>22)+c|0,e+=(c^(f|~d))+b[10]-1051523|0,e=(e<<15|e>>>17)+f|0,d+=(f^(e|~c))+b[1]-0x7a7ba22f|0,d=(d<<21|d>>>11)+e|0,c+=(e^(d|~f))+b[8]+0x6fa87e4f|0,c=(c<<6|c>>>26)+d|0,f+=(d^(c|~e))+b[15]-0x1d31920|0,f=(f<<10|f>>>22)+c|0,e+=(c^(f|~d))+b[6]-0x5cfebcec|0,e=(e<<15|e>>>17)+f|0,d+=(f^(e|~c))+b[13]+0x4e0811a1|0,d=(d<<21|d>>>11)+e|0,c+=(e^(d|~f))+b[4]-0x8ac817e|0,c=(c<<6|c>>>26)+d|0,f+=(d^(c|~e))+b[11]-0x42c50dcb|0,f=(f<<10|f>>>22)+c|0,e+=(c^(f|~d))+b[2]+0x2ad7d2bb|0,e=(e<<15|e>>>17)+f|0,d+=(f^(e|~c))+b[9]-0x14792c6f|0,d=(d<<21|d>>>11)+e|0,a[0]=c+a[0]|0,a[1]=d+a[1]|0,a[2]=e+a[2]|0,a[3]=f+a[3]|0}start(){return this._dataLength=0,this._bufferLength=0,this._state.set(a.stateIdentity),this}appendStr(b){let c=this._buffer8,d=this._buffer32,e=this._bufferLength,f,g;for(g=0;g<b.length;g+=1){if((f=b.charCodeAt(g))<128)c[e++]=f;else if(f<2048)c[e++]=(f>>>6)+192,c[e++]=63&f|128;else if(f<55296||f>56319)c[e++]=(f>>>12)+224,c[e++]=f>>>6&63|128,c[e++]=63&f|128;else{if((f=(f-55296)*1024+(b.charCodeAt(++g)-56320)+65536)>1114111)throw Error("Unicode standard supports code points up to U+10FFFF");c[e++]=(f>>>18)+240,c[e++]=f>>>12&63|128,c[e++]=f>>>6&63|128,c[e++]=63&f|128}e>=64&&(this._dataLength+=64,a._md5cycle(this._state,d),e-=64,d[0]=d[16])}return this._bufferLength=e,this}appendAsciiStr(b){let c=this._buffer8,d=this._buffer32,e=this._bufferLength,f,g=0;for(;;){for(f=Math.min(b.length-g,64-e);f--;)c[e++]=b.charCodeAt(g++);if(e<64)break;this._dataLength+=64,a._md5cycle(this._state,d),e=0}return this._bufferLength=e,this}appendByteArray(b){let c=this._buffer8,d=this._buffer32,e=this._bufferLength,f,g=0;for(;;){for(f=Math.min(b.length-g,64-e);f--;)c[e++]=b[g++];if(e<64)break;this._dataLength+=64,a._md5cycle(this._state,d),e=0}return this._bufferLength=e,this}getState(){let a=this._state;return{buffer:String.fromCharCode.apply(null,Array.from(this._buffer8)),buflen:this._bufferLength,length:this._dataLength,state:[a[0],a[1],a[2],a[3]]}}setState(a){let b=a.buffer,c=a.state,d=this._state,e;for(this._dataLength=a.length,this._bufferLength=a.buflen,d[0]=c[0],d[1]=c[1],d[2]=c[2],d[3]=c[3],e=0;e<b.length;e+=1)this._buffer8[e]=b.charCodeAt(e)}end(b=!1){let c=this._bufferLength,d=this._buffer8,e=this._buffer32,f=(c>>2)+1;this._dataLength+=c;let g=8*this._dataLength;if(d[c]=128,d[c+1]=d[c+2]=d[c+3]=0,e.set(a.buffer32Identity.subarray(f),f),c>55&&(a._md5cycle(this._state,e),e.set(a.buffer32Identity)),g<=0xffffffff)e[14]=g;else{let a=g.toString(16).match(/(.*?)(.{0,8})$/);if(null===a)return;let b=parseInt(a[2],16),c=parseInt(a[1],16)||0;e[14]=b,e[15]=c}return a._md5cycle(this._state,e),b?this._state:a._hex(this._state)}},"Md5"),ev(eY,"stateIdentity",new Int32Array([0x67452301,-0x10325477,-0x67452302,0x10325476])),ev(eY,"buffer32Identity",new Int32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])),ev(eY,"hexChars","0123456789abcdef"),ev(eY,"hexOut",[]),ev(eY,"onePassHasher",new eY),eZ=eY}),e0={};function e1(a){return crypto.getRandomValues(eg.alloc(a))}function e2(a){if("sha256"===a)return{update:eo(function(a){return{digest:eo(function(){return eg.from(eX(a))},"digest")}},"update")};if("md5"===a)return{update:eo(function(a){return{digest:eo(function(){return"string"==typeof a?eZ.hashStr(a):eZ.hashByteArray(a)},"digest")}},"update")};throw Error(`Hash type '${a}' not supported`)}function e3(a,b){if("sha256"!==a)throw Error(`\
Only sha256 is supported (requested: '${a}')`);return{update:eo(function(a){return{digest:eo(function(){"string"==typeof b&&(b=new TextEncoder().encode(b)),"string"==typeof a&&(a=new TextEncoder().encode(a));let c=b.length;if(c>64)b=eX(b);else if(c<64){let a=new Uint8Array(64);a.set(b),b=a}let d=new Uint8Array(64),e=new Uint8Array(64);for(let a=0;a<64;a++)d[a]=54^b[a],e[a]=92^b[a];let f=new Uint8Array(a.length+64);f.set(d,0),f.set(a,64);let g=new Uint8Array(96);return g.set(e,0),g.set(eX(f),64),eg.from(eX(g))},"digest")}},"update")}}er(e0,{createHash:()=>e2,createHmac:()=>e3,randomBytes:()=>e1});var e4=ep(()=>{ez(),e$(),e_(),eo(e1,"randomBytes"),eo(e2,"createHash"),eo(e3,"createHmac")}),e5=eq((a,b)=>{ez(),b.exports={host:"localhost",user:"win32"===eh.platform?eh.env.USERNAME:eh.env.USER,database:void 0,password:null,connectionString:void 0,port:5432,rows:0,binary:!1,max:10,idleTimeoutMillis:3e4,client_encoding:"",ssl:!1,application_name:void 0,fallback_application_name:void 0,options:void 0,parseInputDatesAsUTC:!1,statement_timeout:!1,lock_timeout:!1,idle_in_transaction_session_timeout:!1,query_timeout:!1,connect_timeout:0,keepalives:1,keepalives_idle:0};var c=eV(),d=c.getTypeParser(20,"text"),e=c.getTypeParser(1016,"text");b.exports.__defineSetter__("parseInt8",function(a){c.setTypeParser(20,"text",a?c.getTypeParser(23,"text"):d),c.setTypeParser(1016,"text",a?c.getTypeParser(1007,"text"):e)})}),e6=eq((a,b)=>{ez();var c=(e4(),eu(e0)),d=e5();function e(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'}function f(a){for(var b="{",c=0;c<a.length;c++)c>0&&(b+=","),null===a[c]||typeof a[c]>"u"?b+="NULL":Array.isArray(a[c])?b+=f(a[c]):a[c]instanceof eg?b+="\\\\x"+a[c].toString("hex"):b+=e(g(a[c]));return b+"}"}eo(e,"escapeElement"),eo(f,"arrayString");var g=eo(function(a,b){if(null==a)return null;if(a instanceof eg)return a;if(ArrayBuffer.isView(a)){var c=eg.from(a.buffer,a.byteOffset,a.byteLength);return c.length===a.byteLength?c:c.slice(a.byteOffset,a.byteOffset+a.byteLength)}return a instanceof Date?d.parseInputDatesAsUTC?k(a):j(a):Array.isArray(a)?f(a):"object"==typeof a?h(a,b):a.toString()},"prepareValue");function h(a,b){if(a&&"function"==typeof a.toPostgres){if(-1!==(b=b||[]).indexOf(a))throw Error('circular reference detected while preparing "'+a+'" for query');return b.push(a),g(a.toPostgres(g),b)}return JSON.stringify(a)}function i(a,b){for(a=""+a;a.length<b;)a="0"+a;return a}function j(a){var b=-a.getTimezoneOffset(),c=a.getFullYear(),d=c<1;d&&(c=Math.abs(c)+1);var e=i(c,4)+"-"+i(a.getMonth()+1,2)+"-"+i(a.getDate(),2)+"T"+i(a.getHours(),2)+":"+i(a.getMinutes(),2)+":"+i(a.getSeconds(),2)+"."+i(a.getMilliseconds(),3);return b<0?(e+="-",b*=-1):e+="+",e+=i(Math.floor(b/60),2)+":"+i(b%60,2),d&&(e+=" BC"),e}function k(a){var b=a.getUTCFullYear(),c=b<1;c&&(b=Math.abs(b)+1);var d=i(b,4)+"-"+i(a.getUTCMonth()+1,2)+"-"+i(a.getUTCDate(),2)+"T"+i(a.getUTCHours(),2)+":"+i(a.getUTCMinutes(),2)+":"+i(a.getUTCSeconds(),2)+"."+i(a.getUTCMilliseconds(),3);return d+="+00:00",c&&(d+=" BC"),d}function l(a,b,c){return a="string"==typeof a?{text:a}:a,b&&("function"==typeof b?a.callback=b:a.values=b),c&&(a.callback=c),a}eo(h,"prepareObject"),eo(i,"pad"),eo(j,"dateToString"),eo(k,"dateToStringUTC"),eo(l,"normalizeQueryConfig");var m=eo(function(a){return c.createHash("md5").update(a,"utf-8").digest("hex")},"md5"),n=eo(function(a,b,c){var d=m(b+a);return"md5"+m(eg.concat([eg.from(d),c]))},"postgresMd5PasswordHash");b.exports={prepareValue:eo(function(a){return g(a)},"prepareValueWrapper"),normalizeQueryConfig:l,postgresMd5PasswordHash:n,md5:m}}),e7={};er(e7,{default:()=>e8});var e8,e9=ep(()=>{ez(),e8={}}),fa=eq((a,b)=>{ez();var c=(e4(),eu(e0));function d(a){if(-1===a.indexOf("SCRAM-SHA-256"))throw Error("SASL: Only mechanism SCRAM-SHA-256 is currently supported");let b=c.randomBytes(18).toString("base64");return{mechanism:"SCRAM-SHA-256",clientNonce:b,response:"n,,n=*,r="+b,message:"SASLInitialResponse"}}function e(a,b,c){if("SASLInitialResponse"!==a.message)throw Error("SASL: Last message was not SASLInitialResponse");if("string"!=typeof b)throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: client password must be a string");if("string"!=typeof c)throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: serverData must be a string");let d=j(c);if(d.nonce.startsWith(a.clientNonce)){if(d.nonce.length===a.clientNonce.length)throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short")}else throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");var e=o(b,eg.from(d.salt,"base64"),d.iteration),f=n(e,"Client Key"),g=m(f),h="n=*,r="+a.clientNonce,i="r="+d.nonce+",s="+d.salt+",i="+d.iteration,k="c=biws,r="+d.nonce,p=h+","+i+","+k,q=l(f,n(g,p)).toString("base64"),r=n(e,"Server Key"),s=n(r,p);a.message="SASLResponse",a.serverSignature=s.toString("base64"),a.response=k+",p="+q}function f(a,b){if("SASLResponse"!==a.message)throw Error("SASL: Last message was not SASLResponse");if("string"!=typeof b)throw Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: serverData must be a string");let{serverSignature:c}=k(b);if(c!==a.serverSignature)throw Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature does not match")}function g(a){if("string"!=typeof a)throw TypeError("SASL: text must be a string");return a.split("").map((b,c)=>a.charCodeAt(c)).every(a=>a>=33&&a<=43||a>=45&&a<=126)}function h(a){return/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(a)}function i(a){if("string"!=typeof a)throw TypeError("SASL: attribute pairs text must be a string");return new Map(a.split(",").map(a=>{if(!/^.=/.test(a))throw Error("SASL: Invalid attribute pair entry");return[a[0],a.substring(2)]}))}function j(a){let b=i(a),c=b.get("r");if(c){if(!g(c))throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce must only contain printable characters")}else throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing");let d=b.get("s");if(d){if(!h(d))throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt must be base64")}else throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing");let e=b.get("i");if(e){if(!/^[1-9][0-9]*$/.test(e))throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: invalid iteration count")}else throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: iteration missing");return{nonce:c,salt:d,iteration:parseInt(e,10)}}function k(a){let b=i(a).get("v");if(b){if(!h(b))throw Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature must be base64")}else throw Error("SASL: SCRAM-SERVER-FINAL-MESSAGE: server signature is missing");return{serverSignature:b}}function l(a,b){if(!eg.isBuffer(a))throw TypeError("first argument must be a Buffer");if(!eg.isBuffer(b))throw TypeError("second argument must be a Buffer");if(a.length!==b.length)throw Error("Buffer lengths must match");if(0===a.length)throw Error("Buffers cannot be empty");return eg.from(a.map((c,d)=>a[d]^b[d]))}function m(a){return c.createHash("sha256").update(a).digest()}function n(a,b){return c.createHmac("sha256",a).update(b).digest()}function o(a,b,c){for(var d=n(a,eg.concat([b,eg.from([0,0,0,1])])),e=d,f=0;f<c-1;f++)e=l(e,d=n(a,d));return e}eo(d,"startSession"),eo(e,"continueSession"),eo(f,"finalizeSession"),eo(g,"isPrintableChars"),eo(h,"isBase64"),eo(i,"parseAttributePairs"),eo(j,"parseServerFirstMessage"),eo(k,"parseServerFinalMessage"),eo(l,"xorBuffers"),eo(m,"sha256"),eo(n,"hmacSha256"),eo(o,"Hi"),b.exports={startSession:d,continueSession:e,finalizeSession:f}}),fb={};function fc(...a){return a.join("/")}er(fb,{join:()=>fc});var fd=ep(()=>{ez(),eo(fc,"join")}),fe={};function ff(a,b){b(Error("No filesystem"))}er(fe,{stat:()=>ff});var fg=ep(()=>{ez(),eo(ff,"stat")}),fh={};er(fh,{default:()=>fi});var fi,fj=ep(()=>{ez(),fi={}}),fk={};er(fk,{StringDecoder:()=>fm});var fl,fm,fn=ep(()=>{ez(),eo(fl=class{constructor(a){ev(this,"td"),this.td=new TextDecoder(a)}write(a){return this.td.decode(a,{stream:!0})}end(a){return this.td.decode(a)}},"StringDecoder"),fm=fl}),fo=eq((a,b)=>{ez();var{Transform:c}=(fj(),eu(fh)),{StringDecoder:d}=(fn(),eu(fk)),e=Symbol("last"),f=Symbol("decoder");function g(a,b,c){let d;if(this.overflow){if(1===(d=this[f].write(a).split(this.matcher)).length)return c();d.shift(),this.overflow=!1}else this[e]+=this[f].write(a),d=this[e].split(this.matcher);this[e]=d.pop();for(let a=0;a<d.length;a++)try{i(this,this.mapper(d[a]))}catch(a){return c(a)}(this.overflow=this[e].length>this.maxLength,this.overflow&&!this.skipOverflow)?c(Error("maximum buffer reached")):c()}function h(a){if(this[e]+=this[f].end(),this[e])try{i(this,this.mapper(this[e]))}catch(b){return a(b)}a()}function i(a,b){void 0!==b&&a.push(b)}function j(a){return a}function k(a,b,i){switch(a=a||/\r?\n/,b=b||j,i=i||{},arguments.length){case 1:"function"==typeof a?(b=a,a=/\r?\n/):"object"!=typeof a||a instanceof RegExp||a[Symbol.split]||(i=a,a=/\r?\n/);break;case 2:"function"==typeof a?(i=b,b=a,a=/\r?\n/):"object"==typeof b&&(i=b,b=j)}(i=Object.assign({},i)).autoDestroy=!0,i.transform=g,i.flush=h,i.readableObjectMode=!0;let k=new c(i);return k[e]="",k[f]=new d("utf8"),k.matcher=a,k.mapper=b,k.maxLength=i.maxLength,k.skipOverflow=i.skipOverflow||!1,k.overflow=!1,k._destroy=function(a,b){this._writableState.errorEmitted=!1,b(a)},k}eo(g,"transform"),eo(h,"flush"),eo(i,"push"),eo(j,"noop"),eo(k,"split"),b.exports=k}),fp=eq((a,b)=>{ez();var c=(fd(),eu(fb)),d=(fj(),eu(fh)).Stream,e=fo(),f=(e9(),eu(e7)),g="win32"===eh.platform,h=eh.stderr;function i(a){return(61440&a)==32768}eo(i,"isRegFile");var j=["host","port","database","user","password"],k=j.length,l=j[k-1];function m(){if(h instanceof d&&!0===h.writable){var a=Array.prototype.slice.call(arguments).concat(`
`);h.write(f.format.apply(f,a))}}eo(m,"warn"),Object.defineProperty(b.exports,"isWin",{get:eo(function(){return g},"get"),set:eo(function(a){g=a},"set")}),b.exports.warnTo=function(a){var b=h;return h=a,b},b.exports.getFileName=function(a){var b=a||eh.env;return b.PGPASSFILE||(g?c.join(b.APPDATA||"./","postgresql","pgpass.conf"):c.join(b.HOME||"./",".pgpass"))},b.exports.usePgPass=function(a,b){return!Object.prototype.hasOwnProperty.call(eh.env,"PGPASSWORD")&&(!!g||(b=b||"<unkn>",i(a.mode)?!(63&a.mode)||(m('WARNING: password file "%s" has group or world access; permissions should be u=rw (0600) or less',b),!1):(m('WARNING: password file "%s" is not a plain file',b),!1)))};var n=b.exports.match=function(a,b){return j.slice(0,-1).reduce(function(c,d,e){return 1==e&&Number(a[d]||5432)===Number(b[d])?c&&!0:c&&("*"===b[d]||b[d]===a[d])},!0)};b.exports.getPassword=function(a,b,c){var d,f=b.pipe(e());function g(b){var c=o(b);c&&p(c)&&n(a,c)&&(d=c[l],f.end())}eo(g,"onLine");var h=eo(function(){b.destroy(),c(d)},"onEnd"),i=eo(function(a){b.destroy(),m("WARNING: error on reading file: %s",a),c(void 0)},"onErr");b.on("error",i),f.on("data",g).on("end",h).on("error",i)};var o=b.exports.parseLine=function(a){if(a.length<11||a.match(/^\s+#/))return null;for(var b="",c="",d=0,e=0,f={},g=eo(function(b,c,d){var e=a.substring(c,d);Object.hasOwnProperty.call(eh.env,"PGPASS_NO_DEESCAPE")||(e=e.replace(/\\([:\\])/g,"$1")),f[j[b]]=e},"addToObj"),h=0;h<a.length-1;h+=1){if(b=a.charAt(h+1),c=a.charAt(h),d==k-1){g(d,e);break}h>=0&&":"==b&&"\\"!==c&&(g(d,e,h+1),e=h+2,d+=1)}return f=Object.keys(f).length===k?f:null},p=b.exports.isValidEntry=function(a){for(var b={0:function(a){return a.length>0},1:function(a){return"*"===a||isFinite(a=Number(a))&&a>0&&a<0x20000000000000&&Math.floor(a)===a},2:function(a){return a.length>0},3:function(a){return a.length>0},4:function(a){return a.length>0}},c=0;c<j.length;c+=1)if(!(0,b[c])(a[j[c]]||""))return!1;return!0}}),fq=eq((a,b)=>{ez(),fd(),eu(fb);var c=(fg(),eu(fe)),d=fp();b.exports=function(a,b){var e=d.getFileName();c.stat(e,function(f,g){if(f||!d.usePgPass(g,e))return b(void 0);var h=c.createReadStream(e);d.getPassword(a,h,b)})},b.exports.warnTo=d.warnTo}),fr={};er(fr,{default:()=>fs});var fs,ft=ep(()=>{ez(),fs={}}),fu=eq((a,b)=>{ez();var c=(eK(),eu(eI)),d=(fg(),eu(fe));function e(a){if("/"===a.charAt(0)){var b=a.split(" ");return{host:b[0],database:b[1]}}var e=c.parse(/ |%[^a-f0-9]|%[a-f0-9][^a-f0-9]/i.test(a)?encodeURI(a).replace(/\%25(\d\d)/g,"%$1"):a,!0),b=e.query;for(var f in b)Array.isArray(b[f])&&(b[f]=b[f][b[f].length-1]);var g=(e.auth||":").split(":");if(b.user=g[0],b.password=g.splice(1).join(":"),b.port=e.port,"socket:"==e.protocol)return b.host=decodeURI(e.pathname),b.database=e.query.db,b.client_encoding=e.query.encoding,b;b.host||(b.host=e.hostname);var h=e.pathname;if(!b.host&&h&&/^%2f/i.test(h)){var i=h.split("/");b.host=decodeURIComponent(i[0]),h=i.splice(1).join("/")}switch(h&&"/"===h.charAt(0)&&(h=h.slice(1)||null),b.database=h&&decodeURI(h),("true"===b.ssl||"1"===b.ssl)&&(b.ssl=!0),"0"===b.ssl&&(b.ssl=!1),(b.sslcert||b.sslkey||b.sslrootcert||b.sslmode)&&(b.ssl={}),b.sslcert&&(b.ssl.cert=d.readFileSync(b.sslcert).toString()),b.sslkey&&(b.ssl.key=d.readFileSync(b.sslkey).toString()),b.sslrootcert&&(b.ssl.ca=d.readFileSync(b.sslrootcert).toString()),b.sslmode){case"disable":b.ssl=!1;break;case"prefer":case"require":case"verify-ca":case"verify-full":break;case"no-verify":b.ssl.rejectUnauthorized=!1}return b}eo(e,"parse"),b.exports=e,e.parse=e}),fv=eq((a,b)=>{ez();var c=(ft(),eu(fr)),d=e5(),e=fu().parse,f=eo(function(a,b,c){return void 0===c?c=eh.env["PG"+a.toUpperCase()]:!1===c||(c=eh.env[c]),b[a]||c||d[a]},"val"),g=eo(function(){switch(eh.env.PGSSLMODE){case"disable":return!1;case"prefer":case"require":case"verify-ca":case"verify-full":return!0;case"no-verify":return{rejectUnauthorized:!1}}return d.ssl},"readSSLConfigFromEnvironment"),h=eo(function(a){return"'"+(""+a).replace(/\\/g,"\\\\").replace(/'/g,"\\'")+"'"},"quoteParamValue"),i=eo(function(a,b,c){var d=b[c];null!=d&&a.push(c+"="+h(d))},"add"),j=class{constructor(a){(a="string"==typeof a?e(a):a||{}).connectionString&&(a=Object.assign({},a,e(a.connectionString))),this.user=f("user",a),this.database=f("database",a),void 0===this.database&&(this.database=this.user),this.port=parseInt(f("port",a),10),this.host=f("host",a),Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:f("password",a)}),this.binary=f("binary",a),this.options=f("options",a),this.ssl=typeof a.ssl>"u"?g():a.ssl,"string"==typeof this.ssl&&"true"===this.ssl&&(this.ssl=!0),"no-verify"===this.ssl&&(this.ssl={rejectUnauthorized:!1}),this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this.client_encoding=f("client_encoding",a),this.replication=f("replication",a),this.isDomainSocket=!(this.host||"").indexOf("/"),this.application_name=f("application_name",a,"PGAPPNAME"),this.fallback_application_name=f("fallback_application_name",a,!1),this.statement_timeout=f("statement_timeout",a,!1),this.lock_timeout=f("lock_timeout",a,!1),this.idle_in_transaction_session_timeout=f("idle_in_transaction_session_timeout",a,!1),this.query_timeout=f("query_timeout",a,!1),void 0===a.connectionTimeoutMillis?this.connect_timeout=eh.env.PGCONNECT_TIMEOUT||0:this.connect_timeout=Math.floor(a.connectionTimeoutMillis/1e3),!1===a.keepAlive?this.keepalives=0:!0===a.keepAlive&&(this.keepalives=1),"number"==typeof a.keepAliveInitialDelayMillis&&(this.keepalives_idle=Math.floor(a.keepAliveInitialDelayMillis/1e3))}getLibpqConnectionString(a){var b=[];i(b,this,"user"),i(b,this,"password"),i(b,this,"port"),i(b,this,"application_name"),i(b,this,"fallback_application_name"),i(b,this,"connect_timeout"),i(b,this,"options");var d="object"==typeof this.ssl?this.ssl:this.ssl?{sslmode:this.ssl}:{};if(i(b,d,"sslmode"),i(b,d,"sslca"),i(b,d,"sslkey"),i(b,d,"sslcert"),i(b,d,"sslrootcert"),this.database&&b.push("dbname="+h(this.database)),this.replication&&b.push("replication="+h(this.replication)),this.host&&b.push("host="+h(this.host)),this.isDomainSocket)return a(null,b.join(" "));this.client_encoding&&b.push("client_encoding="+h(this.client_encoding)),c.lookup(this.host,function(c,d){return c?a(c,null):(b.push("hostaddr="+h(d)),a(null,b.join(" ")))})}};eo(j,"ConnectionParameters"),b.exports=j}),fw=eq((a,b)=>{ez();var c=eV(),d=/^([A-Za-z]+)(?: (\d+))?(?: (\d+))?/,e=class{constructor(a,b){this.command=null,this.rowCount=null,this.oid=null,this.rows=[],this.fields=[],this._parsers=void 0,this._types=b,this.RowCtor=null,this.rowAsArray="array"===a,this.rowAsArray&&(this.parseRow=this._parseRowAsArray)}addCommandComplete(a){var b;(b=a.text?d.exec(a.text):d.exec(a.command))&&(this.command=b[1],b[3]?(this.oid=parseInt(b[2],10),this.rowCount=parseInt(b[3],10)):b[2]&&(this.rowCount=parseInt(b[2],10)))}_parseRowAsArray(a){for(var b=Array(a.length),c=0,d=a.length;c<d;c++){var e=a[c];null!==e?b[c]=this._parsers[c](e):b[c]=null}return b}parseRow(a){for(var b={},c=0,d=a.length;c<d;c++){var e=a[c],f=this.fields[c].name;null!==e?b[f]=this._parsers[c](e):b[f]=null}return b}addRow(a){this.rows.push(a)}addFields(a){this.fields=a,this.fields.length&&(this._parsers=Array(a.length));for(var b=0;b<a.length;b++){var d=a[b];this._types?this._parsers[b]=this._types.getTypeParser(d.dataTypeID,d.format||"text"):this._parsers[b]=c.getTypeParser(d.dataTypeID,d.format||"text")}}};eo(e,"Result"),b.exports=e}),fx=eq((a,b)=>{ez();var{EventEmitter:c}=eA(),d=fw(),e=e6(),f=class extends c{constructor(a,b,c){super(),a=e.normalizeQueryConfig(a,b,c),this.text=a.text,this.values=a.values,this.rows=a.rows,this.types=a.types,this.name=a.name,this.binary=a.binary,this.portal=a.portal||"",this.callback=a.callback,this._rowMode=a.rowMode,eh.domain&&a.callback&&(this.callback=eh.domain.bind(a.callback)),this._result=new d(this._rowMode,this.types),this._results=this._result,this.isPreparedStatement=!1,this._canceledDueToError=!1,this._promise=null}requiresPreparation(){return!!this.name||!!this.rows||!!this.text&&!!this.values&&this.values.length>0}_checkForMultirow(){this._result.command&&(Array.isArray(this._results)||(this._results=[this._result]),this._result=new d(this._rowMode,this.types),this._results.push(this._result))}handleRowDescription(a){this._checkForMultirow(),this._result.addFields(a.fields),this._accumulateRows=this.callback||!this.listeners("row").length}handleDataRow(a){let b;if(!this._canceledDueToError){try{b=this._result.parseRow(a.fields)}catch(a){this._canceledDueToError=a;return}this.emit("row",b,this._result),this._accumulateRows&&this._result.addRow(b)}}handleCommandComplete(a,b){this._checkForMultirow(),this._result.addCommandComplete(a),this.rows&&b.sync()}handleEmptyQuery(a){this.rows&&a.sync()}handleError(a,b){if(this._canceledDueToError&&(a=this._canceledDueToError,this._canceledDueToError=!1),this.callback)return this.callback(a);this.emit("error",a)}handleReadyForQuery(a){if(this._canceledDueToError)return this.handleError(this._canceledDueToError,a);if(this.callback)try{this.callback(null,this._results)}catch(a){eh.nextTick(()=>{throw a})}this.emit("end",this._results)}submit(a){if("string"!=typeof this.text&&"string"!=typeof this.name)return Error("A query must have either text or a name. Supplying neither is unsupported.");let b=a.parsedStatements[this.name];return this.text&&b&&this.text!==b?Error(`Prepared statements must be unique - '${this.name}\
' was used for a different statement`):this.values&&!Array.isArray(this.values)?Error("Query values must be an array"):(this.requiresPreparation()?this.prepare(a):a.query(this.text),null)}hasBeenParsed(a){return this.name&&a.parsedStatements[this.name]}handlePortalSuspended(a){this._getRows(a,this.rows)}_getRows(a,b){a.execute({portal:this.portal,rows:b}),b?a.flush():a.sync()}prepare(a){this.isPreparedStatement=!0,this.hasBeenParsed(a)||a.parse({text:this.text,name:this.name,types:this.types});try{a.bind({portal:this.portal,statement:this.name,values:this.values,binary:this.binary,valueMapper:e.prepareValue})}catch(b){this.handleError(b,a);return}a.describe({type:"P",name:this.portal||""}),this._getRows(a,this.rows)}handleCopyInResponse(a){a.sendCopyFail("No source stream defined")}handleCopyData(a,b){}};eo(f,"Query"),b.exports=f}),fy=eq(a=>{ez(),Object.defineProperty(a,"__esModule",{value:!0}),a.NoticeMessage=a.DataRowMessage=a.CommandCompleteMessage=a.ReadyForQueryMessage=a.NotificationResponseMessage=a.BackendKeyDataMessage=a.AuthenticationMD5Password=a.ParameterStatusMessage=a.ParameterDescriptionMessage=a.RowDescriptionMessage=a.Field=a.CopyResponse=a.CopyDataMessage=a.DatabaseError=a.copyDone=a.emptyQuery=a.replicationStart=a.portalSuspended=a.noData=a.closeComplete=a.bindComplete=a.parseComplete=void 0,a.parseComplete={name:"parseComplete",length:5},a.bindComplete={name:"bindComplete",length:5},a.closeComplete={name:"closeComplete",length:5},a.noData={name:"noData",length:5},a.portalSuspended={name:"portalSuspended",length:5},a.replicationStart={name:"replicationStart",length:4},a.emptyQuery={name:"emptyQuery",length:4},a.copyDone={name:"copyDone",length:4};var b=class extends Error{constructor(a,b,c){super(a),this.length=b,this.name=c}};eo(b,"DatabaseError"),a.DatabaseError=b;var c=class{constructor(a,b){this.length=a,this.chunk=b,this.name="copyData"}};eo(c,"CopyDataMessage"),a.CopyDataMessage=c;var d=class{constructor(a,b,c,d){this.length=a,this.name=b,this.binary=c,this.columnTypes=Array(d)}};eo(d,"CopyResponse"),a.CopyResponse=d;var e=class{constructor(a,b,c,d,e,f,g){this.name=a,this.tableID=b,this.columnID=c,this.dataTypeID=d,this.dataTypeSize=e,this.dataTypeModifier=f,this.format=g}};eo(e,"Field"),a.Field=e;var f=class{constructor(a,b){this.length=a,this.fieldCount=b,this.name="rowDescription",this.fields=Array(this.fieldCount)}};eo(f,"RowDescriptionMessage"),a.RowDescriptionMessage=f;var g=class{constructor(a,b){this.length=a,this.parameterCount=b,this.name="parameterDescription",this.dataTypeIDs=Array(this.parameterCount)}};eo(g,"ParameterDescriptionMessage"),a.ParameterDescriptionMessage=g;var h=class{constructor(a,b,c){this.length=a,this.parameterName=b,this.parameterValue=c,this.name="parameterStatus"}};eo(h,"ParameterStatusMessage"),a.ParameterStatusMessage=h;var i=class{constructor(a,b){this.length=a,this.salt=b,this.name="authenticationMD5Password"}};eo(i,"AuthenticationMD5Password"),a.AuthenticationMD5Password=i;var j=class{constructor(a,b,c){this.length=a,this.processID=b,this.secretKey=c,this.name="backendKeyData"}};eo(j,"BackendKeyDataMessage"),a.BackendKeyDataMessage=j;var k=class{constructor(a,b,c,d){this.length=a,this.processId=b,this.channel=c,this.payload=d,this.name="notification"}};eo(k,"NotificationResponseMessage"),a.NotificationResponseMessage=k;var l=class{constructor(a,b){this.length=a,this.status=b,this.name="readyForQuery"}};eo(l,"ReadyForQueryMessage"),a.ReadyForQueryMessage=l;var m=class{constructor(a,b){this.length=a,this.text=b,this.name="commandComplete"}};eo(m,"CommandCompleteMessage"),a.CommandCompleteMessage=m;var n=class{constructor(a,b){this.length=a,this.fields=b,this.name="dataRow",this.fieldCount=b.length}};eo(n,"DataRowMessage"),a.DataRowMessage=n;var o=class{constructor(a,b){this.length=a,this.message=b,this.name="notice"}};eo(o,"NoticeMessage"),a.NoticeMessage=o}),fz=eq(a=>{ez(),Object.defineProperty(a,"__esModule",{value:!0}),a.Writer=void 0;var b=class{constructor(a=256){this.size=a,this.offset=5,this.headerPosition=0,this.buffer=eg.allocUnsafe(a)}ensure(a){if(this.buffer.length-this.offset<a){let b=this.buffer,c=b.length+(b.length>>1)+a;this.buffer=eg.allocUnsafe(c),b.copy(this.buffer)}}addInt32(a){return this.ensure(4),this.buffer[this.offset++]=a>>>24&255,this.buffer[this.offset++]=a>>>16&255,this.buffer[this.offset++]=a>>>8&255,this.buffer[this.offset++]=a>>>0&255,this}addInt16(a){return this.ensure(2),this.buffer[this.offset++]=a>>>8&255,this.buffer[this.offset++]=a>>>0&255,this}addCString(a){if(a){let b=eg.byteLength(a);this.ensure(b+1),this.buffer.write(a,this.offset,"utf-8"),this.offset+=b}else this.ensure(1);return this.buffer[this.offset++]=0,this}addString(a=""){let b=eg.byteLength(a);return this.ensure(b),this.buffer.write(a,this.offset),this.offset+=b,this}add(a){return this.ensure(a.length),a.copy(this.buffer,this.offset),this.offset+=a.length,this}join(a){if(a){this.buffer[this.headerPosition]=a;let b=this.offset-(this.headerPosition+1);this.buffer.writeInt32BE(b,this.headerPosition+1)}return this.buffer.slice(5*!a,this.offset)}flush(a){let b=this.join(a);return this.offset=5,this.headerPosition=0,this.buffer=eg.allocUnsafe(this.size),b}};eo(b,"Writer"),a.Writer=b}),fA=eq(a=>{ez(),Object.defineProperty(a,"__esModule",{value:!0}),a.serialize=void 0;var b=fz(),c=new b.Writer,d=eo(a=>{for(let b of(c.addInt16(3).addInt16(0),Object.keys(a)))c.addCString(b).addCString(a[b]);c.addCString("client_encoding").addCString("UTF8");let d=c.addCString("").flush(),e=d.length+4;return new b.Writer().addInt32(e).add(d).flush()},"startup"),e=eo(()=>{let a=eg.allocUnsafe(8);return a.writeInt32BE(8,0),a.writeInt32BE(0x4d2162f,4),a},"requestSsl"),f=eo(a=>c.addCString(a).flush(112),"password"),g=eo(function(a,b){return c.addCString(a).addInt32(eg.byteLength(b)).addString(b),c.flush(112)},"sendSASLInitialResponseMessage"),h=eo(function(a){return c.addString(a).flush(112)},"sendSCRAMClientFinalMessage"),i=eo(a=>c.addCString(a).flush(81),"query"),j=[],k=eo(a=>{let b=a.name||"";b.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",b,b.length),console.error("This can cause conflicts and silent errors executing queries"));let d=a.types||j,e=d.length,f=c.addCString(b).addCString(a.text).addInt16(e);for(let a=0;a<e;a++)f.addInt32(d[a]);return c.flush(80)},"parse"),l=new b.Writer,m=eo(function(a,b){for(let d=0;d<a.length;d++){let e=b?b(a[d],d):a[d];null==e?(c.addInt16(0),l.addInt32(-1)):e instanceof eg?(c.addInt16(1),l.addInt32(e.length),l.add(e)):(c.addInt16(0),l.addInt32(eg.byteLength(e)),l.addString(e))}},"writeValues"),n=eo((a={})=>{let b=a.portal||"",d=a.statement||"",e=a.binary||!1,f=a.values||j,g=f.length;return c.addCString(b).addCString(d),c.addInt16(g),m(f,a.valueMapper),c.addInt16(g),c.add(l.flush()),c.addInt16(+!!e),c.flush(66)},"bind"),o=eg.from([69,0,0,0,9,0,0,0,0,0]),p=eo(a=>{if(!a||!a.portal&&!a.rows)return o;let b=a.portal||"",c=a.rows||0,d=eg.byteLength(b),e=4+d+1+4,f=eg.allocUnsafe(1+e);return f[0]=69,f.writeInt32BE(e,1),f.write(b,5,"utf-8"),f[d+5]=0,f.writeUInt32BE(c,f.length-4),f},"execute"),q=eo((a,b)=>{let c=eg.allocUnsafe(16);return c.writeInt32BE(16,0),c.writeInt16BE(1234,4),c.writeInt16BE(5678,6),c.writeInt32BE(a,8),c.writeInt32BE(b,12),c},"cancel"),r=eo((a,b)=>{let c=4+eg.byteLength(b)+1,d=eg.allocUnsafe(1+c);return d[0]=a,d.writeInt32BE(c,1),d.write(b,5,"utf-8"),d[c]=0,d},"cstringMessage"),s=c.addCString("P").flush(68),t=c.addCString("S").flush(68),u=eo(a=>a.name?r(68,`${a.type}${a.name||""}`):"P"===a.type?s:t,"describe"),v=eo(a=>r(67,`${a.type}${a.name||""}`),"close"),w=eo(a=>c.add(a).flush(100),"copyData"),x=eo(a=>r(102,a),"copyFail"),y=eo(a=>eg.from([a,0,0,0,4]),"codeOnlyBuffer"),z=y(72),A=y(83),B=y(88),C=y(99);a.serialize={startup:d,password:f,requestSsl:e,sendSASLInitialResponseMessage:g,sendSCRAMClientFinalMessage:h,query:i,parse:k,bind:n,execute:p,describe:u,close:v,flush:eo(()=>z,"flush"),sync:eo(()=>A,"sync"),end:eo(()=>B,"end"),copyData:w,copyDone:eo(()=>C,"copyDone"),copyFail:x,cancel:q}}),fB=eq(a=>{ez(),Object.defineProperty(a,"__esModule",{value:!0}),a.BufferReader=void 0;var b=eg.allocUnsafe(0),c=class{constructor(a=0){this.offset=a,this.buffer=b,this.encoding="utf-8"}setBuffer(a,b){this.offset=a,this.buffer=b}int16(){let a=this.buffer.readInt16BE(this.offset);return this.offset+=2,a}byte(){let a=this.buffer[this.offset];return this.offset++,a}int32(){let a=this.buffer.readInt32BE(this.offset);return this.offset+=4,a}uint32(){let a=this.buffer.readUInt32BE(this.offset);return this.offset+=4,a}string(a){let b=this.buffer.toString(this.encoding,this.offset,this.offset+a);return this.offset+=a,b}cstring(){let a=this.offset,b=a;for(;0!==this.buffer[b++];);return this.offset=b,this.buffer.toString(this.encoding,a,b-1)}bytes(a){let b=this.buffer.slice(this.offset,this.offset+a);return this.offset+=a,b}};eo(c,"BufferReader"),a.BufferReader=c}),fC=eq(a=>{ez(),Object.defineProperty(a,"__esModule",{value:!0}),a.Parser=void 0;var b=fy(),c=fB(),d=eg.allocUnsafe(0),e=class{constructor(a){if(this.buffer=d,this.bufferLength=0,this.bufferOffset=0,this.reader=new c.BufferReader,a?.mode==="binary")throw Error("Binary mode not supported yet");this.mode=a?.mode||"text"}parse(a,b){this.mergeBuffer(a);let c=this.bufferOffset+this.bufferLength,e=this.bufferOffset;for(;e+5<=c;){let a=this.buffer[e],d=this.buffer.readUInt32BE(e+1),f=1+d;if(f+e<=c)b(this.handlePacket(e+5,a,d,this.buffer)),e+=f;else break}e===c?(this.buffer=d,this.bufferLength=0,this.bufferOffset=0):(this.bufferLength=c-e,this.bufferOffset=e)}mergeBuffer(a){if(this.bufferLength>0){let b=this.bufferLength+a.byteLength;if(b+this.bufferOffset>this.buffer.byteLength){let a;if(b<=this.buffer.byteLength&&this.bufferOffset>=this.bufferLength)a=this.buffer;else{let c=2*this.buffer.byteLength;for(;b>=c;)c*=2;a=eg.allocUnsafe(c)}this.buffer.copy(a,0,this.bufferOffset,this.bufferOffset+this.bufferLength),this.buffer=a,this.bufferOffset=0}a.copy(this.buffer,this.bufferOffset+this.bufferLength),this.bufferLength=b}else this.buffer=a,this.bufferOffset=0,this.bufferLength=a.byteLength}handlePacket(a,c,d,e){switch(c){case 50:return b.bindComplete;case 49:return b.parseComplete;case 51:return b.closeComplete;case 110:return b.noData;case 115:return b.portalSuspended;case 99:return b.copyDone;case 87:return b.replicationStart;case 73:return b.emptyQuery;case 68:return this.parseDataRowMessage(a,d,e);case 67:return this.parseCommandCompleteMessage(a,d,e);case 90:return this.parseReadyForQueryMessage(a,d,e);case 65:return this.parseNotificationMessage(a,d,e);case 82:return this.parseAuthenticationResponse(a,d,e);case 83:return this.parseParameterStatusMessage(a,d,e);case 75:return this.parseBackendKeyData(a,d,e);case 69:return this.parseErrorMessage(a,d,e,"error");case 78:return this.parseErrorMessage(a,d,e,"notice");case 84:return this.parseRowDescriptionMessage(a,d,e);case 116:return this.parseParameterDescriptionMessage(a,d,e);case 71:return this.parseCopyInMessage(a,d,e);case 72:return this.parseCopyOutMessage(a,d,e);case 100:return this.parseCopyData(a,d,e);default:return new b.DatabaseError("received invalid response: "+c.toString(16),d,"error")}}parseReadyForQueryMessage(a,c,d){this.reader.setBuffer(a,d);let e=this.reader.string(1);return new b.ReadyForQueryMessage(c,e)}parseCommandCompleteMessage(a,c,d){this.reader.setBuffer(a,d);let e=this.reader.cstring();return new b.CommandCompleteMessage(c,e)}parseCopyData(a,c,d){let e=d.slice(a,a+(c-4));return new b.CopyDataMessage(c,e)}parseCopyInMessage(a,b,c){return this.parseCopyMessage(a,b,c,"copyInResponse")}parseCopyOutMessage(a,b,c){return this.parseCopyMessage(a,b,c,"copyOutResponse")}parseCopyMessage(a,c,d,e){this.reader.setBuffer(a,d);let f=0!==this.reader.byte(),g=this.reader.int16(),h=new b.CopyResponse(c,e,f,g);for(let a=0;a<g;a++)h.columnTypes[a]=this.reader.int16();return h}parseNotificationMessage(a,c,d){this.reader.setBuffer(a,d);let e=this.reader.int32(),f=this.reader.cstring(),g=this.reader.cstring();return new b.NotificationResponseMessage(c,e,f,g)}parseRowDescriptionMessage(a,c,d){this.reader.setBuffer(a,d);let e=this.reader.int16(),f=new b.RowDescriptionMessage(c,e);for(let a=0;a<e;a++)f.fields[a]=this.parseField();return f}parseField(){let a=this.reader.cstring(),c=this.reader.uint32(),d=this.reader.int16(),e=this.reader.uint32(),f=this.reader.int16(),g=this.reader.int32(),h=0===this.reader.int16()?"text":"binary";return new b.Field(a,c,d,e,f,g,h)}parseParameterDescriptionMessage(a,c,d){this.reader.setBuffer(a,d);let e=this.reader.int16(),f=new b.ParameterDescriptionMessage(c,e);for(let a=0;a<e;a++)f.dataTypeIDs[a]=this.reader.int32();return f}parseDataRowMessage(a,c,d){this.reader.setBuffer(a,d);let e=this.reader.int16(),f=Array(e);for(let a=0;a<e;a++){let b=this.reader.int32();f[a]=-1===b?null:this.reader.string(b)}return new b.DataRowMessage(c,f)}parseParameterStatusMessage(a,c,d){this.reader.setBuffer(a,d);let e=this.reader.cstring(),f=this.reader.cstring();return new b.ParameterStatusMessage(c,e,f)}parseBackendKeyData(a,c,d){this.reader.setBuffer(a,d);let e=this.reader.int32(),f=this.reader.int32();return new b.BackendKeyDataMessage(c,e,f)}parseAuthenticationResponse(a,c,d){this.reader.setBuffer(a,d);let e=this.reader.int32(),f={name:"authenticationOk",length:c};switch(e){case 0:break;case 3:8===f.length&&(f.name="authenticationCleartextPassword");break;case 5:if(12===f.length){f.name="authenticationMD5Password";let a=this.reader.bytes(4);return new b.AuthenticationMD5Password(c,a)}break;case 10:{let a;f.name="authenticationSASL",f.mechanisms=[];do(a=this.reader.cstring())&&f.mechanisms.push(a);while(a)}break;case 11:f.name="authenticationSASLContinue",f.data=this.reader.string(c-8);break;case 12:f.name="authenticationSASLFinal",f.data=this.reader.string(c-8);break;default:throw Error("Unknown authenticationOk message type "+e)}return f}parseErrorMessage(a,c,d,e){this.reader.setBuffer(a,d);let f={},g=this.reader.string(1);for(;"\0"!==g;)f[g]=this.reader.cstring(),g=this.reader.string(1);let h=f.M,i="notice"===e?new b.NoticeMessage(c,h):new b.DatabaseError(h,c,e);return i.severity=f.S,i.code=f.C,i.detail=f.D,i.hint=f.H,i.position=f.P,i.internalPosition=f.p,i.internalQuery=f.q,i.where=f.W,i.schema=f.s,i.table=f.t,i.column=f.c,i.dataType=f.d,i.constraint=f.n,i.file=f.F,i.line=f.L,i.routine=f.R,i}};eo(e,"Parser"),a.Parser=e}),fD=eq(a=>{ez(),Object.defineProperty(a,"__esModule",{value:!0}),a.DatabaseError=a.serialize=a.parse=void 0;var b=fy();Object.defineProperty(a,"DatabaseError",{enumerable:!0,get:eo(function(){return b.DatabaseError},"get")});var c=fA();Object.defineProperty(a,"serialize",{enumerable:!0,get:eo(function(){return c.serialize},"get")});var d=fC();function e(a,b){let c=new d.Parser;return a.on("data",a=>c.parse(a,b)),new Promise(b=>a.on("end",()=>b()))}eo(e,"parse"),a.parse=e}),fE={};function fF({socket:a,servername:b}){return a.startTls(b),a}er(fE,{connect:()=>fF});var fG=ep(()=>{ez(),eo(fF,"connect")}),fH=eq((a,b)=>{ez();var c=(eH(),eu(eB)),d=eA().EventEmitter,{parse:e,serialize:f}=fD(),g=f.flush(),h=f.sync(),i=f.end(),j=class extends d{constructor(a){super(),a=a||{},this.stream=a.stream||new c.Socket,this._keepAlive=a.keepAlive,this._keepAliveInitialDelayMillis=a.keepAliveInitialDelayMillis,this.lastBuffer=!1,this.parsedStatements={},this.ssl=a.ssl||!1,this._ending=!1,this._emitMessage=!1;var b=this;this.on("newListener",function(a){"message"===a&&(b._emitMessage=!0)})}connect(a,b){var d=this;this._connecting=!0,this.stream.setNoDelay(!0),this.stream.connect(a,b),this.stream.once("connect",function(){d._keepAlive&&d.stream.setKeepAlive(!0,d._keepAliveInitialDelayMillis),d.emit("connect")});let e=eo(function(a){d._ending&&("ECONNRESET"===a.code||"EPIPE"===a.code)||d.emit("error",a)},"reportStreamError");if(this.stream.on("error",e),this.stream.on("close",function(){d.emit("end")}),!this.ssl)return this.attachListeners(this.stream);this.stream.once("data",function(a){switch(a.toString("utf8")){case"S":break;case"N":return d.stream.end(),d.emit("error",Error("The server does not support SSL connections"));default:return d.stream.end(),d.emit("error",Error("There was an error establishing an SSL connection"))}var f=(fG(),eu(fE));let g={socket:d.stream};!0!==d.ssl&&(Object.assign(g,d.ssl),"key"in d.ssl&&(g.key=d.ssl.key)),0===c.isIP(b)&&(g.servername=b);try{d.stream=f.connect(g)}catch(a){return d.emit("error",a)}d.attachListeners(d.stream),d.stream.on("error",e),d.emit("sslconnect")})}attachListeners(a){a.on("end",()=>{this.emit("end")}),e(a,a=>{var b="error"===a.name?"errorMessage":a.name;this._emitMessage&&this.emit("message",a),this.emit(b,a)})}requestSsl(){this.stream.write(f.requestSsl())}startup(a){this.stream.write(f.startup(a))}cancel(a,b){this._send(f.cancel(a,b))}password(a){this._send(f.password(a))}sendSASLInitialResponseMessage(a,b){this._send(f.sendSASLInitialResponseMessage(a,b))}sendSCRAMClientFinalMessage(a){this._send(f.sendSCRAMClientFinalMessage(a))}_send(a){return!!this.stream.writable&&this.stream.write(a)}query(a){this._send(f.query(a))}parse(a){this._send(f.parse(a))}bind(a){this._send(f.bind(a))}execute(a){this._send(f.execute(a))}flush(){this.stream.writable&&this.stream.write(g)}sync(){this._ending=!0,this._send(g),this._send(h)}ref(){this.stream.ref()}unref(){this.stream.unref()}end(){return(this._ending=!0,this._connecting&&this.stream.writable)?this.stream.write(i,()=>{this.stream.end()}):void this.stream.end()}close(a){this._send(f.close(a))}describe(a){this._send(f.describe(a))}sendCopyFromChunk(a){this._send(f.copyData(a))}endCopyFrom(){this._send(f.copyDone())}sendCopyFail(a){this._send(f.copyFail(a))}};eo(j,"Connection"),b.exports=j}),fI=eq((a,b)=>{ez();var c=eA().EventEmitter,d=(e9(),eu(e7),e6()),e=fa(),f=fq(),g=eW(),h=fv(),i=fx(),j=e5(),k=fH(),l=class extends c{constructor(a){super(),this.connectionParameters=new h(a),this.user=this.connectionParameters.user,this.database=this.connectionParameters.database,this.port=this.connectionParameters.port,this.host=this.connectionParameters.host,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:this.connectionParameters.password}),this.replication=this.connectionParameters.replication;var b=a||{};this._Promise=b.Promise||ee.Promise,this._types=new g(b.types),this._ending=!1,this._connecting=!1,this._connected=!1,this._connectionError=!1,this._queryable=!0,this.connection=b.connection||new k({stream:b.stream,ssl:this.connectionParameters.ssl,keepAlive:b.keepAlive||!1,keepAliveInitialDelayMillis:b.keepAliveInitialDelayMillis||0,encoding:this.connectionParameters.client_encoding||"utf8"}),this.queryQueue=[],this.binary=b.binary||j.binary,this.processID=null,this.secretKey=null,this.ssl=this.connectionParameters.ssl||!1,this.ssl&&this.ssl.key&&Object.defineProperty(this.ssl,"key",{enumerable:!1}),this._connectionTimeoutMillis=b.connectionTimeoutMillis||0}_errorAllQueries(a){let b=eo(b=>{eh.nextTick(()=>{b.handleError(a,this.connection)})},"enqueueError");this.activeQuery&&(b(this.activeQuery),this.activeQuery=null),this.queryQueue.forEach(b),this.queryQueue.length=0}_connect(a){var b=this,c=this.connection;if(this._connectionCallback=a,this._connecting||this._connected){let b=Error("Client has already been connected. You cannot reuse a client.");eh.nextTick(()=>{a(b)});return}this._connecting=!0,this.connectionTimeoutHandle,this._connectionTimeoutMillis>0&&(this.connectionTimeoutHandle=setTimeout(()=>{c._ending=!0,c.stream.destroy(Error("timeout expired"))},this._connectionTimeoutMillis)),this.host&&0===this.host.indexOf("/")?c.connect(this.host+"/.s.PGSQL."+this.port):c.connect(this.port,this.host),c.on("connect",function(){b.ssl?c.requestSsl():c.startup(b.getStartupConf())}),c.on("sslconnect",function(){c.startup(b.getStartupConf())}),this._attachListeners(c),c.once("end",()=>{let a=this._ending?Error("Connection terminated"):Error("Connection terminated unexpectedly");clearTimeout(this.connectionTimeoutHandle),this._errorAllQueries(a),this._ending||(this._connecting&&!this._connectionError?this._connectionCallback?this._connectionCallback(a):this._handleErrorEvent(a):this._connectionError||this._handleErrorEvent(a)),eh.nextTick(()=>{this.emit("end")})})}connect(a){return a?void this._connect(a):new this._Promise((a,b)=>{this._connect(c=>{c?b(c):a()})})}_attachListeners(a){a.on("authenticationCleartextPassword",this._handleAuthCleartextPassword.bind(this)),a.on("authenticationMD5Password",this._handleAuthMD5Password.bind(this)),a.on("authenticationSASL",this._handleAuthSASL.bind(this)),a.on("authenticationSASLContinue",this._handleAuthSASLContinue.bind(this)),a.on("authenticationSASLFinal",this._handleAuthSASLFinal.bind(this)),a.on("backendKeyData",this._handleBackendKeyData.bind(this)),a.on("error",this._handleErrorEvent.bind(this)),a.on("errorMessage",this._handleErrorMessage.bind(this)),a.on("readyForQuery",this._handleReadyForQuery.bind(this)),a.on("notice",this._handleNotice.bind(this)),a.on("rowDescription",this._handleRowDescription.bind(this)),a.on("dataRow",this._handleDataRow.bind(this)),a.on("portalSuspended",this._handlePortalSuspended.bind(this)),a.on("emptyQuery",this._handleEmptyQuery.bind(this)),a.on("commandComplete",this._handleCommandComplete.bind(this)),a.on("parseComplete",this._handleParseComplete.bind(this)),a.on("copyInResponse",this._handleCopyInResponse.bind(this)),a.on("copyData",this._handleCopyData.bind(this)),a.on("notification",this._handleNotification.bind(this))}_checkPgPass(a){let b=this.connection;"function"==typeof this.password?this._Promise.resolve().then(()=>this.password()).then(c=>{if(void 0!==c){if("string"!=typeof c)return void b.emit("error",TypeError("Password must be a string"));this.connectionParameters.password=this.password=c}else this.connectionParameters.password=this.password=null;a()}).catch(a=>{b.emit("error",a)}):null!==this.password?a():f(this.connectionParameters,b=>{void 0!==b&&(this.connectionParameters.password=this.password=b),a()})}_handleAuthCleartextPassword(a){this._checkPgPass(()=>{this.connection.password(this.password)})}_handleAuthMD5Password(a){this._checkPgPass(()=>{let b=d.postgresMd5PasswordHash(this.user,this.password,a.salt);this.connection.password(b)})}_handleAuthSASL(a){this._checkPgPass(()=>{this.saslSession=e.startSession(a.mechanisms),this.connection.sendSASLInitialResponseMessage(this.saslSession.mechanism,this.saslSession.response)})}_handleAuthSASLContinue(a){e.continueSession(this.saslSession,this.password,a.data),this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}_handleAuthSASLFinal(a){e.finalizeSession(this.saslSession,a.data),this.saslSession=null}_handleBackendKeyData(a){this.processID=a.processID,this.secretKey=a.secretKey}_handleReadyForQuery(a){this._connecting&&(this._connecting=!1,this._connected=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback&&(this._connectionCallback(null,this),this._connectionCallback=null),this.emit("connect"));let{activeQuery:b}=this;this.activeQuery=null,this.readyForQuery=!0,b&&b.handleReadyForQuery(this.connection),this._pulseQueryQueue()}_handleErrorWhileConnecting(a){if(!this._connectionError){if(this._connectionError=!0,clearTimeout(this.connectionTimeoutHandle),this._connectionCallback)return this._connectionCallback(a);this.emit("error",a)}}_handleErrorEvent(a){if(this._connecting)return this._handleErrorWhileConnecting(a);this._queryable=!1,this._errorAllQueries(a),this.emit("error",a)}_handleErrorMessage(a){if(this._connecting)return this._handleErrorWhileConnecting(a);let b=this.activeQuery;b?(this.activeQuery=null,b.handleError(a,this.connection)):this._handleErrorEvent(a)}_handleRowDescription(a){this.activeQuery.handleRowDescription(a)}_handleDataRow(a){this.activeQuery.handleDataRow(a)}_handlePortalSuspended(a){this.activeQuery.handlePortalSuspended(this.connection)}_handleEmptyQuery(a){this.activeQuery.handleEmptyQuery(this.connection)}_handleCommandComplete(a){this.activeQuery.handleCommandComplete(a,this.connection)}_handleParseComplete(a){this.activeQuery.name&&(this.connection.parsedStatements[this.activeQuery.name]=this.activeQuery.text)}_handleCopyInResponse(a){this.activeQuery.handleCopyInResponse(this.connection)}_handleCopyData(a){this.activeQuery.handleCopyData(a,this.connection)}_handleNotification(a){this.emit("notification",a)}_handleNotice(a){this.emit("notice",a)}getStartupConf(){var a=this.connectionParameters,b={user:a.user,database:a.database},c=a.application_name||a.fallback_application_name;return c&&(b.application_name=c),a.replication&&(b.replication=""+a.replication),a.statement_timeout&&(b.statement_timeout=String(parseInt(a.statement_timeout,10))),a.lock_timeout&&(b.lock_timeout=String(parseInt(a.lock_timeout,10))),a.idle_in_transaction_session_timeout&&(b.idle_in_transaction_session_timeout=String(parseInt(a.idle_in_transaction_session_timeout,10))),a.options&&(b.options=a.options),b}cancel(a,b){if(a.activeQuery===b){var c=this.connection;this.host&&0===this.host.indexOf("/")?c.connect(this.host+"/.s.PGSQL."+this.port):c.connect(this.port,this.host),c.on("connect",function(){c.cancel(a.processID,a.secretKey)})}else -1!==a.queryQueue.indexOf(b)&&a.queryQueue.splice(a.queryQueue.indexOf(b),1)}setTypeParser(a,b,c){return this._types.setTypeParser(a,b,c)}getTypeParser(a,b){return this._types.getTypeParser(a,b)}escapeIdentifier(a){return'"'+a.replace(/"/g,'""')+'"'}escapeLiteral(a){for(var b=!1,c="'",d=0;d<a.length;d++){var e=a[d];"'"===e?c+=e+e:"\\"===e?(c+=e+e,b=!0):c+=e}return c+="'",!0===b&&(c=" E"+c),c}_pulseQueryQueue(){if(!0===this.readyForQuery)if(this.activeQuery=this.queryQueue.shift(),this.activeQuery){this.readyForQuery=!1,this.hasExecuted=!0;let a=this.activeQuery.submit(this.connection);a&&eh.nextTick(()=>{this.activeQuery.handleError(a,this.connection),this.readyForQuery=!0,this._pulseQueryQueue()})}else this.hasExecuted&&(this.activeQuery=null,this.emit("drain"))}query(a,b,c){var d,e,f,g,h;if(null==a)throw TypeError("Client was passed a null or undefined query");return"function"==typeof a.submit?(f=a.query_timeout||this.connectionParameters.query_timeout,e=d=a,"function"==typeof b&&(d.callback=d.callback||b)):(f=this.connectionParameters.query_timeout,(d=new i(a,b,c)).callback||(e=new this._Promise((a,b)=>{d.callback=(c,d)=>c?b(c):a(d)}))),f&&(h=d.callback,g=setTimeout(()=>{var a=Error("Query read timeout");eh.nextTick(()=>{d.handleError(a,this.connection)}),h(a),d.callback=()=>{};var b=this.queryQueue.indexOf(d);b>-1&&this.queryQueue.splice(b,1),this._pulseQueryQueue()},f),d.callback=(a,b)=>{clearTimeout(g),h(a,b)}),this.binary&&!d.binary&&(d.binary=!0),d._result&&!d._result._types&&(d._result._types=this._types),this._queryable?this._ending?eh.nextTick(()=>{d.handleError(Error("Client was closed and is not queryable"),this.connection)}):(this.queryQueue.push(d),this._pulseQueryQueue()):eh.nextTick(()=>{d.handleError(Error("Client has encountered a connection error and is not queryable"),this.connection)}),e}ref(){this.connection.ref()}unref(){this.connection.unref()}end(a){if(this._ending=!0,!this.connection._connecting)if(!a)return this._Promise.resolve();else a();if(this.activeQuery||!this._queryable?this.connection.stream.destroy():this.connection.end(),!a)return new this._Promise(a=>{this.connection.once("end",a)});this.connection.once("end",a)}};eo(l,"Client"),l.Query=i,b.exports=l}),fJ=eq((a,b)=>{ez();var c=eA().EventEmitter,d=eo(function(){},"NOOP"),e=eo((a,b)=>{let c=a.findIndex(b);return -1===c?void 0:a.splice(c,1)[0]},"removeWhere"),f=class{constructor(a,b,c){this.client=a,this.idleListener=b,this.timeoutId=c}};eo(f,"IdleItem");var g=class{constructor(a){this.callback=a}};function h(){throw Error("Release called on client which has already been released to the pool.")}function i(a,b){let c,d;return b?{callback:b,result:void 0}:{callback:eo(function(a,b){a?c(a):d(b)},"cb"),result:new a(function(a,b){d=a,c=b}).catch(a=>{throw Error.captureStackTrace(a),a})}}function j(a,b){return eo(function c(d){d.client=b,b.removeListener("error",c),b.on("error",()=>{a.log("additional client error after disconnection due to error",d)}),a._remove(b),a.emit("error",d,b)},"idleListener")}eo(g,"PendingItem"),eo(h,"throwOnDoubleRelease"),eo(i,"promisify"),eo(j,"makeIdleListener");var k=class extends c{constructor(a,b){super(),this.options=Object.assign({},a),null!=a&&"password"in a&&Object.defineProperty(this.options,"password",{configurable:!0,enumerable:!1,writable:!0,value:a.password}),null!=a&&a.ssl&&a.ssl.key&&Object.defineProperty(this.options.ssl,"key",{enumerable:!1}),this.options.max=this.options.max||this.options.poolSize||10,this.options.min=this.options.min||0,this.options.maxUses=this.options.maxUses||1/0,this.options.allowExitOnIdle=this.options.allowExitOnIdle||!1,this.options.maxLifetimeSeconds=this.options.maxLifetimeSeconds||0,this.log=this.options.log||function(){},this.Client=this.options.Client||b||fR().Client,this.Promise=this.options.Promise||ee.Promise,typeof this.options.idleTimeoutMillis>"u"&&(this.options.idleTimeoutMillis=1e4),this._clients=[],this._idle=[],this._expired=new WeakSet,this._pendingQueue=[],this._endCallback=void 0,this.ending=!1,this.ended=!1}_isFull(){return this._clients.length>=this.options.max}_isAboveMin(){return this._clients.length>this.options.min}_pulseQueue(){if(this.log("pulse queue"),this.ended)return void this.log("pulse queue ended");if(this.ending){this.log("pulse queue on ending"),this._idle.length&&this._idle.slice().map(a=>{this._remove(a.client)}),this._clients.length||(this.ended=!0,this._endCallback());return}if(!this._pendingQueue.length)return void this.log("no queued requests");if(!this._idle.length&&this._isFull())return;let a=this._pendingQueue.shift();if(this._idle.length){let b=this._idle.pop();clearTimeout(b.timeoutId);let c=b.client;c.ref&&c.ref();let d=b.idleListener;return this._acquireClient(c,a,d,!1)}if(!this._isFull())return this.newClient(a);throw Error("unexpected condition")}_remove(a){let b=e(this._idle,b=>b.client===a);void 0!==b&&clearTimeout(b.timeoutId),this._clients=this._clients.filter(b=>b!==a),a.end(),this.emit("remove",a)}connect(a){if(this.ending){let b=Error("Cannot use a pool after calling end on the pool");return a?a(b):this.Promise.reject(b)}let b=i(this.Promise,a),c=b.result;if(this._isFull()||this._idle.length){if(this._idle.length&&eh.nextTick(()=>this._pulseQueue()),!this.options.connectionTimeoutMillis)return this._pendingQueue.push(new g(b.callback)),c;let a=eo((a,c,d)=>{clearTimeout(f),b.callback(a,c,d)},"queueCallback"),d=new g(a),f=setTimeout(()=>{e(this._pendingQueue,b=>b.callback===a),d.timedOut=!0,b.callback(Error("timeout exceeded when trying to connect"))},this.options.connectionTimeoutMillis);return f.unref&&f.unref(),this._pendingQueue.push(d),c}return this.newClient(new g(b.callback)),c}newClient(a){let b=new this.Client(this.options);this._clients.push(b);let c=j(this,b);this.log("checking client timeout");let e,f=!1;this.options.connectionTimeoutMillis&&(e=setTimeout(()=>{this.log("ending client due to timeout"),f=!0,b.connection?b.connection.stream.destroy():b.end()},this.options.connectionTimeoutMillis)),this.log("connecting new client"),b.connect(h=>{if(e&&clearTimeout(e),b.on("error",c),h)this.log("client failed to connect",h),this._clients=this._clients.filter(a=>a!==b),f&&(h=Error("Connection terminated due to connection timeout",{cause:h})),this._pulseQueue(),a.timedOut||a.callback(h,void 0,d);else{if(this.log("new client connected"),0!==this.options.maxLifetimeSeconds){let a=setTimeout(()=>{this.log("ending client due to expired lifetime"),this._expired.add(b),-1!==this._idle.findIndex(a=>a.client===b)&&this._acquireClient(b,new g((a,b,c)=>c()),c,!1)},1e3*this.options.maxLifetimeSeconds);a.unref(),b.once("end",()=>clearTimeout(a))}return this._acquireClient(b,a,c,!0)}})}_acquireClient(a,b,c,e){e&&this.emit("connect",a),this.emit("acquire",a),a.release=this._releaseOnce(a,c),a.removeListener("error",c),b.timedOut?e&&this.options.verify?this.options.verify(a,a.release):a.release():e&&this.options.verify?this.options.verify(a,c=>{if(c)return a.release(c),b.callback(c,void 0,d);b.callback(void 0,a,a.release)}):b.callback(void 0,a,a.release)}_releaseOnce(a,b){let c=!1;return d=>{c&&h(),c=!0,this._release(a,b,d)}}_release(a,b,c){let d;if(a.on("error",b),a._poolUseCount=(a._poolUseCount||0)+1,this.emit("release",c,a),c||this.ending||!a._queryable||a._ending||a._poolUseCount>=this.options.maxUses){a._poolUseCount>=this.options.maxUses&&this.log("remove expended client"),this._remove(a),this._pulseQueue();return}if(this._expired.has(a)){this.log("remove expired client"),this._expired.delete(a),this._remove(a),this._pulseQueue();return}this.options.idleTimeoutMillis&&this._isAboveMin()&&(d=setTimeout(()=>{this.log("remove idle client"),this._remove(a)},this.options.idleTimeoutMillis),this.options.allowExitOnIdle&&d.unref()),this.options.allowExitOnIdle&&a.unref(),this._idle.push(new f(a,b,d)),this._pulseQueue()}query(a,b,c){if("function"==typeof a){let b=i(this.Promise,a);return ef(function(){return b.callback(Error("Passing a function as the first parameter to pool.query is not supported"))}),b.result}"function"==typeof b&&(c=b,b=void 0);let d=i(this.Promise,c);return c=d.callback,this.connect((d,e)=>{if(d)return c(d);let f=!1,g=eo(a=>{f||(f=!0,e.release(a),c(a))},"onError");e.once("error",g),this.log("dispatching query");try{e.query(a,b,(a,b)=>{if(this.log("query dispatched"),e.removeListener("error",g),!f)return f=!0,e.release(a),a?c(a):c(void 0,b)})}catch(a){return e.release(a),c(a)}}),d.result}end(a){if(this.log("ending"),this.ending){let b=Error("Called end on pool more than once");return a?a(b):this.Promise.reject(b)}this.ending=!0;let b=i(this.Promise,a);return this._endCallback=b.callback,this._pulseQueue(),b.result}get waitingCount(){return this._pendingQueue.length}get idleCount(){return this._idle.length}get expiredCount(){return this._clients.reduce((a,b)=>a+ +!!this._expired.has(b),0)}get totalCount(){return this._clients.length}};eo(k,"Pool"),b.exports=k}),fK={};er(fK,{default:()=>fL});var fL,fM=ep(()=>{ez(),fL={}}),fN=eq((a,b)=>{b.exports={name:"pg",version:"8.8.0",description:"PostgreSQL client - pure javascript & libpq with the same API",keywords:["database","libpq","pg","postgre","postgres","postgresql","rdbms"],homepage:"https://github.com/brianc/node-postgres",repository:{type:"git",url:"git://github.com/brianc/node-postgres.git",directory:"packages/pg"},author:"Brian Carlson <brian.m.carlson@gmail.com>",main:"./lib",dependencies:{"buffer-writer":"2.0.0","packet-reader":"1.0.0","pg-connection-string":"^2.5.0","pg-pool":"^3.5.2","pg-protocol":"^1.5.0","pg-types":"^2.1.0",pgpass:"1.x"},devDependencies:{async:"2.6.4",bluebird:"3.5.2",co:"4.6.0","pg-copy-streams":"0.3.0"},peerDependencies:{"pg-native":">=3.0.1"},peerDependenciesMeta:{"pg-native":{optional:!0}},scripts:{test:"make test-all"},files:["lib","SPONSORS.md"],license:"MIT",engines:{node:">= 8.0.0"},gitHead:"c99fb2c127ddf8d712500db2c7b9a5491a178655"}}),fO=eq((a,b)=>{ez();var c=eA().EventEmitter,d=(e9(),eu(e7)),e=e6(),f=b.exports=function(a,b,d){c.call(this),a=e.normalizeQueryConfig(a,b,d),this.text=a.text,this.values=a.values,this.name=a.name,this.callback=a.callback,this.state="new",this._arrayMode="array"===a.rowMode,this._emitRowEvents=!1,this.on("newListener",(function(a){"row"===a&&(this._emitRowEvents=!0)}).bind(this))};d.inherits(f,c);var g={sqlState:"code",statementPosition:"position",messagePrimary:"message",context:"where",schemaName:"schema",tableName:"table",columnName:"column",dataTypeName:"dataType",constraintName:"constraint",sourceFile:"file",sourceLine:"line",sourceFunction:"routine"};f.prototype.handleError=function(a){var b=this.native.pq.resultErrorFields();if(b)for(var c in b)a[g[c]||c]=b[c];this.callback?this.callback(a):this.emit("error",a),this.state="error"},f.prototype.then=function(a,b){return this._getPromise().then(a,b)},f.prototype.catch=function(a){return this._getPromise().catch(a)},f.prototype._getPromise=function(){return this._promise||(this._promise=new Promise((function(a,b){this._once("end",a),this._once("error",b)}).bind(this))),this._promise},f.prototype.submit=function(a){this.state="running";var b=this;this.native=a.native,a.native.arrayMode=this._arrayMode;var c=eo(function(c,d,e){if(a.native.arrayMode=!1,ef(function(){b.emit("_done")}),c)return b.handleError(c);b._emitRowEvents&&(e.length>1?d.forEach((a,c)=>{a.forEach(a=>{b.emit("row",a,e[c])})}):d.forEach(function(a){b.emit("row",a,e)})),b.state="end",b.emit("end",e),b.callback&&b.callback(null,e)},"after");if(eh.domain&&(c=eh.domain.bind(c)),this.name){this.name.length>63&&(console.error("Warning! Postgres only supports 63 characters for query names."),console.error("You supplied %s (%s)",this.name,this.name.length),console.error("This can cause conflicts and silent errors executing queries"));var d=(this.values||[]).map(e.prepareValue);if(a.namedQueries[this.name]){if(this.text&&a.namedQueries[this.name]!==this.text){let a=Error(`Prepa\
red statements must be unique - '${this.name}' was used for a different statement`);return c(a)}return a.native.execute(this.name,d,c)}return a.native.prepare(this.name,this.text,d.length,function(e){return e?c(e):(a.namedQueries[b.name]=b.text,b.native.execute(b.name,d,c))})}if(this.values){if(!Array.isArray(this.values)){let a=Error("Query values must be an array");return c(a)}var f=this.values.map(e.prepareValue);a.native.query(this.text,f,c)}else a.native.query(this.text,c)}}),fP=eq((a,b)=>{ez();var c=(fM(),eu(fK)),d=eW(),e=(fN(),eA().EventEmitter),f=(e9(),eu(e7)),g=fv(),h=fO(),i=b.exports=function(a){e.call(this),a=a||{},this._Promise=a.Promise||ee.Promise,this._types=new d(a.types),this.native=new c({types:this._types}),this._queryQueue=[],this._ending=!1,this._connecting=!1,this._connected=!1,this._queryable=!0;var b=this.connectionParameters=new g(a);this.user=b.user,Object.defineProperty(this,"password",{configurable:!0,enumerable:!1,writable:!0,value:b.password}),this.database=b.database,this.host=b.host,this.port=b.port,this.namedQueries={}};i.Query=h,f.inherits(i,e),i.prototype._errorAllQueries=function(a){let b=eo(b=>{eh.nextTick(()=>{b.native=this.native,b.handleError(a)})},"enqueueError");this._hasActiveQuery()&&(b(this._activeQuery),this._activeQuery=null),this._queryQueue.forEach(b),this._queryQueue.length=0},i.prototype._connect=function(a){var b=this;this._connecting?eh.nextTick(()=>a(Error("Client has already been connected. You cannot reuse a client."))):(this._connecting=!0,this.connectionParameters.getLibpqConnectionString(function(c,d){if(c)return a(c);b.native.connect(d,function(c){if(c)return b.native.end(),a(c);b._connected=!0,b.native.on("error",function(a){b._queryable=!1,b._errorAllQueries(a),b.emit("error",a)}),b.native.on("notification",function(a){b.emit("notification",{channel:a.relname,payload:a.extra})}),b.emit("connect"),b._pulseQueryQueue(!0),a()})}))},i.prototype.connect=function(a){return a?void this._connect(a):new this._Promise((a,b)=>{this._connect(c=>{c?b(c):a()})})},i.prototype.query=function(a,b,c){var d,e,f,g,i;if(null==a)throw TypeError("Client was passed a null or undefined query");if("function"==typeof a.submit)f=a.query_timeout||this.connectionParameters.query_timeout,e=d=a,"function"==typeof b&&(a.callback=b);else if(f=this.connectionParameters.query_timeout,!(d=new h(a,b,c)).callback){let a,b;e=new this._Promise((c,d)=>{a=c,b=d}),d.callback=(c,d)=>c?b(c):a(d)}return f&&(i=d.callback,g=setTimeout(()=>{var a=Error("Query read timeout");eh.nextTick(()=>{d.handleError(a,this.connection)}),i(a),d.callback=()=>{};var b=this._queryQueue.indexOf(d);b>-1&&this._queryQueue.splice(b,1),this._pulseQueryQueue()},f),d.callback=(a,b)=>{clearTimeout(g),i(a,b)}),this._queryable?this._ending?(d.native=this.native,eh.nextTick(()=>{d.handleError(Error("Client was closed and is not queryable"))})):(this._queryQueue.push(d),this._pulseQueryQueue()):(d.native=this.native,eh.nextTick(()=>{d.handleError(Error("Client has encountered a connection error and is not queryable"))})),e},i.prototype.end=function(a){var b,c=this;return this._ending=!0,this._connected||this.once("connect",this.end.bind(this,a)),a||(b=new this._Promise(function(b,c){a=eo(a=>a?c(a):b(),"cb")})),this.native.end(function(){c._errorAllQueries(Error("Connection terminated")),eh.nextTick(()=>{c.emit("end"),a&&a()})}),b},i.prototype._hasActiveQuery=function(){return this._activeQuery&&"error"!==this._activeQuery.state&&"end"!==this._activeQuery.state},i.prototype._pulseQueryQueue=function(a){if(this._connected&&!this._hasActiveQuery()){var b=this._queryQueue.shift();if(!b){a||this.emit("drain");return}this._activeQuery=b,b.submit(this);var c=this;b.once("_done",function(){c._pulseQueryQueue()})}},i.prototype.cancel=function(a){this._activeQuery===a?this.native.cancel(function(){}):-1!==this._queryQueue.indexOf(a)&&this._queryQueue.splice(this._queryQueue.indexOf(a),1)},i.prototype.ref=function(){},i.prototype.unref=function(){},i.prototype.setTypeParser=function(a,b,c){return this._types.setTypeParser(a,b,c)},i.prototype.getTypeParser=function(a,b){return this._types.getTypeParser(a,b)}}),fQ=eq((a,b)=>{ez(),b.exports=fP()}),fR=eq((a,b)=>{ez();var c=fI(),d=e5(),e=fH(),f=fJ(),{DatabaseError:g}=fD(),h=eo(a=>{var b;return eo(b=class extends f{constructor(b){super(b,a)}},"BoundPool"),b},"poolFactory"),i=eo(function(a){this.defaults=d,this.Client=a,this.Query=this.Client.Query,this.Pool=h(this.Client),this._pools=[],this.Connection=e,this.types=eV(),this.DatabaseError=g},"PG");"u">typeof eh.env.NODE_PG_FORCE_NATIVE?b.exports=new i(fQ()):(b.exports=new i(c),Object.defineProperty(b.exports,"native",{configurable:!0,enumerable:!1,get(){var a=null;try{a=new i(fQ())}catch(a){if("MODULE_NOT_FOUND"!==a.code)throw a}return Object.defineProperty(b.exports,"native",{value:a}),a}}))});ez(),ez(),eH(),eK(),ez();var fS=Object.defineProperty,fT=Object.defineProperties,fU=Object.getOwnPropertyDescriptors,fV=Object.getOwnPropertySymbols,fW=Object.prototype.hasOwnProperty,fX=Object.prototype.propertyIsEnumerable,fY=eo((a,b,c)=>b in a?fS(a,b,{enumerable:!0,configurable:!0,writable:!0,value:c}):a[b]=c,"__defNormalProp"),fZ=eo((a,b)=>{for(var c in b||(b={}))fW.call(b,c)&&fY(a,c,b[c]);if(fV)for(var c of fV(b))fX.call(b,c)&&fY(a,c,b[c]);return a},"__spreadValues"),f$=eo((a,b)=>fT(a,fU(b)),"__spreadProps"),f_=2===new Uint8Array(new Uint16Array([258]).buffer)[0],f0=new TextDecoder,f1=new TextEncoder,f2=f1.encode("0123456789abcdef"),f3=f1.encode("0123456789ABCDEF"),f4=f1.encode("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/").slice();function f5(a,{alphabet:b,scratchArr:c}={}){if(!n)if(n=new Uint16Array(256),o=new Uint16Array(256),f_)for(let a=0;a<256;a++)n[a]=f2[15&a]<<8|f2[a>>>4],o[a]=f3[15&a]<<8|f3[a>>>4];else for(let a=0;a<256;a++)n[a]=f2[15&a]|f2[a>>>4]<<8,o[a]=f3[15&a]|f3[a>>>4]<<8;a.byteOffset%4!=0&&(a=new Uint8Array(a));let d=a.length,e=d>>>2,f=c||new Uint16Array(d),g=new Uint32Array(a.buffer,a.byteOffset,e),h=new Uint32Array(f.buffer,f.byteOffset,d>>>1),i="upper"===b?o:n,j=0,k=0,l;if(f_)for(;j<e;)l=g[j++],h[k++]=i[l>>>8&255]<<16|i[255&l],h[k++]=i[l>>>24]<<16|i[l>>>16&255];else for(;j<e;)l=g[j++],h[k++]=i[l>>>24]<<16|i[l>>>16&255],h[k++]=i[l>>>8&255]<<16|i[255&l];for(j<<=2;j<d;)f[j]=i[a[j++]];return f0.decode(f.subarray(0,d))}function f6(a,b={}){let c="",d=a.length,e=Math.ceil(d/504e3),f=new Uint16Array(e>1?504e3:d);for(let d=0;d<e;d++){let e=504e3*d,g=e+504e3;c+=f5(a.subarray(e,g),f$(fZ({},b),{scratchArr:f}))}return c}function f7(a,b={}){return"upper"!==b.alphabet&&"function"==typeof a.toHex?a.toHex():f6(a,b)}f4[62]=45,f4[63]=95,eo(f5,"_toHex"),eo(f6,"_toHexChunked"),eo(f7,"toHex"),ez();var f8=class a{constructor(a,b){this.strings=a,this.values=b}toParameterizedQuery(b={query:"",params:[]}){let{strings:c,values:d}=this;for(let e=0,f=c.length;e<f;e++)if(b.query+=c[e],e<d.length){let c=d[e];if(c instanceof ga)b.query+=c.sql;else if(c instanceof gl)if(c.queryData instanceof a)c.queryData.toParameterizedQuery(b);else{if(c.queryData.params?.length)throw Error("This query is not composable");b.query+=c.queryData.query}else{let{params:a}=b;a.push(c),b.query+="$"+a.length,(c instanceof eg||ArrayBuffer.isView(c))&&(b.query+="::bytea")}}return b}};eo(f8,"SqlTemplate");var f9=class{constructor(a){this.sql=a}};eo(f9,"UnsafeRawSql");var ga=f9;function gb(){}ez(),eo(gb,"warnIfBrowser"),eH();var gc=et(eW()),gd=et(e6()),ge=class a extends Error{constructor(b){super(b),ev(this,"name","NeonDbError"),ev(this,"severity"),ev(this,"code"),ev(this,"detail"),ev(this,"hint"),ev(this,"position"),ev(this,"internalPosition"),ev(this,"internalQuery"),ev(this,"where"),ev(this,"schema"),ev(this,"table"),ev(this,"column"),ev(this,"dataType"),ev(this,"constraint"),ev(this,"file"),ev(this,"line"),ev(this,"routine"),ev(this,"sourceError"),"captureStackTrace"in Error&&"function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,a)}};eo(ge,"NeonDbError");var gf="transaction() expects an array of queries, or a function returning an array of queries",gg=["severity","code","detail","hint","position","internalPosition","internalQuery","where","schema","table","column","dataType","constraint","file","line","routine"];function gh(a){return a instanceof eg?"\\x"+f7(a):a}function gi(a){let{query:b,params:c}=a instanceof f8?a.toParameterizedQuery():a;return{query:b,params:c.map(a=>gh((0,gd.prepareValue)(a)))}}function gj(a,{arrayMode:b,fullResults:c,fetchOptions:d,isolationLevel:e,readOnly:f,deferrable:g,authToken:h,disableWarningInBrowsers:i}={}){let j;if(!a)throw Error("No database connection string was provided to `neon()`. Perhaps an environment variable has not been set?");try{j=eJ(a)}catch{throw Error("Database connection string provided to `neon()` is not a valid URL. Connection string: "+String(a))}let{protocol:k,username:l,hostname:m,port:n,pathname:o}=j;if("postgres:"!==k&&"postgresql:"!==k||!l||!m||!o)throw Error("Database connection string format for `neon()` should be: postgresql://user:password@host.tld/dbname?option=value");function p(a,...b){if(!(Array.isArray(a)&&Array.isArray(a.raw)&&Array.isArray(b)))throw Error('This function can now be called only as a tagged-template function: sql`SELECT ${value}`, not sql("SELECT $1", [value], options). For a conventional function call with value placeholders ($1, $2, etc.), use sql.query("SELECT $1", [value], options).');return new gl(q,new f8(a,b))}async function q(j,k,l){let o,{fetchEndpoint:p,fetchFunction:q}=eG,r=Array.isArray(j)?{queries:j.map(a=>gi(a))}:gi(j),s=d??{},t=b??!1,u=c??!1,v=e,w=f,x=g;void 0!==l&&(void 0!==l.fetchOptions&&(s={...s,...l.fetchOptions}),void 0!==l.arrayMode&&(t=l.arrayMode),void 0!==l.fullResults&&(u=l.fullResults),void 0!==l.isolationLevel&&(v=l.isolationLevel),void 0!==l.readOnly&&(w=l.readOnly),void 0!==l.deferrable&&(x=l.deferrable)),void 0===k||Array.isArray(k)||void 0===k.fetchOptions||(s={...s,...k.fetchOptions});let y=h;Array.isArray(k)||k?.authToken===void 0||(y=k.authToken);let z="function"==typeof p?p(m,n,{jwtAuth:void 0!==y}):p,A={"Neon-Connection-String":a,"Neon-Raw-Text-Output":"true","Neon-Array-Mode":"true"},B=await gn(y);B&&(A.Authorization=`Bearer ${B}`),Array.isArray(j)&&(void 0!==v&&(A["Neon-Batch-Isolation-Level"]=v),void 0!==w&&(A["Neon-Batch-Read-Only"]=String(w)),void 0!==x&&(A["Neon-Batch-Deferrable"]=String(x))),i||eG.disableWarningInBrowsers||gb();try{o=await (q??fetch)(z,{method:"POST",body:JSON.stringify(r),headers:A,...s})}catch(b){let a=new ge(`Error connecting to database: ${b}`);throw a.sourceError=b,a}if(o.ok){let a=await o.json();if(Array.isArray(j)){let b=a.results;if(!Array.isArray(b))throw new ge("Neon internal error: unexpected result format");return b.map((a,b)=>{let c=k[b]??{};return gm(a,{arrayMode:c.arrayMode??t,fullResults:c.fullResults??u,types:c.types})})}{let b=k??{};return gm(a,{arrayMode:b.arrayMode??t,fullResults:b.fullResults??u,types:b.types})}}{let{status:a}=o;if(400===a){let a=await o.json(),b=new ge(a.message);for(let c of gg)b[c]=a[c]??void 0;throw b}{let b=await o.text();throw new ge(`Server error (HTTP status ${a}): ${b}`)}}}return eo(p,"templateFn"),p.query=(a,b,c)=>new gl(q,{query:a,params:b??[]},c),p.unsafe=a=>new ga(a),p.transaction=async(a,b)=>{if("function"==typeof a&&(a=a(p)),!Array.isArray(a))throw Error(gf);return a.forEach(a=>{if(!(a instanceof gl))throw Error(gf)}),q(a.map(a=>a.queryData),a.map(a=>a.opts??{}),b)},eo(q,"execute"),p}eo(gh,"encodeBuffersAsBytea"),eo(gi,"prepareQuery"),eo(gj,"neon");var gk=class{constructor(a,b,c){this.execute=a,this.queryData=b,this.opts=c}then(a,b){return this.execute(this.queryData,this.opts).then(a,b)}catch(a){return this.execute(this.queryData,this.opts).catch(a)}finally(a){return this.execute(this.queryData,this.opts).finally(a)}};eo(gk,"NeonQueryPromise");var gl=gk;function gm(a,{arrayMode:b,fullResults:c,types:d}){let e=new gc.default(d),f=a.fields.map(a=>a.name),g=a.fields.map(a=>e.getTypeParser(a.dataTypeID)),h=!0===b?a.rows.map(a=>a.map((a,b)=>null===a?null:g[b](a))):a.rows.map(a=>Object.fromEntries(a.map((a,b)=>[f[b],null===a?null:g[b](a)])));return c?(a.viaNeonFetch=!0,a.rowAsArray=b,a.rows=h,a._parsers=g,a._types=e,a):h}async function gn(a){if("string"==typeof a)return a;if("function"==typeof a)try{return await Promise.resolve(a())}catch(b){let a=new ge("Error getting auth token.");throw b instanceof Error&&(a=new ge(`Error getting auth token: ${b.message}`)),a}}eo(gm,"processQueryResult"),eo(gn,"getAuthToken"),ez();var go=et(fR());ez();var gp=et(fR()),gq=class extends gp.Client{constructor(a){super(a),this.config=a}get neonConfig(){return this.connection.stream}connect(a){let{neonConfig:b}=this;b.forceDisablePgSSL&&(this.ssl=this.connection.ssl=!1),this.ssl&&b.useSecureWebSocket&&console.warn("SSL is enabled for both Postgres (e.g. ?sslmode=require in the connection string + forceDisablePgSSL = false) and the WebSocket tunnel (useSecureWebSocket = true). Double encryption will increase latency and CPU usage. It may be appropriate to disable SSL in the Postgres connection parameters or set forceDisablePgSSL = true.");let c="string"!=typeof this.config&&this.config?.host!==void 0||"string"!=typeof this.config&&this.config?.connectionString!==void 0||void 0!==eh.env.PGHOST,d=eh.env.USER??eh.env.USERNAME;if(!c&&"localhost"===this.host&&this.user===d&&this.database===d&&null===this.password)throw Error(`No database host or connection string wa\
s set, and key parameters have default values (host: localhost, user: ${d}, db: ${d}, password: null\
). Is an environment variable missing? Alternatively, if you intended to connect with these paramete\
rs, please set the host to 'localhost' explicitly.`);let e=super.connect(a),f=b.pipelineTLS&&this.ssl,g="password"===b.pipelineConnect;if(!f&&!b.pipelineConnect)return e;let h=this.connection;if(f&&h.on("connect",()=>h.stream.emit("data","S")),g){h.removeAllListeners("authenticationCleartextPassword"),h.removeAllListeners("readyForQuery"),h.once("readyForQuery",()=>h.on("readyForQuery",this._handleReadyForQuery.bind(this)));let a=this.ssl?"sslconnect":"connect";h.on(a,()=>{this.neonConfig.disableWarningInBrowsers||gb(),this._handleAuthCleartextPassword(),this._handleReadyForQuery()})}return e}async _handleAuthSASLContinue(a){if(typeof crypto>"u"||void 0===crypto.subtle||void 0===crypto.subtle.importKey)throw Error("Cannot use SASL auth when `crypto.subtle` is not defined");let b=crypto.subtle,c=this.saslSession,d=this.password,e=a.data;if("SASLInitialResponse"!==c.message||"string"!=typeof d||"string"!=typeof e)throw Error("SASL: protocol error");let f=Object.fromEntries(e.split(",").map(a=>{if(!/^.=/.test(a))throw Error("SASL: Invalid attribute pair entry");return[a[0],a.substring(2)]})),g=f.r,h=f.s,i=f.i;if(!g||!/^[!-+--~]+$/.test(g))throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: nonce missing/unprintable");if(!h||!/^(?:[a-zA-Z0-9+/]{4})*(?:[a-zA-Z0-9+/]{2}==|[a-zA-Z0-9+/]{3}=)?$/.test(h))throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: salt missing/not base64");if(!i||!/^[1-9][0-9]*$/.test(i))throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: missing/invalid iteration count");if(!g.startsWith(c.clientNonce))throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce does not start with client nonce");if(g.length===c.clientNonce.length)throw Error("SASL: SCRAM-SERVER-FIRST-MESSAGE: server nonce is too short");let j=parseInt(i,10),k=eg.from(h,"base64"),l=new TextEncoder,m=l.encode(d),n=await b.importKey("raw",m,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),o=new Uint8Array(await b.sign("HMAC",n,eg.concat([k,eg.from([0,0,0,1])]))),p=o;for(var q=0;q<j-1;q++)o=new Uint8Array(await b.sign("HMAC",n,o)),p=eg.from(p.map((a,b)=>p[b]^o[b]));let r=p,s=await b.importKey("raw",r,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),t=new Uint8Array(await b.sign("HMAC",s,l.encode("Client Key"))),u=await b.digest("SHA-256",t),v="n=*,r="+c.clientNonce,w="r="+g+",s="+h+",i="+j,x="c=biws,r="+g,y=v+","+w+","+x,z=await b.importKey("raw",u,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);var A=new Uint8Array(await b.sign("HMAC",z,l.encode(y))),B=eg.from(t.map((a,b)=>t[b]^A[b])).toString("base64");let C=await b.importKey("raw",r,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),D=await b.sign("HMAC",C,l.encode("Server Key")),E=await b.importKey("raw",D,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);var F=eg.from(await b.sign("HMAC",E,l.encode(y)));c.message="SASLResponse",c.serverSignature=F.toString("base64"),c.response=x+",p="+B,this.connection.sendSCRAMClientFinalMessage(this.saslSession.response)}};eo(gq,"NeonClient"),eH();var gr=et(fv());function gs(a,b){let c,d;return b?{callback:b,result:void 0}:{callback:eo(function(a,b){a?c(a):d(b)},"cb"),result:new a(function(a,b){d=a,c=b})}}eo(gs,"promisify"),eo(class extends go.Pool{constructor(){super(...arguments),ev(this,"Client",gq),ev(this,"hasFetchUnsupportedListeners",!1),ev(this,"addListener",this.on)}on(a,b){return"error"!==a&&(this.hasFetchUnsupportedListeners=!0),super.on(a,b)}query(a,b,c){if(!eG.poolQueryViaFetch||this.hasFetchUnsupportedListeners||"function"==typeof a)return super.query(a,b,c);"function"==typeof b&&(c=b,b=void 0);let d=gs(this.Promise,c);c=d.callback;try{let d=new gr.default(this.options),e=encodeURIComponent,f=encodeURI,g=`postgresql://${e(d.user)}:${e(d.password)}@${e(d.host)}\
/${f(d.database)}`,h="string"==typeof a?a:a.text,i=b??a.values??[];gj(g,{fullResults:!0,arrayMode:"array"===a.rowMode}).query(h,i,{types:a.types??this.options?.types}).then(a=>c(void 0,a)).catch(a=>c(a))}catch(a){c(a)}return d.result}},"NeonPool"),eH();var gt=et(fR());gt.DatabaseError,gt.defaults,gt.escapeIdentifier,gt.escapeLiteral;var gu=gt.types;class gv{static [c_]="ConsoleLogWriter";write(a){console.log(a)}}class gw{static [c_]="DefaultLogger";writer;constructor(a){this.writer=a?.writer??new gv}logQuery(a,b){let c=b.map(a=>{try{return JSON.stringify(a)}catch{return String(a)}}),d=c.length?` -- params: [${c.join(", ")}]`:"";this.writer.write(`Query: ${a}${d}`)}}class gx{static [c_]="NoopLogger";logQuery(){}}class gy{static [c_]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(a){return this.then(void 0,a)}finally(a){return this.then(b=>(a?.(),b),b=>{throw a?.(),b})}then(a,b){return this.execute().then(a,b)}}class gz{constructor(a){this.table=a}static [c_]="ColumnAliasProxyHandler";get(a,b){return"table"===b?this.table:a[b]}}class gA{constructor(a,b){this.alias=a,this.replaceOriginalName=b}static [c_]="TableAliasProxyHandler";get(a,b){if(b===db.Symbol.IsAlias)return!0;if(b===db.Symbol.Name||this.replaceOriginalName&&b===db.Symbol.OriginalName)return this.alias;if(b===dB)return{...a[dB],name:this.alias,isAlias:!0};if(b===db.Symbol.Columns){let b=a[db.Symbol.Columns];if(!b)return b;let c={};return Object.keys(b).map(d=>{c[d]=new Proxy(b[d],new gz(new Proxy(a,this)))}),c}let c=a[b];return c0(c,c1)?new Proxy(c,new gz(new Proxy(a,this))):c}}class gB{constructor(a){this.alias=a}static [c_]="RelationTableAliasProxyHandler";get(a,b){return"sourceTable"===b?gC(a.sourceTable,this.alias):a[b]}}function gC(a,b){return new Proxy(a,new gA(b,!1))}function gD(a,b){return new Proxy(a,new gz(new Proxy(a.table,new gA(b,!1))))}function gE(a,b){return new dF.Aliased(gF(a.sql,b),a.fieldAlias)}function gF(a,b){return dK.join(a.queryChunks.map(a=>c0(a,c1)?gD(a,b):c0(a,dF)?gF(a,b):c0(a,dF.Aliased)?gE(a,b):a))}class gG{static [c_]="SelectionProxyHandler";config;constructor(a){this.config={...a}}get(a,b){if("_"===b)return{...a._,selectedFields:new Proxy(a._.selectedFields,this)};if(b===dB)return{...a[dB],selectedFields:new Proxy(a[dB].selectedFields,this)};if("symbol"==typeof b)return a[b];let c=(c0(a,dy)?a._.selectedFields:c0(a,dQ)?a[dB].selectedFields:a)[b];if(c0(c,dF.Aliased)){if("sql"===this.config.sqlAliasedBehavior&&!c.isSelectionField)return c.sql;let a=c.clone();return a.isSelectionField=!0,a}if(c0(c,dF)){if("sql"===this.config.sqlBehavior)return c;throw Error(`You tried to reference "${b}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}return c0(c,c1)?this.config.alias?new Proxy(c,new gz(new Proxy(c.table,new gA(this.config.alias,this.config.replaceOriginalName??!1)))):c:"object"!=typeof c||null===c?c:new Proxy(c,new gG(this.config))}}function gH(a,b){return Object.entries(a).reduce((a,[c,d])=>{if("string"!=typeof c)return a;let e=b?[...b,c]:[c];return c0(d,c1)||c0(d,dF)||c0(d,dF.Aliased)?a.push({path:e,field:d}):c0(d,db)?a.push(...gH(d[db.Symbol.Columns],e)):a.push(...gH(d,e)),a},[])}function gI(a,b){let c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(let[a,b]of c.entries())if(b!==d[a])return!1;return!0}function gJ(a,b){let c=Object.entries(b).filter(([,a])=>void 0!==a).map(([b,c])=>c0(c,dF)||c0(c,c1)?[b,c]:[b,new dJ(c,a[db.Symbol.Columns][b])]);if(0===c.length)throw Error("No values to set");return Object.fromEntries(c)}function gK(a){return a[db.Symbol.Columns]}function gL(a){return c0(a,dy)?a._.alias:c0(a,dQ)?a[dB].name:c0(a,dF)?void 0:a[db.Symbol.IsAlias]?a[db.Symbol.Name]:a[db.Symbol.BaseName]}function gM(a,b){return{name:"string"==typeof a&&a.length>0?a:"",config:"object"==typeof a?a:b}}"undefined"==typeof TextDecoder||new TextDecoder;class gN extends dm{static [c_]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(a){if(a){let{name:b,...c}=a;this.config.generatedIdentity={type:"always",sequenceName:b,sequenceOptions:c}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(a){if(a){let{name:b,...c}=a;this.config.generatedIdentity={type:"byDefault",sequenceName:b,sequenceOptions:c}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}class gO extends gN{static [c_]="PgBigInt53Builder";constructor(a){super(a,"number","PgBigInt53")}build(a){return new gP(a,this.config)}}class gP extends dn{static [c_]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}}class gQ extends gN{static [c_]="PgBigInt64Builder";constructor(a){super(a,"bigint","PgBigInt64")}build(a){return new gR(a,this.config)}}class gR extends dn{static [c_]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(a){return BigInt(a)}}function gS(a,b){let{name:c,config:d}=gM(a,b);return"number"===d.mode?new gO(c):new gQ(c)}class gT extends dm{static [c_]="PgBigSerial53Builder";constructor(a){super(a,"number","PgBigSerial53"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new gU(a,this.config)}}class gU extends dn{static [c_]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}}class gV extends dm{static [c_]="PgBigSerial64Builder";constructor(a){super(a,"bigint","PgBigSerial64"),this.config.hasDefault=!0}build(a){return new gW(a,this.config)}}class gW extends dn{static [c_]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(a){return BigInt(a)}}function gX(a,b){let{name:c,config:d}=gM(a,b);return"number"===d.mode?new gT(c):new gV(c)}class gY extends dm{static [c_]="PgBooleanBuilder";constructor(a){super(a,"boolean","PgBoolean")}build(a){return new gZ(a,this.config)}}class gZ extends dn{static [c_]="PgBoolean";getSQLType(){return"boolean"}}function g$(a){return new gY(a??"")}class g_ extends dm{static [c_]="PgCharBuilder";constructor(a,b){super(a,"string","PgChar"),this.config.length=b.length,this.config.enumValues=b.enum}build(a){return new g0(a,this.config)}}class g0 extends dn{static [c_]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"char":`char(${this.length})`}}function g1(a,b={}){let{name:c,config:d}=gM(a,b);return new g_(c,d)}class g2 extends dm{static [c_]="PgCidrBuilder";constructor(a){super(a,"string","PgCidr")}build(a){return new g3(a,this.config)}}class g3 extends dn{static [c_]="PgCidr";getSQLType(){return"cidr"}}function g4(a){return new g2(a??"")}class g5 extends dm{static [c_]="PgCustomColumnBuilder";constructor(a,b,c){super(a,"custom","PgCustomColumn"),this.config.fieldConfig=b,this.config.customTypeParams=c}build(a){return new g6(a,this.config)}}class g6 extends dn{static [c_]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(a,b){super(a,b),this.sqlName=b.customTypeParams.dataType(b.fieldConfig),this.mapTo=b.customTypeParams.toDriver,this.mapFrom=b.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(a){return"function"==typeof this.mapFrom?this.mapFrom(a):a}mapToDriverValue(a){return"function"==typeof this.mapTo?this.mapTo(a):a}}function g7(a){return(b,c)=>{let{name:d,config:e}=gM(b,c);return new g5(d,e,a)}}class g8 extends dm{static [c_]="PgDateColumnBaseBuilder";defaultNow(){return this.default(dK`now()`)}}class g9 extends g8{static [c_]="PgDateBuilder";constructor(a){super(a,"date","PgDate")}build(a){return new ha(a,this.config)}}class ha extends dn{static [c_]="PgDate";getSQLType(){return"date"}mapFromDriverValue(a){return new Date(a)}mapToDriverValue(a){return a.toISOString()}}class hb extends g8{static [c_]="PgDateStringBuilder";constructor(a){super(a,"string","PgDateString")}build(a){return new hc(a,this.config)}}class hc extends dn{static [c_]="PgDateString";getSQLType(){return"date"}}function hd(a,b){let{name:c,config:d}=gM(a,b);return d?.mode==="date"?new g9(c):new hb(c)}class he extends dm{static [c_]="PgDoublePrecisionBuilder";constructor(a){super(a,"number","PgDoublePrecision")}build(a){return new hf(a,this.config)}}class hf extends dn{static [c_]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(a){return"string"==typeof a?Number.parseFloat(a):a}}function hg(a){return new he(a??"")}class hh extends dm{static [c_]="PgInetBuilder";constructor(a){super(a,"string","PgInet")}build(a){return new hi(a,this.config)}}class hi extends dn{static [c_]="PgInet";getSQLType(){return"inet"}}function hj(a){return new hh(a??"")}class hk extends gN{static [c_]="PgIntegerBuilder";constructor(a){super(a,"number","PgInteger")}build(a){return new hl(a,this.config)}}class hl extends dn{static [c_]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(a){return"string"==typeof a?Number.parseInt(a):a}}function hm(a){return new hk(a??"")}class hn extends dm{static [c_]="PgIntervalBuilder";constructor(a,b){super(a,"string","PgInterval"),this.config.intervalConfig=b}build(a){return new ho(a,this.config)}}class ho extends dn{static [c_]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let a=this.fields?` ${this.fields}`:"",b=this.precision?`(${this.precision})`:"";return`interval${a}${b}`}}function hp(a,b={}){let{name:c,config:d}=gM(a,b);return new hn(c,d)}class hq extends dm{static [c_]="PgJsonBuilder";constructor(a){super(a,"json","PgJson")}build(a){return new hr(a,this.config)}}class hr extends dn{static [c_]="PgJson";constructor(a,b){super(a,b)}getSQLType(){return"json"}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){if("string"==typeof a)try{return JSON.parse(a)}catch{}return a}}function hs(a){return new hq(a??"")}class ht extends dm{static [c_]="PgJsonbBuilder";constructor(a){super(a,"json","PgJsonb")}build(a){return new hu(a,this.config)}}class hu extends dn{static [c_]="PgJsonb";constructor(a,b){super(a,b)}getSQLType(){return"jsonb"}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){if("string"==typeof a)try{return JSON.parse(a)}catch{}return a}}function hv(a){return new ht(a??"")}class hw extends dm{static [c_]="PgLineBuilder";constructor(a){super(a,"array","PgLine")}build(a){return new hx(a,this.config)}}class hx extends dn{static [c_]="PgLine";getSQLType(){return"line"}mapFromDriverValue(a){let[b,c,d]=a.slice(1,-1).split(",");return[Number.parseFloat(b),Number.parseFloat(c),Number.parseFloat(d)]}mapToDriverValue(a){return`{${a[0]},${a[1]},${a[2]}}`}}class hy extends dm{static [c_]="PgLineABCBuilder";constructor(a){super(a,"json","PgLineABC")}build(a){return new hz(a,this.config)}}class hz extends dn{static [c_]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(a){let[b,c,d]=a.slice(1,-1).split(",");return{a:Number.parseFloat(b),b:Number.parseFloat(c),c:Number.parseFloat(d)}}mapToDriverValue(a){return`{${a.a},${a.b},${a.c}}`}}function hA(a,b){let{name:c,config:d}=gM(a,b);return d?.mode&&"tuple"!==d.mode?new hy(c):new hw(c)}class hB extends dm{static [c_]="PgMacaddrBuilder";constructor(a){super(a,"string","PgMacaddr")}build(a){return new hC(a,this.config)}}class hC extends dn{static [c_]="PgMacaddr";getSQLType(){return"macaddr"}}function hD(a){return new hB(a??"")}class hE extends dm{static [c_]="PgMacaddr8Builder";constructor(a){super(a,"string","PgMacaddr8")}build(a){return new hF(a,this.config)}}class hF extends dn{static [c_]="PgMacaddr8";getSQLType(){return"macaddr8"}}function hG(a){return new hE(a??"")}class hH extends dm{static [c_]="PgNumericBuilder";constructor(a,b,c){super(a,"string","PgNumeric"),this.config.precision=b,this.config.scale=c}build(a){return new hI(a,this.config)}}class hI extends dn{static [c_]="PgNumeric";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}mapFromDriverValue(a){return"string"==typeof a?a:String(a)}getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}class hJ extends dm{static [c_]="PgNumericNumberBuilder";constructor(a,b,c){super(a,"number","PgNumericNumber"),this.config.precision=b,this.config.scale=c}build(a){return new hK(a,this.config)}}class hK extends dn{static [c_]="PgNumericNumber";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}mapFromDriverValue(a){return"number"==typeof a?a:Number(a)}mapToDriverValue=String;getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}class hL extends dm{static [c_]="PgNumericBigIntBuilder";constructor(a,b,c){super(a,"bigint","PgNumericBigInt"),this.config.precision=b,this.config.scale=c}build(a){return new hM(a,this.config)}}class hM extends dn{static [c_]="PgNumericBigInt";precision;scale;constructor(a,b){super(a,b),this.precision=b.precision,this.scale=b.scale}mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){return void 0!==this.precision&&void 0!==this.scale?`numeric(${this.precision}, ${this.scale})`:void 0===this.precision?"numeric":`numeric(${this.precision})`}}function hN(a,b){let{name:c,config:d}=gM(a,b),e=d?.mode;return"number"===e?new hJ(c,d?.precision,d?.scale):"bigint"===e?new hL(c,d?.precision,d?.scale):new hH(c,d?.precision,d?.scale)}class hO extends dm{static [c_]="PgPointTupleBuilder";constructor(a){super(a,"array","PgPointTuple")}build(a){return new hP(a,this.config)}}class hP extends dn{static [c_]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(a){if("string"==typeof a){let[b,c]=a.slice(1,-1).split(",");return[Number.parseFloat(b),Number.parseFloat(c)]}return[a.x,a.y]}mapToDriverValue(a){return`(${a[0]},${a[1]})`}}class hQ extends dm{static [c_]="PgPointObjectBuilder";constructor(a){super(a,"json","PgPointObject")}build(a){return new hR(a,this.config)}}class hR extends dn{static [c_]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(a){if("string"==typeof a){let[b,c]=a.slice(1,-1).split(",");return{x:Number.parseFloat(b),y:Number.parseFloat(c)}}return a}mapToDriverValue(a){return`(${a.x},${a.y})`}}function hS(a,b){let{name:c,config:d}=gM(a,b);return d?.mode&&"tuple"!==d.mode?new hQ(c):new hO(c)}function hT(a,b){let c=new DataView(new ArrayBuffer(8));for(let d=0;d<8;d++)c.setUint8(d,a[b+d]);return c.getFloat64(0,!0)}function hU(a){let b=function(a){let b=[];for(let c=0;c<a.length;c+=2)b.push(Number.parseInt(a.slice(c,c+2),16));return new Uint8Array(b)}(a),c=0,d=b[0];c+=1;let e=new DataView(b.buffer),f=e.getUint32(c,1===d);if(c+=4,0x20000000&f&&(e.getUint32(c,1===d),c+=4),(65535&f)==1){let a=hT(b,c),d=hT(b,c+=8);return c+=8,[a,d]}throw Error("Unsupported geometry type")}class hV extends dm{static [c_]="PgGeometryBuilder";constructor(a){super(a,"array","PgGeometry")}build(a){return new hW(a,this.config)}}class hW extends dn{static [c_]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(a){return hU(a)}mapToDriverValue(a){return`point(${a[0]} ${a[1]})`}}class hX extends dm{static [c_]="PgGeometryObjectBuilder";constructor(a){super(a,"json","PgGeometryObject")}build(a){return new hY(a,this.config)}}class hY extends dn{static [c_]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(a){let b=hU(a);return{x:b[0],y:b[1]}}mapToDriverValue(a){return`point(${a.x} ${a.y})`}}function hZ(a,b){let{name:c,config:d}=gM(a,b);return d?.mode&&"tuple"!==d.mode?new hX(c):new hV(c)}class h$ extends dm{static [c_]="PgRealBuilder";constructor(a,b){super(a,"number","PgReal"),this.config.length=b}build(a){return new h_(a,this.config)}}class h_ extends dn{static [c_]="PgReal";constructor(a,b){super(a,b)}getSQLType(){return"real"}mapFromDriverValue=a=>"string"==typeof a?Number.parseFloat(a):a}function h0(a){return new h$(a??"")}class h1 extends dm{static [c_]="PgSerialBuilder";constructor(a){super(a,"number","PgSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new h2(a,this.config)}}class h2 extends dn{static [c_]="PgSerial";getSQLType(){return"serial"}}function h3(a){return new h1(a??"")}class h4 extends gN{static [c_]="PgSmallIntBuilder";constructor(a){super(a,"number","PgSmallInt")}build(a){return new h5(a,this.config)}}class h5 extends dn{static [c_]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=a=>"string"==typeof a?Number(a):a}function h6(a){return new h4(a??"")}class h7 extends dm{static [c_]="PgSmallSerialBuilder";constructor(a){super(a,"number","PgSmallSerial"),this.config.hasDefault=!0,this.config.notNull=!0}build(a){return new h8(a,this.config)}}class h8 extends dn{static [c_]="PgSmallSerial";getSQLType(){return"smallserial"}}function h9(a){return new h7(a??"")}class ia extends dm{static [c_]="PgTextBuilder";constructor(a,b){super(a,"string","PgText"),this.config.enumValues=b.enum}build(a){return new ib(a,this.config)}}class ib extends dn{static [c_]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}}function ic(a,b={}){let{name:c,config:d}=gM(a,b);return new ia(c,d)}class id extends g8{constructor(a,b,c){super(a,"string","PgTime"),this.withTimezone=b,this.precision=c,this.config.withTimezone=b,this.config.precision=c}static [c_]="PgTimeBuilder";build(a){return new ie(a,this.config)}}class ie extends dn{static [c_]="PgTime";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":`(${this.precision})`;return`time${a}${this.withTimezone?" with time zone":""}`}}function ig(a,b={}){let{name:c,config:d}=gM(a,b);return new id(c,d.withTimezone??!1,d.precision)}class ih extends g8{static [c_]="PgTimestampBuilder";constructor(a,b,c){super(a,"date","PgTimestamp"),this.config.withTimezone=b,this.config.precision=c}build(a){return new ii(a,this.config)}}class ii extends dn{static [c_]="PgTimestamp";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":` (${this.precision})`;return`timestamp${a}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=a=>new Date(this.withTimezone?a:a+"+0000");mapToDriverValue=a=>a.toISOString()}class ij extends g8{static [c_]="PgTimestampStringBuilder";constructor(a,b,c){super(a,"string","PgTimestampString"),this.config.withTimezone=b,this.config.precision=c}build(a){return new ik(a,this.config)}}class ik extends dn{static [c_]="PgTimestampString";withTimezone;precision;constructor(a,b){super(a,b),this.withTimezone=b.withTimezone,this.precision=b.precision}getSQLType(){let a=void 0===this.precision?"":`(${this.precision})`;return`timestamp${a}${this.withTimezone?" with time zone":""}`}}function il(a,b={}){let{name:c,config:d}=gM(a,b);return d?.mode==="string"?new ij(c,d.withTimezone??!1,d.precision):new ih(c,d?.withTimezone??!1,d?.precision)}class im extends dm{static [c_]="PgUUIDBuilder";constructor(a){super(a,"string","PgUUID")}defaultRandom(){return this.default(dK`gen_random_uuid()`)}build(a){return new io(a,this.config)}}class io extends dn{static [c_]="PgUUID";getSQLType(){return"uuid"}}function ip(a){return new im(a??"")}class iq extends dm{static [c_]="PgVarcharBuilder";constructor(a,b){super(a,"string","PgVarchar"),this.config.length=b.length,this.config.enumValues=b.enum}build(a){return new ir(a,this.config)}}class ir extends dn{static [c_]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return void 0===this.length?"varchar":`varchar(${this.length})`}}function is(a,b={}){let{name:c,config:d}=gM(a,b);return new iq(c,d)}class it extends dm{static [c_]="PgBinaryVectorBuilder";constructor(a,b){super(a,"string","PgBinaryVector"),this.config.dimensions=b.dimensions}build(a){return new iu(a,this.config)}}class iu extends dn{static [c_]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}}function iv(a,b){let{name:c,config:d}=gM(a,b);return new it(c,d)}class iw extends dm{static [c_]="PgHalfVectorBuilder";constructor(a,b){super(a,"array","PgHalfVector"),this.config.dimensions=b.dimensions}build(a){return new ix(a,this.config)}}class ix extends dn{static [c_]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){return a.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}function iy(a,b){let{name:c,config:d}=gM(a,b);return new iw(c,d)}class iz extends dm{static [c_]="PgSparseVectorBuilder";constructor(a,b){super(a,"string","PgSparseVector"),this.config.dimensions=b.dimensions}build(a){return new iA(a,this.config)}}class iA extends dn{static [c_]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}}function iB(a,b){let{name:c,config:d}=gM(a,b);return new iz(c,d)}class iC extends dm{static [c_]="PgVectorBuilder";constructor(a,b){super(a,"array","PgVector"),this.config.dimensions=b.dimensions}build(a){return new iD(a,this.config)}}class iD extends dn{static [c_]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(a){return JSON.stringify(a)}mapFromDriverValue(a){return a.slice(1,-1).split(",").map(a=>Number.parseFloat(a))}}function iE(a,b){let{name:c,config:d}=gM(a,b);return new iC(c,d)}let iF=Symbol.for("drizzle:PgInlineForeignKeys"),iG=Symbol.for("drizzle:EnableRLS");class iH extends db{static [c_]="PgTable";static Symbol=Object.assign({},db.Symbol,{InlineForeignKeys:iF,EnableRLS:iG});[iF]=[];[iG]=!1;[db.Symbol.ExtraConfigBuilder]=void 0;[db.Symbol.ExtraConfigColumns]={}}let iI=(a,b,c)=>(function(a,b,c,d,e=a){let f=new iH(a,d,e),g="function"==typeof b?b({bigint:gS,bigserial:gX,boolean:g$,char:g1,cidr:g4,customType:g7,date:hd,doublePrecision:hg,inet:hj,integer:hm,interval:hp,json:hs,jsonb:hv,line:hA,macaddr:hD,macaddr8:hG,numeric:hN,point:hS,geometry:hZ,real:h0,serial:h3,smallint:h6,smallserial:h9,text:ic,time:ig,timestamp:il,uuid:ip,varchar:is,bit:iv,halfvec:iy,sparsevec:iB,vector:iE}):b,h=Object.fromEntries(Object.entries(g).map(([a,b])=>{b.setName(a);let c=b.build(f);return f[iF].push(...b.buildForeignKeys(c,f)),[a,c]})),i=Object.fromEntries(Object.entries(g).map(([a,b])=>(b.setName(a),[a,b.buildExtraConfigColumn(f)]))),j=Object.assign(f,h);return j[db.Symbol.Columns]=h,j[db.Symbol.ExtraConfigColumns]=i,c&&(j[iH.Symbol.ExtraConfigBuilder]=c),Object.assign(j,{enableRLS:()=>(j[iH.Symbol.EnableRLS]=!0,j)})})(a,b,c,void 0);class iJ{constructor(a,b){this.name=a,this.value=b}static [c_]="PgCheckBuilder";brand;build(a){return new iK(a,this)}}class iK{constructor(a,b){this.table=a,this.name=b.name,this.value=b.value}static [c_]="PgCheck";name;value}class iL{constructor(a,b){this.unique=a,this.name=b}static [c_]="PgIndexBuilderOn";on(...a){return new iM(a.map(a=>{if(c0(a,dF))return a;let b=new dq(a.name,!!a.keyAsName,a.columnType,a.indexConfig);return a.indexConfig=JSON.parse(JSON.stringify(a.defaultConfig)),b}),this.unique,!1,this.name)}onOnly(...a){return new iM(a.map(a=>{if(c0(a,dF))return a;let b=new dq(a.name,!!a.keyAsName,a.columnType,a.indexConfig);return a.indexConfig=a.defaultConfig,b}),this.unique,!0,this.name)}using(a,...b){return new iM(b.map(a=>{if(c0(a,dF))return a;let b=new dq(a.name,!!a.keyAsName,a.columnType,a.indexConfig);return a.indexConfig=JSON.parse(JSON.stringify(a.defaultConfig)),b}),this.unique,!0,this.name,a)}}class iM{static [c_]="PgIndexBuilder";config;constructor(a,b,c,d,e="btree"){this.config={name:d,columns:a,unique:b,only:c,method:e}}concurrently(){return this.config.concurrently=!0,this}with(a){return this.config.with=a,this}where(a){return this.config.where=a,this}build(a){return new iN(this.config,a)}}class iN{static [c_]="PgIndex";config;constructor(a,b){this.config={...a,table:b}}}class iO{constructor(a,b){this.name=a,b&&(this.as=b.as,this.for=b.for,this.to=b.to,this.using=b.using,this.withCheck=b.withCheck)}static [c_]="PgPolicy";as;for;to;using;withCheck;_linkedTable;link(a){return this._linkedTable=a,this}}class iP{static [c_]="PgPrimaryKeyBuilder";columns;name;constructor(a,b){this.columns=a,this.name=b}build(a){return new iQ(a,this.columns,this.name)}}class iQ{constructor(a,b,c){this.table=a,this.columns=b,this.name=c}static [c_]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[iH.Symbol.Name]}_${this.columns.map(a=>a.name).join("_")}_pk`}}let iR=Symbol.for("drizzle:PgViewConfig");function iS(a){return(a.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map(a=>a.toLowerCase()).join("_")}function iT(a){return(a.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((a,b,c)=>a+(0===c?b.toLowerCase():`${b[0].toUpperCase()}${b.slice(1)}`),"")}function iU(a){return a}class iV{static [c_]="CasingCache";cache={};cachedTables={};convert;constructor(a){this.convert="snake_case"===a?iS:"camelCase"===a?iT:iU}getColumnCasing(a){if(!a.keyAsName)return a.name;let b=a.table[db.Symbol.Schema]??"public",c=a.table[db.Symbol.OriginalName],d=`${b}.${c}.${a.name}`;return this.cache[d]||this.cacheTable(a.table),this.cache[d]}cacheTable(a){let b=a[db.Symbol.Schema]??"public",c=a[db.Symbol.OriginalName],d=`${b}.${c}`;if(!this.cachedTables[d]){for(let b of Object.values(a[db.Symbol.Columns])){let a=`${d}.${b.name}`;this.cache[a]=this.convert(b.name)}this.cachedTables[d]=!0}}clearCache(){this.cache={},this.cachedTables={}}}class iW extends Error{static [c_]="DrizzleError";constructor({message:a,cause:b}){super(a),this.name="DrizzleError",this.cause=b}}class iX extends Error{constructor(a,b,c){super(`Failed query: ${a}
params: ${b}`),this.query=a,this.params=b,this.cause=c,Error.captureStackTrace(this,iX),c&&(this.cause=c)}}class iY extends iW{static [c_]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}class iZ{constructor(a,b,c){this.sourceTable=a,this.referencedTable=b,this.relationName=c,this.referencedTableName=b[db.Symbol.Name]}static [c_]="Relation";referencedTableName;fieldName}class i${constructor(a,b){this.table=a,this.config=b}static [c_]="Relations"}class i_ extends iZ{constructor(a,b,c,d){super(a,b,c?.relationName),this.config=c,this.isNullable=d}static [c_]="One";withFieldName(a){let b=new i_(this.sourceTable,this.referencedTable,this.config,this.isNullable);return b.fieldName=a,b}}class i0 extends iZ{constructor(a,b,c){super(a,b,c?.relationName),this.config=c}static [c_]="Many";withFieldName(a){let b=new i0(this.sourceTable,this.referencedTable,this.config);return b.fieldName=a,b}}function i1(a){return{one:function(b,c){return new i_(a,b,c,c?.fields.reduce((a,b)=>a&&b.notNull,!0)??!1)},many:function(b,c){return new i0(a,b,c)}}}class i2 extends dQ{static [c_]="PgViewBase"}class i3{static [c_]="PgDialect";casing;constructor(a){this.casing=new iV(a?.casing)}async migrate(a,b,c){let d="string"==typeof c?"__drizzle_migrations":c.migrationsTable??"__drizzle_migrations",e="string"==typeof c?"drizzle":c.migrationsSchema??"drizzle",f=dK`
			CREATE TABLE IF NOT EXISTS ${dK.identifier(e)}.${dK.identifier(d)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await b.execute(dK`CREATE SCHEMA IF NOT EXISTS ${dK.identifier(e)}`),await b.execute(f);let g=(await b.all(dK`select id, hash, created_at from ${dK.identifier(e)}.${dK.identifier(d)} order by created_at desc limit 1`))[0];await b.transaction(async b=>{for await(let c of a)if(!g||Number(g.created_at)<c.folderMillis){for(let a of c.sql)await b.execute(dK.raw(a));await b.execute(dK`insert into ${dK.identifier(e)}.${dK.identifier(d)} ("hash", "created_at") values(${c.hash}, ${c.folderMillis})`)}})}escapeName(a){return`"${a}"`}escapeParam(a){return`$${a+1}`}escapeString(a){return`'${a.replace(/'/g,"''")}'`}buildWithCTE(a){if(!a?.length)return;let b=[dK`with `];for(let[c,d]of a.entries())b.push(dK`${dK.identifier(d._.alias)} as (${d._.sql})`),c<a.length-1&&b.push(dK`, `);return b.push(dK` `),dK.join(b)}buildDeleteQuery({table:a,where:b,returning:c,withList:d}){let e=this.buildWithCTE(d),f=c?dK` returning ${this.buildSelection(c,{isSingleTable:!0})}`:void 0,g=b?dK` where ${b}`:void 0;return dK`${e}delete from ${a}${g}${f}`}buildUpdateSet(a,b){let c=a[db.Symbol.Columns],d=Object.keys(c).filter(a=>void 0!==b[a]||c[a]?.onUpdateFn!==void 0),e=d.length;return dK.join(d.flatMap((a,d)=>{let f=c[a],g=b[a]??dK.param(f.onUpdateFn(),f),h=dK`${dK.identifier(this.casing.getColumnCasing(f))} = ${g}`;return d<e-1?[h,dK.raw(", ")]:[h]}))}buildUpdateQuery({table:a,set:b,where:c,returning:d,withList:e,from:f,joins:g}){let h=this.buildWithCTE(e),i=a[iH.Symbol.Name],j=a[iH.Symbol.Schema],k=a[iH.Symbol.OriginalName],l=i===k?void 0:i,m=dK`${j?dK`${dK.identifier(j)}.`:void 0}${dK.identifier(k)}${l&&dK` ${dK.identifier(l)}`}`,n=this.buildUpdateSet(a,b),o=f&&dK.join([dK.raw(" from "),this.buildFromTable(f)]),p=this.buildJoins(g),q=d?dK` returning ${this.buildSelection(d,{isSingleTable:!f})}`:void 0,r=c?dK` where ${c}`:void 0;return dK`${h}update ${m} set ${n}${o}${p}${r}${q}`}buildSelection(a,{isSingleTable:b=!1}={}){let c=a.length,d=a.flatMap(({field:a},d)=>{let e=[];if(c0(a,dF.Aliased)&&a.isSelectionField)e.push(dK.identifier(a.fieldAlias));else if(c0(a,dF.Aliased)||c0(a,dF)){let c=c0(a,dF.Aliased)?a.sql:a;b?e.push(new dF(c.queryChunks.map(a=>c0(a,dn)?dK.identifier(this.casing.getColumnCasing(a)):a))):e.push(c),c0(a,dF.Aliased)&&e.push(dK` as ${dK.identifier(a.fieldAlias)}`)}else c0(a,c1)&&(b?e.push(dK.identifier(this.casing.getColumnCasing(a))):e.push(a));return d<c-1&&e.push(dK`, `),e});return dK.join(d)}buildJoins(a){if(!a||0===a.length)return;let b=[];for(let[c,d]of a.entries()){0===c&&b.push(dK` `);let e=d.table,f=d.lateral?dK` lateral`:void 0,g=d.on?dK` on ${d.on}`:void 0;if(c0(e,iH)){let a=e[iH.Symbol.Name],c=e[iH.Symbol.Schema],h=e[iH.Symbol.OriginalName],i=a===h?void 0:d.alias;b.push(dK`${dK.raw(d.joinType)} join${f} ${c?dK`${dK.identifier(c)}.`:void 0}${dK.identifier(h)}${i&&dK` ${dK.identifier(i)}`}${g}`)}else if(c0(e,dQ)){let a=e[dB].name,c=e[dB].schema,h=e[dB].originalName,i=a===h?void 0:d.alias;b.push(dK`${dK.raw(d.joinType)} join${f} ${c?dK`${dK.identifier(c)}.`:void 0}${dK.identifier(h)}${i&&dK` ${dK.identifier(i)}`}${g}`)}else b.push(dK`${dK.raw(d.joinType)} join${f} ${e}${g}`);c<a.length-1&&b.push(dK` `)}return dK.join(b)}buildFromTable(a){if(c0(a,db)&&a[db.Symbol.IsAlias]){let b=dK`${dK.identifier(a[db.Symbol.OriginalName])}`;return a[db.Symbol.Schema]&&(b=dK`${dK.identifier(a[db.Symbol.Schema])}.${b}`),dK`${b} ${dK.identifier(a[db.Symbol.Name])}`}return a}buildSelectQuery({withList:a,fields:b,fieldsFlat:c,where:d,having:e,table:f,joins:g,orderBy:h,groupBy:i,limit:j,offset:k,lockingClause:l,distinct:m,setOperators:n}){let o,p,q,r=c??gH(b);for(let a of r){let b;if(c0(a.field,c1)&&a.field.table[c2]!==(c0(f,dy)?f._.alias:c0(f,i2)?f[dB].name:c0(f,dF)?void 0:f[c2])&&(b=a.field.table,!g?.some(({alias:a})=>a===(b[db.Symbol.IsAlias]?b[c2]:b[db.Symbol.BaseName])))){let b=a.field.table[c2];throw Error(`Your "${a.path.join("->")}" field references a column "${b}"."${a.field.name}", but the table "${b}" is not part of the query! Did you forget to join it?`)}}let s=!g||0===g.length,t=this.buildWithCTE(a);m&&(o=!0===m?dK` distinct`:dK` distinct on (${dK.join(m.on,dK`, `)})`);let u=this.buildSelection(r,{isSingleTable:s}),v=this.buildFromTable(f),w=this.buildJoins(g),x=d?dK` where ${d}`:void 0,y=e?dK` having ${e}`:void 0;h&&h.length>0&&(p=dK` order by ${dK.join(h,dK`, `)}`),i&&i.length>0&&(q=dK` group by ${dK.join(i,dK`, `)}`);let z="object"==typeof j||"number"==typeof j&&j>=0?dK` limit ${j}`:void 0,A=k?dK` offset ${k}`:void 0,B=dK.empty();if(l){let a=dK` for ${dK.raw(l.strength)}`;l.config.of&&a.append(dK` of ${dK.join(Array.isArray(l.config.of)?l.config.of:[l.config.of],dK`, `)}`),l.config.noWait?a.append(dK` nowait`):l.config.skipLocked&&a.append(dK` skip locked`),B.append(a)}let C=dK`${t}select${o} ${u} from ${v}${w}${x}${q}${y}${p}${z}${A}${B}`;return n.length>0?this.buildSetOperations(C,n):C}buildSetOperations(a,b){let[c,...d]=b;if(!c)throw Error("Cannot pass undefined values to any set operator");return 0===d.length?this.buildSetOperationQuery({leftSelect:a,setOperator:c}):this.buildSetOperations(this.buildSetOperationQuery({leftSelect:a,setOperator:c}),d)}buildSetOperationQuery({leftSelect:a,setOperator:{type:b,isAll:c,rightSelect:d,limit:e,orderBy:f,offset:g}}){let h,i=dK`(${a.getSQL()}) `,j=dK`(${d.getSQL()})`;if(f&&f.length>0){let a=[];for(let b of f)if(c0(b,dn))a.push(dK.identifier(b.name));else if(c0(b,dF)){for(let a=0;a<b.queryChunks.length;a++){let c=b.queryChunks[a];c0(c,dn)&&(b.queryChunks[a]=dK.identifier(c.name))}a.push(dK`${b}`)}else a.push(dK`${b}`);h=dK` order by ${dK.join(a,dK`, `)} `}let k="object"==typeof e||"number"==typeof e&&e>=0?dK` limit ${e}`:void 0,l=dK.raw(`${b} ${c?"all ":""}`),m=g?dK` offset ${g}`:void 0;return dK`${i}${l}${j}${h}${k}${m}`}buildInsertQuery({table:a,values:b,onConflict:c,returning:d,withList:e,select:f,overridingSystemValue_:g}){let h=[],i=Object.entries(a[db.Symbol.Columns]).filter(([a,b])=>!b.shouldDisableInsert()),j=i.map(([,a])=>dK.identifier(this.casing.getColumnCasing(a)));if(f)c0(b,dF)?h.push(b):h.push(b.getSQL());else for(let[a,c]of(h.push(dK.raw("values ")),b.entries())){let d=[];for(let[a,b]of i){let e=c[a];if(void 0===e||c0(e,dJ)&&void 0===e.value)if(void 0!==b.defaultFn){let a=b.defaultFn(),c=c0(a,dF)?a:dK.param(a,b);d.push(c)}else if(b.default||void 0===b.onUpdateFn)d.push(dK`default`);else{let a=b.onUpdateFn(),c=c0(a,dF)?a:dK.param(a,b);d.push(c)}else d.push(e)}h.push(d),a<b.length-1&&h.push(dK`, `)}let k=this.buildWithCTE(e),l=dK.join(h),m=d?dK` returning ${this.buildSelection(d,{isSingleTable:!0})}`:void 0,n=c?dK` on conflict ${c}`:void 0,o=!0===g?dK`overriding system value `:void 0;return dK`${k}insert into ${a} ${j} ${o}${l}${n}${m}`}buildRefreshMaterializedViewQuery({view:a,concurrently:b,withNoData:c}){let d=b?dK` concurrently`:void 0,e=c?dK` with no data`:void 0;return dK`refresh materialized view${d} ${a}${e}`}prepareTyping(a){if(c0(a,hu)||c0(a,hr))return"json";if(c0(a,hI))return"decimal";if(c0(a,ie))return"time";if(c0(a,ii)||c0(a,ik))return"timestamp";if(c0(a,ha)||c0(a,hc))return"date";else if(c0(a,io))return"uuid";else return"none"}sqlToQuery(a,b){return a.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource:b})}buildRelationalQueryWithoutPK({fullSchema:a,schema:b,tableNamesMap:c,table:d,tableConfig:e,queryConfig:f,tableAlias:g,nestedQueryRelation:h,joinOn:i}){let j,k=[],l,m,n=[],o,p=[];if(!0===f)k=Object.entries(e.columns).map(([a,b])=>({dbKey:b.name,tsKey:a,field:gD(b,g),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let d=Object.fromEntries(Object.entries(e.columns).map(([a,b])=>[a,gD(b,g)]));if(f.where){let a="function"==typeof f.where?f.where(d,{and:dU,between:d5,eq:dS,exists:d3,gt:dX,gte:dY,ilike:d9,inArray:d_,isNull:d1,isNotNull:d2,like:d7,lt:dZ,lte:d$,ne:dT,not:dW,notBetween:d6,notExists:d4,notLike:d8,notIlike:ea,notInArray:d0,or:dV,sql:dK}):f.where;o=a&&gF(a,g)}let h=[],i=[];if(f.columns){let a=!1;for(let[b,c]of Object.entries(f.columns))void 0!==c&&b in e.columns&&(a||!0!==c||(a=!0),i.push(b));i.length>0&&(i=a?i.filter(a=>f.columns?.[a]===!0):Object.keys(e.columns).filter(a=>!i.includes(a)))}else i=Object.keys(e.columns);for(let a of i){let b=e.columns[a];h.push({tsKey:a,value:b})}let j=[];if(f.with&&(j=Object.entries(f.with).filter(a=>!!a[1]).map(([a,b])=>({tsKey:a,queryConfig:b,relation:e.relations[a]}))),f.extras)for(let[a,b]of Object.entries("function"==typeof f.extras?f.extras(d,{sql:dK}):f.extras))h.push({tsKey:a,value:gE(b,g)});for(let{tsKey:a,value:b}of h)k.push({dbKey:c0(b,dF.Aliased)?b.fieldAlias:e.columns[a].name,tsKey:a,field:c0(b,c1)?gD(b,g):b,relationTableTsKey:void 0,isJson:!1,selection:[]});let q="function"==typeof f.orderBy?f.orderBy(d,{sql:dK,asc:eb,desc:ec}):f.orderBy??[];for(let{tsKey:d,queryConfig:e,relation:h}of(Array.isArray(q)||(q=[q]),n=q.map(a=>c0(a,c1)?gD(a,g):gF(a,g)),l=f.limit,m=f.offset,j)){let f=function(a,b,c){if(c0(c,i_)&&c.config)return{fields:c.config.fields,references:c.config.references};let d=b[dc(c.referencedTable)];if(!d)throw Error(`Table "${c.referencedTable[db.Symbol.Name]}" not found in schema`);let e=a[d];if(!e)throw Error(`Table "${d}" not found in schema`);let f=c.sourceTable,g=b[dc(f)];if(!g)throw Error(`Table "${f[db.Symbol.Name]}" not found in schema`);let h=[];for(let a of Object.values(e.relations))(c.relationName&&c!==a&&a.relationName===c.relationName||!c.relationName&&a.referencedTable===c.sourceTable)&&h.push(a);if(h.length>1)throw c.relationName?Error(`There are multiple relations with name "${c.relationName}" in table "${d}"`):Error(`There are multiple relations between "${d}" and "${c.sourceTable[db.Symbol.Name]}". Please specify relation name`);if(h[0]&&c0(h[0],i_)&&h[0].config)return{fields:h[0].config.references,references:h[0].config.fields};throw Error(`There is not enough information to infer relation "${g}.${c.fieldName}"`)}(b,c,h),i=c[dc(h.referencedTable)],j=`${g}_${d}`,l=dU(...f.fields.map((a,b)=>dS(gD(f.references[b],j),gD(a,g)))),m=this.buildRelationalQueryWithoutPK({fullSchema:a,schema:b,tableNamesMap:c,table:a[i],tableConfig:b[i],queryConfig:c0(h,i_)?!0===e?{limit:1}:{...e,limit:1}:e,tableAlias:j,joinOn:l,nestedQueryRelation:h}),n=dK`${dK.identifier(j)}.${dK.identifier("data")}`.as(d);p.push({on:dK`true`,table:new dy(m.sql,{},j),alias:j,joinType:"left",lateral:!0}),k.push({dbKey:d,tsKey:d,field:n,relationTableTsKey:i,isJson:!0,selection:m.selection})}}if(0===k.length)throw new iW({message:`No fields selected for table "${e.tsName}" ("${g}")`});if(o=dU(i,o),h){let a=dK`json_build_array(${dK.join(k.map(({field:a,tsKey:b,isJson:c})=>c?dK`${dK.identifier(`${g}_${b}`)}.${dK.identifier("data")}`:c0(a,dF.Aliased)?a.sql:a),dK`, `)})`;c0(h,i0)&&(a=dK`coalesce(json_agg(${a}${n.length>0?dK` order by ${dK.join(n,dK`, `)}`:void 0}), '[]'::json)`);let b=[{dbKey:"data",tsKey:"data",field:a.as("data"),isJson:!0,relationTableTsKey:e.tsName,selection:k}];void 0!==l||void 0!==m||n.length>0?(j=this.buildSelectQuery({table:gC(d,g),fields:{},fieldsFlat:[{path:[],field:dK.raw("*")}],where:o,limit:l,offset:m,orderBy:n,setOperators:[]}),o=void 0,l=void 0,m=void 0,n=[]):j=gC(d,g),j=this.buildSelectQuery({table:c0(j,iH)?j:new dy(j,{},g),fields:{},fieldsFlat:b.map(({field:a})=>({path:[],field:c0(a,c1)?gD(a,g):a})),joins:p,where:o,limit:l,offset:m,orderBy:n,setOperators:[]})}else j=this.buildSelectQuery({table:gC(d,g),fields:{},fieldsFlat:k.map(({field:a})=>({path:[],field:c0(a,c1)?gD(a,g):a})),joins:p,where:o,limit:l,offset:m,orderBy:n,setOperators:[]});return{tableTsKey:e.tsName,sql:j,selection:k}}}class i4{static [c_]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}class i5{static [c_]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(a){this.fields=a.fields,this.session=a.session,this.dialect=a.dialect,a.withList&&(this.withList=a.withList),this.distinct=a.distinct}authToken;setToken(a){return this.authToken=a,this}from(a){let b,c=!!this.fields;return b=this.fields?this.fields:c0(a,dy)?Object.fromEntries(Object.keys(a._.selectedFields).map(b=>[b,a[b]])):c0(a,i2)?a[dB].selectedFields:c0(a,dF)?{}:gK(a),new i7({table:a,fields:b,isPartialSelect:c,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}}class i6 extends i4{static [c_]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table:a,fields:b,isPartialSelect:c,session:d,dialect:e,withList:f,distinct:g}){for(const h of(super(),this.config={withList:f,table:a,fields:{...b},distinct:g,setOperators:[]},this.isPartialSelect=c,this.session=d,this.dialect=e,this._={selectedFields:b,config:this.config},this.tableName=gL(a),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{},jq(a)))this.usedTables.add(h)}getUsedTables(){return[...this.usedTables]}createJoin(a,b){return(c,d)=>{let e=this.tableName,f=gL(c);for(let a of jq(c))this.usedTables.add(a);if("string"==typeof f&&this.config.joins?.some(a=>a.alias===f))throw Error(`Alias "${f}" is already used in this query`);if(!this.isPartialSelect&&(1===Object.keys(this.joinsNotNullableMap).length&&"string"==typeof e&&(this.config.fields={[e]:this.config.fields}),"string"==typeof f&&!c0(c,dF))){let a=c0(c,dy)?c._.selectedFields:c0(c,dQ)?c[dB].selectedFields:c[db.Symbol.Columns];this.config.fields[f]=a}if("function"==typeof d&&(d=d(new Proxy(this.config.fields,new gG({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.joins||(this.config.joins=[]),this.config.joins.push({on:d,table:c,joinType:a,alias:f,lateral:b}),"string"==typeof f)switch(a){case"left":this.joinsNotNullableMap[f]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[f]=!0;break;case"cross":case"inner":this.joinsNotNullableMap[f]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[f]=!1}return this}}leftJoin=this.createJoin("left",!1);leftJoinLateral=this.createJoin("left",!0);rightJoin=this.createJoin("right",!1);innerJoin=this.createJoin("inner",!1);innerJoinLateral=this.createJoin("inner",!0);fullJoin=this.createJoin("full",!1);crossJoin=this.createJoin("cross",!1);crossJoinLateral=this.createJoin("cross",!0);createSetOperator(a,b){return c=>{let d="function"==typeof c?c(i9()):c;if(!gI(this.getSelectedFields(),d.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type:a,isAll:b,rightSelect:d}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(a){return this.config.setOperators.push(...a),this}where(a){return"function"==typeof a&&(a=a(new Proxy(this.config.fields,new gG({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.where=a,this}having(a){return"function"==typeof a&&(a=a(new Proxy(this.config.fields,new gG({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))),this.config.having=a,this}groupBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.fields,new gG({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(b)?b:[b]}else this.config.groupBy=a;return this}orderBy(...a){if("function"==typeof a[0]){let b=a[0](new Proxy(this.config.fields,new gG({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),c=Array.isArray(b)?b:[b];this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=c:this.config.orderBy=c}else this.config.setOperators.length>0?this.config.setOperators.at(-1).orderBy=a:this.config.orderBy=a;return this}limit(a){return this.config.setOperators.length>0?this.config.setOperators.at(-1).limit=a:this.config.limit=a,this}offset(a){return this.config.setOperators.length>0?this.config.setOperators.at(-1).offset=a:this.config.offset=a,this}for(a,b={}){return this.config.lockingClause={strength:a,config:b},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}as(a){let b=[];if(b.push(...jq(this.config.table)),this.config.joins)for(let a of this.config.joins)b.push(...jq(a.table));return new Proxy(new dy(this.getSQL(),this.config.fields,a,!1,[...new Set(b)]),new gG({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new gG({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}$withCache(a){return this.cacheConfig=void 0===a?{config:{},enable:!0,autoInvalidate:!0}:!1===a?{enable:!1}:{enable:!0,autoInvalidate:!0,...a},this}}class i7 extends i6{static [c_]="PgSelect";_prepare(a){let{session:b,config:c,dialect:d,joinsNotNullableMap:e,authToken:f,cacheConfig:g,usedTables:h}=this;if(!b)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");let{fields:i}=c;return dA("drizzle.prepareQuery",()=>{let c=gH(i),j=b.prepareQuery(d.sqlToQuery(this.getSQL()),c,a,!0,void 0,{type:"select",tables:[...h]},g);return j.joinsNotNullableMap=e,j.setToken(f)})}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>dA("drizzle.operation",()=>this._prepare().execute(a,this.authToken))}for(let a of[gy])for(let b of Object.getOwnPropertyNames(a.prototype))"constructor"!==b&&Object.defineProperty(i7.prototype,b,Object.getOwnPropertyDescriptor(a.prototype,b)||Object.create(null));function i8(a,b){return(c,d,...e)=>{let f=[d,...e].map(c=>({type:a,isAll:b,rightSelect:c}));for(let a of f)if(!gI(c.getSelectedFields(),a.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return c.addSetOperators(f)}}let i9=()=>({union:ja,unionAll:jb,intersect:jc,intersectAll:jd,except:je,exceptAll:jf}),ja=i8("union",!1),jb=i8("union",!0),jc=i8("intersect",!1),jd=i8("intersect",!0),je=i8("except",!1),jf=i8("except",!0);class jg{static [c_]="PgQueryBuilder";dialect;dialectConfig;constructor(a){this.dialect=c0(a,i3)?a:void 0,this.dialectConfig=c0(a,i3)?void 0:a}$with=(a,b)=>{let c=this;return{as:d=>("function"==typeof d&&(d=d(c)),new Proxy(new dz(d.getSQL(),b??("getSelectedFields"in d?d.getSelectedFields()??{}:{}),a,!0),new gG({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};with(...a){let b=this;return{select:function(c){return new i5({fields:c??void 0,session:void 0,dialect:b.getDialect(),withList:a})},selectDistinct:function(a){return new i5({fields:a??void 0,session:void 0,dialect:b.getDialect(),distinct:!0})},selectDistinctOn:function(a,c){return new i5({fields:c??void 0,session:void 0,dialect:b.getDialect(),distinct:{on:a}})}}}select(a){return new i5({fields:a??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(a){return new i5({fields:a??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(a,b){return new i5({fields:b??void 0,session:void 0,dialect:this.getDialect(),distinct:{on:a}})}getDialect(){return this.dialect||(this.dialect=new i3(this.dialectConfig)),this.dialect}}class jh{constructor(a,b){this.name=a,this.schema=b}static [c_]="PgDefaultViewBuilderCore";config={};with(a){return this.config.with=a,this}}class ji extends jh{static [c_]="PgViewBuilder";as(a){"function"==typeof a&&(a=a(new jg));let b=new gG({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),c=new Proxy(a.getSelectedFields(),b);return new Proxy(new jn({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:c,query:a.getSQL().inlineParams()}}),b)}}class jj extends jh{static [c_]="PgManualViewBuilder";columns;constructor(a,b,c){super(a,c),this.columns=gK(iI(a,b))}existing(){return new Proxy(new jn({pgConfig:void 0,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new gG({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(a){return new Proxy(new jn({pgConfig:this.config,config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:a.inlineParams()}}),new gG({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}}class jk{constructor(a,b){this.name=a,this.schema=b}static [c_]="PgMaterializedViewBuilderCore";config={};using(a){return this.config.using=a,this}with(a){return this.config.with=a,this}tablespace(a){return this.config.tablespace=a,this}withNoData(){return this.config.withNoData=!0,this}}class jl extends jk{static [c_]="PgMaterializedViewBuilder";as(a){"function"==typeof a&&(a=a(new jg));let b=new gG({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}),c=new Proxy(a.getSelectedFields(),b);return new Proxy(new jp({pgConfig:{with:this.config.with,using:this.config.using,tablespace:this.config.tablespace,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:c,query:a.getSQL().inlineParams()}}),b)}}class jm extends jk{static [c_]="PgManualMaterializedViewBuilder";columns;constructor(a,b,c){super(a,c),this.columns=gK(iI(a,b))}existing(){return new Proxy(new jp({pgConfig:{tablespace:this.config.tablespace,using:this.config.using,with:this.config.with,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:void 0}}),new gG({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}as(a){return new Proxy(new jp({pgConfig:{tablespace:this.config.tablespace,using:this.config.using,with:this.config.with,withNoData:this.config.withNoData},config:{name:this.name,schema:this.schema,selectedFields:this.columns,query:a.inlineParams()}}),new gG({alias:this.name,sqlBehavior:"error",sqlAliasedBehavior:"alias",replaceOriginalName:!0}))}}class jn extends i2{static [c_]="PgView";[iR];constructor({pgConfig:a,config:b}){super(b),a&&(this[iR]={with:a.with})}}let jo=Symbol.for("drizzle:PgMaterializedViewConfig");class jp extends i2{static [c_]="PgMaterializedView";[jo];constructor({pgConfig:a,config:b}){super(b),this[jo]={with:a?.with,using:a?.using,tablespace:a?.tablespace,withNoData:a?.withNoData}}}function jq(a){return c0(a,iH)?[a[c3]?`${a[c3]}.${a[db.Symbol.BaseName]}`:a[db.Symbol.BaseName]]:c0(a,dy)?a._.usedTables??[]:c0(a,dF)?a.usedTables??[]:[]}class jr extends gy{constructor(a,b,c,d){super(),this.session=b,this.dialect=c,this.config={table:a,withList:d}}static [c_]="PgDelete";config;cacheConfig;where(a){return this.config.where=a,this}returning(a=this.config.table[db.Symbol.Columns]){return this.config.returningFields=a,this.config.returning=gH(a),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a){return dA("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,a,!0,void 0,{type:"delete",tables:jq(this.config.table)},this.cacheConfig))}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>dA("drizzle.operation",()=>this._prepare().execute(a,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new gG({alias:this.config.table[c2],sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class js{constructor(a,b,c,d,e){this.table=a,this.session=b,this.dialect=c,this.withList=d,this.overridingSystemValue_=e}static [c_]="PgInsertBuilder";authToken;setToken(a){return this.authToken=a,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(a){if(0===(a=Array.isArray(a)?a:[a]).length)throw Error("values() must be called with at least one value");let b=a.map(a=>{let b={},c=this.table[db.Symbol.Columns];for(let d of Object.keys(a)){let e=a[d];b[d]=c0(e,dF)?e:new dJ(e,c[d])}return b});return new jt(this.table,b,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(a){let b="function"==typeof a?a(new jg):a;if(!c0(b,dF)&&!gI(this.table[c4],b._.selectedFields))throw Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new jt(this.table,b,this.session,this.dialect,this.withList,!0)}}class jt extends gy{constructor(a,b,c,d,e,f,g){super(),this.session=c,this.dialect=d,this.config={table:a,values:b,withList:e,select:f,overridingSystemValue_:g}}static [c_]="PgInsert";config;cacheConfig;returning(a=this.config.table[db.Symbol.Columns]){return this.config.returningFields=a,this.config.returning=gH(a),this}onConflictDoNothing(a={}){if(void 0===a.target)this.config.onConflict=dK`do nothing`;else{let b="";b=Array.isArray(a.target)?a.target.map(a=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(a))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(a.target));let c=a.where?dK` where ${a.where}`:void 0;this.config.onConflict=dK`(${dK.raw(b)})${c} do nothing`}return this}onConflictDoUpdate(a){if(a.where&&(a.targetWhere||a.setWhere))throw Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let b=a.where?dK` where ${a.where}`:void 0,c=a.targetWhere?dK` where ${a.targetWhere}`:void 0,d=a.setWhere?dK` where ${a.setWhere}`:void 0,e=this.dialect.buildUpdateSet(this.config.table,gJ(this.config.table,a.set)),f="";return f=Array.isArray(a.target)?a.target.map(a=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(a))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(a.target)),this.config.onConflict=dK`(${dK.raw(f)})${c} do update set ${e}${b}${d}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a){return dA("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,a,!0,void 0,{type:"insert",tables:jq(this.config.table)},this.cacheConfig))}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>dA("drizzle.operation",()=>this._prepare().execute(a,this.authToken));getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new gG({alias:this.config.table[c2],sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class ju{constructor(a,b,c,d){this.table=a,this.session=b,this.dialect=c,this.withList=d}static [c_]="PgUpdateBuilder";authToken;setToken(a){return this.authToken=a,this}set(a){return new jv(this.table,gJ(this.table,a),this.session,this.dialect,this.withList).setToken(this.authToken)}}class jv extends gy{constructor(a,b,c,d,e){super(),this.session=c,this.dialect=d,this.config={set:b,table:a,withList:e,joins:[]},this.tableName=gL(a),this.joinsNotNullableMap="string"==typeof this.tableName?{[this.tableName]:!0}:{}}static [c_]="PgUpdate";config;tableName;joinsNotNullableMap;cacheConfig;from(a){let b=gL(a);return"string"==typeof b&&(this.joinsNotNullableMap[b]=!0),this.config.from=a,this}getTableLikeFields(a){return c0(a,iH)?a[db.Symbol.Columns]:c0(a,dy)?a._.selectedFields:a[dB].selectedFields}createJoin(a){return(b,c)=>{let d=gL(b);if("string"==typeof d&&this.config.joins.some(a=>a.alias===d))throw Error(`Alias "${d}" is already used in this query`);if("function"==typeof c){let a=this.config.from&&!c0(this.config.from,dF)?this.getTableLikeFields(this.config.from):void 0;c=c(new Proxy(this.config.table[db.Symbol.Columns],new gG({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),a&&new Proxy(a,new gG({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on:c,table:b,joinType:a,alias:d}),"string"==typeof d)switch(a){case"left":this.joinsNotNullableMap[d]=!1;break;case"right":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[d]=!0;break;case"inner":this.joinsNotNullableMap[d]=!0;break;case"full":this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([a])=>[a,!1])),this.joinsNotNullableMap[d]=!1}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(a){return this.config.where=a,this}returning(a){if(!a&&(a=Object.assign({},this.config.table[db.Symbol.Columns]),this.config.from)){let b=gL(this.config.from);if("string"==typeof b&&this.config.from&&!c0(this.config.from,dF)){let c=this.getTableLikeFields(this.config.from);a[b]=c}for(let b of this.config.joins){let c=gL(b.table);if("string"==typeof c&&!c0(b.table,dF)){let d=this.getTableLikeFields(b.table);a[c]=d}}}return this.config.returningFields=a,this.config.returning=gH(a),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a){let b=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,a,!0,void 0,{type:"insert",tables:jq(this.config.table)},this.cacheConfig);return b.joinsNotNullableMap=this.joinsNotNullableMap,b}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>this._prepare().execute(a,this.authToken);getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new gG({alias:this.config.table[c2],sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class jw extends dF{constructor(a){super(jw.buildEmbeddedCount(a.source,a.filters).queryChunks),this.params=a,this.mapWith(Number),this.session=a.session,this.sql=jw.buildCount(a.source,a.filters)}sql;token;static [c_]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(a,b){return dK`(select count(*) from ${a}${dK.raw(" where ").if(b)}${b})`}static buildCount(a,b){return dK`select count(*) as count from ${a}${dK.raw(" where ").if(b)}${b};`}setToken(a){return this.token=a,this}then(a,b){return Promise.resolve(this.session.count(this.sql,this.token)).then(a,b)}catch(a){return this.then(void 0,a)}finally(a){return this.then(b=>(a?.(),b),b=>{throw a?.(),b})}}class jx{constructor(a,b,c,d,e,f,g){this.fullSchema=a,this.schema=b,this.tableNamesMap=c,this.table=d,this.tableConfig=e,this.dialect=f,this.session=g}static [c_]="PgRelationalQueryBuilder";findMany(a){return new jy(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a||{},"many")}findFirst(a){return new jy(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,a?{...a,limit:1}:{limit:1},"first")}}class jy extends gy{constructor(a,b,c,d,e,f,g,h,i){super(),this.fullSchema=a,this.schema=b,this.tableNamesMap=c,this.table=d,this.tableConfig=e,this.dialect=f,this.session=g,this.config=h,this.mode=i}static [c_]="PgRelationalQuery";_prepare(a){return dA("drizzle.prepareQuery",()=>{let{query:b,builtQuery:c}=this._toSQL();return this.session.prepareQuery(c,void 0,a,!0,(a,c)=>{let d=a.map(a=>(function a(b,c,d,e,f=a=>a){let g={};for(let[h,i]of e.entries())if(i.isJson){let e=c.relations[i.tsKey],j=d[h],k="string"==typeof j?JSON.parse(j):j;g[i.tsKey]=c0(e,i_)?k&&a(b,b[i.relationTableTsKey],k,i.selection,f):k.map(c=>a(b,b[i.relationTableTsKey],c,i.selection,f))}else{let a,b=f(d[h]),c=i.field;a=c0(c,c1)?c:c0(c,dF)?c.decoder:c.sql.decoder,g[i.tsKey]=null===b?null:a.mapFromDriverValue(b)}return g})(this.schema,this.tableConfig,a,b.selection,c));return"first"===this.mode?d[0]:d})})}prepare(a){return this._prepare(a)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let a=this._getQuery(),b=this.dialect.sqlToQuery(a.sql);return{query:a,builtQuery:b}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(a){return this.authToken=a,this}execute(){return dA("drizzle.operation",()=>this._prepare().execute(void 0,this.authToken))}}class jz extends gy{constructor(a,b,c,d){super(),this.execute=a,this.sql=b,this.query=c,this.mapBatchResult=d}static [c_]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(a,b){return b?this.mapBatchResult(a):a}_prepare(){return this}isResponseInArrayMode(){return!1}}class jA extends gy{constructor(a,b,c){super(),this.session=b,this.dialect=c,this.config={view:a}}static [c_]="PgRefreshMaterializedView";config;concurrently(){if(void 0!==this.config.withNoData)throw Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(void 0!==this.config.concurrently)throw Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:a,...b}=this.dialect.sqlToQuery(this.getSQL());return b}_prepare(a){return dA("drizzle.prepareQuery",()=>this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,a,!0))}prepare(a){return this._prepare(a)}authToken;setToken(a){return this.authToken=a,this}execute=a=>dA("drizzle.operation",()=>this._prepare().execute(a,this.authToken))}class jB{constructor(a,b,c){if(this.dialect=a,this.session=b,this._=c?{schema:c.schema,fullSchema:c.fullSchema,tableNamesMap:c.tableNamesMap,session:b}:{schema:void 0,fullSchema:{},tableNamesMap:{},session:b},this.query={},this._.schema)for(const[d,e]of Object.entries(this._.schema))this.query[d]=new jx(c.fullSchema,this._.schema,this._.tableNamesMap,c.fullSchema[d],e,a,b);this.$cache={invalidate:async a=>{}}}static [c_]="PgDatabase";query;$with=(a,b)=>{let c=this;return{as:d=>("function"==typeof d&&(d=d(new jg(c.dialect))),new Proxy(new dz(d.getSQL(),b??("getSelectedFields"in d?d.getSelectedFields()??{}:{}),a,!0),new gG({alias:a,sqlAliasedBehavior:"alias",sqlBehavior:"error"})))}};$count(a,b){return new jw({source:a,filters:b,session:this.session})}$cache;with(...a){let b=this;return{select:function(c){return new i5({fields:c??void 0,session:b.session,dialect:b.dialect,withList:a})},selectDistinct:function(c){return new i5({fields:c??void 0,session:b.session,dialect:b.dialect,withList:a,distinct:!0})},selectDistinctOn:function(c,d){return new i5({fields:d??void 0,session:b.session,dialect:b.dialect,withList:a,distinct:{on:c}})},update:function(c){return new ju(c,b.session,b.dialect,a)},insert:function(c){return new js(c,b.session,b.dialect,a)},delete:function(c){return new jr(c,b.session,b.dialect,a)}}}select(a){return new i5({fields:a??void 0,session:this.session,dialect:this.dialect})}selectDistinct(a){return new i5({fields:a??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(a,b){return new i5({fields:b??void 0,session:this.session,dialect:this.dialect,distinct:{on:a}})}update(a){return new ju(a,this.session,this.dialect)}insert(a){return new js(a,this.session,this.dialect)}delete(a){return new jr(a,this.session,this.dialect)}refreshMaterializedView(a){return new jA(a,this.session,this.dialect)}authToken;execute(a){let b="string"==typeof a?dK.raw(a):a.getSQL(),c=this.dialect.sqlToQuery(b),d=this.session.prepareQuery(c,void 0,void 0,!1);return new jz(()=>d.execute(void 0,this.authToken),b,c,a=>d.mapResult(a,!0))}transaction(a,b){return this.session.transaction(a,b)}}class jC{static [c_]="Cache"}class jD extends jC{strategy(){return"all"}static [c_]="NoopCache";async get(a){}async put(a,b,c,d){}async onMutate(a){}}async function jE(a,b){let c=`${a}-${JSON.stringify(b)}`,d=new TextEncoder().encode(c);return[...new Uint8Array(await crypto.subtle.digest("SHA-256",d))].map(a=>a.toString(16).padStart(2,"0")).join("")}class jF{constructor(a,b,c,d){this.query=a,this.cache=b,this.queryMetadata=c,this.cacheConfig=d,b&&"all"===b.strategy()&&void 0===d&&(this.cacheConfig={enable:!0,autoInvalidate:!0}),this.cacheConfig?.enable||(this.cacheConfig=void 0)}authToken;getQuery(){return this.query}mapResult(a,b){return a}setToken(a){return this.authToken=a,this}static [c_]="PgPreparedQuery";joinsNotNullableMap;async queryWithCache(a,b,c){if(void 0===this.cache||c0(this.cache,jD)||void 0===this.queryMetadata||this.cacheConfig&&!this.cacheConfig.enable)try{return await c()}catch(c){throw new iX(a,b,c)}if(("insert"===this.queryMetadata.type||"update"===this.queryMetadata.type||"delete"===this.queryMetadata.type)&&this.queryMetadata.tables.length>0)try{let[a]=await Promise.all([c(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return a}catch(c){throw new iX(a,b,c)}if(!this.cacheConfig)try{return await c()}catch(c){throw new iX(a,b,c)}if("select"===this.queryMetadata.type){let d=await this.cache.get(this.cacheConfig.tag??await jE(a,b),this.queryMetadata.tables,void 0!==this.cacheConfig.tag,this.cacheConfig.autoInvalidate);if(void 0===d){let d;try{d=await c()}catch(c){throw new iX(a,b,c)}return await this.cache.put(this.cacheConfig.tag??await jE(a,b),d,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],void 0!==this.cacheConfig.tag,this.cacheConfig.config),d}return d}try{return await c()}catch(c){throw new iX(a,b,c)}}}class jG{constructor(a){this.dialect=a}static [c_]="PgSession";execute(a,b){return dA("drizzle.operation",()=>dA("drizzle.prepareQuery",()=>this.prepareQuery(this.dialect.sqlToQuery(a),void 0,void 0,!1)).setToken(b).execute(void 0,b))}all(a){return this.prepareQuery(this.dialect.sqlToQuery(a),void 0,void 0,!1).all()}async count(a,b){return Number((await this.execute(a,b))[0].count)}}class jH extends jB{constructor(a,b,c,d=0){super(a,b,c),this.schema=c,this.nestedIndex=d}static [c_]="PgTransaction";rollback(){throw new iY}getTransactionConfigSQL(a){let b=[];return a.isolationLevel&&b.push(`isolation level ${a.isolationLevel}`),a.accessMode&&b.push(a.accessMode),"boolean"==typeof a.deferrable&&b.push(a.deferrable?"deferrable":"not deferrable"),dK.raw(b.join(" "))}setTransaction(a){return this.session.execute(dK`set transaction ${this.getTransactionConfigSQL(a)}`)}}let jI={arrayMode:!1,fullResults:!0},jJ={arrayMode:!0,fullResults:!0};class jK extends jF{constructor(a,b,c,d,e,f,g,h,i){super(b,d,e,f),this.client=a,this.logger=c,this.fields=g,this._isResponseInArrayMode=h,this.customResultMapper=i,this.clientQuery=a.query??a}static [c_]="NeonHttpPreparedQuery";clientQuery;async execute(a={},b=this.authToken){let c=dO(this.query.params,a);this.logger.logQuery(this.query.sql,c);let{fields:d,clientQuery:e,query:f,customResultMapper:g}=this;if(!d&&!g)return this.queryWithCache(f.sql,c,async()=>e(f.sql,c,void 0===b?jI:{...jI,authToken:b}));let h=await this.queryWithCache(f.sql,c,async()=>await e(f.sql,c,void 0===b?jJ:{...jJ,authToken:b}));return this.mapResult(h)}mapResult(a){if(!this.fields&&!this.customResultMapper)return a;let b=a.rows;return this.customResultMapper?this.customResultMapper(b):b.map(a=>(function(a,b,c){let d={},e=a.reduce((a,{path:e,field:f},g)=>{let h;h=c0(f,c1)?f:c0(f,dF)?f.decoder:f.sql.decoder;let i=a;for(let[a,j]of e.entries())if(a<e.length-1)j in i||(i[j]={}),i=i[j];else{let a=b[g],k=i[j]=null===a?null:h.mapFromDriverValue(a);if(c&&c0(f,c1)&&2===e.length){let a=e[0];a in d?"string"==typeof d[a]&&d[a]!==f.table[c2]&&(d[a]=!1):d[a]=null===k&&f.table[c2]}}return a},{});if(c&&Object.keys(d).length>0)for(let[a,b]of Object.entries(d))"string"!=typeof b||c[b]||(e[a]=null);return e})(this.fields,a,this.joinsNotNullableMap))}all(a={}){let b=dO(this.query.params,a);return this.logger.logQuery(this.query.sql,b),this.clientQuery(this.query.sql,b,void 0===this.authToken?jI:{...jI,authToken:this.authToken}).then(a=>a.rows)}values(a={},b){let c=dO(this.query.params,a);return this.logger.logQuery(this.query.sql,c),this.clientQuery(this.query.sql,c,{arrayMode:!0,fullResults:!0,authToken:b}).then(a=>a.rows)}isResponseInArrayMode(){return this._isResponseInArrayMode}}class jL extends jG{constructor(a,b,c,d={}){super(b),this.client=a,this.schema=c,this.options=d,this.clientQuery=a.query??a,this.logger=d.logger??new gx,this.cache=d.cache??new jD}static [c_]="NeonHttpSession";clientQuery;logger;cache;prepareQuery(a,b,c,d,e,f,g){return new jK(this.client,a,this.logger,this.cache,f,g,b,d,e)}async batch(a){let b=[],c=[];for(let d of a){let a=d._prepare(),e=a.getQuery();b.push(a),c.push(this.clientQuery(e.sql,e.params,{fullResults:!0,arrayMode:a.isResponseInArrayMode()}))}return(await this.client.transaction(c,jJ)).map((a,c)=>b[c].mapResult(a,!0))}async query(a,b){return this.logger.logQuery(a,b),await this.clientQuery(a,b,{arrayMode:!0,fullResults:!0})}async queryObjects(a,b){return this.clientQuery(a,b,{arrayMode:!1,fullResults:!0})}async count(a,b){return Number((await this.execute(a,b)).rows[0].count)}async transaction(a,b={}){throw Error("No transactions support in neon-http driver")}}class jM extends jH{static [c_]="NeonHttpTransaction";async transaction(a){throw Error("No transactions support in neon-http driver")}}class jN{constructor(a,b,c={}){this.client=a,this.dialect=b,this.options=c,this.initMappers()}static [c_]="NeonHttpDriver";createSession(a){return new jL(this.client,this.dialect,a,{logger:this.options.logger,cache:this.options.cache})}initMappers(){gu.setTypeParser(gu.builtins.TIMESTAMPTZ,a=>a),gu.setTypeParser(gu.builtins.TIMESTAMP,a=>a),gu.setTypeParser(gu.builtins.DATE,a=>a),gu.setTypeParser(gu.builtins.INTERVAL,a=>a),gu.setTypeParser(1231,a=>a),gu.setTypeParser(1115,a=>a),gu.setTypeParser(1185,a=>a),gu.setTypeParser(1187,a=>a),gu.setTypeParser(1182,a=>a)}}function jO(a,b,c,d){return new Proxy(a,{get(a,e){let f=a[e];return"function"!=typeof f&&("object"!=typeof f||null===f)?f:d?jO(f,b,c):"query"===e?jO(f,b,c,!0):new Proxy(f,{apply(a,d,f){let g=a.call(d,...f);return"object"==typeof g&&null!==g&&"setToken"in g&&"function"==typeof g.setToken&&g.setToken(b),c(a,e,g)}})}})}class jP extends jB{static [c_]="NeonHttpDatabase";$withAuth(a){return this.authToken=a,jO(this,a,(b,c,d)=>"with"===c?jO(d,a,(a,b,c)=>c):d)}async batch(a){return this.session.batch(a)}}function jQ(a,b={}){let c,d,e=new i3({casing:b.casing});if(!0===b.logger?c=new gw:!1!==b.logger&&(c=b.logger),b.schema){let a=function(a,b){1===Object.keys(a).length&&"default"in a&&!c0(a.default,db)&&(a=a.default);let c={},d={},e={};for(let[f,g]of Object.entries(a))if(c0(g,db)){let a=dc(g),b=d[a];for(let d of(c[a]=f,e[f]={tsName:f,dbName:g[db.Symbol.Name],schema:g[db.Symbol.Schema],columns:g[db.Symbol.Columns],relations:b?.relations??{},primaryKey:b?.primaryKey??[]},Object.values(g[db.Symbol.Columns])))d.primary&&e[f].primaryKey.push(d);let h=g[db.Symbol.ExtraConfigBuilder]?.(g[db.Symbol.ExtraConfigColumns]);if(h)for(let a of Object.values(h))c0(a,iP)&&e[f].primaryKey.push(...a.columns)}else if(c0(g,i$)){let a,f=dc(g.table),h=c[f];for(let[c,i]of Object.entries(g.config(b(g.table))))if(h){let b=e[h];b.relations[c]=i,a&&b.primaryKey.push(...a)}else f in d||(d[f]={relations:{},primaryKey:a}),d[f].relations[c]=i}return{tables:e,tableNamesMap:c}}(b.schema,i1);d={fullSchema:b.schema,schema:a.tables,tableNamesMap:a.tableNamesMap}}let f=new jN(a,e,{logger:c,cache:b.cache}).createSession(d),g=new jP(e,f,d);return g.$client=a,g.$cache=b.cache,g.$cache&&(g.$cache.invalidate=b.cache?.onMutate),g}function jR(...a){if("string"==typeof a[0])return jQ(gj(a[0]),a[1]);if(function(a){if("object"!=typeof a||null===a||"Object"!==a.constructor.name)return!1;if("logger"in a){let b=typeof a.logger;return"boolean"===b||"object"===b&&"function"==typeof a.logger.logQuery||"undefined"===b}if("schema"in a){let b=typeof a.schema;return"object"===b||"undefined"===b}if("casing"in a){let b=typeof a.casing;return"string"===b||"undefined"===b}if("mode"in a)return"default"===a.mode&&"planetscale"===a.mode&&void 0===a.mode;if("connection"in a){let b=typeof a.connection;return"string"===b||"object"===b||"undefined"===b}if("client"in a){let b=typeof a.client;return"object"===b||"function"===b||"undefined"===b}return 0===Object.keys(a).length}(a[0])){let{connection:b,client:c,...d}=a[0];if(c)return jQ(c,d);if("object"==typeof b){let{connectionString:a,...c}=b;return jQ(gj(a,c),d)}return jQ(gj(b),d)}return jQ(a[0],a[1])}(jR||(jR={})).mock=function(a){return jQ({},a)};let jS=iI("user",{id:ic("id").primaryKey(),name:ic("name").notNull(),email:ic("email").notNull().unique(),emailVerified:g$("email_verified").default(!1).notNull(),image:ic("image"),createdAt:il("created_at").defaultNow().notNull(),updatedAt:il("updated_at").defaultNow().$onUpdate(()=>new Date).notNull()}),jT=iI("session",{id:ic("id").primaryKey(),expiresAt:il("expires_at").notNull(),token:ic("token").notNull().unique(),createdAt:il("created_at").defaultNow().notNull(),updatedAt:il("updated_at").$onUpdate(()=>new Date).notNull(),ipAddress:ic("ip_address"),userAgent:ic("user_agent"),userId:ic("user_id").notNull().references(()=>jS.id,{onDelete:"cascade"})}),jU=iI("account",{id:ic("id").primaryKey(),accountId:ic("account_id").notNull(),providerId:ic("provider_id").notNull(),userId:ic("user_id").notNull().references(()=>jS.id,{onDelete:"cascade"}),accessToken:ic("access_token"),refreshToken:ic("refresh_token"),idToken:ic("id_token"),accessTokenExpiresAt:il("access_token_expires_at"),refreshTokenExpiresAt:il("refresh_token_expires_at"),scope:ic("scope"),password:ic("password"),createdAt:il("created_at").defaultNow().notNull(),updatedAt:il("updated_at").$onUpdate(()=>new Date).notNull()}),jV=iI("verification",{id:ic("id").primaryKey(),identifier:ic("identifier").notNull(),value:ic("value").notNull(),expiresAt:il("expires_at").notNull(),createdAt:il("created_at").defaultNow().notNull(),updatedAt:il("updated_at").defaultNow().$onUpdate(()=>new Date).notNull()}),jW=iI("apikey",{id:ic("id").primaryKey(),name:ic("name"),start:ic("start"),prefix:ic("prefix"),key:ic("key").notNull(),userId:ic("user_id").notNull().references(()=>jS.id,{onDelete:"cascade"}),refillInterval:hm("refill_interval"),refillAmount:hm("refill_amount"),lastRefillAt:il("last_refill_at"),enabled:g$("enabled").default(!0),rateLimitEnabled:g$("rate_limit_enabled").default(!0),rateLimitTimeWindow:hm("rate_limit_time_window").default(36e5),rateLimitMax:hm("rate_limit_max").default(100),requestCount:hm("request_count").default(0),remaining:hm("remaining"),lastRequest:il("last_request"),expiresAt:il("expires_at"),createdAt:il("created_at").notNull(),updatedAt:il("updated_at").notNull(),permissions:ic("permissions"),metadata:ic("metadata")}),jX={user:jS,session:jT,account:jU,verification:jV,apikey:jW};a.s(["account",0,jU,"apikey",0,jW,"authSchema",0,jX,"session",0,jT,"user",0,jS,"verification",0,jV],43476);let jY=iI("clients",{id:ic("id").primaryKey(),userId:ic("user_id").notNull().references(()=>jS.id),name:ic("name").notNull(),email:ic("email"),phone:ic("phone"),address:ic("address"),notes:ic("notes"),createdAt:il("created_at").defaultNow().notNull(),updatedAt:il("updated_at").defaultNow().notNull()}),jZ=iI("devis",{id:ic("id").primaryKey(),userId:ic("user_id").notNull().references(()=>jS.id),clientId:ic("client_id").notNull().references(()=>jY.id),number:ic("number").notNull(),status:ic("status").notNull().default("draft"),date:hd("date").notNull(),validUntil:hd("valid_until"),total:hN("total",{precision:10,scale:2}).notNull().default("0"),createdAt:il("created_at").defaultNow().notNull(),updatedAt:il("updated_at").defaultNow().notNull()}),j$=iI("devis_items",{id:ic("id").primaryKey(),devisId:ic("devis_id").notNull().references(()=>jZ.id,{onDelete:"cascade"}),description:ic("description").notNull(),quantity:hN("quantity",{precision:10,scale:2}).notNull().default("1"),price:hN("price",{precision:10,scale:2}).notNull().default("0"),total:hN("total",{precision:10,scale:2}).notNull().default("0")}),j_=iI("factures",{id:ic("id").primaryKey(),userId:ic("user_id").notNull().references(()=>jS.id),clientId:ic("client_id").notNull().references(()=>jY.id),devisId:ic("devis_id").references(()=>jZ.id),stripeInvoiceId:ic("stripe_invoice_id").unique(),stripeCustomerId:ic("stripe_customer_id"),stripeAccountId:ic("stripe_account_id").references(()=>j3.id),number:ic("number").notNull(),status:ic("status").notNull().default("pending"),date:hd("date").notNull(),dueDate:hd("due_date"),total:hN("total",{precision:10,scale:2}).notNull().default("0"),createdAt:il("created_at").defaultNow().notNull(),updatedAt:il("updated_at").defaultNow().notNull()}),j0=iI("factures_items",{id:ic("id").primaryKey(),factureId:ic("facture_id").notNull().references(()=>j_.id,{onDelete:"cascade"}),description:ic("description").notNull(),quantity:hN("quantity",{precision:10,scale:2}).notNull().default("1"),price:hN("price",{precision:10,scale:2}).notNull().default("0"),total:hN("total",{precision:10,scale:2}).notNull().default("0")}),j1=iI("recettes",{id:ic("id").primaryKey(),userId:ic("user_id").notNull().references(()=>jS.id),factureId:ic("facture_id").references(()=>j_.id),clientId:ic("client_id").references(()=>jY.id),amount:hN("amount",{precision:10,scale:2}).notNull(),date:hd("date").notNull(),paymentMethod:ic("payment_method"),createdAt:il("created_at").defaultNow().notNull()}),j2=iI("settings",{id:ic("id").primaryKey(),userId:ic("user_id").notNull().references(()=>jS.id).unique(),companyName:ic("company_name"),siret:ic("siret"),address:ic("address"),email:ic("email"),logoUrl:ic("logo_url"),legalMentions:ic("legal_mentions"),createdAt:il("created_at").defaultNow().notNull(),updatedAt:il("updated_at").defaultNow().notNull()}),j3=iI("stripe_accounts",{id:ic("id").primaryKey(),userId:ic("user_id").notNull().references(()=>jS.id,{onDelete:"cascade"}),name:ic("name").notNull(),description:ic("description"),stripeAccountId:ic("stripe_account_id"),apiKey:ic("api_key").notNull(),webhookSecret:ic("webhook_secret"),isActive:g$("is_active").default(!0).notNull(),lastSyncAt:il("last_sync_at"),createdAt:il("created_at").defaultNow().notNull(),updatedAt:il("updated_at").defaultNow().notNull()}),j4=iI("products",{id:ic("id").primaryKey(),userId:ic("user_id").notNull().references(()=>jS.id,{onDelete:"cascade"}),stripeAccountId:ic("stripe_account_id").notNull().references(()=>j3.id,{onDelete:"cascade"}),stripeProductId:ic("stripe_product_id").notNull(),stripePriceId:ic("stripe_price_id"),name:ic("name").notNull(),description:ic("description"),price:hN("price",{precision:10,scale:2}),currency:ic("currency").default("EUR").notNull(),isRecurring:g$("is_recurring").default(!1).notNull(),billingPeriod:ic("billing_period"),isActive:g$("is_active").default(!0).notNull(),metadata:ic("metadata"),createdAt:il("created_at").defaultNow().notNull(),updatedAt:il("updated_at").defaultNow().notNull()}),j5=iI("subscriptions",{id:ic("id").primaryKey(),userId:ic("user_id").notNull().references(()=>jS.id,{onDelete:"cascade"}),stripeAccountId:ic("stripe_account_id").notNull().references(()=>j3.id,{onDelete:"cascade"}),clientId:ic("client_id").references(()=>jY.id,{onDelete:"set null"}),productId:ic("product_id").references(()=>j4.id,{onDelete:"set null"}),stripeSubscriptionId:ic("stripe_subscription_id").notNull().unique(),stripeCustomerId:ic("stripe_customer_id"),status:ic("status").notNull(),currentPeriodStart:il("current_period_start"),currentPeriodEnd:il("current_period_end"),cancelAtPeriodEnd:g$("cancel_at_period_end").default(!1).notNull(),canceledAt:il("canceled_at"),amount:hN("amount",{precision:10,scale:2}),currency:ic("currency").default("EUR"),metadata:ic("metadata"),createdAt:il("created_at").defaultNow().notNull(),updatedAt:il("updated_at").defaultNow().notNull()}),j6=iI("stripe_events",{id:ic("id").primaryKey(),stripeAccountId:ic("stripe_account_id").references(()=>j3.id,{onDelete:"cascade"}),stripeEventId:ic("stripe_event_id").notNull().unique(),eventType:ic("event_type").notNull(),processed:g$("processed").default(!1).notNull(),error:ic("error"),payload:ic("payload"),createdAt:il("created_at").defaultNow().notNull()}),j7=iI("monthly_analytics",{id:h3("id").notNull().unique(),accountId:is("account_id").notNull().references(()=>j3.id,{onDelete:"cascade"}),monthKey:is("month_key",{length:7}).notNull(),startingMRR:h0("starting_mrr").notNull(),endingMRR:h0("ending_mrr").notNull(),newMRR:h0("new_mrr").notNull(),churnedMRR:h0("churned_mrr").notNull(),startingCustomers:hm("starting_customers").notNull(),endingCustomers:hm("ending_customers").notNull(),newCustomers:hm("new_customers").notNull(),churnedCustomers:hm("churned_customers").notNull(),customerChurnRate:h0("customer_churn_rate").notNull(),createdAt:il("created_at").defaultNow().notNull(),updatedAt:il("updated_at").defaultNow().notNull()},a=>({pk:function(...a){return a[0].columns?new iP(a[0].columns,a[0].name):new iP(a)}({columns:[a.accountId,a.monthKey]})})),j8=(l=({one:a})=>({stripeAccount:a(j3,{fields:[j7.accountId],references:[j3.id]})}),new i$(j7,a=>Object.fromEntries(Object.entries(l(a)).map(([a,b])=>[a,b.withFieldName(a)]))));a.s(["clients",0,jY,"devis",0,jZ,"devisItems",0,j$,"factures",0,j_,"facturesItems",0,j0,"monthlyAnalytics",0,j7,"monthlyAnalyticsRelations",0,j8,"products",0,j4,"recettes",0,j1,"settings",0,j2,"stripeAccounts",0,j3,"stripeEvents",0,j6,"subscriptions",0,j5],28176);var j9=a.i(28176),ka=a.i(43476);let kb=process.env.DATABASE_URL;if(!kb)throw Error("Missing DATABASE_URL environment variable");let kc=jR(gj(kb.split("?")[0]),{schema:{...j9,...ka}}),kd=((a,b)=>{let c=b(a),{api:d}=cs(c,a);return{handler:async b=>{let d=await c,e=d.options.basePath||"/api/auth";if(!d.options.baseURL){let a=ak(void 0,e,b,void 0,d.options.advanced?.trustedProxyHeaders);if(a)d.baseURL=a,d.options.baseURL=al(d.baseURL)||void 0;else throw new _.BetterAuthError("Could not get base URL from request. Please provide a valid base URL.")}d.trustedOrigins=[...a.trustedOrigins?Array.isArray(a.trustedOrigins)?a.trustedOrigins:await a.trustedOrigins(b):[],d.options.baseURL];let{handler:f}=((a,b)=>{let{api:c,middlewares:d}=cs(a,b),e=new URL(a.baseURL).pathname;return(0,I.createRouter)(c,{routerContext:a,openapi:{disabled:!0},basePath:e,routerMiddleware:[{path:"/**",middleware:bU},...d],allowedMediaTypes:["application/json"],async onRequest(b){let c=a.options.disabledPaths||[],d=new URL(b.url).pathname.replace(e,"");if(c.includes(d))return new Response("Not Found",{status:404});for(let c of a.options.plugins||[])if(c.onRequest){let d=await c.onRequest(b,a);if(d&&"response"in d)return d.response;if(d&&"request"in d){let b=await bX(d.request,a);if(b)return b;return d.request}}return bX(b,a)},async onResponse(b){for(let c of a.options.plugins||[])if(c.onResponse){let d=await c.onResponse(b,a);if(d)return d.response}return b},onError(c){if(c instanceof I.APIError&&"FOUND"===c.status)return;if(b.onAPIError?.throw)throw c;if(b.onAPIError?.onError)return void b.onAPIError.onError(c,a);let d=b.logger?.level,e="error"===d||"warn"===d||"debug"===d?$.logger:void 0;if(b.logger?.disabled!==!0){if(c&&"object"==typeof c&&"message"in c&&"string"==typeof c.message&&(c.message.includes("no column")||c.message.includes("column")||c.message.includes("relation")||c.message.includes("table")||c.message.includes("does not exist")))return void a.logger?.error(c.message);c instanceof I.APIError?("INTERNAL_SERVER_ERROR"===c.status&&a.logger.error(c.status,c),e?.error(c.message)):a.logger?.error(c&&"object"==typeof c&&"name"in c?c.name:"",c)}}})})(d,a);return(0,cu.r)(d.adapter,()=>f(b))},api:d,options:a,$context:c,$ERROR_CODES:{...a.plugins?.reduce((a,b)=>b.$ERROR_CODES?{...a,...b.$ERROR_CODES}:a,{}),...aJ.n}}})({appName:"Solopreneur Tool",database:(m={provider:"pg",schema:jX},h=null,i=a=>({getFieldName:b,options:c})=>{function d(b){let c=m.schema||a._.fullSchema;if(!c)throw new _.BetterAuthError("Drizzle adapter failed to initialize. Schema not found. Please provide a schema object in the adapter options object.");let d=c[b];if(!d)throw new _.BetterAuthError(`[# Drizzle Adapter]: The model "${b}" was not found in the schema object. Please pass the schema directly to the adapter options.`);return d}let e=async(b,c,e,g)=>{if("mysql"!==m.provider)return(await c.returning())[0];await c.execute();let h=d(b),i=c.config?.values;if(g?.length){let c=f(g.map(a=>void 0!==e[a.field]?{...a,value:e[a.field]}:a),b);return(await a.select().from(h).where(...c))[0]}if(i&&i[0]?.id?.value){let b=i[0]?.id?.value;return b||(b=(await a.select({id:dK`LAST_INSERT_ID()`}).from(h).orderBy(ec(h.id)).limit(1))[0].id),(await a.select().from(h).where(dS(h.id,b)).limit(1).execute())[0]}if(e.id)return(await a.select().from(h).where(dS(h.id,e.id)).limit(1).execute())[0];if(!("id"in h))throw new _.BetterAuthError(`The model "${b}" does not have an "id" field. Please use the "id" field as your primary key.`);return(await a.select().from(h).orderBy(ec(h.id)).limit(1).execute())[0]};function f(a,c){let e=d(c);if(!a)return[];if(1===a.length){let d=a[0];if(!d)return[];let f=b({model:c,field:d.field});if(!e[f])throw new _.BetterAuthError(`The field "${d.field}" does not exist in the schema for the model "${c}". Please update your schema.`);if("in"===d.operator){if(!Array.isArray(d.value))throw new _.BetterAuthError(`The value for the field "${d.field}" must be an array when using the "in" operator.`);return[d_(e[f],d.value)]}if("not_in"===d.operator){if(!Array.isArray(d.value))throw new _.BetterAuthError(`The value for the field "${d.field}" must be an array when using the "not_in" operator.`);return[d0(e[f],d.value)]}return"contains"===d.operator?[d7(e[f],`%${d.value}%`)]:"starts_with"===d.operator?[d7(e[f],`${d.value}%`)]:"ends_with"===d.operator?[d7(e[f],`%${d.value}`)]:"lt"===d.operator?[dZ(e[f],d.value)]:"lte"===d.operator?[d$(e[f],d.value)]:"ne"===d.operator?[dT(e[f],d.value)]:"gt"===d.operator?[dX(e[f],d.value)]:"gte"===d.operator?[dY(e[f],d.value)]:[dS(e[f],d.value)]}let f=a.filter(a=>"AND"===a.connector||!a.connector),g=a.filter(a=>"OR"===a.connector),h=dU(...f.map(a=>{let d=b({model:c,field:a.field});if("in"===a.operator){if(!Array.isArray(a.value))throw new _.BetterAuthError(`The value for the field "${a.field}" must be an array when using the "in" operator.`);return d_(e[d],a.value)}if("not_in"===a.operator){if(!Array.isArray(a.value))throw new _.BetterAuthError(`The value for the field "${a.field}" must be an array when using the "not_in" operator.`);return d0(e[d],a.value)}return"contains"===a.operator?d7(e[d],`%${a.value}%`):"starts_with"===a.operator?d7(e[d],`${a.value}%`):"ends_with"===a.operator?d7(e[d],`%${a.value}`):"lt"===a.operator?dZ(e[d],a.value):"lte"===a.operator?d$(e[d],a.value):"gt"===a.operator?dX(e[d],a.value):"gte"===a.operator?dY(e[d],a.value):"ne"===a.operator?dT(e[d],a.value):dS(e[d],a.value)})),i=dV(...g.map(a=>{let d=b({model:c,field:a.field});if("in"===a.operator){if(!Array.isArray(a.value))throw new _.BetterAuthError(`The value for the field "${a.field}" must be an array when using the "in" operator.`);return d_(e[d],a.value)}if("not_in"===a.operator){if(!Array.isArray(a.value))throw new _.BetterAuthError(`The value for the field "${a.field}" must be an array when using the "not_in" operator.`);return d0(e[d],a.value)}return"contains"===a.operator?d7(e[d],`%${a.value}%`):"starts_with"===a.operator?d7(e[d],`${a.value}%`):"ends_with"===a.operator?d7(e[d],`%${a.value}`):"lt"===a.operator?dZ(e[d],a.value):"lte"===a.operator?d$(e[d],a.value):"gt"===a.operator?dX(e[d],a.value):"gte"===a.operator?dY(e[d],a.value):"ne"===a.operator?dT(e[d],a.value):dS(e[d],a.value)})),j=[];return f.length&&j.push(h),g.length&&j.push(i),j}return{async create({model:b,data:c}){let f=d(b);if(!f)throw new _.BetterAuthError("Drizzle adapter failed to initialize. Drizzle Schema not found. Please provide a schema object in the adapter options object.");for(let a in c)if(!f[a])throw new _.BetterAuthError(`The field "${a}" does not exist in the "${b}" Drizzle schema. Please update your drizzle schema or re-generate using "npx @better-auth/cli@latest generate".`);return await e(b,a.insert(f).values(c),c)},async findOne({model:b,where:e,join:g}){let h=d(b),i=f(e,b);if(c.experimental?.joins)if(a.query&&a.query[b]){let d,e=[];if(g)for(let[a,b]of(d={},Object.entries(g))){let f=b.limit??c.advanced?.database?.defaultFindManyLimit??100,g="one-to-one"===b.relation,h=g||m.usePlural?"":"s";d[`${a}${h}`]=!!g||{limit:f},g||e.push(`${a}${h}`)}let f=await a.query[b].findFirst({where:i[0],with:d});if(f)for(let a of e){let b=m.usePlural?a:a.slice(0,-1);f[b]=f[a],a!==b&&delete f[a]}return f}else $.logger.error(`[# Drizzle Adapter]: The model "${b}" was not found in the query object. Please update your Drizzle schema to include relations or re-generate using "npx @better-auth/cli@latest generate".`),$.logger.info("Falling back to regular query");let j=await a.select().from(h).where(...i);return j.length?j[0]:null},async findMany({model:e,where:g,sortBy:h,limit:i,offset:j,join:k}){let l=d(e),n=g?f(g,e):[],o=h?.direction==="desc"?ec:eb;if(c.experimental?.joins)if(a.query[e]){let d,f,g=[];if(k)for(let[a,b]of(d={},Object.entries(k))){let e="one-to-one"===b.relation,f=b.limit??c.advanced?.database?.defaultFindManyLimit??100,h=e||m.usePlural?"":"s";d[`${a}${h}`]=!!e||{limit:f},e||g.push(`${a}${h}`)}h?.field&&(f=[o(l[b({model:e,field:h?.field})])]);let p=await a.query[e].findMany({where:n[0],with:d,limit:i??100,offset:j??0,orderBy:f});if(p)for(let a of p)for(let b of g){let c=m.usePlural?b:b.slice(0,-1);c!==b&&(a[c]=a[b],delete a[b])}return p}else $.logger.error(`[# Drizzle Adapter]: The model "${e}" was not found in the query object. Please update your Drizzle schema to include relations or re-generate using "npx @better-auth/cli@latest generate".`),$.logger.info("Falling back to regular query");let p=a.select().from(l);return void 0!==i&&(p=p.limit(i)),void 0!==j&&(p=p.offset(j)),h?.field&&(p=p.orderBy(o(l[b({model:e,field:h?.field})]))),await p.where(...n)},async count({model:b,where:c}){let e=d(b),g=c?f(c,b):[];return(await a.select({count:dK`count(${dK.raw("*")})`.mapWith(Number)}).from(e).where(...g))[0].count},async update({model:b,where:c,update:g}){let h=d(b),i=f(c,b);return await e(b,a.update(h).set(g).where(...i),g,c)},async updateMany({model:b,where:c,update:e}){let g=d(b),h=f(c,b);return await a.update(g).set(e).where(...h)},async delete({model:b,where:c}){let e=d(b),g=f(c,b);return await a.delete(e).where(...g)},async deleteMany({model:b,where:c}){let e=d(b),g=f(c,b),h=await a.delete(e).where(...g),i=0;return h&&"rowCount"in h?i=h.rowCount:Array.isArray(h)?i=h.length:h&&("affectedRows"in h||"rowsAffected"in h||"changes"in h)&&(i=h.affectedRows??h.rowsAffected??h.changes),"number"!=typeof i&&$.logger.error("[Drizzle Adapter] The result of the deleteMany operation is not a number. This is likely a bug in the adapter. Please report this issue to the Better Auth team.",{res:h,model:b,where:c}),i},options:m}},j=null,j={config:{adapterId:"drizzle",adapterName:"Drizzle Adapter",usePlural:m.usePlural??!1,debugLogs:m.debugLogs??!1,supportsUUIDs:"pg"===m.provider,transaction:!!m.transaction&&(a=>kc.transaction(b=>a((0,c$.t)({config:j.config,adapter:i(b)})(h))))},adapter:i(kc)},k=(0,c$.t)(j),a=>(h=a,k(a))),trustedOrigins:["http://localhost:3000","http://localhost:8081","http://localhost:19006","https://solopreneur.sethylaleye.com"],emailAndPassword:{enabled:!0},plugins:[{id:"next-cookies",hooks:{after:[{matcher:a=>!0,handler:aM(async b=>{let c=b.context.responseHeaders;if((!("_flag"in b)||"router"!==b._flag)&&c instanceof Headers){let b,d,e=c?.get("set-cookie");if(!e)return;let f=(d=new Map,e.split(", ").forEach(a=>{let[b,...c]=a.split(";").map(a=>a.trim()),[e,...f]=(b||"").split("="),g=f.join("=");if(!e||void 0===g)return;let h={value:g};c.forEach(a=>{let[b,...c]=a.split("="),d=c.join("="),e=b.trim().toLowerCase();switch(e){case"max-age":h["max-age"]=d?parseInt(d.trim(),10):void 0;break;case"expires":h.expires=d?new Date(d.trim()):void 0;break;case"domain":h.domain=d?d.trim():void 0;break;case"path":h.path=d?d.trim():void 0;break;case"secure":h.secure=!0;break;case"httponly":h.httponly=!0;break;case"samesite":h.samesite=d?d.trim().toLowerCase():void 0;break;default:h[e]=!d||d.trim()}}),d.set(e,h)}),d),{cookies:g}=await a.A(43877);try{b=await g()}catch(a){if(a instanceof Error&&a.message.startsWith("`cookies` was called outside a request scope."))return;throw a}f.forEach((a,c)=>{if(!c)return;let d={sameSite:a.samesite,secure:a.secure,maxAge:a["max-age"],httpOnly:a.httponly,domain:a.domain,path:a.path};try{b.set(c,decodeURIComponent(a.value),d)}catch(a){}});return}})}]}}]},cY);var ke=a.i(28396),kf=a.i(6205);let kg=[{title:"Dashboard",url:"/dashboard",icon:w},{title:"Clients",url:"/dashboard/clients",icon:x},{title:"Devis",url:"/dashboard/devis",icon:C},{title:"Factures",url:"/dashboard/factures",icon:B},{title:"Livres Recettes",url:"/dashboard/recettes",icon:z},{title:"Stripe",url:"/dashboard/stripe",icon:A},{title:"Paramtres",url:"/dashboard/settings",icon:y}];async function kh(){let a=await kd.api.getSession({headers:await (0,ke.headers)()}),b=await kc.select().from(j2).where(dS(j2.userId,a?.user.id)),c=a?.user;return(0,p.jsxs)(D.Sidebar,{children:[(0,p.jsx)(D.SidebarHeader,{className:"border-b border-sidebar-border p-4 h-16",children:(0,p.jsxs)("div",{className:"flex items-center gap-2",children:[(0,p.jsx)("div",{className:"flex h-8 w-8 items-center justify-center rounded-lg bg-primary text-primary-foreground",children:(0,p.jsx)(A,{className:"h-4 w-4"})}),(0,p.jsxs)("div",{className:"flex flex-col",children:[(0,p.jsx)("span",{className:"text-sm font-semibold",children:b[0]?.companyName}),(0,p.jsx)("span",{className:"text-xs text-muted-foreground",children:c?.name})]})]})}),(0,p.jsx)(D.SidebarContent,{children:(0,p.jsxs)(D.SidebarGroup,{children:[(0,p.jsx)(D.SidebarGroupLabel,{children:"Navigation"}),(0,p.jsx)(D.SidebarGroupContent,{children:(0,p.jsx)(D.SidebarMenu,{children:kg.map(a=>(0,p.jsx)(D.SidebarMenuItem,{children:(0,p.jsx)(D.SidebarMenuButton,{asChild:!0,children:(0,p.jsxs)(E.default,{href:a.url,children:[(0,p.jsx)(a.icon,{}),(0,p.jsx)("span",{children:a.title})]})})},a.title))})})]})}),(0,p.jsxs)(D.SidebarFooter,{className:"border-t border-sidebar-border p-4",children:[c&&(0,p.jsx)(kf.SidebarUserNav,{user:c,company:b[0]}),(0,p.jsx)("div",{className:"text-xs text-muted-foreground",children:" 2024 Micro-Entrepreneur"})]})]})}function ki({children:a}){return(0,p.jsxs)(D.SidebarProvider,{children:[(0,p.jsx)(kh,{}),(0,p.jsx)("main",{className:"flex flex-1 flex-col gap-4 p-4 lg:gap-6 lg:p-6",children:a})]})}a.s(["default",()=>ki],20050)}];

//# sourceMappingURL=Documents_Code_solopreneur-tool_f95771fd._.js.map